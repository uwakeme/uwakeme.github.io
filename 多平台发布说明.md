# Hexo博客多平台发布系统

这个系统允许你在更新个人Hexo博客的同时，自动或半自动地将文章同步发布到其他平台，如公众号、博客园、CSDN等。

## 系统组成

1. `scripts/multi-platform-publisher.js` - 核心发布脚本
2. `scripts/wechat-helper.js` - 微信公众号内容格式化辅助脚本
3. `publish-config.json` - 平台配置文件
4. `publish_all.sh` - 一键发布脚本

## 配置说明

### 1. 安装依赖

首先需要安装必要的NPM包：

```bash
npm install axios gray-matter turndown puppeteer --save
```

或者直接运行：

```bash
npm install
```

### 2. 平台配置

编辑 `publish-config.json` 文件，填入各平台的账号信息：

```json
{
  "platforms": {
    "csdn": {
      "enabled": true,
      "username": "YOUR_CSDN_USERNAME",
      "password": "YOUR_CSDN_PASSWORD"
    },
    "cnblogs": {
      "enabled": true,
      "username": "YOUR_CNBLOGS_USERNAME",
      "token": "YOUR_CNBLOGS_TOKEN",
      "blogId": "YOUR_BLOG_ID"
    },
    // 其他平台配置...
  }
}
```

> 注意：请将文件中的占位符替换为实际的账号信息。

### 3. 在Windows系统中使用

在Windows系统中，如果使用PowerShell，需要修改脚本执行权限：

```powershell
# 运行发布脚本
./publish_all.sh my-post.md
```

## 使用方法

### 基本流程

1. 编写并发布Hexo博客文章
2. 使用多平台发布脚本将内容同步到其他平台

### 命令说明

#### 完整发布流程

```bash
./publish_all.sh 文章文件名.md
```

这个命令会：
1. 生成博客静态文件
2. 部署到GitHub Pages
3. 将文章发布到已配置的其他平台

#### 仅发布到其他平台

```bash
npm run publish -- 文章文件名.md
```

#### 准备微信公众号文章

```bash
npm run wechat -- 文章文件名.md
```

这个命令会生成一个适合微信公众号的版本，并自动打开文件供你复制内容。

## 支持的平台

目前支持的平台包括：

1. CSDN
2. 博客园 (CNBlogs)
3. 简书
4. 掘金
5. 微信公众号 (半自动，需手动操作)

## 日志与排查问题

### 日志系统

发布系统集成了完善的日志记录功能：

1. **控制台日志**：发布过程中会在控制台实时显示彩色的操作日志
2. **日志文件**：所有日志会自动保存到 `logs/publish-YYYY-MM-DD.log` 文件中
3. **浏览器截图**：每个关键步骤会自动保存浏览器截图到 `logs/` 目录，便于排查问题
4. **发布报告**：每次发布完成后会生成一个发布报告，保存在 `temp/reports/` 目录

### 查看日志

```bash
# 查看最新的日志文件
cat logs/publish-$(date +%Y-%m-%d).log

# 或者打开日志目录
open logs/
```

### 常见错误排查

如果发布过程中遇到问题，您可以：

1. 查看控制台输出，了解基本错误信息
2. 查看日志文件中的详细错误信息和堆栈跟踪
3. 查看浏览器截图，了解错误发生时的界面状态
4. 查看发布报告，了解整体发布结果

最常见的错误是平台登录失败或界面选择器变化，您可以根据日志和截图进行调整。

## 常见问题

### Q: 发布失败怎么办？

A: 检查配置文件中的账号信息是否正确，以及平台的选择器是否发生变化。查看日志文件和浏览器截图，了解具体失败原因。可能需要更新脚本中的选择器。

### Q: 为什么微信公众号不能自动发布？

A: 微信公众号没有开放API，且有较为严格的登录验证机制，所以只提供了内容格式化功能，需要手动登录并粘贴发布。

### Q: 如何添加新的平台支持？

A: 在 `multi-platform-publisher.js` 中添加新的平台发布函数，并在 `publish-config.json` 中添加相应的配置项。

### Q: 如何处理登录验证码问题？

A: 对于需要验证码的平台，可以通过配置 Puppeteer 以非无头模式运行，或者使用已登录的 Cookie。脚本会保存登录页面截图，方便您查看验证码情况。

## 贡献与改进

如有建议或发现问题，欢迎提交Issue或Pull Request。 