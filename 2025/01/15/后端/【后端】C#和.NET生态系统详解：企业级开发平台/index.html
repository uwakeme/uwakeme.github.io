<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【后端】C#和.NET生态系统详解：企业级开发平台 | Uwakeme</title><meta name="author" content="Wake"><meta name="copyright" content="Wake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="全面解析C#和.NET生态系统，包括.NET Core、ASP.NET Core、微服务架构、企业级开发最佳实践，为开发者提供完整的.NET技术栈指南">
<meta property="og:type" content="article">
<meta property="og:title" content="【后端】C#和.NET生态系统详解：企业级开发平台">
<meta property="og:url" content="https://hexo.blog.uwakeme.tech/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91C#%E5%92%8C.NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/index.html">
<meta property="og:site_name" content="Uwakeme">
<meta property="og:description" content="全面解析C#和.NET生态系统，包括.NET Core、ASP.NET Core、微服务架构、企业级开发最佳实践，为开发者提供完整的.NET技术栈指南">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2025-01-14T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-15T08:48:25.191Z">
<meta property="article:author" content="Wake">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="微服务">
<meta property="article:tag" content="C#">
<meta property="article:tag" content=".NET">
<meta property="article:tag" content="ASP.NET Core">
<meta property="article:tag" content="企业级开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【后端】C#和.NET生态系统详解：企业级开发平台",
  "url": "https://hexo.blog.uwakeme.tech/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91C#%E5%92%8C.NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/",
  "image": "https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png",
  "datePublished": "2025-01-14T16:00:00.000Z",
  "dateModified": "2026-01-15T08:48:25.191Z",
  "author": [
    {
      "@type": "Person",
      "name": "Wake",
      "url": "https://hexo.blog.uwakeme.tech/about/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/avatar.jpeg"><link rel="canonical" href="https://hexo.blog.uwakeme.tech/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91C#%E5%92%8C.NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f96f39b60e7cc4fbcbd971a88f91f326";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/local-search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【后端】C#和.NET生态系统详解：企业级开发平台',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css"></noscript></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">252</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">688</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Uwakeme</span></a><a class="nav-page-title" href="/"><span class="site-name">【后端】C#和.NET生态系统详解：企业级开发平台</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【后端】C#和.NET生态系统详解：企业级开发平台</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-14T16:00:00.000Z" title="发表于 2025-01-15 00:00:00">2025-01-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-15T08:48:25.191Z" title="更新于 2026-01-15 16:48:25">2026-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91C#%E5%92%8C.NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;本文最后更新于&quot;,&quot;messageNext&quot;:&quot;天前，文中内容可能已过时，请谨慎参考。&quot;,&quot;postUpdate&quot;:&quot;2026-01-15 16:48:25&quot;}" hidden=""></div><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>C#和.NET生态系统作为微软公司推出的企业级开发平台，经历了从传统的Windows专属框架到现代跨平台开源框架的重大转变。随着.NET Core的推出和.NET 5/6/7/8的持续演进，.NET已经成为构建现代云原生应用、微服务架构和高性能Web应用的重要选择。</p>
<p>本文将全面解析C#和.NET生态系统的核心特性、技术架构、开发实践和应用场景，帮助开发者深入理解这个强大的企业级开发平台。</p>
<blockquote>
<p><strong>相关文章导航</strong>：</p>
<ul>
<li><a href="./%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%85%A8%E6%99%AF%E5%9B%BE%EF%BC%9A%E7%8E%B0%E4%BB%A3%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF%E6%A0%88%E8%AF%A6%E8%A7%A3.md">后端框架全景图：现代服务端开发技术栈详解</a></li>
<li><a href="./%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91Spring%20Boot%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7Java%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6.md">Spring Boot详解：企业级Java开发框架</a></li>
<li><a href="../Node.js/%E3%80%90Node.js%E3%80%91Node.js%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1.md">Node.js深度解析：构建高性能的后端服务</a></li>
</ul>
</blockquote>
<h1 id="本文内容概览"><a href="#本文内容概览" class="headerlink" title="本文内容概览"></a>本文内容概览</h1><ul>
<li><strong>.NET平台发展历程</strong>：从.NET Framework到.NET Core的演进</li>
<li><strong>核心技术架构</strong>：CLR、BCL、语言特性深度解析</li>
<li><strong>ASP.NET Core详解</strong>：现代Web开发框架</li>
<li><strong>微服务架构实践</strong>：.NET微服务生态系统</li>
<li><strong>企业级开发特性</strong>：安全、性能、可扩展性</li>
<li><strong>开发工具生态</strong>：Visual Studio、开发体验</li>
<li><strong>实际应用案例</strong>：企业级项目实战</li>
</ul>
<h1 id="一、-NET平台发展历程"><a href="#一、-NET平台发展历程" class="headerlink" title="一、.NET平台发展历程"></a>一、.NET平台发展历程</h1><h2 id="（一）技术演进阶段"><a href="#（一）技术演进阶段" class="headerlink" title="（一）技术演进阶段"></a>（一）技术演进阶段</h2><h3 id="1-NET-Framework时代（2002-2016）"><a href="#1-NET-Framework时代（2002-2016）" class="headerlink" title="1. .NET Framework时代（2002-2016）"></a>1. .NET Framework时代（2002-2016）</h3><ul>
<li><strong>特点</strong>：Windows专属，企业级应用首选 <mcreference link="https://blog.csdn.net/weixin_55959870/article/details/122474430" index="1">1</mcreference></li>
<li><strong>核心组件</strong>：CLR、BCL、ASP.NET、WinForms、WPF</li>
<li><strong>优势</strong>：成熟稳定，企业级特性完善</li>
<li><strong>局限</strong>：平台绑定，部署复杂</li>
</ul>
<h3 id="2-NET-Core时代（2016-2020）"><a href="#2-NET-Core时代（2016-2020）" class="headerlink" title="2. .NET Core时代（2016-2020）"></a>2. .NET Core时代（2016-2020）</h3><ul>
<li><strong>特点</strong>：跨平台、开源、高性能 <mcreference link="https://blog.csdn.net/weixin_55959870/article/details/122474430" index="1">1</mcreference></li>
<li><strong>核心特性</strong>：<ul>
<li>跨平台支持（Windows、macOS、Linux）</li>
<li>模块化架构</li>
<li>容器化友好</li>
<li>云原生设计</li>
</ul>
</li>
</ul>
<h3 id="3-NET-5-统一时代（2020-至今）"><a href="#3-NET-5-统一时代（2020-至今）" class="headerlink" title="3. .NET 5+统一时代（2020-至今）"></a>3. .NET 5+统一时代（2020-至今）</h3><ul>
<li><strong>特点</strong>：统一的.NET平台，一个框架支持所有应用类型</li>
<li><strong>版本演进</strong>：.NET 5 → .NET 6 → .NET 7 → .NET 8</li>
<li><strong>核心改进</strong>：性能提升、新语言特性、云原生优化</li>
</ul>
<h2 id="（二）平台特性对比"><a href="#（二）平台特性对比" class="headerlink" title="（二）平台特性对比"></a>（二）平台特性对比</h2><table>
<thead>
<tr>
<th>特性</th>
<th>.NET Framework</th>
<th>.NET Core/.NET 5+</th>
</tr>
</thead>
<tbody><tr>
<td>平台支持</td>
<td>Windows Only</td>
<td>跨平台</td>
</tr>
<tr>
<td>开源</td>
<td>部分开源</td>
<td>完全开源</td>
</tr>
<tr>
<td>部署方式</td>
<td>依赖系统安装</td>
<td>自包含部署</td>
</tr>
<tr>
<td>性能</td>
<td>良好</td>
<td>优秀</td>
</tr>
<tr>
<td>容器支持</td>
<td>有限</td>
<td>原生支持</td>
</tr>
<tr>
<td>微服务</td>
<td>支持</td>
<td>优化支持</td>
</tr>
</tbody></table>
<h1 id="二、-NET-Core平台深度解析"><a href="#二、-NET-Core平台深度解析" class="headerlink" title="二、.NET Core平台深度解析"></a>二、.NET Core平台深度解析</h1><h2 id="（一）核心架构组件"><a href="#（一）核心架构组件" class="headerlink" title="（一）核心架构组件"></a>（一）核心架构组件</h2><h3 id="1-NET-Core运行时"><a href="#1-NET-Core运行时" class="headerlink" title="1. .NET Core运行时"></a>1. .NET Core运行时</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .NET Core运行时提供的核心服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RuntimeServices</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 类型系统</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Type <span class="title">GetType</span>(<span class="params"><span class="built_in">string</span> typeName</span>)</span> { }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 程序集加载</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Assembly <span class="title">LoadAssembly</span>(<span class="params"><span class="built_in">string</span> assemblyPath</span>)</span> { }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 垃圾回收器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ForceGarbageCollection</span>()</span> </span><br><span class="line">    {</span><br><span class="line">        GC.Collect();</span><br><span class="line">        GC.WaitForPendingFinalizers();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 本机互操作</span></span><br><span class="line">    [<span class="meta">DllImport(<span class="string">"kernel32.dll"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">GetCurrentProcess</span>()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-基础类库（BCL）"><a href="#2-基础类库（BCL）" class="headerlink" title="2. 基础类库（BCL）"></a>2. 基础类库（BCL）</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础类库示例</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BCLExample</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 集合操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">List</span>&lt;<span class="title">T</span>&gt;&gt; <span class="title">ProcessDataAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params">IEnumerable&lt;T&gt; data</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> result = <span class="keyword">new</span> List&lt;T&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> data.ToAsyncEnumerable())</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 异步处理逻辑</span></span><br><span class="line">            result.Add(item);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 文件I/O操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">string</span>&gt; <span class="title">ReadFileAsync</span>(<span class="params"><span class="built_in">string</span> filePath</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> reader = <span class="keyword">new</span> StreamReader(filePath);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> reader.ReadToEndAsync();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）平台特性详解"><a href="#（二）平台特性详解" class="headerlink" title="（二）平台特性详解"></a>（二）平台特性详解</h2><h3 id="1-跨平台能力-1"><a href="#1-跨平台能力-1" class="headerlink" title="1. 跨平台能力 1"></a>1. 跨平台能力 <mcreference link="https://blog.csdn.net/weixin_55959870/article/details/122474430" index="1">1</mcreference></h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跨平台文件路径处理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CrossPlatformHelper</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetConfigPath</span>()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> Path.Combine(Environment.GetFolderPath(</span><br><span class="line">                Environment.SpecialFolder.ApplicationData), <span class="string">"MyApp"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RuntimeInformation.IsOSPlatform(OSPlatform.Linux))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> Path.Combine(Environment.GetEnvironmentVariable(<span class="string">"HOME"</span>), </span><br><span class="line">                <span class="string">".config"</span>, <span class="string">"myapp"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RuntimeInformation.IsOSPlatform(OSPlatform.OSX))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> Path.Combine(Environment.GetEnvironmentVariable(<span class="string">"HOME"</span>), </span><br><span class="line">                <span class="string">"Library"</span>, <span class="string">"Application Support"</span>, <span class="string">"MyApp"</span>);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> PlatformNotSupportedException();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-高性能特性"><a href="#2-高性能特性" class="headerlink" title="2. 高性能特性"></a>2. 高性能特性</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Span&lt;T&gt;和Memory&lt;T&gt;高性能操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighPerformanceOperations</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 零拷贝字符串操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ReadOnlySpan&lt;<span class="built_in">char</span>&gt; <span class="title">ExtractDomain</span>(<span class="params">ReadOnlySpan&lt;<span class="built_in">char</span>&gt; email</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> atIndex = email.IndexOf(<span class="string">'@'</span>);</span><br><span class="line">        <span class="keyword">return</span> atIndex &gt;= <span class="number">0</span> ? email.Slice(atIndex + <span class="number">1</span>) : ReadOnlySpan&lt;<span class="built_in">char</span>&gt;.Empty;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 高性能数组操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ProcessLargeArray</span>(<span class="params"><span class="built_in">int</span>[] data</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> span = data.AsSpan();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 并行处理</span></span><br><span class="line">        Parallel.For(<span class="number">0</span>, span.Length, i =&gt;</span><br><span class="line">        {</span><br><span class="line">            span[i] = span[i] * <span class="number">2</span>;</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3-依赖注入容器"><a href="#3-依赖注入容器" class="headerlink" title="3. 依赖注入容器"></a>3. 依赖注入容器</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内置依赖注入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DIExample</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 注册服务</span></span><br><span class="line">        services.AddScoped&lt;IUserService, UserService&gt;();</span><br><span class="line">        services.AddSingleton&lt;IConfiguration, Configuration&gt;();</span><br><span class="line">        services.AddTransient&lt;IEmailService, EmailService&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册泛型服务</span></span><br><span class="line">        services.AddScoped(<span class="keyword">typeof</span>(IRepository&lt;&gt;), <span class="keyword">typeof</span>(Repository&lt;&gt;));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserService</span></span><br><span class="line">{</span><br><span class="line">    <span class="function">Task&lt;User&gt; <span class="title">GetUserAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserService</span> : <span class="title">IUserService</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRepository&lt;User&gt; _userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;UserService&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserService</span>(<span class="params">IRepository&lt;User&gt; userRepository, </span></span></span><br><span class="line"><span class="params"><span class="function">                      ILogger&lt;UserService&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _userRepository = userRepository;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;User&gt; <span class="title">GetUserAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _logger.LogInformation(<span class="string">"Getting user with ID: {UserId}"</span>, id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> _userRepository.GetByIdAsync(id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="三、ASP-NET-Core-Web框架"><a href="#三、ASP-NET-Core-Web框架" class="headerlink" title="三、ASP.NET Core Web框架"></a>三、ASP.NET Core Web框架</h1><h2 id="（一）核心特性"><a href="#（一）核心特性" class="headerlink" title="（一）核心特性"></a>（一）核心特性</h2><h3 id="1-中间件管道-2"><a href="#1-中间件管道-2" class="headerlink" title="1. 中间件管道 2"></a>1. 中间件管道 <mcreference link="https://www.cnblogs.com/vipyoumay/p/7735750.html" index="2">2</mcreference></h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Startup.cs 中间件配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app, IWebHostEnvironment env</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">        {</span><br><span class="line">            app.UseDeveloperExceptionPage();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            app.UseExceptionHandler(<span class="string">"/Error"</span>);</span><br><span class="line">            app.UseHsts();</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        app.UseHttpsRedirection();</span><br><span class="line">        app.UseStaticFiles();</span><br><span class="line">        app.UseRouting();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义中间件</span></span><br><span class="line">        app.UseMiddleware&lt;RequestLoggingMiddleware&gt;();</span><br><span class="line">        </span><br><span class="line">        app.UseAuthentication();</span><br><span class="line">        app.UseAuthorization();</span><br><span class="line">        </span><br><span class="line">        app.UseEndpoints(endpoints =&gt;</span><br><span class="line">        {</span><br><span class="line">            endpoints.MapControllers();</span><br><span class="line">            endpoints.MapRazorPages();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义中间件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RequestLoggingMiddleware</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> RequestDelegate _next;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;RequestLoggingMiddleware&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RequestLoggingMiddleware</span>(<span class="params">RequestDelegate next, </span></span></span><br><span class="line"><span class="params"><span class="function">                                   ILogger&lt;RequestLoggingMiddleware&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _next = next;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">InvokeAsync</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> stopwatch = Stopwatch.StartNew();</span><br><span class="line">        </span><br><span class="line">        _logger.LogInformation(<span class="string">"Request started: {Method} {Path}"</span>, </span><br><span class="line">                              context.Request.Method, </span><br><span class="line">                              context.Request.Path);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> _next(context);</span><br><span class="line">        </span><br><span class="line">        stopwatch.Stop();</span><br><span class="line">        _logger.LogInformation(<span class="string">"Request completed in {ElapsedMs}ms"</span>, </span><br><span class="line">                              stopwatch.ElapsedMilliseconds);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-Web-API开发"><a href="#2-Web-API开发" class="headerlink" title="2. Web API开发"></a>2. Web API开发</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 现代Web API控制器</span></span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">"api/[controller]"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UsersController</span> : <span class="title">ControllerBase</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IUserService _userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IMapper _mapper;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UsersController</span>(<span class="params">IUserService userService, IMapper mapper</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _userService = userService;</span><br><span class="line">        _mapper = mapper;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取用户列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="pageIndex"&gt;</span>页码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="pageSize"&gt;</span>页大小<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>用户列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    [<span class="meta">ProducesResponseType(typeof(PagedResult&lt;UserDto&gt;), 200)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;PagedResult&lt;UserDto&gt;&gt;&gt; GetUsers(</span><br><span class="line">        [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageIndex = <span class="number">1</span>, </span><br><span class="line">        [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageSize = <span class="number">10</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> users = <span class="keyword">await</span> _userService.GetUsersAsync(pageIndex, pageSize);</span><br><span class="line">        <span class="keyword">var</span> userDtos = _mapper.Map&lt;PagedResult&lt;UserDto&gt;&gt;(users);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Ok(userDtos);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 根据ID获取用户</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="id"&gt;</span>用户ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>用户信息<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    [<span class="meta">HttpGet(<span class="string">"{id:int}"</span>)</span>]</span><br><span class="line">    [<span class="meta">ProducesResponseType(typeof(UserDto), 200)</span>]</span><br><span class="line">    [<span class="meta">ProducesResponseType(404)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;UserDto&gt;&gt; GetUser(<span class="built_in">int</span> id)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> user = <span class="keyword">await</span> _userService.GetUserAsync(id);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> NotFound();</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> userDto = _mapper.Map&lt;UserDto&gt;(user);</span><br><span class="line">        <span class="keyword">return</span> Ok(userDto);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建新用户</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="createUserDto"&gt;</span>用户创建信息<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>创建的用户信息<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    [<span class="meta">HttpPost</span>]</span><br><span class="line">    [<span class="meta">ProducesResponseType(typeof(UserDto), 201)</span>]</span><br><span class="line">    [<span class="meta">ProducesResponseType(400)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;UserDto&gt;&gt; CreateUser(</span><br><span class="line">        [<span class="meta">FromBody</span>] CreateUserDto createUserDto)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (!ModelState.IsValid)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> BadRequest(ModelState);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> user = _mapper.Map&lt;User&gt;(createUserDto);</span><br><span class="line">        <span class="keyword">var</span> createdUser = <span class="keyword">await</span> _userService.CreateUserAsync(user);</span><br><span class="line">        <span class="keyword">var</span> userDto = _mapper.Map&lt;UserDto&gt;(createdUser);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CreatedAtAction(<span class="keyword">nameof</span>(GetUser), </span><br><span class="line">                              <span class="keyword">new</span> { id = userDto.Id }, </span><br><span class="line">                              userDto);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// DTO类定义</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserDto</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Username { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Email { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> DateTime CreatedAt { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CreateUserDto</span></span><br><span class="line">{</span><br><span class="line">    [<span class="meta">Required</span>]</span><br><span class="line">    [<span class="meta">StringLength(50, MinimumLength = 3)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Username { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">Required</span>]</span><br><span class="line">    [<span class="meta">EmailAddress</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Email { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">Required</span>]</span><br><span class="line">    [<span class="meta">StringLength(100, MinimumLength = 6)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Password { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3-实时通信（SignalR）"><a href="#3-实时通信（SignalR）" class="headerlink" title="3. 实时通信（SignalR）"></a>3. 实时通信（SignalR）</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SignalR Hub</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ChatHub</span> : <span class="title">Hub</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IUserService _userService;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChatHub</span>(<span class="params">IUserService userService</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _userService = userService;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">JoinGroup</span>(<span class="params"><span class="built_in">string</span> groupName</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">await</span> Groups.AddToGroupAsync(Context.ConnectionId, groupName);</span><br><span class="line">        <span class="keyword">await</span> Clients.Group(groupName).SendAsync(<span class="string">"UserJoined"</span>, </span><br><span class="line">                                                Context.User.Identity.Name);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">SendMessageToGroup</span>(<span class="params"><span class="built_in">string</span> groupName, <span class="built_in">string</span> message</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> user = <span class="keyword">await</span> _userService.GetUserAsync(Context.User.Identity.Name);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> Clients.Group(groupName).SendAsync(<span class="string">"ReceiveMessage"</span>, </span><br><span class="line">                                                 user.Username, </span><br><span class="line">                                                 message, </span><br><span class="line">                                                 DateTime.UtcNow);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">async</span> Task <span class="title">OnDisconnectedAsync</span>(<span class="params">Exception exception</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 处理断开连接逻辑</span></span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">base</span>.OnDisconnectedAsync(exception);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端JavaScript代码</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">const connection = new signalR.HubConnectionBuilder()</span></span><br><span class="line"><span class="comment">    .withUrl("/chathub")</span></span><br><span class="line"><span class="comment">    .build();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">connection.start().then(function () {</span></span><br><span class="line"><span class="comment">    console.log("Connected to SignalR hub");</span></span><br><span class="line"><span class="comment">}).catch(function (err) {</span></span><br><span class="line"><span class="comment">    console.error(err.toString());</span></span><br><span class="line"><span class="comment">});</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">connection.on("ReceiveMessage", function (username, message, timestamp) {</span></span><br><span class="line"><span class="comment">    const messageElement = document.createElement("div");</span></span><br><span class="line"><span class="comment">    messageElement.innerHTML = `&lt;strong&gt;${username}&lt;/strong&gt;: ${message} &lt;small&gt;${timestamp}&lt;/small&gt;`;</span></span><br><span class="line"><span class="comment">    document.getElementById("messagesList").appendChild(messageElement);</span></span><br><span class="line"><span class="comment">});</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）企业级特性"><a href="#（二）企业级特性" class="headerlink" title="（二）企业级特性"></a>（二）企业级特性</h2><h3 id="1-身份认证与授权"><a href="#1-身份认证与授权" class="headerlink" title="1. 身份认证与授权"></a>1. 身份认证与授权</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JWT身份认证配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JwtAuthenticationService</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IConfiguration _configuration;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JwtAuthenticationService</span>(<span class="params">IConfiguration configuration</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _configuration = configuration;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureJwtAuthentication</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> jwtSettings = _configuration.GetSection(<span class="string">"JwtSettings"</span>);</span><br><span class="line">        <span class="keyword">var</span> secretKey = Encoding.ASCII.GetBytes(jwtSettings[<span class="string">"SecretKey"</span>]);</span><br><span class="line">        </span><br><span class="line">        services.AddAuthentication(options =&gt;</span><br><span class="line">        {</span><br><span class="line">            options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;</span><br><span class="line">            options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;</span><br><span class="line">        })</span><br><span class="line">        .AddJwtBearer(options =&gt;</span><br><span class="line">        {</span><br><span class="line">            options.RequireHttpsMetadata = <span class="literal">false</span>;</span><br><span class="line">            options.SaveToken = <span class="literal">true</span>;</span><br><span class="line">            options.TokenValidationParameters = <span class="keyword">new</span> TokenValidationParameters</span><br><span class="line">            {</span><br><span class="line">                ValidateIssuerSigningKey = <span class="literal">true</span>,</span><br><span class="line">                IssuerSigningKey = <span class="keyword">new</span> SymmetricSecurityKey(secretKey),</span><br><span class="line">                ValidateIssuer = <span class="literal">true</span>,</span><br><span class="line">                ValidIssuer = jwtSettings[<span class="string">"Issuer"</span>],</span><br><span class="line">                ValidateAudience = <span class="literal">true</span>,</span><br><span class="line">                ValidAudience = jwtSettings[<span class="string">"Audience"</span>],</span><br><span class="line">                ValidateLifetime = <span class="literal">true</span>,</span><br><span class="line">                ClockSkew = TimeSpan.Zero</span><br><span class="line">            };</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GenerateJwtToken</span>(<span class="params">User user</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> jwtSettings = _configuration.GetSection(<span class="string">"JwtSettings"</span>);</span><br><span class="line">        <span class="keyword">var</span> secretKey = Encoding.ASCII.GetBytes(jwtSettings[<span class="string">"SecretKey"</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> claims = <span class="keyword">new</span>[]</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">new</span> Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),</span><br><span class="line">            <span class="keyword">new</span> Claim(ClaimTypes.Name, user.Username),</span><br><span class="line">            <span class="keyword">new</span> Claim(ClaimTypes.Email, user.Email),</span><br><span class="line">            <span class="keyword">new</span> Claim(<span class="string">"role"</span>, user.Role)</span><br><span class="line">        };</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> tokenDescriptor = <span class="keyword">new</span> SecurityTokenDescriptor</span><br><span class="line">        {</span><br><span class="line">            Subject = <span class="keyword">new</span> ClaimsIdentity(claims),</span><br><span class="line">            Expires = DateTime.UtcNow.AddHours(<span class="number">24</span>),</span><br><span class="line">            Issuer = jwtSettings[<span class="string">"Issuer"</span>],</span><br><span class="line">            Audience = jwtSettings[<span class="string">"Audience"</span>],</span><br><span class="line">            SigningCredentials = <span class="keyword">new</span> SigningCredentials(</span><br><span class="line">                <span class="keyword">new</span> SymmetricSecurityKey(secretKey), </span><br><span class="line">                SecurityAlgorithms.HmacSha256Signature)</span><br><span class="line">        };</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> tokenHandler = <span class="keyword">new</span> JwtSecurityTokenHandler();</span><br><span class="line">        <span class="keyword">var</span> token = tokenHandler.CreateToken(tokenDescriptor);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> tokenHandler.WriteToken(token);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于策略的授权</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AuthorizationPolicies</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ConfigurePolicies</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">    {</span><br><span class="line">        services.AddAuthorization(options =&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 管理员策略</span></span><br><span class="line">            options.AddPolicy(<span class="string">"AdminOnly"</span>, policy =&gt;</span><br><span class="line">                policy.RequireRole(<span class="string">"Admin"</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 年龄要求策略</span></span><br><span class="line">            options.AddPolicy(<span class="string">"MinimumAge"</span>, policy =&gt;</span><br><span class="line">                policy.Requirements.Add(<span class="keyword">new</span> MinimumAgeRequirement(<span class="number">18</span>)));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 复合策略</span></span><br><span class="line">            options.AddPolicy(<span class="string">"AdminOrOwner"</span>, policy =&gt;</span><br><span class="line">                policy.RequireAssertion(context =&gt;</span><br><span class="line">                    context.User.IsInRole(<span class="string">"Admin"</span>) ||</span><br><span class="line">                    context.User.HasClaim(<span class="string">"UserId"</span>, </span><br><span class="line">                        context.Resource?.ToString())));</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        services.AddScoped&lt;IAuthorizationHandler, MinimumAgeHandler&gt;();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义授权要求</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MinimumAgeRequirement</span> : <span class="title">IAuthorizationRequirement</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MinimumAge { <span class="keyword">get</span>; }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinimumAgeRequirement</span>(<span class="params"><span class="built_in">int</span> minimumAge</span>)</span></span><br><span class="line">    {</span><br><span class="line">        MinimumAge = minimumAge;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MinimumAgeHandler</span> : <span class="title">AuthorizationHandler</span>&lt;<span class="title">MinimumAgeRequirement</span>&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">HandleRequirementAsync</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        AuthorizationHandlerContext context,</span></span></span><br><span class="line"><span class="params"><span class="function">        MinimumAgeRequirement requirement</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> birthDateClaim = context.User.FindFirst(<span class="string">"birthdate"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (birthDateClaim != <span class="literal">null</span> &amp;&amp; </span><br><span class="line">            DateTime.TryParse(birthDateClaim.Value, <span class="keyword">out</span> <span class="keyword">var</span> birthDate))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> age = DateTime.Today.Year - birthDate.Year;</span><br><span class="line">            <span class="keyword">if</span> (birthDate.Date &gt; DateTime.Today.AddYears(-age))</span><br><span class="line">                age--;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (age &gt;= requirement.MinimumAge)</span><br><span class="line">            {</span><br><span class="line">                context.Succeed(requirement);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-数据访问（Entity-Framework-Core）"><a href="#2-数据访问（Entity-Framework-Core）" class="headerlink" title="2. 数据访问（Entity Framework Core）"></a>2. 数据访问（Entity Framework Core）</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Entity Framework Core配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApplicationDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ApplicationDbContext</span>(<span class="params">DbContextOptions&lt;ApplicationDbContext&gt; options</span>)</span></span><br><span class="line"><span class="function">        : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line">    {</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DbSet</span>&lt;<span class="title">User</span>&gt; Users</span> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DbSet</span>&lt;<span class="title">Order</span>&gt; Orders</span> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DbSet</span>&lt;<span class="title">Product</span>&gt; Products</span> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 用户实体配置</span></span><br><span class="line">        modelBuilder.Entity&lt;User&gt;(entity =&gt;</span><br><span class="line">        {</span><br><span class="line">            entity.HasKey(e =&gt; e.Id);</span><br><span class="line">            entity.Property(e =&gt; e.Username)</span><br><span class="line">                  .IsRequired()</span><br><span class="line">                  .HasMaxLength(<span class="number">50</span>);</span><br><span class="line">            entity.Property(e =&gt; e.Email)</span><br><span class="line">                  .IsRequired()</span><br><span class="line">                  .HasMaxLength(<span class="number">100</span>);</span><br><span class="line">            entity.HasIndex(e =&gt; e.Email)</span><br><span class="line">                  .IsUnique();</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 订单实体配置</span></span><br><span class="line">        modelBuilder.Entity&lt;Order&gt;(entity =&gt;</span><br><span class="line">        {</span><br><span class="line">            entity.HasKey(e =&gt; e.Id);</span><br><span class="line">            entity.Property(e =&gt; e.TotalAmount)</span><br><span class="line">                  .HasColumnType(<span class="string">"decimal(18,2)"</span>);</span><br><span class="line">            entity.HasOne(e =&gt; e.User)</span><br><span class="line">                  .WithMany(e =&gt; e.Orders)</span><br><span class="line">                  .HasForeignKey(e =&gt; e.UserId)</span><br><span class="line">                  .OnDelete(DeleteBehavior.Restrict);</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 种子数据</span></span><br><span class="line">        modelBuilder.Entity&lt;User&gt;().HasData(</span><br><span class="line">            <span class="keyword">new</span> User { Id = <span class="number">1</span>, Username = <span class="string">"admin"</span>, Email = <span class="string">"admin@example.com"</span> }</span><br><span class="line">        );</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 仓储模式实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IRepository</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="keyword">class</span></span><br><span class="line">{</span><br><span class="line">    <span class="function">Task&lt;T&gt; <span class="title">GetByIdAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">    Task&lt;IEnumerable&lt;T&gt;&gt; GetAllAsync();</span><br><span class="line">    <span class="function">Task&lt;T&gt; <span class="title">AddAsync</span>(<span class="params">T entity</span>)</span>;</span><br><span class="line">    <span class="function">Task <span class="title">UpdateAsync</span>(<span class="params">T entity</span>)</span>;</span><br><span class="line">    <span class="function">Task <span class="title">DeleteAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Repository</span>&lt;<span class="title">T</span>&gt; : <span class="title">IRepository</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="keyword">class</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ApplicationDbContext _context;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> DbSet&lt;T&gt; _dbSet;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Repository</span>(<span class="params">ApplicationDbContext context</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _context = context;</span><br><span class="line">        _dbSet = context.Set&lt;T&gt;();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;T&gt; <span class="title">GetByIdAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> _dbSet.FindAsync(id);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IEnumerable&lt;T&gt;&gt; GetAllAsync()</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> _dbSet.ToListAsync();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;T&gt; <span class="title">AddAsync</span>(<span class="params">T entity</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">await</span> _dbSet.AddAsync(entity);</span><br><span class="line">        <span class="keyword">await</span> _context.SaveChangesAsync();</span><br><span class="line">        <span class="keyword">return</span> entity;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">UpdateAsync</span>(<span class="params">T entity</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _dbSet.Update(entity);</span><br><span class="line">        <span class="keyword">await</span> _context.SaveChangesAsync();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">DeleteAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> entity = <span class="keyword">await</span> GetByIdAsync(id);</span><br><span class="line">        <span class="keyword">if</span> (entity != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            _dbSet.Remove(entity);</span><br><span class="line">            <span class="keyword">await</span> _context.SaveChangesAsync();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="四、-NET微服务架构"><a href="#四、-NET微服务架构" class="headerlink" title="四、.NET微服务架构"></a>四、.NET微服务架构</h1><h2 id="（一）微服务架构概述-1"><a href="#（一）微服务架构概述-1" class="headerlink" title="（一）微服务架构概述 1"></a>（一）微服务架构概述 <mcreference link="https://blog.csdn.net/weixin_55959870/article/details/122474430" index="1">1</mcreference></h2><h3 id="1-微服务设计原则-1"><a href="#1-微服务设计原则-1" class="headerlink" title="1. 微服务设计原则 1"></a>1. 微服务设计原则 <mcreference link="https://blog.csdn.net/weixin_55959870/article/details/122474430" index="1">1</mcreference></h3><ul>
<li><strong>垂直划分优先原则</strong>：根据业务领域对服务进行垂直划分</li>
<li><strong>持续演进原则</strong>：逐步划分和持续演进，避免服务数量爆炸性增长</li>
<li><strong>服务自治、接口隔离原则</strong>：通过标准接口隔离，隐藏内部实现细节</li>
<li><strong>自动化驱动原则</strong>：构建自动化工具及环境</li>
</ul>
<h3 id="2-微服务核心组件"><a href="#2-微服务核心组件" class="headerlink" title="2. 微服务核心组件"></a>2. 微服务核心组件</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务注册与发现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServiceDiscovery</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IConsulClient _consulClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;ServiceDiscovery&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServiceDiscovery</span>(<span class="params">IConsulClient consulClient, </span></span></span><br><span class="line"><span class="params"><span class="function">                           ILogger&lt;ServiceDiscovery&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _consulClient = consulClient;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册服务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">RegisterServiceAsync</span>(<span class="params">ServiceRegistration registration</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> consulRegistration = <span class="keyword">new</span> AgentServiceRegistration</span><br><span class="line">        {</span><br><span class="line">            ID = registration.Id,</span><br><span class="line">            Name = registration.Name,</span><br><span class="line">            Address = registration.Address,</span><br><span class="line">            Port = registration.Port,</span><br><span class="line">            Tags = registration.Tags,</span><br><span class="line">            Check = <span class="keyword">new</span> AgentServiceCheck</span><br><span class="line">            {</span><br><span class="line">                HTTP = <span class="string">$"http://<span class="subst">{registration.Address}</span>:<span class="subst">{registration.Port}</span>/health"</span>,</span><br><span class="line">                Interval = TimeSpan.FromSeconds(<span class="number">30</span>),</span><br><span class="line">                Timeout = TimeSpan.FromSeconds(<span class="number">10</span>)</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> _consulClient.Agent.ServiceRegister(consulRegistration);</span><br><span class="line">        _logger.LogInformation(<span class="string">"Service {ServiceName} registered with ID {ServiceId}"</span>, </span><br><span class="line">                              registration.Name, registration.Id);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发现服务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;List&lt;ServiceInstance&gt;&gt; DiscoverServicesAsync(<span class="built_in">string</span> serviceName)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> services = <span class="keyword">await</span> _consulClient.Health.Service(serviceName, </span><br><span class="line">                                                          <span class="built_in">string</span>.Empty, </span><br><span class="line">                                                          <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> services.Response.Select(s =&gt; <span class="keyword">new</span> ServiceInstance</span><br><span class="line">        {</span><br><span class="line">            Id = s.Service.ID,</span><br><span class="line">            Name = s.Service.Service,</span><br><span class="line">            Address = s.Service.Address,</span><br><span class="line">            Port = s.Service.Port</span><br><span class="line">        }).ToList();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务实例模型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServiceInstance</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Address { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Port { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServiceRegistration</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Address { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Port { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span>[] Tags { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="3-API网关实现"><a href="#3-API网关实现" class="headerlink" title="3. API网关实现"></a>3. API网关实现</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ocelot API网关配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApiGatewayConfiguration</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureOcelot</span>(<span class="params">IServiceCollection services, </span></span></span><br><span class="line"><span class="params"><span class="function">                               IConfiguration configuration</span>)</span></span><br><span class="line">    {</span><br><span class="line">        services.AddOcelot(configuration)</span><br><span class="line">                .AddConsul()</span><br><span class="line">                .AddPolly();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加认证</span></span><br><span class="line">        services.AddAuthentication(<span class="string">"Bearer"</span>)</span><br><span class="line">                .AddJwtBearer(<span class="string">"Bearer"</span>, options =&gt;</span><br><span class="line">                {</span><br><span class="line">                    options.Authority = configuration[<span class="string">"IdentityServer:Authority"</span>];</span><br><span class="line">                    options.RequireHttpsMetadata = <span class="literal">false</span>;</span><br><span class="line">                    options.Audience = <span class="string">"api1"</span>;</span><br><span class="line">                });</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureOcelotPipeline</span>(<span class="params">IApplicationBuilder app</span>)</span></span><br><span class="line">    {</span><br><span class="line">        app.UseOcelot().Wait();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ocelot.json配置示例</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">{</span></span><br><span class="line"><span class="comment">  "Routes": [</span></span><br><span class="line"><span class="comment">    {</span></span><br><span class="line"><span class="comment">      "DownstreamPathTemplate": "/api/users/{everything}",</span></span><br><span class="line"><span class="comment">      "DownstreamScheme": "http",</span></span><br><span class="line"><span class="comment">      "ServiceName": "user-service",</span></span><br><span class="line"><span class="comment">      "LoadBalancerOptions": {</span></span><br><span class="line"><span class="comment">        "Type": "RoundRobin"</span></span><br><span class="line"><span class="comment">      },</span></span><br><span class="line"><span class="comment">      "UpstreamPathTemplate": "/api/users/{everything}",</span></span><br><span class="line"><span class="comment">      "UpstreamHttpMethod": [ "GET", "POST", "PUT", "DELETE" ],</span></span><br><span class="line"><span class="comment">      "AuthenticationOptions": {</span></span><br><span class="line"><span class="comment">        "AuthenticationProviderKey": "Bearer",</span></span><br><span class="line"><span class="comment">        "AllowedScopes": []</span></span><br><span class="line"><span class="comment">      },</span></span><br><span class="line"><span class="comment">      "RateLimitOptions": {</span></span><br><span class="line"><span class="comment">        "ClientWhitelist": [],</span></span><br><span class="line"><span class="comment">        "EnableRateLimiting": true,</span></span><br><span class="line"><span class="comment">        "Period": "1m",</span></span><br><span class="line"><span class="comment">        "PeriodTimespan": 60,</span></span><br><span class="line"><span class="comment">        "Limit": 100</span></span><br><span class="line"><span class="comment">      }</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">  ],</span></span><br><span class="line"><span class="comment">  "GlobalConfiguration": {</span></span><br><span class="line"><span class="comment">    "ServiceDiscoveryProvider": {</span></span><br><span class="line"><span class="comment">      "Host": "localhost",</span></span><br><span class="line"><span class="comment">      "Port": 8500,</span></span><br><span class="line"><span class="comment">      "Type": "Consul"</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">  }</span></span><br><span class="line"><span class="comment">}</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）微服务通信模式-3"><a href="#（二）微服务通信模式-3" class="headerlink" title="（二）微服务通信模式 3"></a>（二）微服务通信模式 <mcreference link="https://www.cnblogs.com/edisonchou/p/dotnetcore_microservice_foundation_blogs_index_final.html" index="3">3</mcreference></h2><h3 id="1-HTTP-REST通信"><a href="#1-HTTP-REST通信" class="headerlink" title="1. HTTP REST通信"></a>1. HTTP REST通信</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTTP客户端服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserServiceClient</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HttpClient _httpClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;UserServiceClient&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceClient</span>(<span class="params">HttpClient httpClient, </span></span></span><br><span class="line"><span class="params"><span class="function">                            ILogger&lt;UserServiceClient&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _httpClient = httpClient;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;UserDto&gt; <span class="title">GetUserAsync</span>(<span class="params"><span class="built_in">int</span> userId</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> response = <span class="keyword">await</span> _httpClient.GetAsync(<span class="string">$"/api/users/<span class="subst">{userId}</span>"</span>);</span><br><span class="line">            response.EnsureSuccessStatusCode();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> content = <span class="keyword">await</span> response.Content.ReadAsStringAsync();</span><br><span class="line">            <span class="keyword">return</span> JsonSerializer.Deserialize&lt;UserDto&gt;(content, </span><br><span class="line">                <span class="keyword">new</span> JsonSerializerOptions { PropertyNameCaseInsensitive = <span class="literal">true</span> });</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (HttpRequestException ex)</span><br><span class="line">        {</span><br><span class="line">            _logger.LogError(ex, <span class="string">"Error calling user service for user {UserId}"</span>, userId);</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务注册</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureHttpClients</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">{</span><br><span class="line">    services.AddHttpClient&lt;UserServiceClient&gt;(client =&gt;</span><br><span class="line">    {</span><br><span class="line">        client.BaseAddress = <span class="keyword">new</span> Uri(<span class="string">"http://user-service"</span>);</span><br><span class="line">        client.Timeout = TimeSpan.FromSeconds(<span class="number">30</span>);</span><br><span class="line">    })</span><br><span class="line">    .AddPolicyHandler(GetRetryPolicy())</span><br><span class="line">    .AddPolicyHandler(GetCircuitBreakerPolicy());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重试策略</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> IAsyncPolicy&lt;HttpResponseMessage&gt; <span class="title">GetRetryPolicy</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> HttpPolicyExtensions</span><br><span class="line">        .HandleTransientHttpError()</span><br><span class="line">        .WaitAndRetryAsync(</span><br><span class="line">            retryCount: <span class="number">3</span>,</span><br><span class="line">            sleepDurationProvider: retryAttempt =&gt; </span><br><span class="line">                TimeSpan.FromSeconds(Math.Pow(<span class="number">2</span>, retryAttempt)),</span><br><span class="line">            onRetry: (outcome, timespan, retryCount, context) =&gt;</span><br><span class="line">            {</span><br><span class="line">                Console.WriteLine(<span class="string">$"Retry <span class="subst">{retryCount}</span> after <span class="subst">{timespan}</span> seconds"</span>);</span><br><span class="line">            });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 熔断策略</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> IAsyncPolicy&lt;HttpResponseMessage&gt; <span class="title">GetCircuitBreakerPolicy</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">return</span> HttpPolicyExtensions</span><br><span class="line">        .HandleTransientHttpError()</span><br><span class="line">        .CircuitBreakerAsync(</span><br><span class="line">            handledEventsAllowedBeforeBreaking: <span class="number">3</span>,</span><br><span class="line">            durationOfBreak: TimeSpan.FromSeconds(<span class="number">30</span>),</span><br><span class="line">            onBreak: (exception, duration) =&gt;</span><br><span class="line">            {</span><br><span class="line">                Console.WriteLine(<span class="string">$"Circuit breaker opened for <span class="subst">{duration}</span>"</span>);</span><br><span class="line">            },</span><br><span class="line">            onReset: () =&gt;</span><br><span class="line">            {</span><br><span class="line">                Console.WriteLine(<span class="string">"Circuit breaker reset"</span>);</span><br><span class="line">            });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-消息队列通信"><a href="#2-消息队列通信" class="headerlink" title="2. 消息队列通信"></a>2. 消息队列通信</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RabbitMQ消息发布者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessagePublisher</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IConnection _connection;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IModel _channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;MessagePublisher&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessagePublisher</span>(<span class="params">IConnectionFactory connectionFactory, </span></span></span><br><span class="line"><span class="params"><span class="function">                           ILogger&lt;MessagePublisher&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _connection = connectionFactory.CreateConnection();</span><br><span class="line">        _channel = _connection.CreateModel();</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">PublishAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> exchange, <span class="built_in">string</span> routingKey, T message</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> json = JsonSerializer.Serialize(message);</span><br><span class="line">            <span class="keyword">var</span> body = Encoding.UTF8.GetBytes(json);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> properties = _channel.CreateBasicProperties();</span><br><span class="line">            properties.Persistent = <span class="literal">true</span>;</span><br><span class="line">            properties.MessageId = Guid.NewGuid().ToString();</span><br><span class="line">            properties.Timestamp = <span class="keyword">new</span> AmqpTimestamp(DateTimeOffset.UtcNow.ToUnixTimeSeconds());</span><br><span class="line">            </span><br><span class="line">            _channel.BasicPublish(</span><br><span class="line">                exchange: exchange,</span><br><span class="line">                routingKey: routingKey,</span><br><span class="line">                basicProperties: properties,</span><br><span class="line">                body: body);</span><br><span class="line">            </span><br><span class="line">            _logger.LogInformation(<span class="string">"Message published to {Exchange}/{RoutingKey}"</span>, </span><br><span class="line">                                  exchange, routingKey);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        {</span><br><span class="line">            _logger.LogError(ex, <span class="string">"Error publishing message to {Exchange}/{RoutingKey}"</span>, </span><br><span class="line">                            exchange, routingKey);</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消息消费者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessageConsumer</span> : <span class="title">BackgroundService</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IConnection _connection;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IModel _channel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IServiceProvider _serviceProvider;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;MessageConsumer&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageConsumer</span>(<span class="params">IConnectionFactory connectionFactory,</span></span></span><br><span class="line"><span class="params"><span class="function">                          IServiceProvider serviceProvider,</span></span></span><br><span class="line"><span class="params"><span class="function">                          ILogger&lt;MessageConsumer&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _connection = connectionFactory.CreateConnection();</span><br><span class="line">        _channel = _connection.CreateModel();</span><br><span class="line">        _serviceProvider = serviceProvider;</span><br><span class="line">        _logger = logger;</span><br><span class="line">        </span><br><span class="line">        SetupQueues();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetupQueues</span>()</span></span><br><span class="line">    {</span><br><span class="line">        _channel.ExchangeDeclare(<span class="string">"user.events"</span>, ExchangeType.Topic, durable: <span class="literal">true</span>);</span><br><span class="line">        _channel.QueueDeclare(<span class="string">"user.created"</span>, durable: <span class="literal">true</span>, exclusive: <span class="literal">false</span>, autoDelete: <span class="literal">false</span>);</span><br><span class="line">        _channel.QueueBind(<span class="string">"user.created"</span>, <span class="string">"user.events"</span>, <span class="string">"user.created"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Task <span class="title">ExecuteAsync</span>(<span class="params">CancellationToken stoppingToken</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> consumer = <span class="keyword">new</span> EventingBasicConsumer(_channel);</span><br><span class="line">        </span><br><span class="line">        consumer.Received += <span class="keyword">async</span> (model, ea) =&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> body = ea.Body.ToArray();</span><br><span class="line">                <span class="keyword">var</span> message = Encoding.UTF8.GetString(body);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">await</span> ProcessMessageAsync(ea.RoutingKey, message);</span><br><span class="line">                </span><br><span class="line">                _channel.BasicAck(ea.DeliveryTag, <span class="literal">false</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            {</span><br><span class="line">                _logger.LogError(ex, <span class="string">"Error processing message"</span>);</span><br><span class="line">                _channel.BasicNack(ea.DeliveryTag, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        </span><br><span class="line">        _channel.BasicConsume(queue: <span class="string">"user.created"</span>, autoAck: <span class="literal">false</span>, consumer: consumer);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Task.CompletedTask;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">ProcessMessageAsync</span>(<span class="params"><span class="built_in">string</span> routingKey, <span class="built_in">string</span> message</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> scope = _serviceProvider.CreateScope();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (routingKey)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"user.created"</span>:</span><br><span class="line">                <span class="keyword">var</span> userCreatedEvent = JsonSerializer.Deserialize&lt;UserCreatedEvent&gt;(message);</span><br><span class="line">                <span class="keyword">var</span> handler = scope.ServiceProvider.GetRequiredService&lt;IUserCreatedEventHandler&gt;();</span><br><span class="line">                <span class="keyword">await</span> handler.HandleAsync(userCreatedEvent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                _logger.LogWarning(<span class="string">"Unknown routing key: {RoutingKey}"</span>, routingKey);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件模型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserCreatedEvent</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> UserId { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Username { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Email { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> DateTime CreatedAt { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserCreatedEventHandler</span></span><br><span class="line">{</span><br><span class="line">    <span class="function">Task <span class="title">HandleAsync</span>(<span class="params">UserCreatedEvent userCreatedEvent</span>)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserCreatedEventHandler</span> : <span class="title">IUserCreatedEventHandler</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IEmailService _emailService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;UserCreatedEventHandler&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserCreatedEventHandler</span>(<span class="params">IEmailService emailService,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  ILogger&lt;UserCreatedEventHandler&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _emailService = emailService;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">HandleAsync</span>(<span class="params">UserCreatedEvent userCreatedEvent</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _logger.LogInformation(<span class="string">"Processing user created event for user {UserId}"</span>, </span><br><span class="line">                              userCreatedEvent.UserId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发送欢迎邮件</span></span><br><span class="line">        <span class="keyword">await</span> _emailService.SendWelcomeEmailAsync(</span><br><span class="line">            userCreatedEvent.Email, </span><br><span class="line">            userCreatedEvent.Username);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="五、企业级开发特性"><a href="#五、企业级开发特性" class="headerlink" title="五、企业级开发特性"></a>五、企业级开发特性</h1><h2 id="（一）性能优化"><a href="#（一）性能优化" class="headerlink" title="（一）性能优化"></a>（一）性能优化</h2><h3 id="1-缓存策略"><a href="#1-缓存策略" class="headerlink" title="1. 缓存策略"></a>1. 缓存策略</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分布式缓存实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CacheService</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IDistributedCache _distributedCache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IMemoryCache _memoryCache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;CacheService&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CacheService</span>(<span class="params">IDistributedCache distributedCache,</span></span></span><br><span class="line"><span class="params"><span class="function">                       IMemoryCache memoryCache,</span></span></span><br><span class="line"><span class="params"><span class="function">                       ILogger&lt;CacheService&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _distributedCache = distributedCache;</span><br><span class="line">        _memoryCache = memoryCache;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多级缓存策略</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">T</span>&gt; <span class="title">GetOrSetAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> key, </span></span></span><br><span class="line"><span class="params"><span class="function">                                         Func&lt;Task&lt;T&gt;&gt; getItem, </span></span></span><br><span class="line"><span class="params"><span class="function">                                         TimeSpan? expiry = <span class="literal">null</span></span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 首先检查内存缓存</span></span><br><span class="line">        <span class="keyword">if</span> (_memoryCache.TryGetValue(key, <span class="keyword">out</span> T cachedValue))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> cachedValue;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查分布式缓存</span></span><br><span class="line">        <span class="keyword">var</span> distributedValue = <span class="keyword">await</span> _distributedCache.GetStringAsync(key);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(distributedValue))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> deserializedValue = JsonSerializer.Deserialize&lt;T&gt;(distributedValue);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 回填内存缓存</span></span><br><span class="line">            _memoryCache.Set(key, deserializedValue, TimeSpan.FromMinutes(<span class="number">5</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> deserializedValue;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 缓存未命中，获取数据</span></span><br><span class="line">        <span class="keyword">var</span> item = <span class="keyword">await</span> getItem();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (item != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> serializedItem = JsonSerializer.Serialize(item);</span><br><span class="line">            <span class="keyword">var</span> options = <span class="keyword">new</span> DistributedCacheEntryOptions();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (expiry.HasValue)</span><br><span class="line">            {</span><br><span class="line">                options.SetAbsoluteExpiration(expiry.Value);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                options.SetSlidingExpiration(TimeSpan.FromHours(<span class="number">1</span>));</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">await</span> _distributedCache.SetStringAsync(key, serializedItem, options);</span><br><span class="line">            _memoryCache.Set(key, item, TimeSpan.FromMinutes(<span class="number">5</span>));</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">RemoveAsync</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _memoryCache.Remove(key);</span><br><span class="line">        <span class="keyword">await</span> _distributedCache.RemoveAsync(key);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存装饰器模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CachedUserService</span> : <span class="title">IUserService</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IUserService _userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> CacheService _cacheService;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CachedUserService</span>(<span class="params">IUserService userService, CacheService cacheService</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _userService = userService;</span><br><span class="line">        _cacheService = cacheService;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;User&gt; <span class="title">GetUserAsync</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> _cacheService.GetOrSetAsync(</span><br><span class="line">            <span class="string">$"user:<span class="subst">{id}</span>"</span>,</span><br><span class="line">            () =&gt; _userService.GetUserAsync(id),</span><br><span class="line">            TimeSpan.FromMinutes(<span class="number">30</span>));</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;User&gt; <span class="title">UpdateUserAsync</span>(<span class="params">User user</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> updatedUser = <span class="keyword">await</span> _userService.UpdateUserAsync(user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清除缓存</span></span><br><span class="line">        <span class="keyword">await</span> _cacheService.RemoveAsync(<span class="string">$"user:<span class="subst">{user.Id}</span>"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> updatedUser;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-异步编程最佳实践"><a href="#2-异步编程最佳实践" class="headerlink" title="2. 异步编程最佳实践"></a>2. 异步编程最佳实践</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步编程模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AsyncBestPractices</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HttpClient _httpClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;AsyncBestPractices&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AsyncBestPractices</span>(<span class="params">HttpClient httpClient, </span></span></span><br><span class="line"><span class="params"><span class="function">                             ILogger&lt;AsyncBestPractices&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _httpClient = httpClient;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 并行处理多个异步操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;List&lt;UserDto&gt;&gt; GetUsersInParallelAsync(List&lt;<span class="built_in">int</span>&gt; userIds)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> tasks = userIds.Select(<span class="keyword">async</span> id =&gt;</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> response = <span class="keyword">await</span> _httpClient.GetAsync(<span class="string">$"/api/users/<span class="subst">{id}</span>"</span>);</span><br><span class="line">                <span class="keyword">if</span> (response.IsSuccessStatusCode)</span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">var</span> content = <span class="keyword">await</span> response.Content.ReadAsStringAsync();</span><br><span class="line">                    <span class="keyword">return</span> JsonSerializer.Deserialize&lt;UserDto&gt;(content);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            {</span><br><span class="line">                _logger.LogError(ex, <span class="string">"Error fetching user {UserId}"</span>, id);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> results = <span class="keyword">await</span> Task.WhenAll(tasks);</span><br><span class="line">        <span class="keyword">return</span> results.Where(u =&gt; u != <span class="literal">null</span>).ToList();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 异步流处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> IAsyncEnumerable&lt;ProcessedData&gt; <span class="title">ProcessDataStreamAsync</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        IAsyncEnumerable&lt;RawData&gt; dataStream,</span></span></span><br><span class="line"><span class="params"><span class="function">        [EnumeratorCancellation] CancellationToken cancellationToken = <span class="literal">default</span></span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">foreach</span> (<span class="keyword">var</span> data <span class="keyword">in</span> dataStream.WithCancellation(cancellationToken))</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 异步处理每个数据项</span></span><br><span class="line">            <span class="keyword">var</span> processed = <span class="keyword">await</span> ProcessSingleDataAsync(data);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (processed != <span class="literal">null</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">return</span> processed;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task&lt;ProcessedData&gt; <span class="title">ProcessSingleDataAsync</span>(<span class="params">RawData data</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 模拟异步处理</span></span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">100</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProcessedData</span><br><span class="line">        {</span><br><span class="line">            Id = data.Id,</span><br><span class="line">            ProcessedValue = data.Value * <span class="number">2</span>,</span><br><span class="line">            ProcessedAt = DateTime.UtcNow</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 超时和取消处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">T</span>&gt; <span class="title">ExecuteWithTimeoutAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        Func&lt;CancellationToken, Task&lt;T&gt;&gt; operation,</span></span></span><br><span class="line"><span class="params"><span class="function">        TimeSpan timeout</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> cts = <span class="keyword">new</span> CancellationTokenSource(timeout);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> operation(cts.Token);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (OperationCanceledException) <span class="keyword">when</span> (cts.Token.IsCancellationRequested)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException(<span class="string">$"Operation timed out after <span class="subst">{timeout}</span>"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RawData</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> Value { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProcessedData</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> ProcessedValue { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> DateTime ProcessedAt { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）监控与诊断-3"><a href="#（二）监控与诊断-3" class="headerlink" title="（二）监控与诊断 3"></a>（二）监控与诊断 <mcreference link="https://www.cnblogs.com/edisonchou/p/dotnetcore_microservice_foundation_blogs_index_final.html" index="3">3</mcreference></h2><h3 id="1-健康检查"><a href="#1-健康检查" class="headerlink" title="1. 健康检查"></a>1. 健康检查</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 健康检查配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HealthCheckConfiguration</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureHealthChecks</span>(<span class="params">IServiceCollection services, </span></span></span><br><span class="line"><span class="params"><span class="function">                                     IConfiguration configuration</span>)</span></span><br><span class="line">    {</span><br><span class="line">        services.AddHealthChecks()</span><br><span class="line">                .AddCheck(<span class="string">"self"</span>, () =&gt; HealthCheckResult.Healthy())</span><br><span class="line">                .AddSqlServer(configuration.GetConnectionString(<span class="string">"DefaultConnection"</span>),</span><br><span class="line">                             name: <span class="string">"database"</span>)</span><br><span class="line">                .AddRedis(configuration.GetConnectionString(<span class="string">"Redis"</span>),</span><br><span class="line">                         name: <span class="string">"redis"</span>)</span><br><span class="line">                .AddUrlGroup(<span class="keyword">new</span> Uri(<span class="string">"https://api.external-service.com/health"</span>),</span><br><span class="line">                           name: <span class="string">"external-api"</span>)</span><br><span class="line">                .AddCheck&lt;CustomHealthCheck&gt;(<span class="string">"custom-check"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureHealthCheckEndpoints</span>(<span class="params">IApplicationBuilder app</span>)</span></span><br><span class="line">    {</span><br><span class="line">        app.UseHealthChecks(<span class="string">"/health"</span>, <span class="keyword">new</span> HealthCheckOptions</span><br><span class="line">        {</span><br><span class="line">            ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        app.UseHealthChecks(<span class="string">"/health/ready"</span>, <span class="keyword">new</span> HealthCheckOptions</span><br><span class="line">        {</span><br><span class="line">            Predicate = check =&gt; check.Tags.Contains(<span class="string">"ready"</span>),</span><br><span class="line">            ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        app.UseHealthChecks(<span class="string">"/health/live"</span>, <span class="keyword">new</span> HealthCheckOptions</span><br><span class="line">        {</span><br><span class="line">            Predicate = _ =&gt; <span class="literal">false</span>,</span><br><span class="line">            ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义健康检查</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomHealthCheck</span> : <span class="title">IHealthCheck</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IUserService _userService;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomHealthCheck</span>(<span class="params">IUserService userService</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _userService = userService;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;HealthCheckResult&gt; <span class="title">CheckHealthAsync</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        HealthCheckContext context,</span></span></span><br><span class="line"><span class="params"><span class="function">        CancellationToken cancellationToken = <span class="literal">default</span></span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 执行业务逻辑健康检查</span></span><br><span class="line">            <span class="keyword">var</span> isHealthy = <span class="keyword">await</span> _userService.IsServiceHealthyAsync();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (isHealthy)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">return</span> HealthCheckResult.Healthy(<span class="string">"User service is healthy"</span>);</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> HealthCheckResult.Unhealthy(<span class="string">"User service is not responding"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> HealthCheckResult.Unhealthy(</span><br><span class="line">                <span class="string">"User service health check failed"</span>, ex);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-应用监控"><a href="#2-应用监控" class="headerlink" title="2. 应用监控"></a>2. 应用监控</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Application Insights集成</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonitoringConfiguration</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureApplicationInsights</span>(<span class="params">IServiceCollection services, </span></span></span><br><span class="line"><span class="params"><span class="function">                                            IConfiguration configuration</span>)</span></span><br><span class="line">    {</span><br><span class="line">        services.AddApplicationInsightsTelemetry(configuration);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义遥测初始化器</span></span><br><span class="line">        services.AddSingleton&lt;ITelemetryInitializer, CustomTelemetryInitializer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义遥测处理器</span></span><br><span class="line">        services.AddApplicationInsightsTelemetryProcessor&lt;CustomTelemetryProcessor&gt;();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义遥测初始化器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomTelemetryInitializer</span> : <span class="title">ITelemetryInitializer</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">ITelemetry telemetry</span>)</span></span><br><span class="line">    {</span><br><span class="line">        telemetry.Context.GlobalProperties[<span class="string">"Environment"</span>] = </span><br><span class="line">            Environment.GetEnvironmentVariable(<span class="string">"ASPNETCORE_ENVIRONMENT"</span>);</span><br><span class="line">        telemetry.Context.GlobalProperties[<span class="string">"ServiceName"</span>] = <span class="string">"UserService"</span>;</span><br><span class="line">        telemetry.Context.GlobalProperties[<span class="string">"Version"</span>] = <span class="string">"1.0.0"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义遥测处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomTelemetryProcessor</span> : <span class="title">ITelemetryProcessor</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ITelemetryProcessor _next;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomTelemetryProcessor</span>(<span class="params">ITelemetryProcessor next</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _next = next;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Process</span>(<span class="params">ITelemetry item</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 过滤敏感信息</span></span><br><span class="line">        <span class="keyword">if</span> (item <span class="keyword">is</span> RequestTelemetry request)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (request.Url?.AbsolutePath?.Contains(<span class="string">"/health"</span>) == <span class="literal">true</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 不记录健康检查请求</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加自定义属性</span></span><br><span class="line">        <span class="keyword">if</span> (item <span class="keyword">is</span> TraceTelemetry trace)</span><br><span class="line">        {</span><br><span class="line">            trace.Properties[<span class="string">"CustomProperty"</span>] = <span class="string">"CustomValue"</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        _next.Process(item);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义指标收集</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MetricsCollector</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> TelemetryClient _telemetryClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;MetricsCollector&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MetricsCollector</span>(<span class="params">TelemetryClient telemetryClient,</span></span></span><br><span class="line"><span class="params"><span class="function">                           ILogger&lt;MetricsCollector&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _telemetryClient = telemetryClient;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TrackUserOperation</span>(<span class="params"><span class="built_in">string</span> operation, TimeSpan duration, <span class="built_in">bool</span> success</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _telemetryClient.TrackMetric(<span class="string">$"UserOperation.<span class="subst">{operation}</span>.Duration"</span>, </span><br><span class="line">                                    duration.TotalMilliseconds);</span><br><span class="line">        </span><br><span class="line">        _telemetryClient.TrackMetric(<span class="string">$"UserOperation.<span class="subst">{operation}</span>.Success"</span>, </span><br><span class="line">                                    success ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> properties = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;</span><br><span class="line">        {</span><br><span class="line">            [<span class="string">"Operation"</span>] = operation,</span><br><span class="line">            [<span class="string">"Success"</span>] = success.ToString()</span><br><span class="line">        };</span><br><span class="line">        </span><br><span class="line">        _telemetryClient.TrackEvent(<span class="string">"UserOperationCompleted"</span>, properties);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TrackBusinessMetric</span>(<span class="params"><span class="built_in">string</span> metricName, <span class="built_in">double</span> <span class="keyword">value</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">                                   Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; properties = <span class="literal">null</span></span>)</span></span><br><span class="line">    {</span><br><span class="line">        _telemetryClient.TrackMetric(metricName, <span class="keyword">value</span>, properties);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="六、开发工具生态"><a href="#六、开发工具生态" class="headerlink" title="六、开发工具生态"></a>六、开发工具生态</h1><h2 id="（一）Visual-Studio开发体验"><a href="#（一）Visual-Studio开发体验" class="headerlink" title="（一）Visual Studio开发体验"></a>（一）Visual Studio开发体验</h2><h3 id="1-项目模板和脚手架"><a href="#1-项目模板和脚手架" class="headerlink" title="1. 项目模板和脚手架"></a>1. 项目模板和脚手架</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .NET CLI命令</span></span><br><span class="line"><span class="comment"># 创建Web API项目</span></span><br><span class="line">dotnet new webapi -n MyApi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建MVC项目</span></span><br><span class="line">dotnet new mvc -n MyWebApp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建类库</span></span><br><span class="line">dotnet new classlib -n MyLibrary</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建解决方案</span></span><br><span class="line">dotnet new sln -n MySolution</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加项目到解决方案</span></span><br><span class="line">dotnet sln add MyApi/MyApi.csproj</span><br><span class="line">dotnet sln add MyWebApp/MyWebApp.csproj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加包引用</span></span><br><span class="line">dotnet add package Microsoft.EntityFrameworkCore.SqlServer</span><br><span class="line">dotnet add package Serilog.AspNetCore</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行项目</span></span><br><span class="line">dotnet run</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布项目</span></span><br><span class="line">dotnet publish -c Release -o ./publish</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-调试和诊断工具"><a href="#2-调试和诊断工具" class="headerlink" title="2. 调试和诊断工具"></a>2. 调试和诊断工具</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调试配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DebuggingConfiguration</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureDebugging</span>(<span class="params">IServiceCollection services, </span></span></span><br><span class="line"><span class="params"><span class="function">                                  IWebHostEnvironment env</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 开发环境特定配置</span></span><br><span class="line">            services.AddDeveloperExceptionPage();</span><br><span class="line">            services.AddDatabaseDeveloperPageExceptionFilter();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 启用详细错误信息</span></span><br><span class="line">            services.Configure&lt;RouteOptions&gt;(options =&gt;</span><br><span class="line">            {</span><br><span class="line">                options.LowercaseUrls = <span class="literal">true</span>;</span><br><span class="line">                options.LowercaseQueryStrings = <span class="literal">true</span>;</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureDiagnostics</span>(<span class="params">IApplicationBuilder app, </span></span></span><br><span class="line"><span class="params"><span class="function">                                    IWebHostEnvironment env</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">        {</span><br><span class="line">            app.UseDeveloperExceptionPage();</span><br><span class="line">            app.UseMigrationsEndPoint();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            app.UseExceptionHandler(<span class="string">"/Error"</span>);</span><br><span class="line">            app.UseHsts();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 性能分析</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PerformanceProfiler</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;PerformanceProfiler&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PerformanceProfiler</span>(<span class="params">ILogger&lt;PerformanceProfiler&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">T</span>&gt; <span class="title">ProfileAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> operationName, </span></span></span><br><span class="line"><span class="params"><span class="function">                                        Func&lt;Task&lt;T&gt;&gt; operation</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> stopwatch = Stopwatch.StartNew();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> result = <span class="keyword">await</span> operation();</span><br><span class="line">            stopwatch.Stop();</span><br><span class="line">            </span><br><span class="line">            _logger.LogInformation(</span><br><span class="line">                <span class="string">"Operation {OperationName} completed in {ElapsedMs}ms"</span>,</span><br><span class="line">                operationName, stopwatch.ElapsedMilliseconds);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        {</span><br><span class="line">            stopwatch.Stop();</span><br><span class="line">            </span><br><span class="line">            _logger.LogError(ex, </span><br><span class="line">                <span class="string">"Operation {OperationName} failed after {ElapsedMs}ms"</span>,</span><br><span class="line">                operationName, stopwatch.ElapsedMilliseconds);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）DevOps集成"><a href="#（二）DevOps集成" class="headerlink" title="（二）DevOps集成"></a>（二）DevOps集成</h2><h3 id="1-Docker容器化"><a href="#1-Docker容器化" class="headerlink" title="1. Docker容器化"></a>1. Docker容器化</h3><figure class="highlight dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile示例</span></span><br><span class="line"><span class="keyword">FROM</span> mcr.microsoft.com/dotnet/aspnet:<span class="number">8.0</span> AS base</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">443</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> mcr.microsoft.com/dotnet/sdk:<span class="number">8.0</span> AS build</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /src</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [<span class="string">"MyApi/MyApi.csproj"</span>, <span class="string">"MyApi/"</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dotnet restore <span class="string">"MyApi/MyApi.csproj"</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="string">"/src/MyApi"</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dotnet build <span class="string">"MyApi.csproj"</span> -c Release -o /app/build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> build AS publish</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dotnet publish <span class="string">"MyApi.csproj"</span> -c Release -o /app/publish</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> base AS final</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=publish /app/publish .</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">"dotnet"</span>, <span class="string">"MyApi.dll"</span>]</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">'3.8'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"5000:80"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ASPNETCORE_ENVIRONMENT=Development</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ConnectionStrings__DefaultConnection=Server=db;Database=MyApiDb;User</span> <span class="string">Id=sa;Password=YourPassword123;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ConnectionStrings__Redis=redis:6379</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mcr.microsoft.com/mssql/server:2022-latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ACCEPT_EULA=Y</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SA_PASSWORD=YourPassword123</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"1433:1433"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sqlserver_data:/var/opt/mssql</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7-alpine</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"6379:6379"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis_data:/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">sqlserver_data:</span></span><br><span class="line">  <span class="attr">redis_data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">app-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-CI-CD管道"><a href="#2-CI-CD管道" class="headerlink" title="2. CI/CD管道"></a>2. CI/CD管道</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Azure DevOps Pipeline</span></span><br><span class="line"><span class="attr">trigger:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">develop</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pool:</span></span><br><span class="line">  <span class="attr">vmImage:</span> <span class="string">'ubuntu-latest'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">buildConfiguration:</span> <span class="string">'Release'</span></span><br><span class="line">  <span class="attr">dotNetFramework:</span> <span class="string">'net8.0'</span></span><br><span class="line">  <span class="attr">dotNetVersion:</span> <span class="string">'8.0.x'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">stage:</span> <span class="string">Build</span></span><br><span class="line">  <span class="attr">displayName:</span> <span class="string">'Build and Test'</span></span><br><span class="line">  <span class="attr">jobs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job:</span> <span class="string">BuildAndTest</span></span><br><span class="line">    <span class="attr">displayName:</span> <span class="string">'Build and Test Job'</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">UseDotNet@2</span></span><br><span class="line">      <span class="attr">displayName:</span> <span class="string">'Use .NET SDK'</span></span><br><span class="line">      <span class="attr">inputs:</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">$(dotNetVersion)</span></span><br><span class="line">        <span class="attr">includePreviewVersions:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">DotNetCoreCLI@2</span></span><br><span class="line">      <span class="attr">displayName:</span> <span class="string">'Restore packages'</span></span><br><span class="line">      <span class="attr">inputs:</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">'restore'</span></span><br><span class="line">        <span class="attr">projects:</span> <span class="string">'**/*.csproj'</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">DotNetCoreCLI@2</span></span><br><span class="line">      <span class="attr">displayName:</span> <span class="string">'Build solution'</span></span><br><span class="line">      <span class="attr">inputs:</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">'build'</span></span><br><span class="line">        <span class="attr">projects:</span> <span class="string">'**/*.csproj'</span></span><br><span class="line">        <span class="attr">arguments:</span> <span class="string">'--configuration $(buildConfiguration) --no-restore'</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">DotNetCoreCLI@2</span></span><br><span class="line">      <span class="attr">displayName:</span> <span class="string">'Run unit tests'</span></span><br><span class="line">      <span class="attr">inputs:</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">'test'</span></span><br><span class="line">        <span class="attr">projects:</span> <span class="string">'**/*Tests.csproj'</span></span><br><span class="line">        <span class="attr">arguments:</span> <span class="string">'--configuration $(buildConfiguration) --no-build --collect "Code coverage"'</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">DotNetCoreCLI@2</span></span><br><span class="line">      <span class="attr">displayName:</span> <span class="string">'Publish application'</span></span><br><span class="line">      <span class="attr">inputs:</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">'publish'</span></span><br><span class="line">        <span class="attr">publishWebProjects:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">arguments:</span> <span class="string">'--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'</span></span><br><span class="line">        <span class="attr">zipAfterPublish:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">PublishBuildArtifacts@1</span></span><br><span class="line">      <span class="attr">displayName:</span> <span class="string">'Publish artifacts'</span></span><br><span class="line">      <span class="attr">inputs:</span></span><br><span class="line">        <span class="attr">PathtoPublish:</span> <span class="string">'$(Build.ArtifactStagingDirectory)'</span></span><br><span class="line">        <span class="attr">ArtifactName:</span> <span class="string">'drop'</span></span><br><span class="line">        <span class="attr">publishLocation:</span> <span class="string">'Container'</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">stage:</span> <span class="string">Deploy</span></span><br><span class="line">  <span class="attr">displayName:</span> <span class="string">'Deploy to Production'</span></span><br><span class="line">  <span class="attr">dependsOn:</span> <span class="string">Build</span></span><br><span class="line">  <span class="attr">condition:</span> <span class="string">and(succeeded(),</span> <span class="string">eq(variables['Build.SourceBranch'],</span> <span class="string">'refs/heads/main'</span><span class="string">))</span></span><br><span class="line">  <span class="attr">jobs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">deployment:</span> <span class="string">DeployToProduction</span></span><br><span class="line">    <span class="attr">displayName:</span> <span class="string">'Deploy to Production'</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="string">'production'</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">runOnce:</span></span><br><span class="line">        <span class="attr">deploy:</span></span><br><span class="line">          <span class="attr">steps:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">task:</span> <span class="string">AzureWebApp@1</span></span><br><span class="line">            <span class="attr">displayName:</span> <span class="string">'Deploy to Azure Web App'</span></span><br><span class="line">            <span class="attr">inputs:</span></span><br><span class="line">              <span class="attr">azureSubscription:</span> <span class="string">'Azure-Connection'</span></span><br><span class="line">              <span class="attr">appType:</span> <span class="string">'webApp'</span></span><br><span class="line">              <span class="attr">appName:</span> <span class="string">'my-dotnet-api'</span></span><br><span class="line">              <span class="attr">package:</span> <span class="string">'$(Pipeline.Workspace)/drop/*.zip'</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="七、实际应用案例"><a href="#七、实际应用案例" class="headerlink" title="七、实际应用案例"></a>七、实际应用案例</h1><h2 id="（一）电商平台微服务架构"><a href="#（一）电商平台微服务架构" class="headerlink" title="（一）电商平台微服务架构"></a>（一）电商平台微服务架构</h2><h3 id="1-系统架构设计"><a href="#1-系统架构设计" class="headerlink" title="1. 系统架构设计"></a>1. 系统架构设计</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户服务</span></span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">"api/[controller]"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UsersController</span> : <span class="title">ControllerBase</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IUserService _userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IEventBus _eventBus;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UsersController</span>(<span class="params">IUserService userService, IEventBus eventBus</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _userService = userService;</span><br><span class="line">        _eventBus = eventBus;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">HttpPost(<span class="string">"register"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;UserDto&gt;&gt; RegisterUser([FromBody] RegisterUserDto dto)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> user = <span class="keyword">await</span> _userService.RegisterUserAsync(dto);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发布用户注册事件</span></span><br><span class="line">        <span class="keyword">await</span> _eventBus.PublishAsync(<span class="keyword">new</span> UserRegisteredEvent</span><br><span class="line">        {</span><br><span class="line">            UserId = user.Id,</span><br><span class="line">            Email = user.Email,</span><br><span class="line">            Username = user.Username</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Ok(user);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单服务</span></span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">"api/[controller]"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrdersController</span> : <span class="title">ControllerBase</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IOrderService _orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IPaymentService _paymentService;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">HttpPost</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;OrderDto&gt;&gt; CreateOrder([FromBody] CreateOrderDto dto)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 创建订单</span></span><br><span class="line">        <span class="keyword">var</span> order = <span class="keyword">await</span> _orderService.CreateOrderAsync(dto);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理支付</span></span><br><span class="line">        <span class="keyword">var</span> paymentResult = <span class="keyword">await</span> _paymentService.ProcessPaymentAsync(</span><br><span class="line">            order.Id, dto.PaymentInfo);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (paymentResult.IsSuccess)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">await</span> _orderService.ConfirmOrderAsync(order.Id);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Ok(order);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 库存服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InventoryService</span> : <span class="title">IInventoryService</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRepository&lt;Product&gt; _productRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IDistributedLock _distributedLock;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ReserveInventoryAsync</span>(<span class="params"><span class="built_in">int</span> productId, <span class="built_in">int</span> quantity</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> lockKey = <span class="string">$"inventory:product:<span class="subst">{productId}</span>"</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> lockHandle = <span class="keyword">await</span> _distributedLock.AcquireAsync(lockKey, TimeSpan.FromSeconds(<span class="number">30</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (lockHandle != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> product = <span class="keyword">await</span> _productRepository.GetByIdAsync(productId);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (product.Stock &gt;= quantity)</span><br><span class="line">            {</span><br><span class="line">                product.Stock -= quantity;</span><br><span class="line">                <span class="keyword">await</span> _productRepository.UpdateAsync(product);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-分布式事务处理"><a href="#2-分布式事务处理" class="headerlink" title="2. 分布式事务处理"></a>2. 分布式事务处理</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Saga模式实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderSaga</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IOrderService _orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IPaymentService _paymentService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IInventoryService _inventoryService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IEventBus _eventBus;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">HandleOrderCreatedEvent</span>(<span class="params">OrderCreatedEvent @<span class="keyword">event</span></span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> sagaData = <span class="keyword">new</span> OrderSagaData</span><br><span class="line">        {</span><br><span class="line">            OrderId = @event.OrderId,</span><br><span class="line">            UserId = @event.UserId,</span><br><span class="line">            Items = @event.Items,</span><br><span class="line">            State = SagaState.Started</span><br><span class="line">        };</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 步骤1：预留库存</span></span><br><span class="line">            <span class="keyword">var</span> inventoryReserved = <span class="keyword">await</span> _inventoryService.ReserveInventoryAsync(</span><br><span class="line">                sagaData.Items);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!inventoryReserved)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">await</span> CompensateOrderAsync(sagaData);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            sagaData.State = SagaState.InventoryReserved;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 步骤2：处理支付</span></span><br><span class="line">            <span class="keyword">var</span> paymentResult = <span class="keyword">await</span> _paymentService.ProcessPaymentAsync(</span><br><span class="line">                sagaData.OrderId, sagaData.PaymentAmount);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!paymentResult.IsSuccess)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">await</span> CompensateInventoryAsync(sagaData);</span><br><span class="line">                <span class="keyword">await</span> CompensateOrderAsync(sagaData);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            sagaData.State = SagaState.PaymentProcessed;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 步骤3：确认订单</span></span><br><span class="line">            <span class="keyword">await</span> _orderService.ConfirmOrderAsync(sagaData.OrderId);</span><br><span class="line">            sagaData.State = SagaState.Completed;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">await</span> _eventBus.PublishAsync(<span class="keyword">new</span> OrderCompletedEvent</span><br><span class="line">            {</span><br><span class="line">                OrderId = sagaData.OrderId,</span><br><span class="line">                UserId = sagaData.UserId</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">await</span> CompensateAsync(sagaData);</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">CompensateAsync</span>(<span class="params">OrderSagaData sagaData</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">switch</span> (sagaData.State)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> SagaState.PaymentProcessed:</span><br><span class="line">                <span class="keyword">await</span> _paymentService.RefundPaymentAsync(sagaData.OrderId);</span><br><span class="line">                <span class="keyword">goto</span> <span class="keyword">case</span> SagaState.InventoryReserved;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">case</span> SagaState.InventoryReserved:</span><br><span class="line">                <span class="keyword">await</span> _inventoryService.ReleaseInventoryAsync(sagaData.Items);</span><br><span class="line">                <span class="keyword">goto</span> <span class="keyword">case</span> SagaState.Started;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">case</span> SagaState.Started:</span><br><span class="line">                <span class="keyword">await</span> _orderService.CancelOrderAsync(sagaData.OrderId);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）企业级应用最佳实践"><a href="#（二）企业级应用最佳实践" class="headerlink" title="（二）企业级应用最佳实践"></a>（二）企业级应用最佳实践</h2><h3 id="1-配置管理"><a href="#1-配置管理" class="headerlink" title="1. 配置管理"></a>1. 配置管理</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 强类型配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApplicationSettings</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> DatabaseSettings Database { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> RedisSettings Redis { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> JwtSettings Jwt { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> EmailSettings Email { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DatabaseSettings</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ConnectionString { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> CommandTimeout { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> EnableSensitiveDataLogging { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JwtSettings</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> SecretKey { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Issuer { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Audience { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> ExpirationMinutes { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="number">60</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置验证</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApplicationSettingsValidator</span> : <span class="title">IValidateOptions</span>&lt;<span class="title">ApplicationSettings</span>&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ValidateOptionsResult <span class="title">Validate</span>(<span class="params"><span class="built_in">string</span> name, ApplicationSettings options</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> errors = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(options.Database?.ConnectionString))</span><br><span class="line">        {</span><br><span class="line">            errors.Add(<span class="string">"Database connection string is required"</span>);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(options.Jwt?.SecretKey) || </span><br><span class="line">            options.Jwt.SecretKey.Length &lt; <span class="number">32</span>)</span><br><span class="line">        {</span><br><span class="line">            errors.Add(<span class="string">"JWT secret key must be at least 32 characters"</span>);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (errors.Any())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> ValidateOptionsResult.Fail(errors);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ValidateOptionsResult.Success;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Startup配置</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 绑定配置</span></span><br><span class="line">    services.Configure&lt;ApplicationSettings&gt;(Configuration);</span><br><span class="line">    services.AddSingleton&lt;IValidateOptions&lt;ApplicationSettings&gt;, </span><br><span class="line">                         ApplicationSettingsValidator&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用配置</span></span><br><span class="line">    services.AddScoped(provider =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">var</span> options = provider.GetRequiredService&lt;IOptions&lt;ApplicationSettings&gt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> options.Value;</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-错误处理和日志记录"><a href="#2-错误处理和日志记录" class="headerlink" title="2. 错误处理和日志记录"></a>2. 错误处理和日志记录</h3><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局异常处理中间件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GlobalExceptionHandlingMiddleware</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> RequestDelegate _next;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;GlobalExceptionHandlingMiddleware&gt; _logger;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlobalExceptionHandlingMiddleware</span>(<span class="params">RequestDelegate next,</span></span></span><br><span class="line"><span class="params"><span class="function">                                           ILogger&lt;GlobalExceptionHandlingMiddleware&gt; logger</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _next = next;</span><br><span class="line">        _logger = logger;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">InvokeAsync</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">await</span> _next(context);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        {</span><br><span class="line">            _logger.LogError(ex, <span class="string">"An unhandled exception occurred"</span>);</span><br><span class="line">            <span class="keyword">await</span> HandleExceptionAsync(context, ex);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">HandleExceptionAsync</span>(<span class="params">HttpContext context, Exception exception</span>)</span></span><br><span class="line">    {</span><br><span class="line">        context.Response.ContentType = <span class="string">"application/json"</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> response = <span class="keyword">new</span> ErrorResponse();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (exception)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> ValidationException validationEx:</span><br><span class="line">                response.StatusCode = <span class="number">400</span>;</span><br><span class="line">                response.Message = <span class="string">"Validation failed"</span>;</span><br><span class="line">                response.Details = validationEx.Errors;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">case</span> NotFoundException notFoundEx:</span><br><span class="line">                response.StatusCode = <span class="number">404</span>;</span><br><span class="line">                response.Message = notFoundEx.Message;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">case</span> UnauthorizedException unauthorizedEx:</span><br><span class="line">                response.StatusCode = <span class="number">401</span>;</span><br><span class="line">                response.Message = <span class="string">"Unauthorized access"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                response.StatusCode = <span class="number">500</span>;</span><br><span class="line">                response.Message = <span class="string">"An internal server error occurred"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        context.Response.StatusCode = response.StatusCode;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> jsonResponse = JsonSerializer.Serialize(response);</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(jsonResponse);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ErrorResponse</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> StatusCode { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Message { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">object</span> Details { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> TraceId { <span class="keyword">get</span>; <span class="keyword">set</span>; } = Activity.Current?.Id;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="八、总结与展望"><a href="#八、总结与展望" class="headerlink" title="八、总结与展望"></a>八、总结与展望</h1><h2 id="（一）-NET生态系统优势"><a href="#（一）-NET生态系统优势" class="headerlink" title="（一）.NET生态系统优势"></a>（一）.NET生态系统优势</h2><h3 id="1-技术优势"><a href="#1-技术优势" class="headerlink" title="1. 技术优势"></a>1. 技术优势</h3><ul>
<li><strong>跨平台能力</strong>：支持Windows、macOS、Linux多平台部署</li>
<li><strong>高性能</strong>：优化的运行时和编译器，出色的性能表现</li>
<li><strong>现代化架构</strong>：微服务、云原生、容器化友好</li>
<li><strong>强类型系统</strong>：编译时错误检查，提高代码质量</li>
<li><strong>丰富的生态</strong>：完善的包管理和第三方库支持</li>
</ul>
<h3 id="2-企业级特性"><a href="#2-企业级特性" class="headerlink" title="2. 企业级特性"></a>2. 企业级特性</h3><ul>
<li><strong>成熟的开发工具</strong>：Visual Studio、VS Code等优秀IDE</li>
<li><strong>完善的监控诊断</strong>：Application Insights、健康检查等</li>
<li><strong>安全性</strong>：内置安全特性，符合企业级安全要求</li>
<li><strong>可扩展性</strong>：支持水平扩展和垂直扩展</li>
<li><strong>社区支持</strong>：活跃的开发者社区和微软官方支持</li>
</ul>
<h2 id="（二）适用场景"><a href="#（二）适用场景" class="headerlink" title="（二）适用场景"></a>（二）适用场景</h2><h3 id="1-企业级Web应用"><a href="#1-企业级Web应用" class="headerlink" title="1. 企业级Web应用"></a>1. 企业级Web应用</h3><ul>
<li>大型电商平台</li>
<li>企业管理系统</li>
<li>金融服务应用</li>
<li>政府信息系统</li>
</ul>
<h3 id="2-微服务架构"><a href="#2-微服务架构" class="headerlink" title="2. 微服务架构"></a>2. 微服务架构</h3><ul>
<li>分布式系统</li>
<li>云原生应用</li>
<li>API网关服务</li>
<li>事件驱动架构</li>
</ul>
<h3 id="3-实时应用"><a href="#3-实时应用" class="headerlink" title="3. 实时应用"></a>3. 实时应用</h3><ul>
<li>在线聊天系统</li>
<li>实时数据监控</li>
<li>游戏服务器</li>
<li>IoT数据处理</li>
</ul>
<h2 id="（三）学习建议"><a href="#（三）学习建议" class="headerlink" title="（三）学习建议"></a>（三）学习建议</h2><h3 id="1-学习路径"><a href="#1-学习路径" class="headerlink" title="1. 学习路径"></a>1. 学习路径</h3><ol>
<li><strong>基础语法</strong>：掌握C#语言基础和面向对象编程</li>
<li><strong>Web开发</strong>：学习ASP.NET Core框架和Web API开发</li>
<li><strong>数据访问</strong>：掌握Entity Framework Core和数据库操作</li>
<li><strong>微服务</strong>：了解微服务架构和相关技术栈</li>
<li><strong>DevOps</strong>：学习容器化、CI/CD和云部署</li>
</ol>
<h3 id="2-实践项目"><a href="#2-实践项目" class="headerlink" title="2. 实践项目"></a>2. 实践项目</h3><ul>
<li>构建RESTful API服务</li>
<li>开发微服务应用</li>
<li>实现实时通信功能</li>
<li>集成第三方服务</li>
<li>部署到云平台</li>
</ul>
<h2 id="（四）未来发展趋势"><a href="#（四）未来发展趋势" class="headerlink" title="（四）未来发展趋势"></a>（四）未来发展趋势</h2><h3 id="1-技术发展方向"><a href="#1-技术发展方向" class="headerlink" title="1. 技术发展方向"></a>1. 技术发展方向</h3><ul>
<li>**.NET 9+**：持续的性能优化和新特性</li>
<li><strong>云原生优化</strong>：更好的容器和Kubernetes支持</li>
<li><strong>AI/ML集成</strong>：机器学习和人工智能能力增强</li>
<li><strong>WebAssembly</strong>：前端应用开发能力扩展</li>
</ul>
<h3 id="2-生态系统演进"><a href="#2-生态系统演进" class="headerlink" title="2. 生态系统演进"></a>2. 生态系统演进</h3><ul>
<li><strong>开源生态</strong>：更多开源项目和社区贡献</li>
<li><strong>跨平台增强</strong>：移动端和嵌入式设备支持</li>
<li><strong>性能提升</strong>：AOT编译和运行时优化</li>
<li><strong>开发体验</strong>：更智能的开发工具和调试能力</li>
</ul>
<p>C#和.NET生态系统作为现代企业级开发平台，凭借其强大的技术能力、完善的工具链和活跃的社区支持，已经成为构建高性能、可扩展、安全可靠应用的首选技术栈。无论是传统的Web应用开发，还是现代的微服务架构和云原生应用，.NET都能提供完整的解决方案和最佳实践。</p>
<p>随着技术的不断演进和生态系统的持续完善，.NET将继续在企业级应用开发领域发挥重要作用，为开发者提供更加高效、现代化的开发体验。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://hexo.blog.uwakeme.tech/about/">Wake</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://hexo.blog.uwakeme.tech/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91C#%E5%92%8C.NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/">https://hexo.blog.uwakeme.tech/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91C#%E5%92%8C.NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://hexo.blog.uwakeme.tech" target="_blank">Uwakeme</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF/">后端</a><a class="post-meta__tags" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><a class="post-meta__tags" href="/tags/C/">C#</a><a class="post-meta__tags" href="/tags/NET/">.NET</a><a class="post-meta__tags" href="/tags/ASP-NET-Core/">ASP.NET Core</a><a class="post-meta__tags" href="/tags/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91/">企业级开发</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/reward/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/reward/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/15/%E6%95%B0%E6%8D%AE%E5%BA%93/%E3%80%90%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%91%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%B0%E7%90%86%E5%88%86%E7%89%87%E8%AF%A6%E8%A7%A3%EF%BC%9A%E8%B7%A8%E5%9C%B0%E5%8C%BA%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E4%B8%8E%E8%AF%BB%E5%86%99%E7%AD%96%E7%95%A5/" title="【数据库】数据库地理分片详解：跨地区数据分布与读写策略"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/uwakeme/personal-image-repository/images/database-sharding.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">【数据库】数据库地理分片详解：跨地区数据分布与读写策略</div></div><div class="info-2"><div class="info-item-1">随着全球化业务的快速发展，现代应用程序需要为分布在世界各地的用户提供低延迟、高可用的服务。数据库地理分片作为一种重要的分布式数据库技术，通过将数据按地理位置进行分片存储，实现了数据的就近访问和跨地区的高可用性。本文将深入探讨数据库地理分片的核心概念、实现方案以及跨地区读写策略。 一、数据库地理分片概述（一）什么是地理分片地理分片（Geo-Sharding） 是一种数据库水平分片技术，它根据地理位置将数据分布到不同地区的数据库节点上。与传统的基于哈希或范围的分片不同，地理分片主要考虑数据的地理属性和用户的地理位置。 核心特征 地理位置感知：根据数据的地理属性或用户位置进行分片 就近访问：用户可以访问距离最近的数据节点 跨地区分布：数据分布在多个地理位置的数据中心 高可用性：单个地区故障不影响其他地区的服务  （二）地理分片的优势1. 延迟优化graph TD     A[用户请求] --&gt; B{地理位置检测}     B --&gt; C[北美数据中心]     B --&gt; D[欧洲数据中心]     B --&gt; E[亚洲数据中心]     C --&gt; F[本地数据访问]     D -...</div></div></div></a><a class="pagination-related" href="/2025/01/15/%E5%90%8E%E7%AB%AF/%E3%80%90%E5%90%8E%E7%AB%AF%E3%80%91%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E9%80%89%E6%8B%A9%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E%E5%8D%95%E4%BD%93%E5%88%B0%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/" title="【后端】业务模块划分与微服务架构选择指南：从单体到微服务的演进之路"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【后端】业务模块划分与微服务架构选择指南：从单体到微服务的演进之路</div></div><div class="info-2"><div class="info-item-1">一、引言在现代软件开发中，如何合理划分业务模块、选择合适的架构模式是每个技术团队都会面临的重要决策。随着业务复杂度的增加和团队规模的扩大，传统的单体架构逐渐暴露出扩展性、维护性等方面的局限性，微服务架构应运而生。然而，微服务并非银弹，盲目采用可能带来更多问题。 本文将深入探讨业务模块划分的原则和方法，对比单体架构与微服务架构的优劣，并提供实用的架构选择指南，帮助读者在不同场景下做出明智的技术决策。 核心观点预览  业务模块划分是架构设计的基础，应遵循高内聚、低耦合原则 单体架构与微服务各有适用场景，需要根据团队规模、业务复杂度等因素综合考虑 DDD（领域驱动设计）为业务模块划分提供了科学的方法论 架构演进应该是渐进式的，而非一蹴而就    二、业务模块划分的基础理论（一）模块化设计的核心原则1. 高内聚原则高内聚是指模块内部的元素紧密相关，共同完成一个明确的功能。在业务系统中，这意味着相关的业务逻辑、数据和操作应该聚集在同一个模块中。 1234567891011121314151617181920212223242526272829303132// 高内聚的用户管理模块示例@Se...</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Wake</div><div class="author-info-description">一起学习，一起进步</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">252</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">688</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/uwakeme"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/uwakeme" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wakemeup2025@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！这里分享技术知识、学习心得和生活感悟。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E5%86%85%E5%AE%B9%E6%A6%82%E8%A7%88"><span class="toc-text">本文内容概览</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81-NET%E5%B9%B3%E5%8F%B0%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="toc-text">一、.NET平台发展历程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%8A%80%E6%9C%AF%E6%BC%94%E8%BF%9B%E9%98%B6%E6%AE%B5"><span class="toc-text">（一）技术演进阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NET-Framework%E6%97%B6%E4%BB%A3%EF%BC%882002-2016%EF%BC%89"><span class="toc-text">1. .NET Framework时代（2002-2016）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NET-Core%E6%97%B6%E4%BB%A3%EF%BC%882016-2020%EF%BC%89"><span class="toc-text">2. .NET Core时代（2016-2020）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NET-5-%E7%BB%9F%E4%B8%80%E6%97%B6%E4%BB%A3%EF%BC%882020-%E8%87%B3%E4%BB%8A%EF%BC%89"><span class="toc-text">3. .NET 5+统一时代（2020-至今）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B9%B3%E5%8F%B0%E7%89%B9%E6%80%A7%E5%AF%B9%E6%AF%94"><span class="toc-text">（二）平台特性对比</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-NET-Core%E5%B9%B3%E5%8F%B0%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-text">二、.NET Core平台深度解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E7%BB%84%E4%BB%B6"><span class="toc-text">（一）核心架构组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NET-Core%E8%BF%90%E8%A1%8C%E6%97%B6"><span class="toc-text">1. .NET Core运行时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%BA%93%EF%BC%88BCL%EF%BC%89"><span class="toc-text">2. 基础类库（BCL）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%B9%B3%E5%8F%B0%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3"><span class="toc-text">（二）平台特性详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%83%BD%E5%8A%9B-1"><span class="toc-text">1. 跨平台能力 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%AB%98%E6%80%A7%E8%83%BD%E7%89%B9%E6%80%A7"><span class="toc-text">2. 高性能特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="toc-text">3. 依赖注入容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81ASP-NET-Core-Web%E6%A1%86%E6%9E%B6"><span class="toc-text">三、ASP.NET Core Web框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-text">（一）核心特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%AE%A1%E9%81%93-2"><span class="toc-text">1. 中间件管道 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Web-API%E5%BC%80%E5%8F%91"><span class="toc-text">2. Web API开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1%EF%BC%88SignalR%EF%BC%89"><span class="toc-text">3. 实时通信（SignalR）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-text">（二）企业级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83"><span class="toc-text">1. 身份认证与授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%EF%BC%88Entity-Framework-Core%EF%BC%89"><span class="toc-text">2. 数据访问（Entity Framework Core）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-NET%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text">四、.NET微服务架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0-1"><span class="toc-text">（一）微服务架构概述 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99-1"><span class="toc-text">1. 微服务设计原则 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-text">2. 微服务核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-API%E7%BD%91%E5%85%B3%E5%AE%9E%E7%8E%B0"><span class="toc-text">3. API网关实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%BC%8F-3"><span class="toc-text">（二）微服务通信模式 3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-HTTP-REST%E9%80%9A%E4%BF%A1"><span class="toc-text">1. HTTP REST通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%80%9A%E4%BF%A1"><span class="toc-text">2. 消息队列通信</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E7%89%B9%E6%80%A7"><span class="toc-text">五、企业级开发特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">（一）性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-text">1. 缓存策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">2. 异步编程最佳实践</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD-3"><span class="toc-text">（二）监控与诊断 3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="toc-text">1. 健康检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BA%94%E7%94%A8%E7%9B%91%E6%8E%A7"><span class="toc-text">2. 应用监控</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%94%9F%E6%80%81"><span class="toc-text">六、开发工具生态</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89Visual-Studio%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C"><span class="toc-text">（一）Visual Studio开发体验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF%E5%92%8C%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-text">1. 项目模板和脚手架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%B0%83%E8%AF%95%E5%92%8C%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7"><span class="toc-text">2. 调试和诊断工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89DevOps%E9%9B%86%E6%88%90"><span class="toc-text">（二）DevOps集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Docker%E5%AE%B9%E5%99%A8%E5%8C%96"><span class="toc-text">1. Docker容器化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-CI-CD%E7%AE%A1%E9%81%93"><span class="toc-text">2. CI/CD管道</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">七、实际应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E7%94%B5%E5%95%86%E5%B9%B3%E5%8F%B0%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text">（一）电商平台微服务架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">1. 系统架构设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-text">2. 分布式事务处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">（二）企业级应用最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-text">1. 配置管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%92%8C%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-text">2. 错误处理和日志记录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-text">八、总结与展望</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89-NET%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8A%BF"><span class="toc-text">（一）.NET生态系统优势</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF"><span class="toc-text">1. 技术优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-text">2. 企业级特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">（二）适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BC%81%E4%B8%9A%E7%BA%A7Web%E5%BA%94%E7%94%A8"><span class="toc-text">1. 企业级Web应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text">2. 微服务架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%9E%E6%97%B6%E5%BA%94%E7%94%A8"><span class="toc-text">3. 实时应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="toc-text">（三）学习建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-text">1. 学习路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE"><span class="toc-text">2. 实践项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E6%9C%AA%E6%9D%A5%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF"><span class="toc-text">（四）未来发展趋势</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95%E6%96%B9%E5%90%91"><span class="toc-text">1. 技术发展方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%BC%94%E8%BF%9B"><span class="toc-text">2. 生态系统演进</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/13/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%9AKMP%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="【算法】字符串匹配算法深入解析：KMP算法原理与实现"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】字符串匹配算法深入解析：KMP算法原理与实现"></a><div class="content"><a class="title" href="/2026/02/13/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%9AKMP%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="【算法】字符串匹配算法深入解析：KMP算法原理与实现">【算法】字符串匹配算法深入解析：KMP算法原理与实现</a><time datetime="2026-02-13T09:06:00.000Z" title="发表于 2026-02-13 17:06:00">2026-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/22/BUG/%E3%80%90BUG%E3%80%91Claude%20Code%E8%B7%B3%E8%BF%87%E5%BC%BA%E5%88%B6%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="【BUG】Claude Code跳过强制登录解决方法"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/uwakeme/personal-image-repository/master/images/20260122114551679.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【BUG】Claude Code跳过强制登录解决方法"></a><div class="content"><a class="title" href="/2026/01/22/BUG/%E3%80%90BUG%E3%80%91Claude%20Code%E8%B7%B3%E8%BF%87%E5%BC%BA%E5%88%B6%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="【BUG】Claude Code跳过强制登录解决方法">【BUG】Claude Code跳过强制登录解决方法</a><time datetime="2026-01-22T03:45:00.000Z" title="发表于 2026-01-22 11:45:00">2026-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%88%86%E8%80%8C%E6%B2%BB%E4%B9%8B%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" title="【算法】《算法图解》第四章学习笔记：分而治之与快速排序"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】《算法图解》第四章学习笔记：分而治之与快速排序"></a><div class="content"><a class="title" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%88%86%E8%80%8C%E6%B2%BB%E4%B9%8B%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" title="【算法】《算法图解》第四章学习笔记：分而治之与快速排序">【算法】《算法图解》第四章学习笔记：分而治之与快速排序</a><time datetime="2026-01-15T08:48:25.264Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95/" title="【算法】《算法图解》第十章学习笔记：贪婪算法"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】《算法图解》第十章学习笔记：贪婪算法"></a><div class="content"><a class="title" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95/" title="【算法】《算法图解》第十章学习笔记：贪婪算法">【算法】《算法图解》第十章学习笔记：贪婪算法</a><time datetime="2026-01-15T08:48:25.264Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%A6%82%E4%BD%95%E5%81%9A/" title="【算法】《算法图解》第十三章学习笔记：接下来如何做"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】《算法图解》第十三章学习笔记：接下来如何做"></a><div class="content"><a class="title" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%A6%82%E4%BD%95%E5%81%9A/" title="【算法】《算法图解》第十三章学习笔记：接下来如何做">【算法】《算法图解》第十三章学习笔记：接下来如何做</a><time datetime="2026-01-15T08:48:25.263Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">©2024 - 2026 By Wake</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.8.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23liBiL0mPM9ywqcV3',
      clientSecret: '99811bbc42de51338a2ef755501651c968f3240c',
      repo: 'gitalk-pool',
      owner: 'uwakeme',
      admin: ['uwakeme'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'ae80ecb3375bf79df68b9f86440008f2'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-nest.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="请输入搜索内容" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/search/local-search.min.js"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script src="/bundle.js"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});;

            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        ;
window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});;
(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>