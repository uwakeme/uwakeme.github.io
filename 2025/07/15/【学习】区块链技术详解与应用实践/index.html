

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/uwakeme/cdn@main/img/favicon.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Wake">
  <meta name="keywords" content="技术博客, Web开发, 后端开发, Java, Python, 人工智能, 编程学习, 技术分享">
  
    <meta name="description" content="前言区块链技术作为近年来最具革命性的技术之一，正在深刻改变着金融、供应链、医疗、政务等各个领域。从比特币的诞生到以太坊智能合约的兴起，再到各种DeFi应用的蓬勃发展，区块链技术展现出了巨大的潜力和价值。 本文将从技术原理出发，深入解析区块链的核心概念、关键技术、共识机制、智能合约等内容，并通过实际代码示例帮助读者理解区块链的工作原理。无论您是技术开发者、产品经理，还是对区块链技术感兴趣的学习者，都">
<meta property="og:type" content="article">
<meta property="og:title" content="【学习】区块链技术详解与应用实践">
<meta property="og:url" content="https://uwakeme.top/2025/07/15/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="Uwakeme">
<meta property="og:description" content="前言区块链技术作为近年来最具革命性的技术之一，正在深刻改变着金融、供应链、医疗、政务等各个领域。从比特币的诞生到以太坊智能合约的兴起，再到各种DeFi应用的蓬勃发展，区块链技术展现出了巨大的潜力和价值。 本文将从技术原理出发，深入解析区块链的核心概念、关键技术、共识机制、智能合约等内容，并通过实际代码示例帮助读者理解区块链的工作原理。无论您是技术开发者、产品经理，还是对区块链技术感兴趣的学习者，都">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-15T02:03:44.231Z">
<meta property="article:modified_time" content="2025-07-15T02:03:44.231Z">
<meta property="article:author" content="Wake">
<meta property="article:tag" content="分布式系统">
<meta property="article:tag" content="区块链">
<meta property="article:tag" content="加密技术">
<meta property="article:tag" content="智能合约">
<meta property="article:tag" content="去中心化">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>【学习】区块链技术详解与应用实践 - Uwakeme</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3846514_kabxni94auf.css">
<link rel="stylesheet" href="/css/custom.css">
<link rel="stylesheet" href="/css/ai-assistant.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"uwakeme.top","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"|","loop":false,"scope":[],"backSpeed":40,"showCursor":true},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100},"position_indicator":{"enable":true,"color":"#33a3dc"}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""],"img_max_width":"80%","img_max_height":"80%"},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0,"level":3,"collapse":false,"follow":true,"number":true,"heading_list":true,"expand_all":true},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2,"element_loading_img":true},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"41fc030db57d5570dd22f78997dc4a7e","google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null},"busuanzi":{"enable":true,"script_url":"//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","site_uv":true,"site_pv":true,"page_pv":true}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?41fc030db57d5570dd22f78997dc4a7e";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Wake 的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives" target="_self">
                <i class="iconfont icon-books"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories" target="_self">
                <i class="iconfont icon-th-large"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-book"></i>
                <span>文档</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="https://hexo.fluid-dev.com/" target="_self">
                    
                    <span>主题博客</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://hexo.fluid-dev.com/docs/guide/" target="_self">
                    
                    <span>配置指南</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://hexo.fluid-dev.com/docs/icon/" target="_self">
                    
                    <span>图标用法</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="【学习】区块链技术详解与应用实践"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Wake
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-15 10:03" pubdate>
          2025-07-15 10:03
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          86 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">【学习】区块链技术详解与应用实践</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>区块链技术作为近年来最具革命性的技术之一，正在深刻改变着金融、供应链、医疗、政务等各个领域。从比特币的诞生到以太坊智能合约的兴起，再到各种DeFi应用的蓬勃发展，区块链技术展现出了巨大的潜力和价值。</p>
<p>本文将从技术原理出发，深入解析区块链的核心概念、关键技术、共识机制、智能合约等内容，并通过实际代码示例帮助读者理解区块链的工作原理。无论您是技术开发者、产品经理，还是对区块链技术感兴趣的学习者，都能从本文中获得有价值的知识和实践指导。</p>
<h1 id="一、区块链基础概念"><a href="#一、区块链基础概念" class="headerlink" title="一、区块链基础概念"></a>一、区块链基础概念</h1><h2 id="（一）什么是区块链"><a href="#（一）什么是区块链" class="headerlink" title="（一）什么是区块链"></a>（一）什么是区块链</h2><p>区块链（Blockchain）是一种分布式数据库技术，它将数据存储在一个个相互连接的区块中，形成一个不可篡改的链式结构。每个区块包含一定数量的交易记录，并通过密码学哈希函数与前一个区块相连。</p>
<h3 id="1-核心特征"><a href="#1-核心特征" class="headerlink" title="1. 核心特征"></a>1. 核心特征</h3><ul>
<li><strong>去中心化</strong>：没有中央控制机构，所有节点平等参与</li>
<li><strong>不可篡改</strong>：一旦数据写入区块链，几乎无法修改</li>
<li><strong>透明性</strong>：所有交易记录公开可查</li>
<li><strong>匿名性</strong>：用户身份通过密码学地址保护</li>
<li><strong>共识机制</strong>：通过算法确保网络一致性</li>
</ul>
<h3 id="2-区块链的基本结构"><a href="#2-区块链的基本结构" class="headerlink" title="2. 区块链的基本结构"></a>2. 区块链的基本结构</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> json
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">Block</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""区块类定义"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">,</span> transactions<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> previous_hash<span class="token punctuation">,</span> nonce<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> index                    <span class="token comment"># 区块索引</span>
        self<span class="token punctuation">.</span>transactions <span class="token operator">=</span> transactions      <span class="token comment"># 交易列表</span>
        self<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> timestamp           <span class="token comment"># 时间戳</span>
        self<span class="token punctuation">.</span>previous_hash <span class="token operator">=</span> previous_hash   <span class="token comment"># 前一个区块的哈希值</span>
        self<span class="token punctuation">.</span>nonce <span class="token operator">=</span> nonce                   <span class="token comment"># 工作量证明随机数</span>
        self<span class="token punctuation">.</span><span class="token builtin">hash</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_hash<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 当前区块哈希值</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_hash</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算区块哈希值"""</span>
        block_string <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token string">"index"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
            <span class="token string">"transactions"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>transactions<span class="token punctuation">,</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"previous_hash"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>previous_hash<span class="token punctuation">,</span>
            <span class="token string">"nonce"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>nonce
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> sort_keys<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>block_string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">mine_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> difficulty<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""挖矿过程 - 工作量证明"""</span>
        target <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">*</span> difficulty
        <span class="token keyword">while</span> self<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">[</span><span class="token punctuation">:</span>difficulty<span class="token punctuation">]</span> <span class="token operator">!=</span> target<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>nonce <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span><span class="token builtin">hash</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_hash<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"区块挖掘成功: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 创建创世区块</span>
<span class="token keyword">def</span> <span class="token function">create_genesis_block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Block<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>

<span class="token comment"># 示例使用</span>
genesis_block <span class="token operator">=</span> create_genesis_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"创世区块哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>genesis_block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h2 id="（二）区块链的分类"><a href="#（二）区块链的分类" class="headerlink" title="（二）区块链的分类"></a>（二）区块链的分类</h2><h3 id="1-按访问权限分类"><a href="#1-按访问权限分类" class="headerlink" title="1. 按访问权限分类"></a>1. 按访问权限分类</h3><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>应用场景</th>
<th>代表项目</th>
</tr>
</thead>
<tbody><tr>
<td><strong>公有链</strong></td>
<td>完全去中心化，任何人可参与</td>
<td>数字货币、DeFi</td>
<td>Bitcoin、Ethereum</td>
</tr>
<tr>
<td><strong>私有链</strong></td>
<td>由单一组织控制</td>
<td>企业内部应用</td>
<td>Hyperledger Fabric</td>
</tr>
<tr>
<td><strong>联盟链</strong></td>
<td>由多个组织共同维护</td>
<td>行业联盟、供应链</td>
<td>R3 Corda</td>
</tr>
<tr>
<td><strong>混合链</strong></td>
<td>结合公有链和私有链特点</td>
<td>企业级应用</td>
<td>各种企业解决方案</td>
</tr>
</tbody></table>
<h3 id="2-按技术架构分类"><a href="#2-按技术架构分类" class="headerlink" title="2. 按技术架构分类"></a>2. 按技术架构分类</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 不同共识机制的简单实现示例</span>

<span class="token keyword">class</span> <span class="token class-name">ConsensusAlgorithm</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""共识算法基类"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    
    <span class="token keyword">def</span> <span class="token function">validate_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError

<span class="token keyword">class</span> <span class="token class-name">ProofOfWork</span><span class="token punctuation">(</span>ConsensusAlgorithm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""工作量证明"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> difficulty<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token string">"Proof of Work"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>difficulty <span class="token operator">=</span> difficulty
    
    <span class="token keyword">def</span> <span class="token function">validate_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证工作量证明"""</span>
        target <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>difficulty
        <span class="token keyword">return</span> block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">mine_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""挖矿过程"""</span>
        block<span class="token punctuation">.</span>mine_block<span class="token punctuation">(</span>self<span class="token punctuation">.</span>difficulty<span class="token punctuation">)</span>
        <span class="token keyword">return</span> block

<span class="token keyword">class</span> <span class="token class-name">ProofOfStake</span><span class="token punctuation">(</span>ConsensusAlgorithm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""权益证明"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token string">"Proof of Stake"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 验证者及其权益</span>
    
    <span class="token keyword">def</span> <span class="token function">add_validator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">,</span> stake<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加验证者"""</span>
        self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>address<span class="token punctuation">]</span> <span class="token operator">=</span> stake
    
    <span class="token keyword">def</span> <span class="token function">select_validator</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""根据权益选择验证者"""</span>
        total_stake <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>validators<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">import</span> random
        random_point <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> total_stake<span class="token punctuation">)</span>
        
        current_stake <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> validator<span class="token punctuation">,</span> stake <span class="token keyword">in</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            current_stake <span class="token operator">+=</span> stake
            <span class="token keyword">if</span> current_stake <span class="token operator">>=</span> random_point<span class="token punctuation">:</span>
                <span class="token keyword">return</span> validator
        <span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token comment"># 使用示例</span>
pow_consensus <span class="token operator">=</span> ProofOfWork<span class="token punctuation">(</span>difficulty<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
pos_consensus <span class="token operator">=</span> ProofOfStake<span class="token punctuation">(</span><span class="token punctuation">)</span>
pos_consensus<span class="token punctuation">.</span>add_validator<span class="token punctuation">(</span><span class="token string">"validator1"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
pos_consensus<span class="token punctuation">.</span>add_validator<span class="token punctuation">(</span><span class="token string">"validator2"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

selected_validator <span class="token operator">=</span> pos_consensus<span class="token punctuation">.</span>select_validator<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"选中的验证者: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>selected_validator<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h1 id="二、区块链核心技术"><a href="#二、区块链核心技术" class="headerlink" title="二、区块链核心技术"></a>二、区块链核心技术</h1><h2 id="（一）密码学基础"><a href="#（一）密码学基础" class="headerlink" title="（一）密码学基础"></a>（一）密码学基础</h2><h3 id="1-哈希函数"><a href="#1-哈希函数" class="headerlink" title="1. 哈希函数"></a>1. 哈希函数</h3><p>哈希函数是区块链的基础，它将任意长度的输入转换为固定长度的输出，具有单向性和雪崩效应。</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> hmac

<span class="token keyword">class</span> <span class="token class-name">CryptographicUtils</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""密码学工具类"""</span>
    
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">sha256_hash</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""SHA-256哈希"""</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">merkle_root</span><span class="token punctuation">(</span>transactions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算默克尔树根"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> transactions<span class="token punctuation">:</span>
            <span class="token keyword">return</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 如果交易数量为奇数，复制最后一个</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>transactions<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            transactions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>transactions<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 递归计算默克尔树</span>
        <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>transactions<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>
            next_level <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>transactions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                combined <span class="token operator">=</span> transactions<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> transactions<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
                next_level<span class="token punctuation">.</span>append<span class="token punctuation">(</span>CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span>combined<span class="token punctuation">)</span><span class="token punctuation">)</span>
            transactions <span class="token operator">=</span> next_level
        
        <span class="token keyword">return</span> transactions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">hmac_signature</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""HMAC签名"""</span>
        <span class="token keyword">return</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>
            key<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            hashlib<span class="token punctuation">.</span>sha256
        <span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 示例：默克尔树计算</span>
transactions <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"tx1: Alice -> Bob: 10 BTC"</span><span class="token punctuation">,</span>
    <span class="token string">"tx2: Bob -> Charlie: 5 BTC"</span><span class="token punctuation">,</span>
    <span class="token string">"tx3: Charlie -> David: 3 BTC"</span><span class="token punctuation">,</span>
    <span class="token string">"tx4: David -> Eve: 2 BTC"</span>
<span class="token punctuation">]</span>

merkle_root <span class="token operator">=</span> CryptographicUtils<span class="token punctuation">.</span>merkle_root<span class="token punctuation">(</span>transactions<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"默克尔树根: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>merkle_root<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 验证数据完整性</span>
original_hash <span class="token operator">=</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span><span class="token string">"重要数据"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"原始数据哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>original_hash<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 数据被篡改后</span>
tampered_hash <span class="token operator">=</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span><span class="token string">"被篡改的数据"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"篡改后哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>tampered_hash<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据是否被篡改: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>original_hash <span class="token operator">!=</span> tampered_hash<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h3 id="2-数字签名"><a href="#2-数字签名" class="headerlink" title="2. 数字签名"></a>2. 数字签名</h3><p>数字签名确保交易的真实性和不可否认性。</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives <span class="token keyword">import</span> hashes<span class="token punctuation">,</span> serialization
<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>hazmat<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span>asymmetric <span class="token keyword">import</span> rsa<span class="token punctuation">,</span> padding
<span class="token keyword">from</span> cryptography<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> InvalidSignature
<span class="token keyword">import</span> base64

<span class="token keyword">class</span> <span class="token class-name">DigitalSignature</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""数字签名类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>private_key <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>public_key <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_key_pair</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成密钥对"""</span>
        self<span class="token punctuation">.</span>private_key <span class="token operator">=</span> rsa<span class="token punctuation">.</span>generate_private_key<span class="token punctuation">(</span>
            public_exponent<span class="token operator">=</span><span class="token number">65537</span><span class="token punctuation">,</span>
            key_size<span class="token operator">=</span><span class="token number">2048</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>public_key <span class="token operator">=</span> self<span class="token punctuation">.</span>private_key<span class="token punctuation">.</span>public_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>private_key<span class="token punctuation">,</span> self<span class="token punctuation">.</span>public_key
    
    <span class="token keyword">def</span> <span class="token function">sign_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""签名消息"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>private_key<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"请先生成密钥对"</span><span class="token punctuation">)</span>
        
        message_bytes <span class="token operator">=</span> message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        signature <span class="token operator">=</span> self<span class="token punctuation">.</span>private_key<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>
            message_bytes<span class="token punctuation">,</span>
            padding<span class="token punctuation">.</span>PSS<span class="token punctuation">(</span>
                mgf<span class="token operator">=</span>padding<span class="token punctuation">.</span>MGF1<span class="token punctuation">(</span>hashes<span class="token punctuation">.</span>SHA256<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                salt_length<span class="token operator">=</span>padding<span class="token punctuation">.</span>PSS<span class="token punctuation">.</span>MAX_LENGTH
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            hashes<span class="token punctuation">.</span>SHA256<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">verify_signature</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> public_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证签名"""</span>
        <span class="token keyword">if</span> public_key <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            public_key <span class="token operator">=</span> self<span class="token punctuation">.</span>public_key
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            message_bytes <span class="token operator">=</span> message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            signature_bytes <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            public_key<span class="token punctuation">.</span>verify<span class="token punctuation">(</span>
                signature_bytes<span class="token punctuation">,</span>
                message_bytes<span class="token punctuation">,</span>
                padding<span class="token punctuation">.</span>PSS<span class="token punctuation">(</span>
                    mgf<span class="token operator">=</span>padding<span class="token punctuation">.</span>MGF1<span class="token punctuation">(</span>hashes<span class="token punctuation">.</span>SHA256<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    salt_length<span class="token operator">=</span>padding<span class="token punctuation">.</span>PSS<span class="token punctuation">.</span>MAX_LENGTH
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                hashes<span class="token punctuation">.</span>SHA256<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> InvalidSignature<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">export_public_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""导出公钥"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>public_key<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"请先生成密钥对"</span><span class="token punctuation">)</span>
        
        pem <span class="token operator">=</span> self<span class="token punctuation">.</span>public_key<span class="token punctuation">.</span>serialize<span class="token punctuation">(</span>
            encoding<span class="token operator">=</span>serialization<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span>PEM<span class="token punctuation">,</span>
            <span class="token builtin">format</span><span class="token operator">=</span>serialization<span class="token punctuation">.</span>PublicFormat<span class="token punctuation">.</span>SubjectPublicKeyInfo
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> pem<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token comment"># 使用示例</span>
signer <span class="token operator">=</span> DigitalSignature<span class="token punctuation">(</span><span class="token punctuation">)</span>
private_key<span class="token punctuation">,</span> public_key <span class="token operator">=</span> signer<span class="token punctuation">.</span>generate_key_pair<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 签名交易</span>
transaction <span class="token operator">=</span> <span class="token string">"Alice向Bob转账10个比特币"</span>
signature <span class="token operator">=</span> signer<span class="token punctuation">.</span>sign_message<span class="token punctuation">(</span>transaction<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"交易签名: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>signature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">50]</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>

<span class="token comment"># 验证签名</span>
is_valid <span class="token operator">=</span> signer<span class="token punctuation">.</span>verify_signature<span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> signature<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"签名验证结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>is_valid<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 导出公钥</span>
public_key_pem <span class="token operator">=</span> signer<span class="token punctuation">.</span>export_public_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"公钥 (前100字符): </span><span class="token interpolation"><span class="token punctuation">&#123;</span>public_key_pem<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h2 id="（二）共识机制详解"><a href="#（二）共识机制详解" class="headerlink" title="（二）共识机制详解"></a>（二）共识机制详解</h2><h3 id="1-工作量证明-Proof-of-Work"><a href="#1-工作量证明-Proof-of-Work" class="headerlink" title="1. 工作量证明 (Proof of Work)"></a>1. 工作量证明 (Proof of Work)</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> threading
<span class="token keyword">from</span> concurrent<span class="token punctuation">.</span>futures <span class="token keyword">import</span> ThreadPoolExecutor

<span class="token keyword">class</span> <span class="token class-name">ProofOfWorkMiner</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""工作量证明挖矿器"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> difficulty<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>difficulty <span class="token operator">=</span> difficulty
        self<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">*</span> difficulty
        self<span class="token punctuation">.</span>mining <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>solution_found <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">mine_block_single_thread</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""单线程挖矿"""</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        attempts <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token keyword">while</span> <span class="token keyword">not</span> block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>self<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
            block<span class="token punctuation">.</span>nonce <span class="token operator">+=</span> <span class="token number">1</span>
            block<span class="token punctuation">.</span><span class="token builtin">hash</span> <span class="token operator">=</span> block<span class="token punctuation">.</span>calculate_hash<span class="token punctuation">(</span><span class="token punctuation">)</span>
            attempts <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token keyword">if</span> attempts <span class="token operator">%</span> <span class="token number">100000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"尝试次数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempts<span class="token punctuation">&#125;</span></span><span class="token string">, 当前哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">20]</span><span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"挖矿成功! 耗时: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>end_time <span class="token operator">-</span> start_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">秒"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"总尝试次数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>attempts<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"最终哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"随机数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>block<span class="token punctuation">.</span>nonce<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> block
    
    <span class="token keyword">def</span> <span class="token function">mine_worker</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">,</span> start_nonce<span class="token punctuation">,</span> step<span class="token punctuation">,</span> result_container<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""多线程挖矿工作函数"""</span>
        local_block <span class="token operator">=</span> Block<span class="token punctuation">(</span>
            block<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
            block<span class="token punctuation">.</span>transactions<span class="token punctuation">,</span>
            block<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span>
            block<span class="token punctuation">.</span>previous_hash<span class="token punctuation">,</span>
            start_nonce
        <span class="token punctuation">)</span>
        
        attempts <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>mining <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>solution_found<span class="token punctuation">:</span>
            local_block<span class="token punctuation">.</span>nonce <span class="token operator">+=</span> step
            local_block<span class="token punctuation">.</span><span class="token builtin">hash</span> <span class="token operator">=</span> local_block<span class="token punctuation">.</span>calculate_hash<span class="token punctuation">(</span><span class="token punctuation">)</span>
            attempts <span class="token operator">+=</span> <span class="token number">1</span>
            
            <span class="token keyword">if</span> local_block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>self<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>solution_found <span class="token operator">=</span> <span class="token boolean">True</span>
                result_container<span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_block
                result_container<span class="token punctuation">[</span><span class="token string">'attempts'</span><span class="token punctuation">]</span> <span class="token operator">=</span> attempts
                <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">mine_block_multi_thread</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">,</span> num_threads<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""多线程挖矿"""</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mining <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>solution_found <span class="token operator">=</span> <span class="token boolean">False</span>
        result_container <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        
        <span class="token keyword">with</span> ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span>num_threads<span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
            futures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_threads<span class="token punctuation">)</span><span class="token punctuation">:</span>
                future <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>
                    self<span class="token punctuation">.</span>mine_worker<span class="token punctuation">,</span>
                    block<span class="token punctuation">,</span>
                    i<span class="token punctuation">,</span>  <span class="token comment"># 起始随机数</span>
                    num_threads<span class="token punctuation">,</span>  <span class="token comment"># 步长</span>
                    result_container
                <span class="token punctuation">)</span>
                futures<span class="token punctuation">.</span>append<span class="token punctuation">(</span>future<span class="token punctuation">)</span>
            
            <span class="token comment"># 等待任一线程找到解</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>mining <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>solution_found<span class="token punctuation">:</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>mining <span class="token operator">=</span> <span class="token boolean">False</span>
        
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token string">'block'</span> <span class="token keyword">in</span> result_container<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"多线程挖矿成功! 耗时: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>end_time <span class="token operator">-</span> start_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">秒"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"使用线程数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>num_threads<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"最终哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result_container<span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> result_container<span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"挖矿失败"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token comment"># 挖矿难度对比测试</span>
<span class="token keyword">def</span> <span class="token function">mining_difficulty_comparison</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""挖矿难度对比"""</span>
    difficulties <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> difficulty <span class="token keyword">in</span> difficulties<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\n=== 难度 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>difficulty<span class="token punctuation">&#125;</span></span><span class="token string"> 挖矿测试 ==="</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建测试区块</span>
        test_block <span class="token operator">=</span> Block<span class="token punctuation">(</span>
            <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token string">"测试交易1"</span><span class="token punctuation">,</span> <span class="token string">"测试交易2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"0000abc123"</span>
        <span class="token punctuation">)</span>
        
        miner <span class="token operator">=</span> ProofOfWorkMiner<span class="token punctuation">(</span>difficulty<span class="token punctuation">)</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 单线程挖矿</span>
        mined_block <span class="token operator">=</span> miner<span class="token punctuation">.</span>mine_block_single_thread<span class="token punctuation">(</span>test_block<span class="token punctuation">)</span>
        
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"难度 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>difficulty<span class="token punctuation">&#125;</span></span><span class="token string"> 挖矿耗时: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>end_time <span class="token operator">-</span> start_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">秒"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"目标前缀: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'0'</span> <span class="token operator">*</span> difficulty<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"实际哈希: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mined_block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行挖矿测试</span>
<span class="token comment"># mining_difficulty_comparison()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h3 id="2-权益证明-Proof-of-Stake"><a href="#2-权益证明-Proof-of-Stake" class="headerlink" title="2. 权益证明 (Proof of Stake)"></a>2. 权益证明 (Proof of Stake)</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random
<span class="token keyword">import</span> time
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict

<span class="token keyword">class</span> <span class="token class-name">ProofOfStakeValidator</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""权益证明验证者"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">,</span> stake<span class="token punctuation">,</span> reputation<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>address <span class="token operator">=</span> address
        self<span class="token punctuation">.</span>stake <span class="token operator">=</span> stake
        self<span class="token punctuation">.</span>reputation <span class="token operator">=</span> reputation
        self<span class="token punctuation">.</span>blocks_validated <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>rewards_earned <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>last_validation_time <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_selection_weight</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算选择权重"""</span>
        <span class="token comment"># 权重 = 权益 × 声誉 × 时间因子</span>
        time_factor <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>last_validation_time<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3600</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>stake <span class="token operator">*</span> self<span class="token punctuation">.</span>reputation <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> time_factor<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">validate_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证区块"""</span>
        <span class="token comment"># 简化的验证逻辑</span>
        is_valid <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 实际应包含复杂的验证逻辑</span>
        
        <span class="token keyword">if</span> is_valid<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>blocks_validated <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>last_validation_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            reward <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_reward<span class="token punctuation">(</span>block<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>rewards_earned <span class="token operator">+=</span> reward
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_reward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算验证奖励"""</span>
        base_reward <span class="token operator">=</span> <span class="token number">1.0</span>
        stake_bonus <span class="token operator">=</span> self<span class="token punctuation">.</span>stake <span class="token operator">*</span> <span class="token number">0.001</span>
        <span class="token keyword">return</span> base_reward <span class="token operator">+</span> stake_bonus

<span class="token keyword">class</span> <span class="token class-name">ProofOfStakeConsensus</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""权益证明共识机制"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>minimum_stake <span class="token operator">=</span> <span class="token number">32</span>  <span class="token comment"># 最小权益要求</span>
        self<span class="token punctuation">.</span>slashing_penalty <span class="token operator">=</span> <span class="token number">0.1</span>  <span class="token comment"># 惩罚比例</span>
    
    <span class="token keyword">def</span> <span class="token function">add_validator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">,</span> stake<span class="token punctuation">,</span> reputation<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加验证者"""</span>
        <span class="token keyword">if</span> stake <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>minimum_stake<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"权益不足，最小要求: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>minimum_stake<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        validator <span class="token operator">=</span> ProofOfStakeValidator<span class="token punctuation">(</span>address<span class="token punctuation">,</span> stake<span class="token punctuation">,</span> reputation<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>address<span class="token punctuation">]</span> <span class="token operator">=</span> validator
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"验证者 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>address<span class="token punctuation">&#125;</span></span><span class="token string"> 已加入，权益: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>stake<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">select_validator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exclude<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""选择验证者"""</span>
        <span class="token keyword">if</span> exclude <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            exclude <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        available_validators <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            addr<span class="token punctuation">:</span> validator <span class="token keyword">for</span> addr<span class="token punctuation">,</span> validator <span class="token keyword">in</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> addr <span class="token keyword">not</span> <span class="token keyword">in</span> exclude <span class="token keyword">and</span> validator<span class="token punctuation">.</span>stake <span class="token operator">>=</span> self<span class="token punctuation">.</span>minimum_stake
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> available_validators<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 计算总权重</span>
        total_weight <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>
            validator<span class="token punctuation">.</span>calculate_selection_weight<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> validator <span class="token keyword">in</span> available_validators<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 随机选择</span>
        random_point <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> total_weight<span class="token punctuation">)</span>
        current_weight <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token keyword">for</span> address<span class="token punctuation">,</span> validator <span class="token keyword">in</span> available_validators<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            current_weight <span class="token operator">+=</span> validator<span class="token punctuation">.</span>calculate_selection_weight<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> current_weight <span class="token operator">>=</span> random_point<span class="token punctuation">:</span>
                <span class="token keyword">return</span> address
        
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">validate_block_pos</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""权益证明区块验证"""</span>
        <span class="token comment"># 选择主验证者</span>
        primary_validator_addr <span class="token operator">=</span> self<span class="token punctuation">.</span>select_validator<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> primary_validator_addr<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"没有可用的验证者"</span>
        
        primary_validator <span class="token operator">=</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>primary_validator_addr<span class="token punctuation">]</span>
        
        <span class="token comment"># 主验证者验证区块</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> primary_validator<span class="token punctuation">.</span>validate_block<span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"主验证者验证失败"</span>
        
        <span class="token comment"># 选择额外验证者进行确认</span>
        confirmations <span class="token operator">=</span> <span class="token number">0</span>
        required_confirmations <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>validators<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>required_confirmations<span class="token punctuation">)</span><span class="token punctuation">:</span>
            confirmer_addr <span class="token operator">=</span> self<span class="token punctuation">.</span>select_validator<span class="token punctuation">(</span>exclude<span class="token operator">=</span><span class="token punctuation">&#123;</span>primary_validator_addr<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> confirmer_addr<span class="token punctuation">:</span>
                confirmer <span class="token operator">=</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>confirmer_addr<span class="token punctuation">]</span>
                <span class="token keyword">if</span> confirmer<span class="token punctuation">.</span>validate_block<span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    confirmations <span class="token operator">+=</span> <span class="token number">1</span>
        
        success <span class="token operator">=</span> confirmations <span class="token operator">>=</span> required_confirmations <span class="token operator">*</span> <span class="token number">0.67</span>  <span class="token comment"># 2/3多数</span>
        
        <span class="token keyword">if</span> success<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"区块验证成功，确认数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>confirmations<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>required_confirmations<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 惩罚恶意验证者</span>
            self<span class="token punctuation">.</span>slash_validator<span class="token punctuation">(</span>primary_validator_addr<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"验证失败，验证者被惩罚"</span>
    
    <span class="token keyword">def</span> <span class="token function">slash_validator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validator_address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""惩罚恶意验证者"""</span>
        <span class="token keyword">if</span> validator_address <span class="token keyword">in</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">:</span>
            validator <span class="token operator">=</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">[</span>validator_address<span class="token punctuation">]</span>
            penalty <span class="token operator">=</span> validator<span class="token punctuation">.</span>stake <span class="token operator">*</span> self<span class="token punctuation">.</span>slashing_penalty
            validator<span class="token punctuation">.</span>stake <span class="token operator">-=</span> penalty
            validator<span class="token punctuation">.</span>reputation <span class="token operator">*=</span> <span class="token number">0.9</span>  <span class="token comment"># 降低声誉</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"验证者 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>validator_address<span class="token punctuation">&#125;</span></span><span class="token string"> 被惩罚，扣除权益: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>penalty<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_validator_stats</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取验证者统计信息"""</span>
        stats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> addr<span class="token punctuation">,</span> validator <span class="token keyword">in</span> self<span class="token punctuation">.</span>validators<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            stats<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token string">"地址"</span><span class="token punctuation">:</span> addr<span class="token punctuation">,</span>
                <span class="token string">"权益"</span><span class="token punctuation">:</span> validator<span class="token punctuation">.</span>stake<span class="token punctuation">,</span>
                <span class="token string">"声誉"</span><span class="token punctuation">:</span> validator<span class="token punctuation">.</span>reputation<span class="token punctuation">,</span>
                <span class="token string">"验证区块数"</span><span class="token punctuation">:</span> validator<span class="token punctuation">.</span>blocks_validated<span class="token punctuation">,</span>
                <span class="token string">"获得奖励"</span><span class="token punctuation">:</span> validator<span class="token punctuation">.</span>rewards_earned<span class="token punctuation">,</span>
                <span class="token string">"选择权重"</span><span class="token punctuation">:</span> validator<span class="token punctuation">.</span>calculate_selection_weight<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> stats

<span class="token comment"># 权益证明演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_proof_of_stake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示权益证明"""</span>
    pos_consensus <span class="token operator">=</span> ProofOfStakeConsensus<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 添加验证者</span>
    validators_data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">"validator_1"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"validator_2"</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"validator_3"</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"validator_4"</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"validator_5"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> addr<span class="token punctuation">,</span> stake<span class="token punctuation">,</span> reputation <span class="token keyword">in</span> validators_data<span class="token punctuation">:</span>
        pos_consensus<span class="token punctuation">.</span>add_validator<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> stake<span class="token punctuation">,</span> reputation<span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n=== 验证者初始状态 ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> stat <span class="token keyword">in</span> pos_consensus<span class="token punctuation">.</span>get_validator_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'地址'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">: 权益=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'权益'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">, 声誉=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'声誉'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">, 权重=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'选择权重'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟区块验证</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n=== 模拟区块验证 ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        test_block <span class="token operator">=</span> Block<span class="token punctuation">(</span>
            i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"交易</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"交易</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"previous_hash_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        
        success<span class="token punctuation">,</span> message <span class="token operator">=</span> pos_consensus<span class="token punctuation">.</span>validate_block_pos<span class="token punctuation">(</span>test_block<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"区块 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n=== 验证者最终状态 ==="</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> stat <span class="token keyword">in</span> pos_consensus<span class="token punctuation">.</span>get_validator_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'地址'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">: 验证=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'验证区块数'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">, 奖励=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'获得奖励'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行演示</span>
<span class="token comment"># demonstrate_proof_of_stake()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h1 id="三、智能合约技术"><a href="#三、智能合约技术" class="headerlink" title="三、智能合约技术"></a>三、智能合约技术</h1><h2 id="（一）智能合约基础"><a href="#（一）智能合约基础" class="headerlink" title="（一）智能合约基础"></a>（一）智能合约基础</h2><p>智能合约是运行在区块链上的自动执行程序，它能够在满足预定条件时自动执行合约条款。</p>
<h3 id="1-简单智能合约实现"><a href="#1-简单智能合约实现" class="headerlink" title="1. 简单智能合约实现"></a>1. 简单智能合约实现</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum

<span class="token keyword">class</span> <span class="token class-name">ContractState</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""合约状态枚举"""</span>
    CREATED <span class="token operator">=</span> <span class="token string">"created"</span>
    ACTIVE <span class="token operator">=</span> <span class="token string">"active"</span>
    COMPLETED <span class="token operator">=</span> <span class="token string">"completed"</span>
    CANCELLED <span class="token operator">=</span> <span class="token string">"cancelled"</span>
    EXPIRED <span class="token operator">=</span> <span class="token string">"expired"</span>

<span class="token keyword">class</span> <span class="token class-name">SmartContract</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""智能合约基类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> contract_id<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> participants<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>contract_id <span class="token operator">=</span> contract_id
        self<span class="token punctuation">.</span>creator <span class="token operator">=</span> creator
        self<span class="token punctuation">.</span>participants <span class="token operator">=</span> participants
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> ContractState<span class="token punctuation">.</span>CREATED
        self<span class="token punctuation">.</span>created_at <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conditions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>storage <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    
    <span class="token keyword">def</span> <span class="token function">add_condition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> condition_func<span class="token punctuation">,</span> description<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加执行条件"""</span>
        self<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token string">"function"</span><span class="token punctuation">:</span> condition_func<span class="token punctuation">,</span>
            <span class="token string">"description"</span><span class="token punctuation">:</span> description
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">add_action</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action_func<span class="token punctuation">,</span> description<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加执行动作"""</span>
        self<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token string">"function"</span><span class="token punctuation">:</span> action_func<span class="token punctuation">,</span>
            <span class="token string">"description"</span><span class="token punctuation">:</span> description
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">check_conditions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查所有条件是否满足"""</span>
        <span class="token keyword">for</span> condition <span class="token keyword">in</span> self<span class="token punctuation">.</span>conditions<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> condition<span class="token punctuation">[</span><span class="token string">"function"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> condition<span class="token punctuation">[</span><span class="token string">"description"</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"所有条件已满足"</span>
    
    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""执行合约"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>state <span class="token operator">!=</span> ContractState<span class="token punctuation">.</span>ACTIVE<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"合约未激活"</span>
        
        conditions_met<span class="token punctuation">,</span> message <span class="token operator">=</span> self<span class="token punctuation">.</span>check_conditions<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> conditions_met<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"条件未满足: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        
        <span class="token comment"># 执行所有动作</span>
        <span class="token keyword">for</span> action <span class="token keyword">in</span> self<span class="token punctuation">.</span>actions<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> action<span class="token punctuation">[</span><span class="token string">"function"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"执行动作: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>action<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">, 结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"动作执行失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>action<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">, 错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"动作执行失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> ContractState<span class="token punctuation">.</span>COMPLETED
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"合约执行完成"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"合约执行成功"</span>
    
    <span class="token keyword">def</span> <span class="token function">activate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""激活合约"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>state <span class="token operator">==</span> ContractState<span class="token punctuation">.</span>CREATED<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> ContractState<span class="token punctuation">.</span>ACTIVE
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"合约已激活"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">cancel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""取消合约"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>state <span class="token keyword">in</span> <span class="token punctuation">[</span>ContractState<span class="token punctuation">.</span>CREATED<span class="token punctuation">,</span> ContractState<span class="token punctuation">.</span>ACTIVE<span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>state <span class="token operator">=</span> ContractState<span class="token punctuation">.</span>CANCELLED
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"合约已取消"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">log_event</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""记录事件"""</span>
        event <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"message"</span><span class="token punctuation">:</span> message
        <span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>events<span class="token punctuation">.</span>append<span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>event<span class="token punctuation">[</span><span class="token string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_status</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取合约状态"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"contract_id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>contract_id<span class="token punctuation">,</span>
            <span class="token string">"state"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
            <span class="token string">"creator"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>creator<span class="token punctuation">,</span>
            <span class="token string">"participants"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>participants<span class="token punctuation">,</span>
            <span class="token string">"created_at"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
            <span class="token string">"events_count"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"storage"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>storage
        <span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">EscrowContract</span><span class="token punctuation">(</span>SmartContract<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""托管合约示例"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> contract_id<span class="token punctuation">,</span> buyer<span class="token punctuation">,</span> seller<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> escrow_agent<span class="token punctuation">)</span><span class="token punctuation">:</span>
        participants <span class="token operator">=</span> <span class="token punctuation">[</span>buyer<span class="token punctuation">,</span> seller<span class="token punctuation">,</span> escrow_agent<span class="token punctuation">]</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>contract_id<span class="token punctuation">,</span> buyer<span class="token punctuation">,</span> participants<span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>buyer <span class="token operator">=</span> buyer
        self<span class="token punctuation">.</span>seller <span class="token operator">=</span> seller
        self<span class="token punctuation">.</span>amount <span class="token operator">=</span> amount
        self<span class="token punctuation">.</span>escrow_agent <span class="token operator">=</span> escrow_agent
        self<span class="token punctuation">.</span>payment_received <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>goods_delivered <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>buyer_confirmed <span class="token operator">=</span> <span class="token boolean">False</span>
        
        <span class="token comment"># 设置合约条件和动作</span>
        self<span class="token punctuation">.</span>setup_contract<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">setup_contract</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""设置合约条件和动作"""</span>
        <span class="token comment"># 添加执行条件</span>
        self<span class="token punctuation">.</span>add_condition<span class="token punctuation">(</span>
            <span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>payment_received<span class="token punctuation">,</span>
            <span class="token string">"买方已付款"</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>add_condition<span class="token punctuation">(</span>
            <span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>goods_delivered<span class="token punctuation">,</span>
            <span class="token string">"卖方已发货"</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>add_condition<span class="token punctuation">(</span>
            <span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>buyer_confirmed<span class="token punctuation">,</span>
            <span class="token string">"买方已确认收货"</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment"># 添加执行动作</span>
        self<span class="token punctuation">.</span>add_action<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>release_payment<span class="token punctuation">,</span>
            <span class="token string">"释放托管资金给卖方"</span>
        <span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">receive_payment</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""接收买方付款"""</span>
        <span class="token keyword">if</span> amount <span class="token operator">>=</span> self<span class="token punctuation">.</span>amount<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>payment_received <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>storage<span class="token punctuation">[</span><span class="token string">"payment_amount"</span><span class="token punctuation">]</span> <span class="token operator">=</span> amount
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"收到买方付款: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">confirm_delivery</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""卖方确认发货"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>payment_received<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>goods_delivered <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"卖方已确认发货"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">buyer_confirm_receipt</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""买方确认收货"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>goods_delivered<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>buyer_confirmed <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"买方已确认收货"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">release_payment</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""释放托管资金"""</span>
        self<span class="token punctuation">.</span>storage<span class="token punctuation">[</span><span class="token string">"payment_released"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>storage<span class="token punctuation">[</span><span class="token string">"release_time"</span><span class="token punctuation">]</span> <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"向卖方 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>seller<span class="token punctuation">&#125;</span></span><span class="token string"> 释放资金 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    
    <span class="token keyword">def</span> <span class="token function">dispute_resolution</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> decision<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""争议解决"""</span>
        <span class="token keyword">if</span> decision <span class="token operator">==</span> <span class="token string">"buyer"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>storage<span class="token punctuation">[</span><span class="token string">"refund_to_buyer"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"争议解决：退款给买方"</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> decision <span class="token operator">==</span> <span class="token string">"seller"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>release_payment<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"争议解决：付款给卖方"</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> ContractState<span class="token punctuation">.</span>COMPLETED

<span class="token comment"># 托管合约演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_escrow_contract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示托管合约"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 托管合约演示 ==="</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建托管合约</span>
    escrow <span class="token operator">=</span> EscrowContract<span class="token punctuation">(</span>
        contract_id<span class="token operator">=</span><span class="token string">"ESC001"</span><span class="token punctuation">,</span>
        buyer<span class="token operator">=</span><span class="token string">"Alice"</span><span class="token punctuation">,</span>
        seller<span class="token operator">=</span><span class="token string">"Bob"</span><span class="token punctuation">,</span>
        amount<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
        escrow_agent<span class="token operator">=</span><span class="token string">"EscrowService"</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment"># 激活合约</span>
    escrow<span class="token punctuation">.</span>activate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 买方付款"</span><span class="token punctuation">)</span>
    escrow<span class="token punctuation">.</span>receive_payment<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 卖方发货"</span><span class="token punctuation">)</span>
    escrow<span class="token punctuation">.</span>confirm_delivery<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 买方确认收货"</span><span class="token punctuation">)</span>
    escrow<span class="token punctuation">.</span>buyer_confirm_receipt<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 执行合约"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> message <span class="token operator">=</span> escrow<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"执行结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n5. 合约状态"</span><span class="token punctuation">)</span>
    status <span class="token operator">=</span> escrow<span class="token punctuation">.</span>get_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> status<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行演示</span>
<span class="token comment"># demonstrate_escrow_contract()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h3 id="2-去中心化自治组织-DAO-合约"><a href="#2-去中心化自治组织-DAO-合约" class="headerlink" title="2. 去中心化自治组织 (DAO) 合约"></a>2. 去中心化自治组织 (DAO) 合约</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">import</span> uuid

<span class="token keyword">class</span> <span class="token class-name">Proposal</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""提案类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> proposal_id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> description<span class="token punctuation">,</span> proposer<span class="token punctuation">,</span> voting_period_days<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>proposal_id <span class="token operator">=</span> proposal_id
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> title
        self<span class="token punctuation">.</span>description <span class="token operator">=</span> description
        self<span class="token punctuation">.</span>proposer <span class="token operator">=</span> proposer
        self<span class="token punctuation">.</span>created_at <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>voting_deadline <span class="token operator">=</span> self<span class="token punctuation">.</span>created_at <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>voting_period_days<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>votes_for <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>votes_against <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>voters <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>executed <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>passed <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">DAOContract</span><span class="token punctuation">(</span>SmartContract<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""去中心化自治组织合约"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> contract_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> token_supply<span class="token operator">=</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>contract_id<span class="token punctuation">,</span> <span class="token string">"DAO_Creator"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>token_supply <span class="token operator">=</span> token_supply
        self<span class="token punctuation">.</span>token_balances <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>members <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>proposals <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>minimum_quorum <span class="token operator">=</span> <span class="token number">0.1</span>  <span class="token comment"># 10%最小参与率</span>
        self<span class="token punctuation">.</span>minimum_majority <span class="token operator">=</span> <span class="token number">0.6</span>  <span class="token comment"># 60%多数通过</span>
        
        <span class="token comment"># DAO治理参数</span>
        self<span class="token punctuation">.</span>governance_params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"proposal_threshold"</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># 提案所需最小代币数</span>
            <span class="token string">"voting_period"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token comment"># 投票期限（天）</span>
            <span class="token string">"execution_delay"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 执行延迟（天）</span>
        <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">def</span> <span class="token function">mint_tokens</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> recipient<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""铸造代币"""</span>
        <span class="token keyword">if</span> amount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"铸造数量必须大于0"</span>
        
        self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>recipient<span class="token punctuation">]</span> <span class="token operator">+=</span> amount
        self<span class="token punctuation">.</span>members<span class="token punctuation">.</span>add<span class="token punctuation">(</span>recipient<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"为 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>recipient<span class="token punctuation">&#125;</span></span><span class="token string"> 铸造 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string"> 代币"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"成功铸造 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string"> 代币"</span></span>
    
    <span class="token keyword">def</span> <span class="token function">transfer_tokens</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_addr<span class="token punctuation">,</span> to_addr<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""转移代币"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>from_addr<span class="token punctuation">]</span> <span class="token operator">&lt;</span> amount<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"余额不足"</span>
        
        self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>from_addr<span class="token punctuation">]</span> <span class="token operator">-=</span> amount
        self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>to_addr<span class="token punctuation">]</span> <span class="token operator">+=</span> amount
        self<span class="token punctuation">.</span>members<span class="token punctuation">.</span>add<span class="token punctuation">(</span>to_addr<span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token string"> 向 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>to_addr<span class="token punctuation">&#125;</span></span><span class="token string"> 转移 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string"> 代币"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"转移成功"</span>
    
    <span class="token keyword">def</span> <span class="token function">create_proposal</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> proposer<span class="token punctuation">,</span> title<span class="token punctuation">,</span> description<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建提案"""</span>
        <span class="token comment"># 检查提案者是否有足够代币</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>proposer<span class="token punctuation">]</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>governance_params<span class="token punctuation">[</span><span class="token string">"proposal_threshold"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"提案需要至少 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>governance_params<span class="token punctuation">[</span><span class="token string">'proposal_threshold'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> 代币"</span></span>
        
        proposal_id <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span>
        proposal <span class="token operator">=</span> Proposal<span class="token punctuation">(</span>
            proposal_id<span class="token punctuation">,</span>
            title<span class="token punctuation">,</span>
            description<span class="token punctuation">,</span>
            proposer<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>governance_params<span class="token punctuation">[</span><span class="token string">"voting_period"</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>proposals<span class="token punctuation">[</span>proposal_id<span class="token punctuation">]</span> <span class="token operator">=</span> proposal
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"创建提案 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proposal_id<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>title<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> proposal_id
    
    <span class="token keyword">def</span> <span class="token function">vote</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> voter<span class="token punctuation">,</span> proposal_id<span class="token punctuation">,</span> support<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""投票"""</span>
        <span class="token keyword">if</span> proposal_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>proposals<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"提案不存在"</span>
        
        proposal <span class="token operator">=</span> self<span class="token punctuation">.</span>proposals<span class="token punctuation">[</span>proposal_id<span class="token punctuation">]</span>
        
        <span class="token comment"># 检查投票期限</span>
        <span class="token keyword">if</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> proposal<span class="token punctuation">.</span>voting_deadline<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"投票期限已过"</span>
        
        <span class="token comment"># 检查是否已投票</span>
        <span class="token keyword">if</span> voter <span class="token keyword">in</span> proposal<span class="token punctuation">.</span>voters<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"已经投过票"</span>
        
        <span class="token comment"># 检查投票权重（基于代币余额）</span>
        voting_power <span class="token operator">=</span> self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>voter<span class="token punctuation">]</span>
        <span class="token keyword">if</span> voting_power <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"没有投票权"</span>
        
        <span class="token comment"># 记录投票</span>
        proposal<span class="token punctuation">.</span>voters<span class="token punctuation">.</span>add<span class="token punctuation">(</span>voter<span class="token punctuation">)</span>
        <span class="token keyword">if</span> support<span class="token punctuation">:</span>
            proposal<span class="token punctuation">.</span>votes_for <span class="token operator">+=</span> voting_power
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            proposal<span class="token punctuation">.</span>votes_against <span class="token operator">+=</span> voting_power
        
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>voter<span class="token punctuation">&#125;</span></span><span class="token string"> 对提案 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proposal_id<span class="token punctuation">&#125;</span></span><span class="token string"> 投票: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'支持'</span> <span class="token keyword">if</span> support <span class="token keyword">else</span> <span class="token string">'反对'</span><span class="token punctuation">&#125;</span></span><span class="token string"> (权重: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>voting_power<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"投票成功"</span>
    
    <span class="token keyword">def</span> <span class="token function">execute_proposal</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> proposal_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""执行提案"""</span>
        <span class="token keyword">if</span> proposal_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>proposals<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"提案不存在"</span>
        
        proposal <span class="token operator">=</span> self<span class="token punctuation">.</span>proposals<span class="token punctuation">[</span>proposal_id<span class="token punctuation">]</span>
        
        <span class="token comment"># 检查是否已执行</span>
        <span class="token keyword">if</span> proposal<span class="token punctuation">.</span>executed<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"提案已执行"</span>
        
        <span class="token comment"># 检查投票是否结束</span>
        <span class="token keyword">if</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> proposal<span class="token punctuation">.</span>voting_deadline<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"投票期限未到"</span>
        
        <span class="token comment"># 计算投票结果</span>
        total_votes <span class="token operator">=</span> proposal<span class="token punctuation">.</span>votes_for <span class="token operator">+</span> proposal<span class="token punctuation">.</span>votes_against
        total_supply <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>token_balances<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查法定人数</span>
        quorum_met <span class="token operator">=</span> total_votes <span class="token operator">>=</span> <span class="token punctuation">(</span>total_supply <span class="token operator">*</span> self<span class="token punctuation">.</span>minimum_quorum<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> quorum_met<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提案 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proposal_id<span class="token punctuation">&#125;</span></span><span class="token string"> 未达到法定人数"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"未达到法定人数"</span>
        
        <span class="token comment"># 检查多数通过</span>
        majority_met <span class="token operator">=</span> proposal<span class="token punctuation">.</span>votes_for <span class="token operator">>=</span> <span class="token punctuation">(</span>total_votes <span class="token operator">*</span> self<span class="token punctuation">.</span>minimum_majority<span class="token punctuation">)</span>
        
        proposal<span class="token punctuation">.</span>executed <span class="token operator">=</span> <span class="token boolean">True</span>
        proposal<span class="token punctuation">.</span>passed <span class="token operator">=</span> majority_met
        
        <span class="token keyword">if</span> majority_met<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提案 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proposal_id<span class="token punctuation">&#125;</span></span><span class="token string"> 通过并执行"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"提案通过并执行"</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提案 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proposal_id<span class="token punctuation">&#125;</span></span><span class="token string"> 未通过"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"提案未通过"</span>
    
    <span class="token keyword">def</span> <span class="token function">get_proposal_status</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> proposal_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取提案状态"""</span>
        <span class="token keyword">if</span> proposal_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>proposals<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        proposal <span class="token operator">=</span> self<span class="token punctuation">.</span>proposals<span class="token punctuation">[</span>proposal_id<span class="token punctuation">]</span>
        total_votes <span class="token operator">=</span> proposal<span class="token punctuation">.</span>votes_for <span class="token operator">+</span> proposal<span class="token punctuation">.</span>votes_against
        
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"proposal_id"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>proposal_id<span class="token punctuation">,</span>
            <span class="token string">"title"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
            <span class="token string">"proposer"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>proposer<span class="token punctuation">,</span>
            <span class="token string">"created_at"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
            <span class="token string">"voting_deadline"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>voting_deadline<span class="token punctuation">,</span>
            <span class="token string">"votes_for"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>votes_for<span class="token punctuation">,</span>
            <span class="token string">"votes_against"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>votes_against<span class="token punctuation">,</span>
            <span class="token string">"total_votes"</span><span class="token punctuation">:</span> total_votes<span class="token punctuation">,</span>
            <span class="token string">"voters_count"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>proposal<span class="token punctuation">.</span>voters<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"executed"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>executed<span class="token punctuation">,</span>
            <span class="token string">"passed"</span><span class="token punctuation">:</span> proposal<span class="token punctuation">.</span>passed
        <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">def</span> <span class="token function">get_member_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> member<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取成员信息"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"address"</span><span class="token punctuation">:</span> member<span class="token punctuation">,</span>
            <span class="token string">"token_balance"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>member<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"voting_power"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>token_balances<span class="token punctuation">[</span>member<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"is_member"</span><span class="token punctuation">:</span> member <span class="token keyword">in</span> self<span class="token punctuation">.</span>members
        <span class="token punctuation">&#125;</span>

<span class="token comment"># DAO演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_dao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示DAO功能"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== DAO (去中心化自治组织) 演示 ==="</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建DAO</span>
    dao <span class="token operator">=</span> DAOContract<span class="token punctuation">(</span><span class="token string">"DAO001"</span><span class="token punctuation">,</span> <span class="token string">"TechDAO"</span><span class="token punctuation">)</span>
    dao<span class="token punctuation">.</span>activate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 分发代币给成员</span>
    members <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token string">"Eve"</span><span class="token punctuation">]</span>
    token_amounts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 分发代币"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> member<span class="token punctuation">,</span> amount <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>members<span class="token punctuation">,</span> token_amounts<span class="token punctuation">)</span><span class="token punctuation">:</span>
        success<span class="token punctuation">,</span> message <span class="token operator">=</span> dao<span class="token punctuation">.</span>mint_tokens<span class="token punctuation">(</span>member<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>member<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建提案</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 创建提案"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> proposal_id <span class="token operator">=</span> dao<span class="token punctuation">.</span>create_proposal<span class="token punctuation">(</span>
        <span class="token string">"Alice"</span><span class="token punctuation">,</span>
        <span class="token string">"增加开发资金"</span><span class="token punctuation">,</span>
        <span class="token string">"提议增加1000 ETH用于新功能开发"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提案创建: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>proposal_id <span class="token keyword">if</span> success <span class="token keyword">else</span> <span class="token string">'失败'</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 成员投票</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 成员投票"</span><span class="token punctuation">)</span>
    votes <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"Eve"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> voter<span class="token punctuation">,</span> support <span class="token keyword">in</span> votes<span class="token punctuation">:</span>
        success<span class="token punctuation">,</span> message <span class="token operator">=</span> dao<span class="token punctuation">.</span>vote<span class="token punctuation">(</span>voter<span class="token punctuation">,</span> proposal_id<span class="token punctuation">,</span> support<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>voter<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 查看提案状态</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 提案状态"</span><span class="token punctuation">)</span>
    status <span class="token operator">=</span> dao<span class="token punctuation">.</span>get_proposal_status<span class="token punctuation">(</span>proposal_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> status<span class="token punctuation">:</span>
        <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> status<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>key<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟投票期限结束，执行提案</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n5. 执行提案"</span><span class="token punctuation">)</span>
    <span class="token comment"># 手动设置投票截止时间为过去时间</span>
    dao<span class="token punctuation">.</span>proposals<span class="token punctuation">[</span>proposal_id<span class="token punctuation">]</span><span class="token punctuation">.</span>voting_deadline <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    success<span class="token punctuation">,</span> message <span class="token operator">=</span> dao<span class="token punctuation">.</span>execute_proposal<span class="token punctuation">(</span>proposal_id<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"执行结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 查看最终状态</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n6. 最终提案状态"</span><span class="token punctuation">)</span>
    final_status <span class="token operator">=</span> dao<span class="token punctuation">.</span>get_proposal_status<span class="token punctuation">(</span>proposal_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> final_status<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"通过状态: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>final_status<span class="token punctuation">[</span><span class="token string">'passed'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"支持票: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>final_status<span class="token punctuation">[</span><span class="token string">'votes_for'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"反对票: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>final_status<span class="token punctuation">[</span><span class="token string">'votes_against'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行演示</span>
<span class="token comment"># demonstrate_dao()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h1 id="四、区块链应用场景"><a href="#四、区块链应用场景" class="headerlink" title="四、区块链应用场景"></a>四、区块链应用场景</h1><h2 id="（一）数字货币系统"><a href="#（一）数字货币系统" class="headerlink" title="（一）数字货币系统"></a>（一）数字货币系统</h2><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal<span class="token punctuation">,</span> getcontext
<span class="token keyword">import</span> threading

<span class="token comment"># 设置精度</span>
getcontext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prec <span class="token operator">=</span> <span class="token number">18</span>

<span class="token keyword">class</span> <span class="token class-name">Transaction</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""交易类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_addr<span class="token punctuation">,</span> to_addr<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> fee<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>tx_id <span class="token operator">=</span> self<span class="token punctuation">.</span>generate_tx_id<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>from_addr <span class="token operator">=</span> from_addr
        self<span class="token punctuation">.</span>to_addr <span class="token operator">=</span> to_addr
        self<span class="token punctuation">.</span>amount <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fee <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
        self<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>signature <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>confirmed <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_tx_id</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成交易ID"""</span>
        <span class="token keyword">import</span> uuid
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">sign_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> private_key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""签名交易"""</span>
        <span class="token comment"># 简化的签名过程</span>
        tx_data <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>to_addr<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>amount<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>timestamp<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        self<span class="token punctuation">.</span>signature <span class="token operator">=</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span>tx_data <span class="token operator">+</span> private_key<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">verify_signature</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证签名"""</span>
        <span class="token comment"># 简化的验证过程</span>
        tx_data <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>to_addr<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>amount<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>timestamp<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        expected_signature <span class="token operator">=</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span>tx_data <span class="token operator">+</span> public_key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>signature <span class="token operator">==</span> expected_signature
    
    <span class="token keyword">def</span> <span class="token function">to_dict</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""转换为字典"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"tx_id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>tx_id<span class="token punctuation">,</span>
            <span class="token string">"from"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>from_addr<span class="token punctuation">,</span>
            <span class="token string">"to"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>to_addr<span class="token punctuation">,</span>
            <span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"fee"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>fee<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>timestamp<span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"confirmed"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>confirmed
        <span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Wallet</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""钱包类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>address <span class="token operator">=</span> address
        self<span class="token punctuation">.</span>private_key <span class="token operator">=</span> self<span class="token punctuation">.</span>generate_private_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>public_key <span class="token operator">=</span> self<span class="token punctuation">.</span>generate_public_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>balance <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>transaction_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_private_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成私钥"""</span>
        <span class="token keyword">import</span> secrets
        <span class="token keyword">return</span> secrets<span class="token punctuation">.</span>token_hex<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_public_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成公钥"""</span>
        <span class="token keyword">return</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span>self<span class="token punctuation">.</span>private_key<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> to_addr<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> fee<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建交易"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>balance <span class="token operator">&lt;</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"余额不足"</span><span class="token punctuation">)</span>
        
        tx <span class="token operator">=</span> Transaction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>address<span class="token punctuation">,</span> to_addr<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> fee<span class="token punctuation">)</span>
        tx<span class="token punctuation">.</span>sign_transaction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>private_key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> tx
    
    <span class="token keyword">def</span> <span class="token function">update_balance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""更新余额"""</span>
        self<span class="token punctuation">.</span>balance <span class="token operator">+=</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">add_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加交易记录"""</span>
        self<span class="token punctuation">.</span>transaction_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span>transaction<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DigitalCurrencyBlockchain</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""数字货币区块链"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> total_supply<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>symbol <span class="token operator">=</span> symbol
        self<span class="token punctuation">.</span>total_supply <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>total_supply<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>chain <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>pending_transactions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>wallets <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>mining_reward <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'10'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>difficulty <span class="token operator">=</span> <span class="token number">4</span>
        self<span class="token punctuation">.</span>lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建创世区块</span>
        self<span class="token punctuation">.</span>create_genesis_block<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_genesis_block</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建创世区块"""</span>
        genesis_block <span class="token operator">=</span> Block<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
        genesis_block<span class="token punctuation">.</span>mine_block<span class="token punctuation">(</span>self<span class="token punctuation">.</span>difficulty<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>chain<span class="token punctuation">.</span>append<span class="token punctuation">(</span>genesis_block<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_wallet</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建钱包"""</span>
        <span class="token keyword">if</span> address <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>wallets<span class="token punctuation">:</span>
            wallet <span class="token operator">=</span> Wallet<span class="token punctuation">(</span>address<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>wallets<span class="token punctuation">[</span>address<span class="token punctuation">]</span> <span class="token operator">=</span> wallet
            <span class="token keyword">return</span> wallet
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>wallets<span class="token punctuation">[</span>address<span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">get_balance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取地址余额"""</span>
        balance <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> block <span class="token keyword">in</span> self<span class="token punctuation">.</span>chain<span class="token punctuation">:</span>
            <span class="token keyword">for</span> tx_data <span class="token keyword">in</span> block<span class="token punctuation">.</span>transactions<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 挖矿奖励</span>
                    <span class="token keyword">if</span> tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'mining_reward'</span> <span class="token keyword">and</span> tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'to'</span><span class="token punctuation">)</span> <span class="token operator">==</span> address<span class="token punctuation">:</span>
                        balance <span class="token operator">+=</span> Decimal<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'amount'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">,</span> <span class="token string">'to_addr'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">,</span> <span class="token string">'from_addr'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 普通交易</span>
                    <span class="token keyword">if</span> tx_data<span class="token punctuation">.</span>to_addr <span class="token operator">==</span> address<span class="token punctuation">:</span>
                        balance <span class="token operator">+=</span> tx_data<span class="token punctuation">.</span>amount
                    <span class="token keyword">if</span> tx_data<span class="token punctuation">.</span>from_addr <span class="token operator">==</span> address<span class="token punctuation">:</span>
                        balance <span class="token operator">-=</span> <span class="token punctuation">(</span>tx_data<span class="token punctuation">.</span>amount <span class="token operator">+</span> tx_data<span class="token punctuation">.</span>fee<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> balance
    
    <span class="token keyword">def</span> <span class="token function">add_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加交易到待处理池"""</span>
        <span class="token comment"># 验证交易</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>validate_transaction<span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"交易验证失败"</span>
        
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>lock<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>pending_transactions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>transaction<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"交易已添加到待处理池"</span>
    
    <span class="token keyword">def</span> <span class="token function">validate_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证交易"""</span>
        <span class="token comment"># 检查余额</span>
        sender_balance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_balance<span class="token punctuation">(</span>transaction<span class="token punctuation">.</span>from_addr<span class="token punctuation">)</span>
        required_amount <span class="token operator">=</span> transaction<span class="token punctuation">.</span>amount <span class="token operator">+</span> transaction<span class="token punctuation">.</span>fee
        
        <span class="token keyword">if</span> sender_balance <span class="token operator">&lt;</span> required_amount<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token comment"># 验证签名（简化版本）</span>
        <span class="token keyword">if</span> transaction<span class="token punctuation">.</span>from_addr <span class="token keyword">in</span> self<span class="token punctuation">.</span>wallets<span class="token punctuation">:</span>
            wallet <span class="token operator">=</span> self<span class="token punctuation">.</span>wallets<span class="token punctuation">[</span>transaction<span class="token punctuation">.</span>from_addr<span class="token punctuation">]</span>
            <span class="token keyword">return</span> transaction<span class="token punctuation">.</span>verify_signature<span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>public_key<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">mine_pending_transactions</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mining_reward_address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""挖矿处理待处理交易"""</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>lock<span class="token punctuation">:</span>
            <span class="token comment"># 添加挖矿奖励交易</span>
            reward_tx <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'mining_reward'</span><span class="token punctuation">,</span>
                <span class="token string">'to'</span><span class="token punctuation">:</span> mining_reward_address<span class="token punctuation">,</span>
                <span class="token string">'amount'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mining_reward<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment"># 创建新区块</span>
            transactions <span class="token operator">=</span> self<span class="token punctuation">.</span>pending_transactions<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span>reward_tx<span class="token punctuation">]</span>
            new_block <span class="token operator">=</span> Block<span class="token punctuation">(</span>
                <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>chain<span class="token punctuation">)</span><span class="token punctuation">,</span>
                transactions<span class="token punctuation">,</span>
                datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>get_latest_block<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hash</span>
            <span class="token punctuation">)</span>
            
            <span class="token comment"># 挖矿</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始挖矿区块 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>new_block<span class="token punctuation">.</span>index<span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
            new_block<span class="token punctuation">.</span>mine_block<span class="token punctuation">(</span>self<span class="token punctuation">.</span>difficulty<span class="token punctuation">)</span>
            
            <span class="token comment"># 添加到链中</span>
            self<span class="token punctuation">.</span>chain<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_block<span class="token punctuation">)</span>
            
            <span class="token comment"># 清空待处理交易</span>
            self<span class="token punctuation">.</span>pending_transactions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"区块 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>new_block<span class="token punctuation">.</span>index<span class="token punctuation">&#125;</span></span><span class="token string"> 挖矿成功!"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> new_block
    
    <span class="token keyword">def</span> <span class="token function">get_latest_block</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取最新区块"""</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>chain<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">is_chain_valid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证区块链完整性"""</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>chain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            current_block <span class="token operator">=</span> self<span class="token punctuation">.</span>chain<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            previous_block <span class="token operator">=</span> self<span class="token punctuation">.</span>chain<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 验证当前区块哈希</span>
            <span class="token keyword">if</span> current_block<span class="token punctuation">.</span><span class="token builtin">hash</span> <span class="token operator">!=</span> current_block<span class="token punctuation">.</span>calculate_hash<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token comment"># 验证与前一个区块的连接</span>
            <span class="token keyword">if</span> current_block<span class="token punctuation">.</span>previous_hash <span class="token operator">!=</span> previous_block<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">get_transaction_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取地址交易历史"""</span>
        history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> block <span class="token keyword">in</span> self<span class="token punctuation">.</span>chain<span class="token punctuation">:</span>
            <span class="token keyword">for</span> tx_data <span class="token keyword">in</span> block<span class="token punctuation">.</span>transactions<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 挖矿奖励</span>
                    <span class="token keyword">if</span> tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'mining_reward'</span> <span class="token keyword">and</span> tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'to'</span><span class="token punctuation">)</span> <span class="token operator">==</span> address<span class="token punctuation">:</span>
                        history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                            <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'mining_reward'</span><span class="token punctuation">,</span>
                            <span class="token string">'amount'</span><span class="token punctuation">:</span> tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'amount'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token string">'timestamp'</span><span class="token punctuation">:</span> tx_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'timestamp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token string">'block'</span><span class="token punctuation">:</span> block<span class="token punctuation">.</span>index
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">,</span> <span class="token string">'to_addr'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">,</span> <span class="token string">'from_addr'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 普通交易</span>
                    <span class="token keyword">if</span> tx_data<span class="token punctuation">.</span>to_addr <span class="token operator">==</span> address <span class="token keyword">or</span> tx_data<span class="token punctuation">.</span>from_addr <span class="token operator">==</span> address<span class="token punctuation">:</span>
                        history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                            <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'transfer'</span><span class="token punctuation">,</span>
                            <span class="token string">'from'</span><span class="token punctuation">:</span> tx_data<span class="token punctuation">.</span>from_addr<span class="token punctuation">,</span>
                            <span class="token string">'to'</span><span class="token punctuation">:</span> tx_data<span class="token punctuation">.</span>to_addr<span class="token punctuation">,</span>
                            <span class="token string">'amount'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token string">'fee'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tx_data<span class="token punctuation">.</span>fee<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token string">'timestamp'</span><span class="token punctuation">:</span> tx_data<span class="token punctuation">.</span>timestamp<span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token string">'block'</span><span class="token punctuation">:</span> block<span class="token punctuation">.</span>index
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> history

<span class="token comment"># 数字货币演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_digital_currency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示数字货币系统"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 数字货币系统演示 ==="</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建区块链</span>
    blockchain <span class="token operator">=</span> DigitalCurrencyBlockchain<span class="token punctuation">(</span><span class="token string">"TechCoin"</span><span class="token punctuation">,</span> <span class="token string">"TECH"</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建钱包</span>
    alice_wallet <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>create_wallet<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span>
    bob_wallet <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>create_wallet<span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span>
    charlie_wallet <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>create_wallet<span class="token punctuation">(</span><span class="token string">"Charlie"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 初始挖矿 - 为Alice获得初始代币"</span><span class="token punctuation">)</span>
    blockchain<span class="token punctuation">.</span>mine_pending_transactions<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>blockchain<span class="token punctuation">.</span>get_balance<span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. Alice向Bob转账"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        tx1 <span class="token operator">=</span> alice_wallet<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
        success<span class="token punctuation">,</span> message <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>add_transaction<span class="token punctuation">(</span>tx1<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"交易状态: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"交易失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. Alice向Charlie转账"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        tx2 <span class="token operator">=</span> alice_wallet<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
        success<span class="token punctuation">,</span> message <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>add_transaction<span class="token punctuation">(</span>tx2<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"交易状态: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"交易失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 挖矿确认交易"</span><span class="token punctuation">)</span>
    blockchain<span class="token punctuation">.</span>mine_pending_transactions<span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span>  <span class="token comment"># Bob作为矿工</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n5. 查看余额"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> address <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Charlie"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        balance <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>get_balance<span class="token punctuation">(</span>address<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>address<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>balance<span class="token punctuation">&#125;</span></span><span class="token string"> TECH"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n6. 验证区块链完整性"</span><span class="token punctuation">)</span>
    is_valid <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>is_chain_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"区块链完整性: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'有效'</span> <span class="token keyword">if</span> is_valid <span class="token keyword">else</span> <span class="token string">'无效'</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n7. 查看交易历史"</span><span class="token punctuation">)</span>
    alice_history <span class="token operator">=</span> blockchain<span class="token punctuation">.</span>get_transaction_history<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice交易历史: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>alice_history<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">笔交易"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> tx <span class="token keyword">in</span> alice_history<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行演示</span>
<span class="token comment"># demonstrate_digital_currency()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h2 id="（二）供应链管理"><a href="#（二）供应链管理" class="headerlink" title="（二）供应链管理"></a>（二）供应链管理</h2><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SupplyChainItem</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""供应链物品类"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> category<span class="token punctuation">,</span> origin<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>item_id <span class="token operator">=</span> item_id
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>category <span class="token operator">=</span> category
        self<span class="token punctuation">.</span>origin <span class="token operator">=</span> origin
        self<span class="token punctuation">.</span>created_at <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>current_owner <span class="token operator">=</span> origin
        self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">"created"</span>
        self<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"origin"</span>
        self<span class="token punctuation">.</span>quality_checks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>certifications <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>transfer_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">add_quality_check</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inspector<span class="token punctuation">,</span> result<span class="token punctuation">,</span> notes<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加质量检查记录"""</span>
        check <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"inspector"</span><span class="token punctuation">:</span> inspector<span class="token punctuation">,</span>
            <span class="token string">"result"</span><span class="token punctuation">:</span> result<span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> notes<span class="token punctuation">,</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"location"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>location
        <span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>quality_checks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>check<span class="token punctuation">)</span>
        <span class="token keyword">return</span> check
    
    <span class="token keyword">def</span> <span class="token function">add_certification</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> authority<span class="token punctuation">,</span> cert_type<span class="token punctuation">,</span> cert_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加认证"""</span>
        cert <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"authority"</span><span class="token punctuation">:</span> authority<span class="token punctuation">,</span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> cert_type<span class="token punctuation">,</span>
            <span class="token string">"cert_id"</span><span class="token punctuation">:</span> cert_id<span class="token punctuation">,</span>
            <span class="token string">"issued_at"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>certifications<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cert<span class="token punctuation">)</span>
        <span class="token keyword">return</span> cert
    
    <span class="token keyword">def</span> <span class="token function">transfer_ownership</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new_owner<span class="token punctuation">,</span> location<span class="token punctuation">,</span> notes<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""转移所有权"""</span>
        transfer <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"from"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>current_owner<span class="token punctuation">,</span>
            <span class="token string">"to"</span><span class="token punctuation">:</span> new_owner<span class="token punctuation">,</span>
            <span class="token string">"location"</span><span class="token punctuation">:</span> location<span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> notes<span class="token punctuation">,</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        self<span class="token punctuation">.</span>transfer_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span>transfer<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>current_owner <span class="token operator">=</span> new_owner
        self<span class="token punctuation">.</span>location <span class="token operator">=</span> location
        <span class="token keyword">return</span> transfer

<span class="token keyword">class</span> <span class="token class-name">SupplyChainContract</span><span class="token punctuation">(</span>SmartContract<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""供应链智能合约"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> contract_id<span class="token punctuation">,</span> supply_chain_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>contract_id<span class="token punctuation">,</span> <span class="token string">"SupplyChain"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>supply_chain_name <span class="token operator">=</span> supply_chain_name
        self<span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>participants <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>compliance_rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
    <span class="token keyword">def</span> <span class="token function">register_participant</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> participant_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> role<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""注册参与者"""</span>
        participant <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"id"</span><span class="token punctuation">:</span> participant_id<span class="token punctuation">,</span>
            <span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
            <span class="token string">"role"</span><span class="token punctuation">:</span> role<span class="token punctuation">,</span>  <span class="token comment"># producer, distributor, retailer, consumer</span>
            <span class="token string">"location"</span><span class="token punctuation">:</span> location<span class="token punctuation">,</span>
            <span class="token string">"registered_at"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"reputation_score"</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
            <span class="token string">"items_handled"</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span>
        
        self<span class="token punctuation">.</span>participants<span class="token punctuation">[</span>participant_id<span class="token punctuation">]</span> <span class="token operator">=</span> participant
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"参与者注册: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">&#123;</span>role<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> participant
    
    <span class="token keyword">def</span> <span class="token function">create_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> creator_id<span class="token punctuation">,</span> item_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> category<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建物品"""</span>
        <span class="token keyword">if</span> creator_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>participants<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"创建者未注册"</span>
        
        creator <span class="token operator">=</span> self<span class="token punctuation">.</span>participants<span class="token punctuation">[</span>creator_id<span class="token punctuation">]</span>
        item <span class="token operator">=</span> SupplyChainItem<span class="token punctuation">(</span>item_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> category<span class="token punctuation">,</span> creator_id<span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>item_id<span class="token punctuation">]</span> <span class="token operator">=</span> item
        creator<span class="token punctuation">[</span><span class="token string">"items_handled"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"物品创建: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> (ID: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>item_id<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> item
    
    <span class="token keyword">def</span> <span class="token function">transfer_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item_id<span class="token punctuation">,</span> from_id<span class="token punctuation">,</span> to_id<span class="token punctuation">,</span> location<span class="token punctuation">,</span> notes<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""转移物品"""</span>
        <span class="token keyword">if</span> item_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>items<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"物品不存在"</span>
        
        <span class="token keyword">if</span> from_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>participants <span class="token keyword">or</span> to_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>participants<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"参与者未注册"</span>
        
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>item_id<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> item<span class="token punctuation">.</span>current_owner <span class="token operator">!=</span> from_id<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"转移者不是当前所有者"</span>
        
        <span class="token comment"># 执行转移</span>
        transfer <span class="token operator">=</span> item<span class="token punctuation">.</span>transfer_ownership<span class="token punctuation">(</span>to_id<span class="token punctuation">,</span> location<span class="token punctuation">,</span> notes<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新参与者统计</span>
        self<span class="token punctuation">.</span>participants<span class="token punctuation">[</span>to_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"items_handled"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"物品转移: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> 从 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>from_id<span class="token punctuation">&#125;</span></span><span class="token string"> 到 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>to_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> transfer
    
    <span class="token keyword">def</span> <span class="token function">add_quality_check</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item_id<span class="token punctuation">,</span> inspector_id<span class="token punctuation">,</span> result<span class="token punctuation">,</span> notes<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加质量检查"""</span>
        <span class="token keyword">if</span> item_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>items<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"物品不存在"</span>
        
        <span class="token keyword">if</span> inspector_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>participants<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"检查员未注册"</span>
        
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>item_id<span class="token punctuation">]</span>
        check <span class="token operator">=</span> item<span class="token punctuation">.</span>add_quality_check<span class="token punctuation">(</span>inspector_id<span class="token punctuation">,</span> result<span class="token punctuation">,</span> notes<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新检查员声誉</span>
        inspector <span class="token operator">=</span> self<span class="token punctuation">.</span>participants<span class="token punctuation">[</span>inspector_id<span class="token punctuation">]</span>
        <span class="token keyword">if</span> result <span class="token operator">==</span> <span class="token string">"pass"</span><span class="token punctuation">:</span>
            inspector<span class="token punctuation">[</span><span class="token string">"reputation_score"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> inspector<span class="token punctuation">[</span><span class="token string">"reputation_score"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> result <span class="token operator">==</span> <span class="token string">"fail"</span><span class="token punctuation">:</span>
            inspector<span class="token punctuation">[</span><span class="token string">"reputation_score"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inspector<span class="token punctuation">[</span><span class="token string">"reputation_score"</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"质量检查: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> check
    
    <span class="token keyword">def</span> <span class="token function">trace_item_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""追溯物品历史"""</span>
        <span class="token keyword">if</span> item_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>items<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>item_id<span class="token punctuation">]</span>
        
        history <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"item_info"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>item_id<span class="token punctuation">,</span>
                <span class="token string">"name"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>category<span class="token punctuation">,</span>
                <span class="token string">"origin"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>origin<span class="token punctuation">,</span>
                <span class="token string">"created_at"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
                <span class="token string">"current_owner"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>current_owner<span class="token punctuation">,</span>
                <span class="token string">"current_location"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>location<span class="token punctuation">,</span>
                <span class="token string">"status"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>status
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token string">"transfer_history"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>transfer_history<span class="token punctuation">,</span>
            <span class="token string">"quality_checks"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>quality_checks<span class="token punctuation">,</span>
            <span class="token string">"certifications"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>certifications
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> history
    
    <span class="token keyword">def</span> <span class="token function">verify_authenticity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证物品真实性"""</span>
        <span class="token keyword">if</span> item_id <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>items<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"物品不存在"</span>
        
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>items<span class="token punctuation">[</span>item_id<span class="token punctuation">]</span>
        
        <span class="token comment"># 检查是否有质量检查记录</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> item<span class="token punctuation">.</span>quality_checks<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"缺少质量检查记录"</span>
        
        <span class="token comment"># 检查最近的质量检查结果</span>
        latest_check <span class="token operator">=</span> item<span class="token punctuation">.</span>quality_checks<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> latest_check<span class="token punctuation">[</span><span class="token string">"result"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"pass"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"最近质量检查未通过"</span>
        
        <span class="token comment"># 检查转移历史的完整性</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>transfer_history<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> item<span class="token punctuation">.</span>current_owner <span class="token operator">!=</span> item<span class="token punctuation">.</span>origin<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"转移历史不完整"</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"物品验证通过"</span>

<span class="token comment"># 供应链演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_supply_chain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示供应链管理"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 供应链管理演示 ==="</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建供应链合约</span>
    supply_chain <span class="token operator">=</span> SupplyChainContract<span class="token punctuation">(</span><span class="token string">"SC001"</span><span class="token punctuation">,</span> <span class="token string">"有机食品供应链"</span><span class="token punctuation">)</span>
    supply_chain<span class="token punctuation">.</span>activate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 注册参与者</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 注册供应链参与者"</span><span class="token punctuation">)</span>
    participants <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">"farm001"</span><span class="token punctuation">,</span> <span class="token string">"绿色农场"</span><span class="token punctuation">,</span> <span class="token string">"producer"</span><span class="token punctuation">,</span> <span class="token string">"山东寿光"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"dist001"</span><span class="token punctuation">,</span> <span class="token string">"新鲜配送"</span><span class="token punctuation">,</span> <span class="token string">"distributor"</span><span class="token punctuation">,</span> <span class="token string">"北京朝阳"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"store001"</span><span class="token punctuation">,</span> <span class="token string">"有机超市"</span><span class="token punctuation">,</span> <span class="token string">"retailer"</span><span class="token punctuation">,</span> <span class="token string">"北京海淀"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"qc001"</span><span class="token punctuation">,</span> <span class="token string">"质检机构"</span><span class="token punctuation">,</span> <span class="token string">"inspector"</span><span class="token punctuation">,</span> <span class="token string">"北京"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> pid<span class="token punctuation">,</span> name<span class="token punctuation">,</span> role<span class="token punctuation">,</span> location <span class="token keyword">in</span> participants<span class="token punctuation">:</span>
        participant <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>register_participant<span class="token punctuation">(</span>pid<span class="token punctuation">,</span> name<span class="token punctuation">,</span> role<span class="token punctuation">,</span> location<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"注册: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">&#123;</span>role<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建物品</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 创建有机蔬菜"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> item <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>create_item<span class="token punctuation">(</span>
        <span class="token string">"farm001"</span><span class="token punctuation">,</span> <span class="token string">"tomato001"</span><span class="token punctuation">,</span> <span class="token string">"有机西红柿"</span><span class="token punctuation">,</span> <span class="token string">"蔬菜"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"创建结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>success<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 添加质量检查</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 农场质量检查"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> check <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>add_quality_check<span class="token punctuation">(</span>
        <span class="token string">"tomato001"</span><span class="token punctuation">,</span> <span class="token string">"qc001"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">,</span> <span class="token string">"符合有机标准"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"质检结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>check<span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> success <span class="token keyword">else</span> <span class="token string">'失败'</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 转移到配送中心</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 转移到配送中心"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> transfer <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>transfer_item<span class="token punctuation">(</span>
        <span class="token string">"tomato001"</span><span class="token punctuation">,</span> <span class="token string">"farm001"</span><span class="token punctuation">,</span> <span class="token string">"dist001"</span><span class="token punctuation">,</span> <span class="token string">"配送中心"</span><span class="token punctuation">,</span> <span class="token string">"冷链运输"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"转移结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>success<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 配送中心质量检查</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n5. 配送中心质量检查"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> check <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>add_quality_check<span class="token punctuation">(</span>
        <span class="token string">"tomato001"</span><span class="token punctuation">,</span> <span class="token string">"qc001"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">,</span> <span class="token string">"运输过程保持新鲜"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"质检结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>check<span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> success <span class="token keyword">else</span> <span class="token string">'失败'</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 转移到零售店</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n6. 转移到零售店"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> transfer <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>transfer_item<span class="token punctuation">(</span>
        <span class="token string">"tomato001"</span><span class="token punctuation">,</span> <span class="token string">"dist001"</span><span class="token punctuation">,</span> <span class="token string">"store001"</span><span class="token punctuation">,</span> <span class="token string">"有机超市"</span><span class="token punctuation">,</span> <span class="token string">"上架销售"</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"转移结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>success<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 追溯历史</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n7. 追溯物品历史"</span><span class="token punctuation">)</span>
    history <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>trace_item_history<span class="token punctuation">(</span><span class="token string">"tomato001"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> history<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"物品: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>history<span class="token punctuation">[</span><span class="token string">'item_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"原产地: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>history<span class="token punctuation">[</span><span class="token string">'item_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'origin'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"当前位置: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>history<span class="token punctuation">[</span><span class="token string">'item_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'current_location'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"转移次数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>history<span class="token punctuation">[</span><span class="token string">'transfer_history'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"质检次数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>history<span class="token punctuation">[</span><span class="token string">'quality_checks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n转移历史:"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> transfer <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>history<span class="token punctuation">[</span><span class="token string">'transfer_history'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">&#123;</span>transfer<span class="token punctuation">[</span><span class="token string">'from'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>transfer<span class="token punctuation">[</span><span class="token string">'to'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">&#123;</span>transfer<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 验证真实性</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n8. 验证物品真实性"</span><span class="token punctuation">)</span>
    is_authentic<span class="token punctuation">,</span> message <span class="token operator">=</span> supply_chain<span class="token punctuation">.</span>verify_authenticity<span class="token punctuation">(</span><span class="token string">"tomato001"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"验证结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行演示</span>
<span class="token comment"># demonstrate_supply_chain()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h1 id="五、区块链开发实践"><a href="#五、区块链开发实践" class="headerlink" title="五、区块链开发实践"></a>五、区块链开发实践</h1><h2 id="（一）简单区块链网络实现"><a href="#（一）简单区块链网络实现" class="headerlink" title="（一）简单区块链网络实现"></a>（一）简单区块链网络实现</h2><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> json
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue

<span class="token keyword">class</span> <span class="token class-name">BlockchainNode</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""区块链网络节点"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> node_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>host <span class="token operator">=</span> host
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port
        self<span class="token punctuation">.</span>node_id <span class="token operator">=</span> node_id
        self<span class="token punctuation">.</span>blockchain <span class="token operator">=</span> DigitalCurrencyBlockchain<span class="token punctuation">(</span><span class="token string">"NetworkCoin"</span><span class="token punctuation">,</span> <span class="token string">"NET"</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>peers <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server_socket <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>message_queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">start_server</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""启动节点服务器"""</span>
        self<span class="token punctuation">.</span>server_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server_socket<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server_socket<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server_socket<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"节点 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>node_id<span class="token punctuation">&#125;</span></span><span class="token string"> 在 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>host<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>port<span class="token punctuation">&#125;</span></span><span class="token string"> 启动"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 启动消息处理线程</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>process_messages<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                client_socket<span class="token punctuation">,</span> address <span class="token operator">=</span> self<span class="token punctuation">.</span>server_socket<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
                threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>
                    target<span class="token operator">=</span>self<span class="token punctuation">.</span>handle_client<span class="token punctuation">,</span>
                    args<span class="token operator">=</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    daemon<span class="token operator">=</span><span class="token boolean">True</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"服务器错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_client</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client_socket<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理客户端连接"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                data <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                
                message <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>message_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> client_socket<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"客户端处理错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            client_socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">process_messages</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理消息队列"""</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>message_queue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    message<span class="token punctuation">,</span> sender_socket <span class="token operator">=</span> self<span class="token punctuation">.</span>message_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>handle_message<span class="token punctuation">(</span>message<span class="token punctuation">,</span> sender_socket<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"消息处理错误: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">,</span> sender_socket<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理收到的消息"""</span>
        msg_type <span class="token operator">=</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> msg_type <span class="token operator">==</span> <span class="token string">'new_block'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>handle_new_block<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">'block'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> msg_type <span class="token operator">==</span> <span class="token string">'new_transaction'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>handle_new_transaction<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> msg_type <span class="token operator">==</span> <span class="token string">'request_blockchain'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>send_blockchain<span class="token punctuation">(</span>sender_socket<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> msg_type <span class="token operator">==</span> <span class="token string">'peer_discovery'</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>handle_peer_discovery<span class="token punctuation">(</span>message<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">handle_new_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理新区块"""</span>
        <span class="token comment"># 验证区块</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>validate_block<span class="token punctuation">(</span>block_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 添加到本地链</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"节点 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>node_id<span class="token punctuation">&#125;</span></span><span class="token string"> 接收到新区块: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>block_data<span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token comment"># 这里应该有更复杂的区块验证和添加逻辑</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_new_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tx_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理新交易"""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"节点 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>node_id<span class="token punctuation">&#125;</span></span><span class="token string"> 接收到新交易: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx_data<span class="token punctuation">[</span><span class="token string">'tx_id'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment"># 验证并添加到交易池</span>
    
    <span class="token keyword">def</span> <span class="token function">validate_block</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> block_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证区块"""</span>
        <span class="token comment"># 简化的区块验证</span>
        required_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'transactions'</span><span class="token punctuation">,</span> <span class="token string">'timestamp'</span><span class="token punctuation">,</span> <span class="token string">'previous_hash'</span><span class="token punctuation">,</span> <span class="token string">'hash'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token builtin">all</span><span class="token punctuation">(</span>field <span class="token keyword">in</span> block_data <span class="token keyword">for</span> field <span class="token keyword">in</span> required_fields<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">broadcast_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""广播消息给所有节点"""</span>
        <span class="token keyword">for</span> peer <span class="token keyword">in</span> self<span class="token punctuation">.</span>peers<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>send_message_to_peer<span class="token punctuation">(</span>peer<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"广播到 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>peer<span class="token punctuation">&#125;</span></span><span class="token string"> 失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">send_message_to_peer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> peer<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""发送消息给指定节点"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
            sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>peer<span class="token punctuation">)</span>
            sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"发送消息到 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>peer<span class="token punctuation">&#125;</span></span><span class="token string"> 失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">add_peer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> peer_host<span class="token punctuation">,</span> peer_port<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""添加对等节点"""</span>
        peer <span class="token operator">=</span> <span class="token punctuation">(</span>peer_host<span class="token punctuation">,</span> peer_port<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>peers<span class="token punctuation">.</span>add<span class="token punctuation">(</span>peer<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"节点 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>node_id<span class="token punctuation">&#125;</span></span><span class="token string"> 添加对等节点: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>peer<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""停止节点"""</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>server_socket<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>server_socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"节点 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>node_id<span class="token punctuation">&#125;</span></span><span class="token string"> 已停止"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 网络演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_blockchain_network</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示区块链网络"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 区块链网络演示 ==="</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建多个节点</span>
    nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    ports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8001</span><span class="token punctuation">,</span> <span class="token number">8002</span><span class="token punctuation">,</span> <span class="token number">8003</span><span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> port <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ports<span class="token punctuation">)</span><span class="token punctuation">:</span>
        node <span class="token operator">=</span> BlockchainNode<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> port<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"node_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        nodes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    
    <span class="token comment"># 启动节点（在实际应用中，这些会在不同的进程或机器上运行）</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>node<span class="token punctuation">.</span>start_server<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 等待节点启动</span>
    <span class="token keyword">import</span> time
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 建立节点连接</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> node <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j<span class="token punctuation">,</span> other_node <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">!=</span> j<span class="token punctuation">:</span>
                node<span class="token punctuation">.</span>add_peer<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> other_node<span class="token punctuation">.</span>port<span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n网络节点已启动并连接"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟网络活动</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 停止所有节点</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        node<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 运行网络演示</span>
<span class="token comment"># demonstrate_blockchain_network()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h2 id="（二）性能优化策略"><a href="#（二）性能优化策略" class="headerlink" title="（二）性能优化策略"></a>（二）性能优化策略</h2><h3 id="1-分片技术"><a href="#1-分片技术" class="headerlink" title="1. 分片技术"></a>1. 分片技术</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ShardedBlockchain</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""分片区块链实现"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_shards<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>num_shards <span class="token operator">=</span> num_shards
        self<span class="token punctuation">.</span>shards <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>cross_shard_transactions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># 初始化分片</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_shards<span class="token punctuation">)</span><span class="token punctuation">:</span>
            shard <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"shard_id"</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>
                <span class="token string">"blockchain"</span><span class="token punctuation">:</span> DigitalCurrencyBlockchain<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Shard</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"S</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token number">250000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"validators"</span><span class="token punctuation">:</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"transaction_pool"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
            self<span class="token punctuation">.</span>shards<span class="token punctuation">.</span>append<span class="token punctuation">(</span>shard<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_shard_for_address</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""根据地址确定分片"""</span>
        address_hash <span class="token operator">=</span> CryptographicUtils<span class="token punctuation">.</span>sha256_hash<span class="token punctuation">(</span>address<span class="token punctuation">)</span>
        shard_id <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>address_hash<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>num_shards
        <span class="token keyword">return</span> shard_id
    
    <span class="token keyword">def</span> <span class="token function">process_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理交易"""</span>
        from_shard <span class="token operator">=</span> self<span class="token punctuation">.</span>get_shard_for_address<span class="token punctuation">(</span>transaction<span class="token punctuation">.</span>from_addr<span class="token punctuation">)</span>
        to_shard <span class="token operator">=</span> self<span class="token punctuation">.</span>get_shard_for_address<span class="token punctuation">(</span>transaction<span class="token punctuation">.</span>to_addr<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> from_shard <span class="token operator">==</span> to_shard<span class="token punctuation">:</span>
            <span class="token comment"># 同分片交易</span>
            self<span class="token punctuation">.</span>shards<span class="token punctuation">[</span>from_shard<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"transaction_pool"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>transaction<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"交易添加到分片 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>from_shard<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 跨分片交易</span>
            cross_shard_tx <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"transaction"</span><span class="token punctuation">:</span> transaction<span class="token punctuation">,</span>
                <span class="token string">"from_shard"</span><span class="token punctuation">:</span> from_shard<span class="token punctuation">,</span>
                <span class="token string">"to_shard"</span><span class="token punctuation">:</span> to_shard<span class="token punctuation">,</span>
                <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"pending"</span>
            <span class="token punctuation">&#125;</span>
            self<span class="token punctuation">.</span>cross_shard_transactions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cross_shard_tx<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"跨分片交易: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>from_shard<span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>to_shard<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    
    <span class="token keyword">def</span> <span class="token function">process_cross_shard_transactions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理跨分片交易"""</span>
        <span class="token keyword">for</span> cross_tx <span class="token keyword">in</span> self<span class="token punctuation">.</span>cross_shard_transactions<span class="token punctuation">:</span>
            <span class="token keyword">if</span> cross_tx<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"pending"</span><span class="token punctuation">:</span>
                <span class="token comment"># 简化的跨分片处理逻辑</span>
                from_shard <span class="token operator">=</span> self<span class="token punctuation">.</span>shards<span class="token punctuation">[</span>cross_tx<span class="token punctuation">[</span><span class="token string">"from_shard"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                to_shard <span class="token operator">=</span> self<span class="token punctuation">.</span>shards<span class="token punctuation">[</span>cross_tx<span class="token punctuation">[</span><span class="token string">"to_shard"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 在源分片扣除余额</span>
                from_shard<span class="token punctuation">[</span><span class="token string">"transaction_pool"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>cross_tx<span class="token punctuation">[</span><span class="token string">"transaction"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token comment"># 在目标分片增加余额</span>
                to_shard<span class="token punctuation">[</span><span class="token string">"transaction_pool"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>cross_tx<span class="token punctuation">[</span><span class="token string">"transaction"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                
                cross_tx<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"completed"</span>
    
    <span class="token keyword">def</span> <span class="token function">get_shard_stats</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取分片统计信息"""</span>
        stats <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> shard <span class="token keyword">in</span> self<span class="token punctuation">.</span>shards<span class="token punctuation">:</span>
            stats<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token string">"shard_id"</span><span class="token punctuation">:</span> shard<span class="token punctuation">[</span><span class="token string">"shard_id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"blocks"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>shard<span class="token punctuation">[</span><span class="token string">"blockchain"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>chain<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"pending_transactions"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>shard<span class="token punctuation">[</span><span class="token string">"transaction_pool"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"validators"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>shard<span class="token punctuation">[</span><span class="token string">"validators"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> stats

<span class="token comment"># 分片演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_sharding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示分片技术"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 分片技术演示 ==="</span><span class="token punctuation">)</span>
    
    sharded_bc <span class="token operator">=</span> ShardedBlockchain<span class="token punctuation">(</span>num_shards<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建测试交易</span>
    addresses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token string">"Eve"</span><span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n地址分片分配:"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> addr <span class="token keyword">in</span> addresses<span class="token punctuation">:</span>
        shard_id <span class="token operator">=</span> sharded_bc<span class="token punctuation">.</span>get_shard_for_address<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>addr<span class="token punctuation">&#125;</span></span><span class="token string">: 分片 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>shard_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建交易</span>
    transactions <span class="token operator">=</span> <span class="token punctuation">[</span>
        Transaction<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Transaction<span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Transaction<span class="token punctuation">(</span><span class="token string">"Charlie"</span><span class="token punctuation">,</span> <span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Transaction<span class="token punctuation">(</span><span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token string">"Eve"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n处理交易:"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> tx <span class="token keyword">in</span> transactions<span class="token punctuation">:</span>
        result <span class="token operator">=</span> sharded_bc<span class="token punctuation">.</span>process_transaction<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx<span class="token punctuation">.</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx<span class="token punctuation">.</span>to_addr<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n分片统计:"</span><span class="token punctuation">)</span>
    stats <span class="token operator">=</span> sharded_bc<span class="token punctuation">.</span>get_shard_stats<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> stat <span class="token keyword">in</span> stats<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"分片 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'shard_id'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>stat<span class="token punctuation">[</span><span class="token string">'pending_transactions'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> 笔待处理交易"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行分片演示</span>
<span class="token comment"># demonstrate_sharding()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h3 id="2-状态通道"><a href="#2-状态通道" class="headerlink" title="2. 状态通道"></a>2. 状态通道</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">StateChannel</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""状态通道实现"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> channel_id<span class="token punctuation">,</span> participant_a<span class="token punctuation">,</span> participant_b<span class="token punctuation">,</span> initial_balance_a<span class="token punctuation">,</span> initial_balance_b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>channel_id <span class="token operator">=</span> channel_id
        self<span class="token punctuation">.</span>participant_a <span class="token operator">=</span> participant_a
        self<span class="token punctuation">.</span>participant_b <span class="token operator">=</span> participant_b
        self<span class="token punctuation">.</span>balance_a <span class="token operator">=</span> initial_balance_a
        self<span class="token punctuation">.</span>balance_b <span class="token operator">=</span> initial_balance_b
        self<span class="token punctuation">.</span>nonce <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>state_updates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>is_open <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>dispute_period <span class="token operator">=</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>created_at <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_state_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_participant<span class="token punctuation">,</span> to_participant<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建状态更新"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_open<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"通道已关闭"</span>
        
        <span class="token comment"># 验证参与者</span>
        <span class="token keyword">if</span> from_participant <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>participant_a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>participant_b<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"无效的发送者"</span>
        
        <span class="token keyword">if</span> to_participant <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>participant_a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>participant_b<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"无效的接收者"</span>
        
        <span class="token comment"># 检查余额</span>
        <span class="token keyword">if</span> from_participant <span class="token operator">==</span> self<span class="token punctuation">.</span>participant_a<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>balance_a <span class="token operator">&lt;</span> amount<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"余额不足"</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>balance_b <span class="token operator">&lt;</span> amount<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"余额不足"</span>
        
        <span class="token comment"># 创建状态更新</span>
        self<span class="token punctuation">.</span>nonce <span class="token operator">+=</span> <span class="token number">1</span>
        state_update <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"nonce"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>nonce<span class="token punctuation">,</span>
            <span class="token string">"from"</span><span class="token punctuation">:</span> from_participant<span class="token punctuation">,</span>
            <span class="token string">"to"</span><span class="token punctuation">:</span> to_participant<span class="token punctuation">,</span>
            <span class="token string">"amount"</span><span class="token punctuation">:</span> amount<span class="token punctuation">,</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"new_balance_a"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>balance_a <span class="token operator">-</span> amount <span class="token keyword">if</span> from_participant <span class="token operator">==</span> self<span class="token punctuation">.</span>participant_a <span class="token keyword">else</span> self<span class="token punctuation">.</span>balance_a <span class="token operator">+</span> amount<span class="token punctuation">,</span>
            <span class="token string">"new_balance_b"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>balance_b <span class="token operator">-</span> amount <span class="token keyword">if</span> from_participant <span class="token operator">==</span> self<span class="token punctuation">.</span>participant_b <span class="token keyword">else</span> self<span class="token punctuation">.</span>balance_b <span class="token operator">+</span> amount
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment"># 更新余额</span>
        <span class="token keyword">if</span> from_participant <span class="token operator">==</span> self<span class="token punctuation">.</span>participant_a<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>balance_a <span class="token operator">-=</span> amount
            self<span class="token punctuation">.</span>balance_b <span class="token operator">+=</span> amount
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>balance_b <span class="token operator">-=</span> amount
            self<span class="token punctuation">.</span>balance_a <span class="token operator">+=</span> amount
        
        self<span class="token punctuation">.</span>state_updates<span class="token punctuation">.</span>append<span class="token punctuation">(</span>state_update<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> state_update
    
    <span class="token keyword">def</span> <span class="token function">close_channel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> final_balance_a<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> final_balance_b<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""关闭通道"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_open<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"通道已关闭"</span>
        
        <span class="token comment"># 使用最终余额或当前余额</span>
        final_a <span class="token operator">=</span> final_balance_a <span class="token keyword">if</span> final_balance_a <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>balance_a
        final_b <span class="token operator">=</span> final_balance_b <span class="token keyword">if</span> final_balance_b <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>balance_b
        
        self<span class="token punctuation">.</span>is_open <span class="token operator">=</span> <span class="token boolean">False</span>
        
        closure_info <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"closed_at"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"final_balance_a"</span><span class="token punctuation">:</span> final_a<span class="token punctuation">,</span>
            <span class="token string">"final_balance_b"</span><span class="token punctuation">:</span> final_b<span class="token punctuation">,</span>
            <span class="token string">"total_updates"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state_updates<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> closure_info
    
    <span class="token keyword">def</span> <span class="token function">get_channel_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取通道信息"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"channel_id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>channel_id<span class="token punctuation">,</span>
            <span class="token string">"participants"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>participant_a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>participant_b<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">"current_balances"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                self<span class="token punctuation">.</span>participant_a<span class="token punctuation">:</span> self<span class="token punctuation">.</span>balance_a<span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>participant_b<span class="token punctuation">:</span> self<span class="token punctuation">.</span>balance_b
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token string">"nonce"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>nonce<span class="token punctuation">,</span>
            <span class="token string">"is_open"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>is_open<span class="token punctuation">,</span>
            <span class="token string">"total_updates"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state_updates<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"created_at"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>created_at
        <span class="token punctuation">&#125;</span>

<span class="token comment"># 状态通道演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_state_channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示状态通道"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 状态通道演示 ==="</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 创建状态通道</span>
    channel <span class="token operator">=</span> StateChannel<span class="token punctuation">(</span><span class="token string">"CH001"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 初始状态"</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> channel<span class="token punctuation">.</span>get_channel_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>info<span class="token punctuation">[</span><span class="token string">'current_balances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bob余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>info<span class="token punctuation">[</span><span class="token string">'current_balances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Bob'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 进行多次交易</span>
    transactions <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 链下交易"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> from_addr<span class="token punctuation">,</span> to_addr<span class="token punctuation">,</span> amount <span class="token keyword">in</span> transactions<span class="token punctuation">:</span>
        success<span class="token punctuation">,</span> result <span class="token operator">=</span> channel<span class="token punctuation">.</span>create_state_update<span class="token punctuation">(</span>from_addr<span class="token punctuation">,</span> to_addr<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>
        <span class="token keyword">if</span> success<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>to_addr<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string"> (成功)"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>to_addr<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string"> (失败: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 最终状态"</span><span class="token punctuation">)</span>
    final_info <span class="token operator">=</span> channel<span class="token punctuation">.</span>get_channel_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>final_info<span class="token punctuation">[</span><span class="token string">'current_balances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bob余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>final_info<span class="token punctuation">[</span><span class="token string">'current_balances'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Bob'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"总交易次数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>final_info<span class="token punctuation">[</span><span class="token string">'total_updates'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 关闭通道</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 关闭通道"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> closure <span class="token operator">=</span> channel<span class="token punctuation">.</span>close_channel<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> success<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"通道已关闭"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice最终余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>closure<span class="token punctuation">[</span><span class="token string">'final_balance_a'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bob最终余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>closure<span class="token punctuation">[</span><span class="token string">'final_balance_b'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行状态通道演示</span>
<span class="token comment"># demonstrate_state_channel()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h1 id="六、区块链安全考虑"><a href="#六、区块链安全考虑" class="headerlink" title="六、区块链安全考虑"></a>六、区块链安全考虑</h1><h2 id="（一）常见攻击类型及防护"><a href="#（一）常见攻击类型及防护" class="headerlink" title="（一）常见攻击类型及防护"></a>（一）常见攻击类型及防护</h2><h3 id="1-51-攻击防护"><a href="#1-51-攻击防护" class="headerlink" title="1. 51%攻击防护"></a>1. 51%攻击防护</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">AttackDetection</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""攻击检测系统"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>mining_power_distribution <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        self<span class="token punctuation">.</span>block_production_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>suspicious_activities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">monitor_mining_power</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> miner_id<span class="token punctuation">,</span> hash_rate<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""监控挖矿算力"""</span>
        self<span class="token punctuation">.</span>mining_power_distribution<span class="token punctuation">[</span>miner_id<span class="token punctuation">]</span> <span class="token operator">=</span> hash_rate
        
        total_hash_rate <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mining_power_distribution<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        miner_percentage <span class="token operator">=</span> <span class="token punctuation">(</span>hash_rate <span class="token operator">/</span> total_hash_rate<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
        
        <span class="token keyword">if</span> miner_percentage <span class="token operator">></span> <span class="token number">45</span><span class="token punctuation">:</span>  <span class="token comment"># 接近51%时发出警告</span>
            warning <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"high_mining_power"</span><span class="token punctuation">,</span>
                <span class="token string">"miner_id"</span><span class="token punctuation">:</span> miner_id<span class="token punctuation">,</span>
                <span class="token string">"percentage"</span><span class="token punctuation">:</span> miner_percentage<span class="token punctuation">,</span>
                <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            self<span class="token punctuation">.</span>suspicious_activities<span class="token punctuation">.</span>append<span class="token punctuation">(</span>warning<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"警告: 矿工 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>miner_id<span class="token punctuation">&#125;</span></span><span class="token string"> 控制了 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>miner_percentage<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">% 的算力"</span></span>
        
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"矿工 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>miner_id<span class="token punctuation">&#125;</span></span><span class="token string"> 算力占比: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>miner_percentage<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">%"</span></span>
    
    <span class="token keyword">def</span> <span class="token function">detect_selfish_mining</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> miner_id<span class="token punctuation">,</span> blocks_mined<span class="token punctuation">,</span> time_period<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检测自私挖矿"""</span>
        expected_blocks <span class="token operator">=</span> time_period <span class="token operator">*</span> <span class="token number">0.1</span>  <span class="token comment"># 假设正常情况下10%的出块率</span>
        
        <span class="token keyword">if</span> blocks_mined <span class="token operator">></span> expected_blocks <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">:</span>
            alert <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"selfish_mining"</span><span class="token punctuation">,</span>
                <span class="token string">"miner_id"</span><span class="token punctuation">:</span> miner_id<span class="token punctuation">,</span>
                <span class="token string">"blocks_mined"</span><span class="token punctuation">:</span> blocks_mined<span class="token punctuation">,</span>
                <span class="token string">"expected_blocks"</span><span class="token punctuation">:</span> expected_blocks<span class="token punctuation">,</span>
                <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            self<span class="token punctuation">.</span>suspicious_activities<span class="token punctuation">.</span>append<span class="token punctuation">(</span>alert<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"可能的自私挖矿: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>miner_id<span class="token punctuation">&#125;</span></span><span class="token string"> 在 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>time_period<span class="token punctuation">&#125;</span></span><span class="token string"> 时间内挖出 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>blocks_mined<span class="token punctuation">&#125;</span></span><span class="token string"> 个区块"</span></span>
        
        <span class="token keyword">return</span> <span class="token string">"正常挖矿行为"</span>
    
    <span class="token keyword">def</span> <span class="token function">check_double_spending</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transaction_history<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查双花攻击"""</span>
        spent_outputs <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        double_spends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> tx <span class="token keyword">in</span> transaction_history<span class="token punctuation">:</span>
            tx_input <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx<span class="token punctuation">.</span>from_addr<span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx<span class="token punctuation">.</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tx<span class="token punctuation">.</span>timestamp<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
            <span class="token keyword">if</span> tx_input <span class="token keyword">in</span> spent_outputs<span class="token punctuation">:</span>
                double_spends<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                spent_outputs<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tx_input<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> double_spends<span class="token punctuation">:</span>
            alert <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"double_spending"</span><span class="token punctuation">,</span>
                <span class="token string">"transactions"</span><span class="token punctuation">:</span> double_spends<span class="token punctuation">,</span>
                <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            self<span class="token punctuation">.</span>suspicious_activities<span class="token punctuation">.</span>append<span class="token punctuation">(</span>alert<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"检测到 </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>double_spends<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> 笔双花交易"</span></span>
        
        <span class="token keyword">return</span> <span class="token string">"未检测到双花攻击"</span>
    
    <span class="token keyword">def</span> <span class="token function">get_security_report</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成安全报告"""</span>
        total_hash_rate <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mining_power_distribution<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        report <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"total_miners"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mining_power_distribution<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"total_hash_rate"</span><span class="token punctuation">:</span> total_hash_rate<span class="token punctuation">,</span>
            <span class="token string">"mining_power_distribution"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                miner<span class="token punctuation">:</span> <span class="token punctuation">(</span>power<span class="token operator">/</span>total_hash_rate<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span> 
                <span class="token keyword">for</span> miner<span class="token punctuation">,</span> power <span class="token keyword">in</span> self<span class="token punctuation">.</span>mining_power_distribution<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token string">"suspicious_activities"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>suspicious_activities<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"recent_alerts"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>suspicious_activities<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 最近5个警报</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> report

<span class="token comment"># 安全监控演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_security_monitoring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示安全监控"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 区块链安全监控演示 ==="</span><span class="token punctuation">)</span>
    
    detector <span class="token operator">=</span> AttackDetection<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟矿工算力分布</span>
    miners <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">"miner_1"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"miner_2"</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"miner_3"</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"miner_4"</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">"miner_5"</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 监控挖矿算力分布"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> miner_id<span class="token punctuation">,</span> hash_rate <span class="token keyword">in</span> miners<span class="token punctuation">:</span>
        result <span class="token operator">=</span> detector<span class="token punctuation">.</span>monitor_mining_power<span class="token punctuation">(</span>miner_id<span class="token punctuation">,</span> hash_rate<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
    <span class="token comment"># 模拟算力集中</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 模拟算力集中情况"</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> detector<span class="token punctuation">.</span>monitor_mining_power<span class="token punctuation">(</span><span class="token string">"miner_1"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>  <span class="token comment"># 大幅增加算力</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
    <span class="token comment"># 检测自私挖矿</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 检测自私挖矿"</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> detector<span class="token punctuation">.</span>detect_selfish_mining<span class="token punctuation">(</span><span class="token string">"miner_1"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 10个时间单位内挖出15个区块</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
    <span class="token comment"># 生成安全报告</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n4. 安全报告"</span><span class="token punctuation">)</span>
    report <span class="token operator">=</span> detector<span class="token punctuation">.</span>get_security_report<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"总矿工数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>report<span class="token punctuation">[</span><span class="token string">'total_miners'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"可疑活动数: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>report<span class="token punctuation">[</span><span class="token string">'suspicious_activities'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n算力分布:"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> miner<span class="token punctuation">,</span> percentage <span class="token keyword">in</span> report<span class="token punctuation">[</span><span class="token string">'mining_power_distribution'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  </span><span class="token interpolation"><span class="token punctuation">&#123;</span>miner<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>percentage<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">%"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行安全监控演示</span>
<span class="token comment"># demonstrate_security_monitoring()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h2 id="（二）智能合约安全"><a href="#（二）智能合约安全" class="headerlink" title="（二）智能合约安全"></a>（二）智能合约安全</h2><h3 id="1-重入攻击防护"><a href="#1-重入攻击防护" class="headerlink" title="1. 重入攻击防护"></a>1. 重入攻击防护</h3><figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ReentrancyGuard</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""重入攻击防护"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>locked <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>locked<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"重入攻击检测: 函数正在执行中"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>locked <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> self
    
    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>locked <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">SecureContract</span><span class="token punctuation">(</span>SmartContract<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""安全智能合约"""</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> contract_id<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> participants<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>contract_id<span class="token punctuation">,</span> creator<span class="token punctuation">,</span> participants<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>balances <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>reentrancy_guard <span class="token operator">=</span> ReentrancyGuard<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>withdrawal_limits <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"last_withdrawal"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>daily_limit <span class="token operator">=</span> <span class="token number">1000</span>
    
    <span class="token keyword">def</span> <span class="token function">deposit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""安全存款"""</span>
        <span class="token keyword">if</span> amount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"存款金额必须大于0"</span>
        
        self<span class="token punctuation">.</span>balances<span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">+=</span> amount
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span></span><span class="token string"> 存款 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"存款成功: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    
    <span class="token keyword">def</span> <span class="token function">withdraw</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""安全提款 - 防重入攻击"""</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>reentrancy_guard<span class="token punctuation">:</span>
            <span class="token comment"># 检查余额</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>balances<span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">&lt;</span> amount<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"余额不足"</span>
            
            <span class="token comment"># 检查提款限制</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>check_withdrawal_limit<span class="token punctuation">(</span>user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"超出每日提款限制"</span>
            
            <span class="token comment"># 先更新状态，再执行外部调用</span>
            self<span class="token punctuation">.</span>balances<span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">-=</span> amount
            
            <span class="token comment"># 更新提款记录</span>
            today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>withdrawal_limits<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"last_withdrawal"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> today<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>withdrawal_limits<span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"last_withdrawal"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
            
            self<span class="token punctuation">.</span>withdrawal_limits<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"amount"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> amount
            self<span class="token punctuation">.</span>withdrawal_limits<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"last_withdrawal"</span><span class="token punctuation">]</span> <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 模拟外部调用</span>
            self<span class="token punctuation">.</span>external_transfer<span class="token punctuation">(</span>user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span></span><span class="token string"> 提款 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"提款成功: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>amount<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    
    <span class="token keyword">def</span> <span class="token function">check_withdrawal_limit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""检查提款限制"""</span>
        today <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
        user_limit <span class="token operator">=</span> self<span class="token punctuation">.</span>withdrawal_limits<span class="token punctuation">[</span>user<span class="token punctuation">]</span>
        
        <span class="token comment"># 如果是新的一天，重置限制</span>
        <span class="token keyword">if</span> user_limit<span class="token punctuation">[</span><span class="token string">"last_withdrawal"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> today<span class="token punctuation">:</span>
            <span class="token keyword">return</span> amount <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>daily_limit
        
        <span class="token comment"># 检查今日累计提款</span>
        total_today <span class="token operator">=</span> user_limit<span class="token punctuation">[</span><span class="token string">"amount"</span><span class="token punctuation">]</span> <span class="token operator">+</span> amount
        <span class="token keyword">return</span> total_today <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>daily_limit
    
    <span class="token keyword">def</span> <span class="token function">external_transfer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""模拟外部转账"""</span>
        <span class="token comment"># 这里模拟可能触发重入攻击的外部调用</span>
        <span class="token keyword">pass</span>
    
    <span class="token keyword">def</span> <span class="token function">get_balance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""获取余额"""</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>balances<span class="token punctuation">[</span>user<span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">emergency_pause</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""紧急暂停"""</span>
        self<span class="token punctuation">.</span>state <span class="token operator">=</span> ContractState<span class="token punctuation">.</span>CANCELLED
        self<span class="token punctuation">.</span>log_event<span class="token punctuation">(</span><span class="token string">"合约已紧急暂停"</span><span class="token punctuation">)</span>

<span class="token comment"># 安全合约演示</span>
<span class="token keyword">def</span> <span class="token function">demonstrate_secure_contract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""演示安全合约"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=== 安全智能合约演示 ==="</span><span class="token punctuation">)</span>
    
    contract <span class="token operator">=</span> SecureContract<span class="token punctuation">(</span><span class="token string">"SEC001"</span><span class="token punctuation">,</span> <span class="token string">"Admin"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    contract<span class="token punctuation">.</span>activate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 正常操作</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. 正常存款和提款"</span><span class="token punctuation">)</span>
    contract<span class="token punctuation">.</span>deposit<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>contract<span class="token punctuation">.</span>get_balance<span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    success<span class="token punctuation">,</span> message <span class="token operator">=</span> contract<span class="token punctuation">.</span>withdraw<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提款结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Alice余额: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>contract<span class="token punctuation">.</span>get_balance<span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 测试提款限制</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. 测试每日提款限制"</span><span class="token punctuation">)</span>
    success<span class="token punctuation">,</span> message <span class="token operator">=</span> contract<span class="token punctuation">.</span>withdraw<span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span>  <span class="token comment"># 总计1300，超过1000限制</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"大额提款结果: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># 测试重入攻击防护</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. 测试重入攻击防护"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 模拟重入攻击</span>
        <span class="token keyword">with</span> contract<span class="token punctuation">.</span>reentrancy_guard<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第一层调用"</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> contract<span class="token punctuation">.</span>reentrancy_guard<span class="token punctuation">:</span>  <span class="token comment"># 这会触发重入检测</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第二层调用 - 不应该执行"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"重入攻击被阻止: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 运行安全合约演示</span>
<span class="token comment"># demonstrate_secure_contract()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>

<h1 id="七、区块链发展趋势"><a href="#七、区块链发展趋势" class="headerlink" title="七、区块链发展趋势"></a>七、区块链发展趋势</h1><h2 id="（一）新兴技术方向"><a href="#（一）新兴技术方向" class="headerlink" title="（一）新兴技术方向"></a>（一）新兴技术方向</h2><h3 id="1-跨链技术"><a href="#1-跨链技术" class="headerlink" title="1. 跨链技术"></a>1. 跨链技术</h3><p>跨链技术允许不同区块链网络之间进行资产和信息的交换，主要包括：</p>
<ul>
<li><strong>侧链技术</strong>：通过双向锚定机制实现主链和侧链的资产转移</li>
<li><strong>中继链</strong>：作为多条区块链的桥梁，协调跨链交易</li>
<li><strong>原子交换</strong>：无需第三方的点对点跨链交易</li>
<li><strong>跨链桥</strong>：连接不同区块链生态系统的基础设施</li>
</ul>
<h3 id="2-量子抗性"><a href="#2-量子抗性" class="headerlink" title="2. 量子抗性"></a>2. 量子抗性</h3><p>随着量子计算的发展，传统密码学面临挑战：</p>
<ul>
<li><strong>后量子密码学</strong>：开发抗量子攻击的加密算法</li>
<li><strong>量子密钥分发</strong>：利用量子物理原理确保通信安全</li>
<li><strong>混合加密方案</strong>：结合传统和量子抗性算法</li>
</ul>
<h3 id="3-绿色区块链"><a href="#3-绿色区块链" class="headerlink" title="3. 绿色区块链"></a>3. 绿色区块链</h3><p>环保和可持续发展成为重要考虑因素：</p>
<ul>
<li><strong>权益证明机制</strong>：大幅降低能耗</li>
<li><strong>碳中和区块链</strong>：通过碳抵消实现环保目标</li>
<li><strong>可再生能源挖矿</strong>：使用清洁能源进行区块链操作</li>
</ul>
<h2 id="（二）应用前景展望"><a href="#（二）应用前景展望" class="headerlink" title="（二）应用前景展望"></a>（二）应用前景展望</h2><h3 id="1-Web3-0时代"><a href="#1-Web3-0时代" class="headerlink" title="1. Web3.0时代"></a>1. Web3.0时代</h3><ul>
<li><strong>去中心化身份</strong>：用户完全控制自己的数字身份</li>
<li><strong>去中心化存储</strong>：分布式文件存储系统</li>
<li><strong>去中心化计算</strong>：分布式计算资源共享</li>
<li><strong>DAO治理</strong>：去中心化自治组织管理</li>
</ul>
<h3 id="2-元宇宙基础设施"><a href="#2-元宇宙基础设施" class="headerlink" title="2. 元宇宙基础设施"></a>2. 元宇宙基础设施</h3><ul>
<li><strong>虚拟资产确权</strong>：NFT技术确保虚拟物品所有权</li>
<li><strong>跨平台互操作</strong>：不同元宇宙平台间的资产流通</li>
<li><strong>去中心化虚拟经济</strong>：基于区块链的虚拟世界经济系统</li>
</ul>
<h3 id="3-央行数字货币-CBDC"><a href="#3-央行数字货币-CBDC" class="headerlink" title="3. 央行数字货币(CBDC)"></a>3. 央行数字货币(CBDC)</h3><ul>
<li><strong>数字法币</strong>：政府发行的数字化法定货币</li>
<li><strong>可编程货币</strong>：具备智能合约功能的数字货币</li>
<li><strong>跨境支付</strong>：简化国际贸易和汇款流程</li>
</ul>
<h1 id="八、学习建议与实践指南"><a href="#八、学习建议与实践指南" class="headerlink" title="八、学习建议与实践指南"></a>八、学习建议与实践指南</h1><h2 id="（一）技术学习路径"><a href="#（一）技术学习路径" class="headerlink" title="（一）技术学习路径"></a>（一）技术学习路径</h2><h3 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h3><ul>
<li>密码学基础（哈希函数、数字签名、非对称加密）</li>
<li>分布式系统原理</li>
<li>网络协议和P2P网络</li>
<li>数据结构和算法</li>
</ul>
<h3 id="2-区块链核心技术"><a href="#2-区块链核心技术" class="headerlink" title="2. 区块链核心技术"></a>2. 区块链核心技术</h3><ul>
<li>共识机制深入理解</li>
<li>智能合约开发</li>
<li>区块链网络架构</li>
<li>性能优化技术</li>
</ul>
<h3 id="3-开发实践"><a href="#3-开发实践" class="headerlink" title="3. 开发实践"></a>3. 开发实践</h3><ul>
<li>选择合适的区块链平台（Ethereum、Hyperledger等）</li>
<li>学习智能合约语言（Solidity、Rust等）</li>
<li>掌握开发工具和框架</li>
<li>参与开源项目</li>
</ul>
<h2 id="（二）实际项目建议"><a href="#（二）实际项目建议" class="headerlink" title="（二）实际项目建议"></a>（二）实际项目建议</h2><h3 id="1-初级项目"><a href="#1-初级项目" class="headerlink" title="1. 初级项目"></a>1. 初级项目</h3><ul>
<li>简单的数字货币实现</li>
<li>基础投票系统</li>
<li>简单的供应链追溯</li>
</ul>
<h3 id="2-中级项目"><a href="#2-中级项目" class="headerlink" title="2. 中级项目"></a>2. 中级项目</h3><ul>
<li>去中心化交易所(DEX)</li>
<li>NFT市场平台</li>
<li>去中心化借贷协议</li>
</ul>
<h3 id="3-高级项目"><a href="#3-高级项目" class="headerlink" title="3. 高级项目"></a>3. 高级项目</h3><ul>
<li>跨链桥开发</li>
<li>Layer 2扩容方案</li>
<li>复杂的DeFi协议</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>区块链技术作为一项革命性的创新，正在深刻改变着我们的数字世界。从比特币的诞生到如今丰富多样的区块链应用生态，这项技术展现出了巨大的潜力和价值。</p>
<h2 id="核心价值"><a href="#核心价值" class="headerlink" title="核心价值"></a>核心价值</h2><ol>
<li><strong>去中心化</strong>：消除单点故障，提高系统韧性</li>
<li><strong>透明性</strong>：所有交易公开可验证，增强信任</li>
<li><strong>不可篡改</strong>：密码学保证数据完整性</li>
<li><strong>可编程性</strong>：智能合约实现自动化执行</li>
<li><strong>全球化</strong>：无国界的价值传输网络</li>
</ol>
<h2 id="技术挑战"><a href="#技术挑战" class="headerlink" title="技术挑战"></a>技术挑战</h2><ol>
<li><strong>可扩展性</strong>：交易吞吐量和确认时间的平衡</li>
<li><strong>能耗问题</strong>：工作量证明机制的环境影响</li>
<li><strong>用户体验</strong>：复杂的技术门槛和操作流程</li>
<li><strong>监管合规</strong>：法律法规的不确定性</li>
<li><strong>安全风险</strong>：智能合约漏洞和攻击威胁</li>
</ol>
<h2 id="发展机遇"><a href="#发展机遇" class="headerlink" title="发展机遇"></a>发展机遇</h2><ol>
<li><strong>金融创新</strong>：DeFi重塑传统金融服务</li>
<li><strong>数字经济</strong>：NFT和元宇宙创造新的价值形式</li>
<li><strong>供应链优化</strong>：提高透明度和可追溯性</li>
<li><strong>身份认证</strong>：去中心化身份管理</li>
<li><strong>社会治理</strong>：DAO探索新的组织形式</li>
</ol>
<h2 id="未来展望"><a href="#未来展望" class="headerlink" title="未来展望"></a>未来展望</h2><p>区块链技术仍处于快速发展阶段，随着技术的不断成熟和应用场景的拓展，我们可以期待：</p>
<ul>
<li><strong>技术融合</strong>：与AI、IoT、5G等技术深度结合</li>
<li><strong>标准化</strong>：行业标准和协议的统一</li>
<li><strong>普及应用</strong>：更多传统行业的数字化转型</li>
<li><strong>监管完善</strong>：更加明确和友好的法律环境</li>
<li><strong>生态繁荣</strong>：更加丰富和成熟的应用生态</li>
</ul>
<p>作为一项颠覆性技术，区块链不仅仅是技术创新，更是思维方式和商业模式的革命。无论是开发者、投资者还是普通用户，都应该持续关注和学习这项技术，在数字化浪潮中把握机遇，迎接挑战。</p>
<p>区块链的未来充满无限可能，让我们共同见证和参与这场技术革命的进程！</p>
<hr>
<p><em>本文涵盖了区块链技术的核心概念、技术原理、应用实践和发展趋势。通过理论学习和代码实践相结合的方式，希望能够帮助读者深入理解区块链技术，为进一步的学习和应用打下坚实基础。</em></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0/" class="category-chain-item">学习</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" class="print-no-link">#分布式系统</a>
      
        <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" class="print-no-link">#区块链</a>
      
        <a href="/tags/%E5%8A%A0%E5%AF%86%E6%8A%80%E6%9C%AF/" class="print-no-link">#加密技术</a>
      
        <a href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" class="print-no-link">#智能合约</a>
      
        <a href="/tags/%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96/" class="print-no-link">#去中心化</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/15/%E3%80%90%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%91%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E7%B1%BB%E5%9E%8B%E4%B8%8E%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/" title="【数据库】数据库索引详解：原理、类型与优化实践">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【数据库】数据库索引详解：原理、类型与优化实践</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/15/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%EF%BC%9AIaaS%E3%80%81PaaS%E3%80%81SaaS%E5%85%A8%E9%9D%A2%E8%A7%A3%E6%9E%90/" title="【学习】云计算服务模式详解：IaaS、PaaS、SaaS全面解析">
                        <span class="hidden-mobile">【学习】云计算服务模式详解：IaaS、PaaS、SaaS全面解析</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/custom.js"></script>
<script src="/js/ai-assistant.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
