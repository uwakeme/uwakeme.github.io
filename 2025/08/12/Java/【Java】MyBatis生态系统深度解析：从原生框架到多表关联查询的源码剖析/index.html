<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【Java】MyBatis生态系统深度解析：从原生框架到多表关联查询的源码剖析 | Uwakeme</title><meta name="author" content="Wake"><meta name="copyright" content="Wake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言在Java持久层技术体系中，MyBatis生态系统经历了从原生MyBatis到MyBatis Plus，再到MyBatis Plus Join的演进历程。每一次演进都解决了特定的痛点，提升了开发效率。本文将深入分析这三个框架的核心架构、源码实现原理，以及它们在多表关联查询方面的技术创新。  系列文章导航 MyBatis基础教程 MyBatis Plus实战指南  一、MyBatis生态系统架构">
<meta property="og:type" content="article">
<meta property="og:title" content="【Java】MyBatis生态系统深度解析：从原生框架到多表关联查询的源码剖析">
<meta property="og:url" content="https://uwakeme.tech/2025/08/12/Java/%E3%80%90Java%E3%80%91MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E5%88%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/index.html">
<meta property="og:site_name" content="Uwakeme">
<meta property="og:description" content="前言在Java持久层技术体系中，MyBatis生态系统经历了从原生MyBatis到MyBatis Plus，再到MyBatis Plus Join的演进历程。每一次演进都解决了特定的痛点，提升了开发效率。本文将深入分析这三个框架的核心架构、源码实现原理，以及它们在多表关联查询方面的技术创新。  系列文章导航 MyBatis基础教程 MyBatis Plus实战指南  一、MyBatis生态系统架构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2025-08-11T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-12T07:06:50.349Z">
<meta property="article:author" content="Wake">
<meta property="article:tag" content="MyBatis Plus">
<meta property="article:tag" content="源码分析">
<meta property="article:tag" content="MyBatis">
<meta property="article:tag" content="MyBatis Plus Join">
<meta property="article:tag" content="ORM框架">
<meta property="article:tag" content="架构设计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【Java】MyBatis生态系统深度解析：从原生框架到多表关联查询的源码剖析",
  "url": "https://uwakeme.tech/2025/08/12/Java/%E3%80%90Java%E3%80%91MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E5%88%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/",
  "image": "https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png",
  "datePublished": "2025-08-11T16:00:00.000Z",
  "dateModified": "2025-08-12T07:06:50.349Z",
  "author": [
    {
      "@type": "Person",
      "name": "Wake",
      "url": "https://uwakeme.tech/about/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/avatar.jpeg"><link rel="canonical" href="https://uwakeme.tech/2025/08/12/Java/%E3%80%90Java%E3%80%91MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E5%88%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f96f39b60e7cc4fbcbd971a88f91f326";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/local-search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【Java】MyBatis生态系统深度解析：从原生框架到多表关联查询的源码剖析',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css"></noscript></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">229</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">627</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Uwakeme</span></a><a class="nav-page-title" href="/"><span class="site-name">【Java】MyBatis生态系统深度解析：从原生框架到多表关联查询的源码剖析</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【Java】MyBatis生态系统深度解析：从原生框架到多表关联查询的源码剖析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-11T16:00:00.000Z" title="发表于 2025-08-12 00:00:00">2025-08-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-12T07:06:50.349Z" title="更新于 2025-08-12 15:06:50">2025-08-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">11.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>58分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/08/12/Java/%E3%80%90Java%E3%80%91MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E5%88%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;本文最后更新于&quot;,&quot;messageNext&quot;:&quot;天前，文中内容可能已过时，请谨慎参考。&quot;,&quot;postUpdate&quot;:&quot;2025-08-12 15:06:50&quot;}" hidden=""></div><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在Java持久层技术体系中，MyBatis生态系统经历了从原生MyBatis到MyBatis Plus，再到MyBatis Plus Join的演进历程。每一次演进都解决了特定的痛点，提升了开发效率。本文将深入分析这三个框架的核心架构、源码实现原理，以及它们在多表关联查询方面的技术创新。</p>
<blockquote>
<p><strong>系列文章导航</strong></p>
<a class="btn-beautify blue larger" target="_blank" rel="noopener" href="https://example.com/mybatis-basic" title="MyBatis基础教程"><i class="far fa-hand-point-right"></i><span>MyBatis基础教程</span></a>
<a class="btn-beautify green larger" target="_blank" rel="noopener" href="https://example.com/mybatis-plus-guide" title="MyBatis Plus实战指南"><i class="far fa-hand-point-right"></i><span>MyBatis Plus实战指南</span></a>
</blockquote>
<h1 id="一、MyBatis生态系统架构演进"><a href="#一、MyBatis生态系统架构演进" class="headerlink" title="一、MyBatis生态系统架构演进"></a>一、MyBatis生态系统架构演进</h1><h2 id="（一）MyBatis原生框架架构"><a href="#（一）MyBatis原生框架架构" class="headerlink" title="（一）MyBatis原生框架架构"></a>（一）MyBatis原生框架架构</h2><p>MyBatis作为一款优秀的持久层框架，采用了半自动化的ORM设计理念，其核心架构包含以下几个关键组件：</p>
<h3 id="核心组件架构图"><a href="#核心组件架构图" class="headerlink" title="核心组件架构图"></a>核心组件架构图</h3><pre class="mermaid">graph TB
    A[SqlSessionFactory] --&gt; B[SqlSession]
    B --&gt; C[Executor]
    C --&gt; D[StatementHandler]
    C --&gt; E[ParameterHandler]
    C --&gt; F[ResultSetHandler]
    D --&gt; G[PreparedStatement]
    H[Configuration] --&gt; A
    I[MapperRegistry] --&gt; H
    J[MappedStatement] --&gt; H</pre>

<h3 id="关键组件源码分析"><a href="#关键组件源码分析" class="headerlink" title="关键组件源码分析"></a>关键组件源码分析</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SqlSessionFactory：会话工厂，MyBatis的核心入口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SqlSessionFactory</span> {</span><br><span class="line">    <span class="comment">// 创建SqlSession的核心方法，支持多种重载形式</span></span><br><span class="line">    SqlSession <span class="title function_">openSession</span><span class="params">()</span>;</span><br><span class="line">    SqlSession <span class="title function_">openSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span>;</span><br><span class="line">    SqlSession <span class="title function_">openSession</span><span class="params">(Connection connection)</span>;</span><br><span class="line">    SqlSession <span class="title function_">openSession</span><span class="params">(TransactionIsolationLevel level)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// DefaultSqlSessionFactory：SqlSessionFactory的默认实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSqlSessionFactory</span> <span class="keyword">implements</span> <span class="title class_">SqlSessionFactory</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Configuration configuration;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultSqlSessionFactory</span><span class="params">(Configuration configuration)</span> {</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 从配置中获取默认的执行器类型和事务隔离级别</span></span><br><span class="line">        <span class="keyword">return</span> openSessionFromDataSource(configuration.getDefaultExecutorType(), <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> SqlSession <span class="title function_">openSessionFromDataSource</span><span class="params">(ExecutorType execType, </span></span><br><span class="line"><span class="params">                                               TransactionIsolationLevel level, </span></span><br><span class="line"><span class="params">                                               <span class="type">boolean</span> autoCommit)</span> {</span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// 获取环境配置，包含数据源和事务管理器</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> configuration.getEnvironment();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">TransactionFactory</span> <span class="variable">transactionFactory</span> <span class="operator">=</span> getTransactionFactoryFromEnvironment(environment);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 创建事务对象</span></span><br><span class="line">            tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 创建执行器，这是MyBatis执行SQL的核心组件</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Executor</span> <span class="variable">executor</span> <span class="operator">=</span> configuration.newExecutor(tx, execType);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 返回DefaultSqlSession实例</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultSqlSession</span>(configuration, executor, autoCommit);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            closeTransaction(tx);</span><br><span class="line">            <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">"Error opening session.  Cause: "</span> + e, e);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            ErrorContext.instance().reset();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Executor执行器架构"><a href="#Executor执行器架构" class="headerlink" title="Executor执行器架构"></a>Executor执行器架构</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Executor：SQL执行器接口，定义了所有数据库操作的抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Executor</span> {</span><br><span class="line">    <span class="type">ResultHandler</span> <span class="variable">NO_RESULT_HANDLER</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新操作（包括INSERT、UPDATE、DELETE）</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(MappedStatement ms, Object parameter)</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询操作，支持结果处理器和分页</span></span><br><span class="line">    &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, </span></span><br><span class="line"><span class="params">                      ResultHandler resultHandler, CacheKey cacheKey, BoundSql boundSql)</span> </span><br><span class="line">                      <span class="keyword">throws</span> SQLException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询单个结果</span></span><br><span class="line">    &lt;E&gt; Cursor&lt;E&gt; <span class="title function_">queryCursor</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds)</span> </span><br><span class="line">                              <span class="keyword">throws</span> SQLException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 批量执行</span></span><br><span class="line">    List&lt;BatchResult&gt; <span class="title function_">flushStatements</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 事务提交和回滚</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(<span class="type">boolean</span> required)</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(<span class="type">boolean</span> required)</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 缓存相关操作</span></span><br><span class="line">    CacheKey <span class="title function_">createCacheKey</span><span class="params">(MappedStatement ms, Object parameterObject, </span></span><br><span class="line"><span class="params">                           RowBounds rowBounds, BoundSql boundSql)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCached</span><span class="params">(MappedStatement ms, CacheKey key)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">clearLocalCache</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseExecutor：执行器的抽象基类，实现了通用逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(BaseExecutor.class);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> Transaction transaction;</span><br><span class="line">    <span class="keyword">protected</span> Executor wrapper;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 延迟加载队列</span></span><br><span class="line">    <span class="keyword">protected</span> ConcurrentLinkedQueue&lt;DeferredLoad&gt; deferredLoads;</span><br><span class="line">    <span class="comment">// 本地缓存，实现一级缓存功能</span></span><br><span class="line">    <span class="keyword">protected</span> PerpetualCache localCache;</span><br><span class="line">    <span class="comment">// 本地输出参数缓存</span></span><br><span class="line">    <span class="keyword">protected</span> PerpetualCache localOutputParameterCache;</span><br><span class="line">    <span class="keyword">protected</span> Configuration configuration;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询计数器，用于嵌套查询检测</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> queryStack;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> closed;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">BaseExecutor</span><span class="params">(Configuration configuration, Transaction transaction)</span> {</span><br><span class="line">        <span class="built_in">this</span>.transaction = transaction;</span><br><span class="line">        <span class="built_in">this</span>.deferredLoads = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="built_in">this</span>.localCache = <span class="keyword">new</span> <span class="title class_">PerpetualCache</span>(<span class="string">"LocalCache"</span>);</span><br><span class="line">        <span class="built_in">this</span>.localOutputParameterCache = <span class="keyword">new</span> <span class="title class_">PerpetualCache</span>(<span class="string">"LocalOutputParameterCache"</span>);</span><br><span class="line">        <span class="built_in">this</span>.closed = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">        <span class="built_in">this</span>.wrapper = <span class="built_in">this</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, </span></span><br><span class="line"><span class="params">                            ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> </span><br><span class="line">                            <span class="keyword">throws</span> SQLException {</span><br><span class="line">        ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">"executing a query"</span>).object(ms.getId());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (closed) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExecutorException</span>(<span class="string">"Executor was closed."</span>);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果是嵌套查询的第一层，清除本地缓存</span></span><br><span class="line">        <span class="keyword">if</span> (queryStack == <span class="number">0</span> &amp;&amp; ms.isFlushCacheRequired()) {</span><br><span class="line">            clearLocalCache();</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        List&lt;E&gt; list;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            queryStack++;</span><br><span class="line">            <span class="comment">// 先从一级缓存中获取结果</span></span><br><span class="line">            list = resultHandler == <span class="literal">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (list != <span class="literal">null</span>) {</span><br><span class="line">                <span class="comment">// 处理存储过程的输出参数</span></span><br><span class="line">                handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// 缓存未命中，从数据库查询</span></span><br><span class="line">                list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            queryStack--;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理延迟加载</span></span><br><span class="line">        <span class="keyword">if</span> (queryStack == <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">for</span> (DeferredLoad deferredLoad : deferredLoads) {</span><br><span class="line">                deferredLoad.load();</span><br><span class="line">            }</span><br><span class="line">            deferredLoads.clear();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 如果本地缓存作用域是STATEMENT，清除缓存</span></span><br><span class="line">            <span class="keyword">if</span> (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) {</span><br><span class="line">                clearLocalCache();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从数据库查询数据的核心方法</span></span><br><span class="line">    <span class="keyword">private</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, </span></span><br><span class="line"><span class="params">                                         RowBounds rowBounds, ResultHandler resultHandler, </span></span><br><span class="line"><span class="params">                                         CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException {</span><br><span class="line">        List&lt;E&gt; list;</span><br><span class="line">        <span class="comment">// 先在缓存中放入占位符，防止循环引用</span></span><br><span class="line">        localCache.putObject(key, EXECUTION_PLACEHOLDER);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// 调用子类实现的具体查询方法</span></span><br><span class="line">            list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">// 移除占位符</span></span><br><span class="line">            localCache.removeObject(key);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 将查询结果放入一级缓存</span></span><br><span class="line">        localCache.putObject(key, list);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果是存储过程，缓存输出参数</span></span><br><span class="line">        <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) {</span><br><span class="line">            localOutputParameterCache.putObject(key, parameter);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 抽象方法，由子类实现具体的查询逻辑</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">doQuery</span><span class="params">(MappedStatement ms, Object parameter, </span></span><br><span class="line"><span class="params">                                          RowBounds rowBounds, ResultHandler resultHandler, </span></span><br><span class="line"><span class="params">                                          BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）MyBatis-Plus架构增强"><a href="#（二）MyBatis-Plus架构增强" class="headerlink" title="（二）MyBatis Plus架构增强"></a>（二）MyBatis Plus架构增强</h2><p>MyBatis Plus在MyBatis基础上进行了大量增强，其核心设计理念是”只做增强不做改变”。</p>
<h3 id="核心架构组件"><a href="#核心架构组件" class="headerlink" title="核心架构组件"></a>核心架构组件</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BaseMapper：MyBatis Plus的核心接口，提供了丰富的CRUD方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseMapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;T&gt; {</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入一条记录</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据ID删除</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据实体条件删除</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除（根据ID批量删除）</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据ID修改</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据whereEntity条件，更新记录</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据ID查询</span></span><br><span class="line">    T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询（根据ID批量查询）</span></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据entity条件，查询一条记录</span></span><br><span class="line">    T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据Wrapper条件，查询总记录数</span></span><br><span class="line">    Long <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据entity条件，查询全部记录</span></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据Wrapper条件，查询全部记录</span></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据Wrapper条件，查询全部记录（返回Object列表）</span></span><br><span class="line">    List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据entity条件，查询全部记录（并翻页）</span></span><br><span class="line">    IPage&lt;T&gt; <span class="title function_">selectPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据Wrapper条件，查询全部记录（并翻页）</span></span><br><span class="line">    IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMapsPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="条件构造器核心实现"><a href="#条件构造器核心实现" class="headerlink" title="条件构造器核心实现"></a>条件构造器核心实现</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbstractWrapper：条件构造器的抽象基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractWrapper</span>&lt;T, R, Children <span class="keyword">extends</span> <span class="title class_">AbstractWrapper</span>&lt;T, R, Children&gt;&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">ISqlSegment</span>, Wrapper&lt;T&gt;, Serializable {</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实体类型</span></span><br><span class="line">    <span class="keyword">protected</span> T entity;</span><br><span class="line">    <span class="comment">// 实体类的Class对象</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;T&gt; entityClass;</span><br><span class="line">    <span class="comment">// SQL片段表达式</span></span><br><span class="line">    <span class="keyword">protected</span> MergeSegments expression;</span><br><span class="line">    <span class="comment">// 参数序号</span></span><br><span class="line">    <span class="keyword">protected</span> AtomicInteger paramNameSeq;</span><br><span class="line">    <span class="comment">// 参数名值对</span></span><br><span class="line">    <span class="keyword">protected</span> Map&lt;String, Object&gt; paramNameValuePairs;</span><br><span class="line">    <span class="comment">// 最后的SQL片段</span></span><br><span class="line">    <span class="keyword">protected</span> SharedString lastSql;</span><br><span class="line">    <span class="comment">// SQL注释</span></span><br><span class="line">    <span class="keyword">protected</span> SharedString sqlComment;</span><br><span class="line">    <span class="comment">// SQL起始位置</span></span><br><span class="line">    <span class="keyword">protected</span> SharedString sqlFirst;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getEntity</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> entity;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">setEntity</span><span class="params">(T entity)</span> {</span><br><span class="line">        <span class="built_in">this</span>.entity = entity;</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Class&lt;T&gt; <span class="title function_">getEntityClass</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (entityClass == <span class="literal">null</span> &amp;&amp; entity != <span class="literal">null</span>) {</span><br><span class="line">            entityClass = (Class&lt;T&gt;) entity.getClass();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> entityClass;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">setEntityClass</span><span class="params">(Class&lt;T&gt; entityClass)</span> {</span><br><span class="line">        <span class="keyword">if</span> (entityClass != <span class="literal">null</span>) {</span><br><span class="line">            <span class="built_in">this</span>.entityClass = entityClass;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取格式化后的SQL语句</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSqlSegment</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> expression.getSqlSegment() + lastSql.getStringValue();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取SQL注释</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSqlComment</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(sqlComment.getStringValue())) {</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"/*"</span> + StringUtils.trim(sqlComment.getStringValue()) + <span class="string">"*/"</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取SQL起始片段</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSqlFirst</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(sqlFirst.getStringValue())) {</span><br><span class="line">            <span class="keyword">return</span> StringUtils.trim(sqlFirst.getStringValue());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// QueryWrapper：查询条件构造器的具体实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QueryWrapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">AbstractWrapper</span>&lt;T, String, QueryWrapper&lt;T&gt;&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Query</span>&lt;QueryWrapper&lt;T&gt;, T, String&gt; {</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询字段</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SharedString</span> <span class="variable">sqlSelect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SharedString</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QueryWrapper</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>((T) <span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QueryWrapper</span><span class="params">(T entity)</span> {</span><br><span class="line">        <span class="built_in">super</span>.setEntity(entity);</span><br><span class="line">        <span class="built_in">super</span>.initNeed();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">QueryWrapper</span><span class="params">(Class&lt;T&gt; entityClass)</span> {</span><br><span class="line">        <span class="built_in">super</span>.setEntityClass(entityClass);</span><br><span class="line">        <span class="built_in">super</span>.initNeed();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置查询字段</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> QueryWrapper&lt;T&gt; <span class="title function_">select</span><span class="params">(String... columns)</span> {</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isNotEmpty(columns)) {</span><br><span class="line">            <span class="built_in">this</span>.sqlSelect.setStringValue(String.join(StringPool.COMMA, columns));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置查询字段（排除某些字段）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> QueryWrapper&lt;T&gt; <span class="title function_">select</span><span class="params">(Class&lt;T&gt; entityClass, Predicate&lt;TableFieldInfo&gt; predicate)</span> {</span><br><span class="line">        <span class="keyword">if</span> (entityClass == <span class="literal">null</span>) {</span><br><span class="line">            entityClass = getEntityClass();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            setEntityClass(entityClass);</span><br><span class="line">        }</span><br><span class="line">        Assert.notNull(entityClass, <span class="string">"entityClass can not be null"</span>);</span><br><span class="line">        <span class="built_in">this</span>.sqlSelect.setStringValue(TableInfoHelper.getTableInfo(entityClass).chooseSelect(predicate));</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSqlSelect</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> sqlSelect.getStringValue();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建实例的静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; QueryWrapper&lt;T&gt; <span class="title function_">create</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> QueryWrapper&lt;T&gt; <span class="title function_">instance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;(getEntity(), getEntityClass(), paramNameSeq, paramNameValuePairs,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MergeSegments</span>(), SharedString.emptyString(), SharedString.emptyString(), SharedString.emptyString());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">super</span>.clear();</span><br><span class="line">        sqlSelect.toEmpty();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="IService服务层接口"><a href="#IService服务层接口" class="headerlink" title="IService服务层接口"></a>IService服务层接口</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IService：MyBatis Plus提供的服务层基础接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IService</span>&lt;T&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认批次提交数量</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">DEFAULT_BATCH_SIZE</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 插入一条记录（选择字段，策略插入）</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(T entity)</span> {</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().insert(entity));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 插入（批量）</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span> {</span><br><span class="line">        <span class="keyword">return</span> saveBatch(entityList, DEFAULT_BATCH_SIZE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 插入（批量）</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TableId 注解存在更新记录，否插入一条记录</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据updateWrapper尝试更新，否继续执行saveOrUpdate(T)方法</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批量修改插入</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批量修改插入</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 entity 条件，删除记录</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().delete(queryWrapper));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 ID 删除</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">removeById</span><span class="params">(Serializable id)</span> {</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().deleteById(id));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">removeByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span> {</span><br><span class="line">        Assert.notEmpty(columnMap, <span class="string">"error: columnMap must not be empty"</span>);</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().deleteByMap(columnMap));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">removeByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span> {</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(idList)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().deleteBatchIds(idList));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 UpdateWrapper 条件，更新记录 需要设置sqlset</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Wrapper&lt;T&gt; updateWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> update(<span class="literal">null</span>, updateWrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 whereWrapper 条件，更新记录</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(T updateEntity, Wrapper&lt;T&gt; whereWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().update(updateEntity, whereWrapper));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 ID 选择修改</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(T entity)</span> {</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(getBaseMapper().updateById(entity));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据ID 批量更新</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据ID 批量更新</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 ID 查询</span></span><br><span class="line">    <span class="keyword">default</span> T <span class="title function_">getById</span><span class="params">(Serializable id)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper，查询一条记录。结果集，如果是多个会抛出异常，随机取一条加上限制条件 wrapper.last("LIMIT 1")</span></span><br><span class="line">    <span class="keyword">default</span> T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> getOne(queryWrapper, <span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">    T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="type">boolean</span> throwEx)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">    Map&lt;String, Object&gt; <span class="title function_">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">    &lt;V&gt; V <span class="title function_">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">list</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> list(Wrappers.emptyWrapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询列表</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">list</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectList(queryWrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">listByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectBatchIds(idList);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">listByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectByMap(columnMap);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有列表</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> listMaps(Wrappers.emptyWrapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询列表</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectMaps(queryWrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询全部记录</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> listObjs(Function.identity());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询全部记录</span></span><br><span class="line">    <span class="keyword">default</span> &lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> listObjs(Wrappers.emptyWrapper(), mapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> listObjs(queryWrapper, Function.identity());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">    <span class="keyword">default</span> &lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectObjs(queryWrapper).stream().filter(Objects::nonNull).map(mapper).collect(Collectors.toList());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无条件分页查询</span></span><br><span class="line">    <span class="keyword">default</span> IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page)</span> {</span><br><span class="line">        <span class="keyword">return</span> page(page, Wrappers.emptyWrapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 条件分页查询</span></span><br><span class="line">    <span class="keyword">default</span> IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectPage(page, queryWrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无条件分页查询</span></span><br><span class="line">    <span class="keyword">default</span> IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">pageMaps</span><span class="params">(IPage&lt;T&gt; page)</span> {</span><br><span class="line">        <span class="keyword">return</span> pageMaps(page, Wrappers.emptyWrapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 条件分页查询</span></span><br><span class="line">    <span class="keyword">default</span> IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">pageMaps</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> getBaseMapper().selectMapsPage(page, queryWrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询总记录数</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">long</span> <span class="title function_">count</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.emptyWrapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">long</span> <span class="title function_">count</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> {</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retCount(getBaseMapper().selectCount(queryWrapper));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对应 entity 的 BaseMapper</span></span><br><span class="line">    BaseMapper&lt;T&gt; <span class="title function_">getBaseMapper</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 entity 的 class</span></span><br><span class="line">    Class&lt;T&gt; <span class="title function_">getEntityClass</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链式查询 普通</span></span><br><span class="line">    <span class="keyword">default</span> QueryChainWrapper&lt;T&gt; <span class="title function_">query</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.queryChain(getBaseMapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链式查询 lambda 式</span></span><br><span class="line">    <span class="keyword">default</span> LambdaQueryChainWrapper&lt;T&gt; <span class="title function_">lambdaQuery</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.lambdaQueryChain(getBaseMapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链式更改 普通</span></span><br><span class="line">    <span class="keyword">default</span> UpdateChainWrapper&lt;T&gt; <span class="title function_">update</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.updateChain(getBaseMapper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链式更改 lambda 式</span></span><br><span class="line">    <span class="keyword">default</span> LambdaUpdateChainWrapper&lt;T&gt; <span class="title function_">lambdaUpdate</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.lambdaUpdateChain(getBaseMapper());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（三）MyBatis-Plus-Join多表查询架构"><a href="#（三）MyBatis-Plus-Join多表查询架构" class="headerlink" title="（三）MyBatis Plus Join多表查询架构"></a>（三）MyBatis Plus Join多表查询架构</h2><p>MyBatis Plus Join是基于MyBatis Plus的多表查询增强框架，专门解决复杂的关联查询问题。</p>
<h3 id="核心架构设计"><a href="#核心架构设计" class="headerlink" title="核心架构设计"></a>核心架构设计</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MPJBaseMapper：多表查询的基础Mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MPJBaseMapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;T&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectJoinList</span><span class="params">(Class&lt;T&gt; clazz, MPJWrapper&lt;T&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">    &lt;DTO&gt; List&lt;DTO&gt; <span class="title function_">selectJoinList</span><span class="params">(Class&lt;DTO&gt; clazz, MPJWrapper&lt;?&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录（并翻页）</span></span><br><span class="line">    IPage&lt;T&gt; <span class="title function_">selectJoinPage</span><span class="params">(IPage&lt;T&gt; page, Class&lt;T&gt; clazz, MPJWrapper&lt;T&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录（并翻页）</span></span><br><span class="line">    &lt;DTO&gt; IPage&lt;DTO&gt; <span class="title function_">selectJoinPage</span><span class="params">(IPage&lt;DTO&gt; page, Class&lt;DTO&gt; clazz, MPJWrapper&lt;?&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line">    Long <span class="title function_">selectJoinCount</span><span class="params">(MPJWrapper&lt;?&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询一条记录</span></span><br><span class="line">    &lt;DTO&gt; DTO <span class="title function_">selectJoinOne</span><span class="params">(Class&lt;DTO&gt; clazz, MPJWrapper&lt;?&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectJoinMaps</span><span class="params">(MPJWrapper&lt;?&gt; wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 Wrapper 条件，查询全部记录（并翻页）</span></span><br><span class="line">    IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectJoinMapsPage</span><span class="params">(IPage&lt;?&gt; page, MPJWrapper&lt;?&gt; wrapper)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// MPJLambdaWrapper：Lambda风格的多表查询条件构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MPJLambdaWrapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">MPJAbstractLambdaWrapper</span>&lt;T, MPJLambdaWrapper&lt;T&gt;&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Query</span>&lt;MPJLambdaWrapper&lt;T&gt;, T, SFunction&lt;T, ?&gt;&gt;, Join&lt;MPJLambdaWrapper&lt;T&gt;&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询字段 SQL 片段</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SharedString</span> <span class="variable">sqlSelect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SharedString</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MPJLambdaWrapper</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>((T) <span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MPJLambdaWrapper</span><span class="params">(T entity)</span> {</span><br><span class="line">        <span class="built_in">super</span>.setEntity(entity);</span><br><span class="line">        <span class="built_in">super</span>.initNeed();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MPJLambdaWrapper</span><span class="params">(Class&lt;T&gt; entityClass)</span> {</span><br><span class="line">        <span class="built_in">super</span>.setEntityClass(entityClass);</span><br><span class="line">        <span class="built_in">super</span>.initNeed();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询指定字段</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MPJLambdaWrapper&lt;T&gt; <span class="title function_">select</span><span class="params">(SFunction&lt;T, ?&gt;... columns)</span> {</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isNotEmpty(columns)) {</span><br><span class="line">            <span class="built_in">this</span>.sqlSelect.setStringValue(columnsToString(<span class="literal">false</span>, columns));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询指定字段（支持别名）</span></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">select</span><span class="params">(SFunction&lt;X, ?&gt; column, String alias)</span> {</span><br><span class="line">        <span class="keyword">return</span> select(columnToString(column) + <span class="string">" AS "</span> + alias);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询指定字段（支持聚合函数）</span></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">selectSum</span><span class="params">(SFunction&lt;X, ?&gt; column)</span> {</span><br><span class="line">        <span class="keyword">return</span> selectFunc(<span class="string">"SUM(%s)"</span>, column);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">selectCount</span><span class="params">(SFunction&lt;X, ?&gt; column)</span> {</span><br><span class="line">        <span class="keyword">return</span> selectFunc(<span class="string">"COUNT(%s)"</span>, column);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">selectMax</span><span class="params">(SFunction&lt;X, ?&gt; column)</span> {</span><br><span class="line">        <span class="keyword">return</span> selectFunc(<span class="string">"MAX(%s)"</span>, column);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">selectMin</span><span class="params">(SFunction&lt;X, ?&gt; column)</span> {</span><br><span class="line">        <span class="keyword">return</span> selectFunc(<span class="string">"MIN(%s)"</span>, column);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">selectAvg</span><span class="params">(SFunction&lt;X, ?&gt; column)</span> {</span><br><span class="line">        <span class="keyword">return</span> selectFunc(<span class="string">"AVG(%s)"</span>, column);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 聚合函数的通用实现</span></span><br><span class="line">    <span class="keyword">private</span> &lt;X&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">selectFunc</span><span class="params">(String funcTemplate, SFunction&lt;X, ?&gt; column)</span> {</span><br><span class="line">        <span class="keyword">return</span> select(String.format(funcTemplate, columnToString(column)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// LEFT JOIN 连接</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">leftJoin</span><span class="params">(Class&lt;E&gt; joinClass, SFunction&lt;E, ?&gt; joinField, SFunction&lt;T, ?&gt; mainField)</span> {</span><br><span class="line">        <span class="keyword">return</span> join(SqlKeyword.LEFT_JOIN, joinClass, joinField, mainField);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RIGHT JOIN 连接</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">rightJoin</span><span class="params">(Class&lt;E&gt; joinClass, SFunction&lt;E, ?&gt; joinField, SFunction&lt;T, ?&gt; mainField)</span> {</span><br><span class="line">        <span class="keyword">return</span> join(SqlKeyword.RIGHT_JOIN, joinClass, joinField, mainField);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// INNER JOIN 连接</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">innerJoin</span><span class="params">(Class&lt;E&gt; joinClass, SFunction&lt;E, ?&gt; joinField, SFunction&lt;T, ?&gt; mainField)</span> {</span><br><span class="line">        <span class="keyword">return</span> join(SqlKeyword.INNER_JOIN, joinClass, joinField, mainField);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JOIN 连接的通用实现</span></span><br><span class="line">    <span class="keyword">private</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">join</span><span class="params">(SqlKeyword sqlKeyword, Class&lt;E&gt; joinClass,</span></span><br><span class="line"><span class="params">                                        SFunction&lt;E, ?&gt; joinField, SFunction&lt;T, ?&gt; mainField)</span> {</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinTableName</span> <span class="operator">=</span> getTableName(joinClass);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinColumnName</span> <span class="operator">=</span> columnToString(joinField);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">mainColumnName</span> <span class="operator">=</span> columnToString(mainField);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinSql</span> <span class="operator">=</span> String.format(<span class="string">" %s %s ON %s = %s"</span>,</span><br><span class="line">                                           sqlKeyword.getSqlSegment(),</span><br><span class="line">                                           joinTableName,</span><br><span class="line">                                           joinColumnName,</span><br><span class="line">                                           mainColumnName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> doIt(<span class="literal">true</span>, () -&gt; appendSqlSegments(JOIN, () -&gt; joinSql));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 支持复杂的JOIN条件</span></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">leftJoin</span><span class="params">(Class&lt;E&gt; joinClass, Consumer&lt;MPJLambdaWrapper&lt;T&gt;&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">return</span> join(SqlKeyword.LEFT_JOIN, joinClass, consumer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">rightJoin</span><span class="params">(Class&lt;E&gt; joinClass, Consumer&lt;MPJLambdaWrapper&lt;T&gt;&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">return</span> join(SqlKeyword.RIGHT_JOIN, joinClass, consumer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">innerJoin</span><span class="params">(Class&lt;E&gt; joinClass, Consumer&lt;MPJLambdaWrapper&lt;T&gt;&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">return</span> join(SqlKeyword.INNER_JOIN, joinClass, consumer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复杂JOIN条件的通用实现</span></span><br><span class="line">    <span class="keyword">private</span> &lt;E&gt; MPJLambdaWrapper&lt;T&gt; <span class="title function_">join</span><span class="params">(SqlKeyword sqlKeyword, Class&lt;E&gt; joinClass,</span></span><br><span class="line"><span class="params">                                        Consumer&lt;MPJLambdaWrapper&lt;T&gt;&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinTableName</span> <span class="operator">=</span> getTableName(joinClass);</span><br><span class="line">        <span class="keyword">final</span> MPJLambdaWrapper&lt;T&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;&gt;();</span><br><span class="line">        consumer.accept(wrapper);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinCondition</span> <span class="operator">=</span> wrapper.getCustomSqlSegment();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinSql</span> <span class="operator">=</span> String.format(<span class="string">" %s %s ON %s"</span>,</span><br><span class="line">                                           sqlKeyword.getSqlSegment(),</span><br><span class="line">                                           joinTableName,</span><br><span class="line">                                           joinCondition);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> doIt(<span class="literal">true</span>, () -&gt; appendSqlSegments(JOIN, () -&gt; joinSql));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSqlSelect</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> sqlSelect.getStringValue();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> MPJLambdaWrapper&lt;T&gt; <span class="title function_">instance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;&gt;(getEntity(), getEntityClass(), paramNameSeq, paramNameValuePairs,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MergeSegments</span>(), SharedString.emptyString(), SharedString.emptyString(), SharedString.emptyString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">super</span>.clear();</span><br><span class="line">        sqlSelect.toEmpty();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="二、核心源码实现原理"><a href="#二、核心源码实现原理" class="headerlink" title="二、核心源码实现原理"></a>二、核心源码实现原理</h1><h2 id="（一）SQL解析与构建机制"><a href="#（一）SQL解析与构建机制" class="headerlink" title="（一）SQL解析与构建机制"></a>（一）SQL解析与构建机制</h2><h3 id="MappedStatement构建过程"><a href="#MappedStatement构建过程" class="headerlink" title="MappedStatement构建过程"></a>MappedStatement构建过程</h3><p>MyBatis中的每个SQL语句都会被封装成一个MappedStatement对象，这是SQL执行的核心数据结构。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MappedStatement：MyBatis中SQL语句的封装对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MappedStatement</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String resource;           <span class="comment">// 资源文件路径</span></span><br><span class="line">    <span class="keyword">private</span> Configuration configuration; <span class="comment">// 全局配置对象</span></span><br><span class="line">    <span class="keyword">private</span> String id;                 <span class="comment">// 语句ID，通常是接口方法的全限定名</span></span><br><span class="line">    <span class="keyword">private</span> Integer fetchSize;         <span class="comment">// 获取记录数</span></span><br><span class="line">    <span class="keyword">private</span> Integer timeout;           <span class="comment">// 超时时间</span></span><br><span class="line">    <span class="keyword">private</span> StatementType statementType; <span class="comment">// 语句类型：STATEMENT、PREPARED、CALLABLE</span></span><br><span class="line">    <span class="keyword">private</span> ResultSetType resultSetType; <span class="comment">// 结果集类型</span></span><br><span class="line">    <span class="keyword">private</span> SqlSource sqlSource;       <span class="comment">// SQL源码对象</span></span><br><span class="line">    <span class="keyword">private</span> Cache cache;               <span class="comment">// 二级缓存</span></span><br><span class="line">    <span class="keyword">private</span> ParameterMap parameterMap; <span class="comment">// 参数映射</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ResultMap&gt; resultMaps; <span class="comment">// 结果映射列表</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flushCacheRequired; <span class="comment">// 是否刷新缓存</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> useCache;          <span class="comment">// 是否使用缓存</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> resultOrdered;     <span class="comment">// 结果是否排序</span></span><br><span class="line">    <span class="keyword">private</span> SqlCommandType sqlCommandType; <span class="comment">// SQL命令类型：SELECT、INSERT、UPDATE、DELETE</span></span><br><span class="line">    <span class="keyword">private</span> KeyGenerator keyGenerator; <span class="comment">// 主键生成器</span></span><br><span class="line">    <span class="keyword">private</span> String[] keyProperties;    <span class="comment">// 主键属性</span></span><br><span class="line">    <span class="keyword">private</span> String[] keyColumns;       <span class="comment">// 主键列</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasNestedResultMaps; <span class="comment">// 是否有嵌套结果映射</span></span><br><span class="line">    <span class="keyword">private</span> String databaseId;         <span class="comment">// 数据库ID</span></span><br><span class="line">    <span class="keyword">private</span> Log statementLog;          <span class="comment">// 日志对象</span></span><br><span class="line">    <span class="keyword">private</span> LanguageDriver lang;       <span class="comment">// 语言驱动器</span></span><br><span class="line">    <span class="keyword">private</span> String[] resultSets;       <span class="comment">// 结果集名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有构造函数，通过Builder模式创建</span></span><br><span class="line">    MappedStatement() {</span><br><span class="line">        <span class="comment">// intentionally empty</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Builder模式构建MappedStatement</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> {</span><br><span class="line">        <span class="keyword">private</span> <span class="type">MappedStatement</span> <span class="variable">mappedStatement</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappedStatement</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">(Configuration configuration, String id, SqlSource sqlSource, SqlCommandType sqlCommandType)</span> {</span><br><span class="line">            mappedStatement.configuration = configuration;</span><br><span class="line">            mappedStatement.id = id;</span><br><span class="line">            mappedStatement.sqlSource = sqlSource;</span><br><span class="line">            mappedStatement.statementType = StatementType.PREPARED;</span><br><span class="line">            mappedStatement.resultSetType = ResultSetType.DEFAULT;</span><br><span class="line">            mappedStatement.parameterMap = <span class="keyword">new</span> <span class="title class_">ParameterMap</span>.Builder(configuration, <span class="string">"defaultParameterMap"</span>, <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).build();</span><br><span class="line">            mappedStatement.resultMaps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            mappedStatement.sqlCommandType = sqlCommandType;</span><br><span class="line">            mappedStatement.keyGenerator = configuration.isUseGeneratedKeys() &amp;&amp; SqlCommandType.INSERT.equals(sqlCommandType) ? Jdbc3KeyGenerator.INSTANCE : NoKeyGenerator.INSTANCE;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logId</span> <span class="operator">=</span> id;</span><br><span class="line">            <span class="keyword">if</span> (configuration.getLogPrefix() != <span class="literal">null</span>) {</span><br><span class="line">                logId = configuration.getLogPrefix() + id;</span><br><span class="line">            }</span><br><span class="line">            mappedStatement.statementLog = LogFactory.getLog(logId);</span><br><span class="line">            mappedStatement.lang = configuration.getDefaultScriptingLanguageInstance();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">resource</span><span class="params">(String resource)</span> {</span><br><span class="line">            mappedStatement.resource = resource;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">fetchSize</span><span class="params">(Integer fetchSize)</span> {</span><br><span class="line">            mappedStatement.fetchSize = fetchSize;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">timeout</span><span class="params">(Integer timeout)</span> {</span><br><span class="line">            mappedStatement.timeout = timeout;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">statementType</span><span class="params">(StatementType statementType)</span> {</span><br><span class="line">            mappedStatement.statementType = statementType;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">resultSetType</span><span class="params">(ResultSetType resultSetType)</span> {</span><br><span class="line">            mappedStatement.resultSetType = resultSetType;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">cache</span><span class="params">(Cache cache)</span> {</span><br><span class="line">            mappedStatement.cache = cache;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">flushCacheRequired</span><span class="params">(<span class="type">boolean</span> flushCacheRequired)</span> {</span><br><span class="line">            mappedStatement.flushCacheRequired = flushCacheRequired;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">useCache</span><span class="params">(<span class="type">boolean</span> useCache)</span> {</span><br><span class="line">            mappedStatement.useCache = useCache;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">resultOrdered</span><span class="params">(<span class="type">boolean</span> resultOrdered)</span> {</span><br><span class="line">            mappedStatement.resultOrdered = resultOrdered;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">keyGenerator</span><span class="params">(KeyGenerator keyGenerator)</span> {</span><br><span class="line">            mappedStatement.keyGenerator = keyGenerator;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">keyProperty</span><span class="params">(String keyProperty)</span> {</span><br><span class="line">            mappedStatement.keyProperties = delimitedStringToArray(keyProperty);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">keyColumn</span><span class="params">(String keyColumn)</span> {</span><br><span class="line">            mappedStatement.keyColumns = delimitedStringToArray(keyColumn);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">databaseId</span><span class="params">(String databaseId)</span> {</span><br><span class="line">            mappedStatement.databaseId = databaseId;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">lang</span><span class="params">(LanguageDriver driver)</span> {</span><br><span class="line">            mappedStatement.lang = driver;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">resultSets</span><span class="params">(String resultSet)</span> {</span><br><span class="line">            mappedStatement.resultSets = delimitedStringToArray(resultSet);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建MappedStatement对象</span></span><br><span class="line">        <span class="keyword">public</span> MappedStatement <span class="title function_">build</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">assert</span> mappedStatement.configuration != <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">assert</span> mappedStatement.id != <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">assert</span> mappedStatement.sqlSource != <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">assert</span> mappedStatement.lang != <span class="literal">null</span>;</span><br><span class="line">            mappedStatement.resultMaps = Collections.unmodifiableList(mappedStatement.resultMaps);</span><br><span class="line">            <span class="keyword">return</span> mappedStatement;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取BoundSql对象，包含最终的SQL语句和参数</span></span><br><span class="line">    <span class="keyword">public</span> BoundSql <span class="title function_">getBoundSql</span><span class="params">(Object parameterObject)</span> {</span><br><span class="line">        <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> sqlSource.getBoundSql(parameterObject);</span><br><span class="line">        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">        <span class="keyword">if</span> (parameterMappings == <span class="literal">null</span> || parameterMappings.isEmpty()) {</span><br><span class="line">            boundSql = <span class="keyword">new</span> <span class="title class_">BoundSql</span>(configuration, boundSql.getSql(), parameterMap.getParameterMappings(), parameterObject);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查嵌套结果映射</span></span><br><span class="line">        <span class="keyword">for</span> (ParameterMapping pm : boundSql.getParameterMappings()) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">rmId</span> <span class="operator">=</span> pm.getResultMapId();</span><br><span class="line">            <span class="keyword">if</span> (rmId != <span class="literal">null</span>) {</span><br><span class="line">                <span class="type">ResultMap</span> <span class="variable">rm</span> <span class="operator">=</span> configuration.getResultMap(rmId);</span><br><span class="line">                <span class="keyword">if</span> (rm != <span class="literal">null</span>) {</span><br><span class="line">                    hasNestedResultMaps |= rm.hasNestedResultMaps();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> boundSql;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="动态SQL解析机制"><a href="#动态SQL解析机制" class="headerlink" title="动态SQL解析机制"></a>动态SQL解析机制</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SqlSource：SQL源码接口，负责根据参数对象生成BoundSql</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SqlSource</span> {</span><br><span class="line">    BoundSql <span class="title function_">getBoundSql</span><span class="params">(Object parameterObject)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// DynamicSqlSource：动态SQL源码实现，处理包含动态元素的SQL</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSqlSource</span> <span class="keyword">implements</span> <span class="title class_">SqlSource</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Configuration configuration;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SqlNode rootSqlNode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicSqlSource</span><span class="params">(Configuration configuration, SqlNode rootSqlNode)</span> {</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">        <span class="built_in">this</span>.rootSqlNode = rootSqlNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BoundSql <span class="title function_">getBoundSql</span><span class="params">(Object parameterObject)</span> {</span><br><span class="line">        <span class="comment">// 创建动态上下文，用于构建SQL</span></span><br><span class="line">        <span class="type">DynamicContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicContext</span>(configuration, parameterObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 应用SQL节点，生成SQL字符串</span></span><br><span class="line">        rootSqlNode.apply(context);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建SQL源码解析器</span></span><br><span class="line">        <span class="type">SqlSourceBuilder</span> <span class="variable">sqlSourceParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSourceBuilder</span>(configuration);</span><br><span class="line">        Class&lt;?&gt; parameterType = parameterObject == <span class="literal">null</span> ? Object.class : parameterObject.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析SQL，处理#{}占位符</span></span><br><span class="line">        <span class="type">SqlSource</span> <span class="variable">sqlSource</span> <span class="operator">=</span> sqlSourceParser.parse(context.getSql(), parameterType, context.getBindings());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取最终的BoundSql对象</span></span><br><span class="line">        <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> sqlSource.getBoundSql(parameterObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将动态上下文中的绑定参数添加到BoundSql中</span></span><br><span class="line">        context.getBindings().forEach(boundSql::setAdditionalParameter);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> boundSql;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// DynamicContext：动态SQL构建上下文</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicContext</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PARAMETER_OBJECT_KEY</span> <span class="operator">=</span> <span class="string">"_parameter"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DATABASE_ID_KEY</span> <span class="operator">=</span> <span class="string">"_databaseId"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="comment">// 注册OGNL方法访问器，支持在动态SQL中调用静态方法</span></span><br><span class="line">        OgnlRuntime.setPropertyAccessor(ContextMap.class, <span class="keyword">new</span> <span class="title class_">ContextAccessor</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ContextMap bindings;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">StringJoiner</span> <span class="variable">sqlBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(<span class="string">" "</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">uniqueNumber</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicContext</span><span class="params">(Configuration configuration, Object parameterObject)</span> {</span><br><span class="line">        <span class="comment">// 初始化绑定参数映射</span></span><br><span class="line">        <span class="keyword">if</span> (parameterObject != <span class="literal">null</span> &amp;&amp; !(parameterObject <span class="keyword">instanceof</span> Map)) {</span><br><span class="line">            <span class="comment">// 如果参数对象不是Map，则通过反射获取其属性</span></span><br><span class="line">            <span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> configuration.newMetaObject(parameterObject);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">existsTypeHandler</span> <span class="operator">=</span> configuration.getTypeHandlerRegistry().hasTypeHandler(parameterObject.getClass());</span><br><span class="line">            bindings = <span class="keyword">new</span> <span class="title class_">ContextMap</span>(metaObject, existsTypeHandler);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            bindings = <span class="keyword">new</span> <span class="title class_">ContextMap</span>(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加内置参数</span></span><br><span class="line">        bindings.put(PARAMETER_OBJECT_KEY, parameterObject);</span><br><span class="line">        bindings.put(DATABASE_ID_KEY, configuration.getDatabaseId());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getBindings</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> bindings;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bind</span><span class="params">(String name, Object value)</span> {</span><br><span class="line">        bindings.put(name, value);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">appendSql</span><span class="params">(String sql)</span> {</span><br><span class="line">        sqlBuilder.add(sql);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSql</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> sqlBuilder.toString().trim();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUniqueNumber</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> uniqueNumber++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上下文映射，支持OGNL表达式访问</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ContextMap</span> <span class="keyword">extends</span> <span class="title class_">HashMap</span>&lt;String, Object&gt; {</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">2977601501966151582L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> MetaObject parameterMetaObject;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> fallbackParameterObject;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ContextMap</span><span class="params">(MetaObject parameterMetaObject, <span class="type">boolean</span> fallbackParameterObject)</span> {</span><br><span class="line">            <span class="built_in">this</span>.parameterMetaObject = parameterMetaObject;</span><br><span class="line">            <span class="built_in">this</span>.fallbackParameterObject = fallbackParameterObject;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> {</span><br><span class="line">            <span class="type">String</span> <span class="variable">strKey</span> <span class="operator">=</span> (String) key;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">super</span>.containsKey(strKey)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">super</span>.get(strKey);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (parameterMetaObject == <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (fallbackParameterObject &amp;&amp; !parameterMetaObject.hasGetter(strKey)) {</span><br><span class="line">                <span class="keyword">return</span> parameterMetaObject.getOriginalObject();</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// issue #61 do not modify the context when reading</span></span><br><span class="line">                <span class="keyword">return</span> parameterMetaObject.getValue(strKey);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上下文访问器，用于OGNL表达式</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ContextAccessor</span> <span class="keyword">implements</span> <span class="title class_">PropertyAccessor</span> {</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">getProperty</span><span class="params">(Map context, Object target, Object name)</span> {</span><br><span class="line">            <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) target;</span><br><span class="line"></span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> map.get(name);</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(name) || result != <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="type">Object</span> <span class="variable">parameterObject</span> <span class="operator">=</span> map.get(PARAMETER_OBJECT_KEY);</span><br><span class="line">            <span class="keyword">if</span> (parameterObject != <span class="literal">null</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="keyword">return</span> OgnlRuntime.getProperty(context, parameterObject, name);</span><br><span class="line">                } <span class="keyword">catch</span> (OgnlException e) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">"Error evaluating expression '"</span> + name + <span class="string">"'. Cause: "</span> + e, e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperty</span><span class="params">(Map context, Object target, Object name, Object value)</span> {</span><br><span class="line">            Map&lt;Object, Object&gt; map = (Map&lt;Object, Object&gt;) target;</span><br><span class="line">            map.put(name, value);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getSourceAccessor</span><span class="params">(OgnlContext arg0, Object arg1, Object arg2)</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getSourceSetter</span><span class="params">(OgnlContext arg0, Object arg1, Object arg2)</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）MyBatis-Plus条件构造器实现原理"><a href="#（二）MyBatis-Plus条件构造器实现原理" class="headerlink" title="（二）MyBatis Plus条件构造器实现原理"></a>（二）MyBatis Plus条件构造器实现原理</h2><h3 id="AbstractWrapper核心机制"><a href="#AbstractWrapper核心机制" class="headerlink" title="AbstractWrapper核心机制"></a>AbstractWrapper核心机制</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbstractWrapper：条件构造器的核心实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractWrapper</span>&lt;T, R, Children <span class="keyword">extends</span> <span class="title class_">AbstractWrapper</span>&lt;T, R, Children&gt;&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">ISqlSegment</span>, Wrapper&lt;T&gt;, Serializable {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL片段表达式容器</span></span><br><span class="line">    <span class="keyword">protected</span> MergeSegments expression;</span><br><span class="line">    <span class="comment">// 参数序号生成器</span></span><br><span class="line">    <span class="keyword">protected</span> AtomicInteger paramNameSeq;</span><br><span class="line">    <span class="comment">// 参数名值对映射</span></span><br><span class="line">    <span class="keyword">protected</span> Map&lt;String, Object&gt; paramNameValuePairs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initNeed</span><span class="params">()</span> {</span><br><span class="line">        paramNameSeq = <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">        paramNameValuePairs = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        expression = <span class="keyword">new</span> <span class="title class_">MergeSegments</span>();</span><br><span class="line">        lastSql = SharedString.emptyString();</span><br><span class="line">        sqlComment = SharedString.emptyString();</span><br><span class="line">        sqlFirst = SharedString.emptyString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加条件的核心方法</span></span><br><span class="line">    <span class="keyword">protected</span> Children <span class="title function_">addCondition</span><span class="params">(<span class="type">boolean</span> condition, ISqlSegment... sqlSegments)</span> {</span><br><span class="line">        <span class="keyword">if</span> (condition) {</span><br><span class="line">            expression.add(sqlSegments);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 嵌套条件处理</span></span><br><span class="line">    <span class="keyword">protected</span> Children <span class="title function_">doIt</span><span class="params">(<span class="type">boolean</span> condition, DoSomething something)</span> {</span><br><span class="line">        <span class="keyword">if</span> (condition) {</span><br><span class="line">            something.doIt();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等于条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">eq</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), EQ,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不等于条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">ne</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), NE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 大于条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">gt</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), GT,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 大于等于条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">ge</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), GE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小于条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">lt</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), LT,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小于等于条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">le</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), LE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BETWEEN条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">between</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val1, Object val2)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), BETWEEN,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val1), AND,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val2));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NOT BETWEEN条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">notBetween</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val1, Object val2)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), NOT_BETWEEN,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val1), AND,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val2));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// LIKE条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">like</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), LIKE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NOT LIKE条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">notLike</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), NOT_LIKE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, val));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// LEFT LIKE条件（%value）</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">likeLeft</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), LIKE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, SqlUtils.concatLike(val, SqlLike.LEFT)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RIGHT LIKE条件（value%）</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">likeRight</span><span class="params">(<span class="type">boolean</span> condition, R column, Object val)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), LIKE,</span><br><span class="line">                           () -&gt; formatParam(<span class="literal">null</span>, SqlUtils.concatLike(val, SqlLike.RIGHT)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// IS NULL条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">isNull</span><span class="params">(<span class="type">boolean</span> condition, R column)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), IS_NULL);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// IS NOT NULL条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">isNotNull</span><span class="params">(<span class="type">boolean</span> condition, R column)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), IS_NOT_NULL);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// IN条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">in</span><span class="params">(<span class="type">boolean</span> condition, R column, Collection&lt;?&gt; coll)</span> {</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(coll)) {</span><br><span class="line">            <span class="keyword">return</span> typedThis;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), IN, inExpression(coll));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NOT IN条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">notIn</span><span class="params">(<span class="type">boolean</span> condition, R column, Collection&lt;?&gt; coll)</span> {</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(coll)) {</span><br><span class="line">            <span class="keyword">return</span> typedThis;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), NOT_IN, inExpression(coll));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// IN子查询条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">inSql</span><span class="params">(<span class="type">boolean</span> condition, R column, String inValue)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), IN,</span><br><span class="line">                           () -&gt; String.format(<span class="string">"(%s)"</span>, inValue));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NOT IN子查询条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">notInSql</span><span class="params">(<span class="type">boolean</span> condition, R column, String inValue)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, columnToSqlSegment(column), NOT_IN,</span><br><span class="line">                           () -&gt; String.format(<span class="string">"(%s)"</span>, inValue));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// GROUP BY条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">groupBy</span><span class="params">(<span class="type">boolean</span> condition, R... columns)</span> {</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isEmpty(columns)) {</span><br><span class="line">            <span class="keyword">return</span> typedThis;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, GROUP_BY,</span><br><span class="line">                           () -&gt; columnsToString(columns));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ORDER BY ASC条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">orderByAsc</span><span class="params">(<span class="type">boolean</span> condition, R... columns)</span> {</span><br><span class="line">        <span class="keyword">return</span> orderBy(condition, <span class="literal">true</span>, columns);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ORDER BY DESC条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">orderByDesc</span><span class="params">(<span class="type">boolean</span> condition, R... columns)</span> {</span><br><span class="line">        <span class="keyword">return</span> orderBy(condition, <span class="literal">false</span>, columns);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ORDER BY通用实现</span></span><br><span class="line">    <span class="keyword">protected</span> Children <span class="title function_">orderBy</span><span class="params">(<span class="type">boolean</span> condition, <span class="type">boolean</span> isAsc, R... columns)</span> {</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isEmpty(columns)) {</span><br><span class="line">            <span class="keyword">return</span> typedThis;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, ORDER_BY,</span><br><span class="line">                           () -&gt; Arrays.stream(columns)</span><br><span class="line">                                      .map(<span class="built_in">this</span>::columnToString)</span><br><span class="line">                                      .map(i -&gt; i + (isAsc ? StringPool.SPACE + ASC.getSqlSegment() :</span><br><span class="line">                                                           StringPool.SPACE + DESC.getSqlSegment()))</span><br><span class="line">                                      .collect(joining(StringPool.COMMA)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// HAVING条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">having</span><span class="params">(<span class="type">boolean</span> condition, String sqlHaving, Object... params)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, HAVING,</span><br><span class="line">                           () -&gt; formatSqlMaybeWithParam(sqlHaving, <span class="literal">null</span>, params));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OR条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">or</span><span class="params">(<span class="type">boolean</span> condition)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, OR);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AND条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">and</span><span class="params">(<span class="type">boolean</span> condition, Consumer&lt;Children&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">return</span> and(condition, <span class="literal">true</span>, consumer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OR条件（带嵌套）</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">or</span><span class="params">(<span class="type">boolean</span> condition, Consumer&lt;Children&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">return</span> and(condition, <span class="literal">false</span>, consumer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AND/OR嵌套条件的通用实现</span></span><br><span class="line">    <span class="keyword">protected</span> Children <span class="title function_">and</span><span class="params">(<span class="type">boolean</span> condition, <span class="type">boolean</span> isAnd, Consumer&lt;Children&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">if</span> (condition) {</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Children</span> <span class="variable">instance</span> <span class="operator">=</span> instance();</span><br><span class="line">            consumer.accept(instance);</span><br><span class="line">            <span class="keyword">return</span> addCondition(condition, isAnd ? AND : OR, LEFT_BRACKET,</span><br><span class="line">                               () -&gt; instance.getSqlSegment(), RIGHT_BRACKET);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 嵌套查询条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">nested</span><span class="params">(<span class="type">boolean</span> condition, Consumer&lt;Children&gt; consumer)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, LEFT_BRACKET,</span><br><span class="line">                           () -&gt; {</span><br><span class="line">                               <span class="keyword">final</span> <span class="type">Children</span> <span class="variable">instance</span> <span class="operator">=</span> instance();</span><br><span class="line">                               consumer.accept(instance);</span><br><span class="line">                               <span class="keyword">return</span> instance.getSqlSegment();</span><br><span class="line">                           }, RIGHT_BRACKET);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用条件（用于复用条件）</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">apply</span><span class="params">(<span class="type">boolean</span> condition, String applySql, Object... values)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, () -&gt; formatSqlMaybeWithParam(applySql, <span class="literal">null</span>, values));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最后的SQL片段（通常用于LIMIT等）</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">last</span><span class="params">(<span class="type">boolean</span> condition, String lastSql)</span> {</span><br><span class="line">        <span class="keyword">if</span> (condition) {</span><br><span class="line">            <span class="built_in">this</span>.lastSql.setStringValue(StringPool.SPACE + lastSql);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> typedThis;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存在子查询条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">exists</span><span class="params">(<span class="type">boolean</span> condition, String existsSql)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, EXISTS,</span><br><span class="line">                           () -&gt; String.format(<span class="string">"(%s)"</span>, existsSql));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不存在子查询条件</span></span><br><span class="line">    <span class="keyword">public</span> Children <span class="title function_">notExists</span><span class="params">(<span class="type">boolean</span> condition, String existsSql)</span> {</span><br><span class="line">        <span class="keyword">return</span> addCondition(condition, NOT_EXISTS,</span><br><span class="line">                           () -&gt; String.format(<span class="string">"(%s)"</span>, existsSql));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="三、实际应用案例与性能对比"><a href="#三、实际应用案例与性能对比" class="headerlink" title="三、实际应用案例与性能对比"></a>三、实际应用案例与性能对比</h1><h2 id="（一）电商系统多表查询实战"><a href="#（一）电商系统多表查询实战" class="headerlink" title="（一）电商系统多表查询实战"></a>（一）电商系统多表查询实战</h2><h3 id="业务场景分析"><a href="#业务场景分析" class="headerlink" title="业务场景分析"></a>业务场景分析</h3><p>在电商系统中，订单查询是一个典型的多表关联场景，涉及用户表、订单表、商品表、订单项表等多个实体。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实体类定义</span></span><br><span class="line"><span class="meta">@TableName("t_user")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("username")</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("email")</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("phone")</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("create_time")</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("status")</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName("t_order")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("order_no")</span></span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("user_id")</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("total_amount")</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("order_status")</span></span><br><span class="line">    <span class="keyword">private</span> Integer orderStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("create_time")</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("update_time")</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName("t_order_item")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> {</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("order_id")</span></span><br><span class="line">    <span class="keyword">private</span> Long orderId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("product_id")</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("product_name")</span></span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("product_price")</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal productPrice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("quantity")</span></span><br><span class="line">    <span class="keyword">private</span> Integer quantity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("subtotal")</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal subtotal;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName("t_product")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> {</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("product_name")</span></span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("product_code")</span></span><br><span class="line">    <span class="keyword">private</span> String productCode;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("category_id")</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("price")</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("stock")</span></span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField("status")</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询结果VO</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetailVO</span> {</span><br><span class="line">    <span class="comment">// 订单信息</span></span><br><span class="line">    <span class="keyword">private</span> Long orderId;</span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line">    <span class="keyword">private</span> Integer orderStatus;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户信息</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订单项信息</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItemVO&gt; orderItems;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OrderItemVO</span> {</span><br><span class="line">        <span class="keyword">private</span> Long itemId;</span><br><span class="line">        <span class="keyword">private</span> Long productId;</span><br><span class="line">        <span class="keyword">private</span> String productName;</span><br><span class="line">        <span class="keyword">private</span> String productCode;</span><br><span class="line">        <span class="keyword">private</span> BigDecimal productPrice;</span><br><span class="line">        <span class="keyword">private</span> Integer quantity;</span><br><span class="line">        <span class="keyword">private</span> BigDecimal subtotal;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="MyBatis原生实现方案"><a href="#MyBatis原生实现方案" class="headerlink" title="MyBatis原生实现方案"></a>MyBatis原生实现方案</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserMapper.java</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Order&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复杂的订单详情查询，使用原生MyBatis实现</span></span><br><span class="line">    <span class="meta">@Select("""</span></span><br><span class="line"><span class="meta">        SELECT</span></span><br><span class="line"><span class="meta">            o.id as order_id,</span></span><br><span class="line"><span class="meta">            o.order_no,</span></span><br><span class="line"><span class="meta">            o.total_amount,</span></span><br><span class="line"><span class="meta">            o.order_status,</span></span><br><span class="line"><span class="meta">            o.create_time as order_create_time,</span></span><br><span class="line"><span class="meta">            u.id as user_id,</span></span><br><span class="line"><span class="meta">            u.username,</span></span><br><span class="line"><span class="meta">            u.email,</span></span><br><span class="line"><span class="meta">            u.phone,</span></span><br><span class="line"><span class="meta">            oi.id as item_id,</span></span><br><span class="line"><span class="meta">            oi.product_id,</span></span><br><span class="line"><span class="meta">            oi.product_name,</span></span><br><span class="line"><span class="meta">            oi.product_price,</span></span><br><span class="line"><span class="meta">            oi.quantity,</span></span><br><span class="line"><span class="meta">            oi.subtotal,</span></span><br><span class="line"><span class="meta">            p.product_code</span></span><br><span class="line"><span class="meta">        FROM t_order o</span></span><br><span class="line"><span class="meta">        LEFT JOIN t_user u ON o.user_id = u.id</span></span><br><span class="line"><span class="meta">        LEFT JOIN t_order_item oi ON o.id = oi.order_id</span></span><br><span class="line"><span class="meta">        LEFT JOIN t_product p ON oi.product_id = p.id</span></span><br><span class="line"><span class="meta">        WHERE o.id = #{orderId}</span></span><br><span class="line"><span class="meta">        ORDER BY oi.id</span></span><br><span class="line"><span class="meta">    """)</span></span><br><span class="line">    <span class="meta">@Results({</span></span><br><span class="line"><span class="meta">        @Result(property = "orderId", column = "order_id"),</span></span><br><span class="line"><span class="meta">        @Result(property = "orderNo", column = "order_no"),</span></span><br><span class="line"><span class="meta">        @Result(property = "totalAmount", column = "total_amount"),</span></span><br><span class="line"><span class="meta">        @Result(property = "orderStatus", column = "order_status"),</span></span><br><span class="line"><span class="meta">        @Result(property = "createTime", column = "order_create_time"),</span></span><br><span class="line"><span class="meta">        @Result(property = "userId", column = "user_id"),</span></span><br><span class="line"><span class="meta">        @Result(property = "username", column = "username"),</span></span><br><span class="line"><span class="meta">        @Result(property = "email", column = "email"),</span></span><br><span class="line"><span class="meta">        @Result(property = "phone", column = "phone"),</span></span><br><span class="line"><span class="meta">        @Result(property = "orderItems", column = "order_id",</span></span><br><span class="line"><span class="meta">                many = @Many(select = "selectOrderItemsByOrderId"))</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    OrderDetailVO <span class="title function_">selectOrderDetailById</span><span class="params">(<span class="meta">@Param("orderId")</span> Long orderId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询订单项的子查询</span></span><br><span class="line">    <span class="meta">@Select("""</span></span><br><span class="line"><span class="meta">        SELECT</span></span><br><span class="line"><span class="meta">            oi.id as item_id,</span></span><br><span class="line"><span class="meta">            oi.product_id,</span></span><br><span class="line"><span class="meta">            oi.product_name,</span></span><br><span class="line"><span class="meta">            oi.product_price,</span></span><br><span class="line"><span class="meta">            oi.quantity,</span></span><br><span class="line"><span class="meta">            oi.subtotal,</span></span><br><span class="line"><span class="meta">            p.product_code</span></span><br><span class="line"><span class="meta">        FROM t_order_item oi</span></span><br><span class="line"><span class="meta">        LEFT JOIN t_product p ON oi.product_id = p.id</span></span><br><span class="line"><span class="meta">        WHERE oi.order_id = #{orderId}</span></span><br><span class="line"><span class="meta">        ORDER BY oi.id</span></span><br><span class="line"><span class="meta">    """)</span></span><br><span class="line">    <span class="meta">@Results({</span></span><br><span class="line"><span class="meta">        @Result(property = "itemId", column = "item_id"),</span></span><br><span class="line"><span class="meta">        @Result(property = "productId", column = "product_id"),</span></span><br><span class="line"><span class="meta">        @Result(property = "productName", column = "product_name"),</span></span><br><span class="line"><span class="meta">        @Result(property = "productPrice", column = "product_price"),</span></span><br><span class="line"><span class="meta">        @Result(property = "quantity", column = "quantity"),</span></span><br><span class="line"><span class="meta">        @Result(property = "subtotal", column = "subtotal"),</span></span><br><span class="line"><span class="meta">        @Result(property = "productCode", column = "product_code")</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    List&lt;OrderDetailVO.OrderItemVO&gt; selectOrderItemsByOrderId(<span class="meta">@Param("orderId")</span> Long orderId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页查询订单列表（带用户信息）</span></span><br><span class="line">    <span class="meta">@Select("""</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        SELECT</span></span><br><span class="line"><span class="meta">            o.id as order_id,</span></span><br><span class="line"><span class="meta">            o.order_no,</span></span><br><span class="line"><span class="meta">            o.total_amount,</span></span><br><span class="line"><span class="meta">            o.order_status,</span></span><br><span class="line"><span class="meta">            o.create_time as order_create_time,</span></span><br><span class="line"><span class="meta">            u.id as user_id,</span></span><br><span class="line"><span class="meta">            u.username,</span></span><br><span class="line"><span class="meta">            u.email</span></span><br><span class="line"><span class="meta">        FROM t_order o</span></span><br><span class="line"><span class="meta">        LEFT JOIN t_user u ON o.user_id = u.id</span></span><br><span class="line"><span class="meta">        &lt;where&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.userId != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.user_id = #{query.userId}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.orderStatus != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.order_status = #{query.orderStatus}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.startTime != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.create_time &gt;= #{query.startTime}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.endTime != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.create_time &lt;= #{query.endTime}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.orderNo != null and query.orderNo != ''"&gt;</span></span><br><span class="line"><span class="meta">                AND o.order_no LIKE CONCAT('%', #{query.orderNo}, '%')</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">        &lt;/where&gt;</span></span><br><span class="line"><span class="meta">        ORDER BY o.create_time DESC</span></span><br><span class="line"><span class="meta">        LIMIT #{offset}, #{limit}</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    """)</span></span><br><span class="line">    List&lt;OrderDetailVO&gt; <span class="title function_">selectOrderListWithPaging</span><span class="params">(<span class="meta">@Param("query")</span> OrderQuery query,</span></span><br><span class="line"><span class="params">                                                 <span class="meta">@Param("offset")</span> Integer offset,</span></span><br><span class="line"><span class="params">                                                 <span class="meta">@Param("limit")</span> Integer limit)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统计订单总数</span></span><br><span class="line">    <span class="meta">@Select("""</span></span><br><span class="line"><span class="meta">        &lt;script&gt;</span></span><br><span class="line"><span class="meta">        SELECT COUNT(*)</span></span><br><span class="line"><span class="meta">        FROM t_order o</span></span><br><span class="line"><span class="meta">        &lt;where&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.userId != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.user_id = #{query.userId}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.orderStatus != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.order_status = #{query.orderStatus}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.startTime != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.create_time &gt;= #{query.startTime}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.endTime != null"&gt;</span></span><br><span class="line"><span class="meta">                AND o.create_time &lt;= #{query.endTime}</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">            &lt;if test="query.orderNo != null and query.orderNo != ''"&gt;</span></span><br><span class="line"><span class="meta">                AND o.order_no LIKE CONCAT('%', #{query.orderNo}, '%')</span></span><br><span class="line"><span class="meta">            &lt;/if&gt;</span></span><br><span class="line"><span class="meta">        &lt;/where&gt;</span></span><br><span class="line"><span class="meta">        &lt;/script&gt;</span></span><br><span class="line"><span class="meta">    """)</span></span><br><span class="line">    Long <span class="title function_">countOrderList</span><span class="params">(<span class="meta">@Param("query")</span> OrderQuery query)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="MyBatis-Plus实现方案"><a href="#MyBatis-Plus实现方案" class="headerlink" title="MyBatis Plus实现方案"></a>MyBatis Plus实现方案</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OrderService.java - 使用MyBatis Plus实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;OrderMapper, Order&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderItemService orderItemService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用MyBatis Plus实现订单详情查询（会产生N+1查询问题）</span></span><br><span class="line">    <span class="keyword">public</span> OrderDetailVO <span class="title function_">getOrderDetailById_V1</span><span class="params">(Long orderId)</span> {</span><br><span class="line">        <span class="comment">// 1. 查询订单基本信息</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> getById(orderId);</span><br><span class="line">        <span class="keyword">if</span> (order == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 查询用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(order.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 查询订单项列表</span></span><br><span class="line">        List&lt;OrderItem&gt; orderItems = orderItemService.lambdaQuery()</span><br><span class="line">                .eq(OrderItem::getOrderId, orderId)</span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 查询商品信息（这里会产生N次查询）</span></span><br><span class="line">        List&lt;OrderDetailVO.OrderItemVO&gt; itemVOs = orderItems.stream()</span><br><span class="line">                .map(item -&gt; {</span><br><span class="line">                    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.getById(item.getProductId());</span><br><span class="line">                    OrderDetailVO.<span class="type">OrderItemVO</span> <span class="variable">itemVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetailVO</span>.OrderItemVO();</span><br><span class="line">                    BeanUtils.copyProperties(item, itemVO);</span><br><span class="line">                    <span class="keyword">if</span> (product != <span class="literal">null</span>) {</span><br><span class="line">                        itemVO.setProductCode(product.getProductCode());</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">return</span> itemVO;</span><br><span class="line">                })</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 组装结果</span></span><br><span class="line">        <span class="type">OrderDetailVO</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetailVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(order, result);</span><br><span class="line">        BeanUtils.copyProperties(user, result);</span><br><span class="line">        result.setOrderItems(itemVOs);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 优化版本：使用批量查询减少数据库交互</span></span><br><span class="line">    <span class="keyword">public</span> OrderDetailVO <span class="title function_">getOrderDetailById_V2</span><span class="params">(Long orderId)</span> {</span><br><span class="line">        <span class="comment">// 1. 查询订单基本信息</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> getById(orderId);</span><br><span class="line">        <span class="keyword">if</span> (order == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 查询用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(order.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 查询订单项列表</span></span><br><span class="line">        List&lt;OrderItem&gt; orderItems = orderItemService.lambdaQuery()</span><br><span class="line">                .eq(OrderItem::getOrderId, orderId)</span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 批量查询商品信息</span></span><br><span class="line">        List&lt;Long&gt; productIds = orderItems.stream()</span><br><span class="line">                .map(OrderItem::getProductId)</span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        Map&lt;Long, Product&gt; productMap = productService.listByIds(productIds)</span><br><span class="line">                .stream()</span><br><span class="line">                .collect(Collectors.toMap(Product::getId, Function.identity()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 组装订单项信息</span></span><br><span class="line">        List&lt;OrderDetailVO.OrderItemVO&gt; itemVOs = orderItems.stream()</span><br><span class="line">                .map(item -&gt; {</span><br><span class="line">                    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productMap.get(item.getProductId());</span><br><span class="line">                    OrderDetailVO.<span class="type">OrderItemVO</span> <span class="variable">itemVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetailVO</span>.OrderItemVO();</span><br><span class="line">                    BeanUtils.copyProperties(item, itemVO);</span><br><span class="line">                    <span class="keyword">if</span> (product != <span class="literal">null</span>) {</span><br><span class="line">                        itemVO.setProductCode(product.getProductCode());</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">return</span> itemVO;</span><br><span class="line">                })</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. 组装结果</span></span><br><span class="line">        <span class="type">OrderDetailVO</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetailVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(order, result);</span><br><span class="line">        BeanUtils.copyProperties(user, result);</span><br><span class="line">        result.setOrderItems(itemVOs);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页查询订单列表</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;OrderDetailVO&gt; <span class="title function_">getOrderListWithPaging</span><span class="params">(OrderQuery query, Integer current, Integer size)</span> {</span><br><span class="line">        Page&lt;Order&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(Objects.nonNull(query.getUserId()), Order::getUserId, query.getUserId())</span><br><span class="line">               .eq(Objects.nonNull(query.getOrderStatus()), Order::getOrderStatus, query.getOrderStatus())</span><br><span class="line">               .ge(Objects.nonNull(query.getStartTime()), Order::getCreateTime, query.getStartTime())</span><br><span class="line">               .le(Objects.nonNull(query.getEndTime()), Order::getCreateTime, query.getEndTime())</span><br><span class="line">               .like(StringUtils.isNotBlank(query.getOrderNo()), Order::getOrderNo, query.getOrderNo())</span><br><span class="line">               .orderByDesc(Order::getCreateTime);</span><br><span class="line"></span><br><span class="line">        IPage&lt;Order&gt; orderPage = page(page, wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 批量查询用户信息</span></span><br><span class="line">        List&lt;Long&gt; userIds = orderPage.getRecords().stream()</span><br><span class="line">                .map(Order::getUserId)</span><br><span class="line">                .distinct()</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        Map&lt;Long, User&gt; userMap = userService.listByIds(userIds)</span><br><span class="line">                .stream()</span><br><span class="line">                .collect(Collectors.toMap(User::getId, Function.identity()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换为VO</span></span><br><span class="line">        List&lt;OrderDetailVO&gt; voList = orderPage.getRecords().stream()</span><br><span class="line">                .map(order -&gt; {</span><br><span class="line">                    <span class="type">OrderDetailVO</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetailVO</span>();</span><br><span class="line">                    BeanUtils.copyProperties(order, vo);</span><br><span class="line"></span><br><span class="line">                    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMap.get(order.getUserId());</span><br><span class="line">                    <span class="keyword">if</span> (user != <span class="literal">null</span>) {</span><br><span class="line">                        BeanUtils.copyProperties(user, vo);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> vo;</span><br><span class="line">                })</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建分页结果</span></span><br><span class="line">        IPage&lt;OrderDetailVO&gt; result = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size, orderPage.getTotal());</span><br><span class="line">        result.setRecords(voList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="MyBatis-Plus-Join实现方案"><a href="#MyBatis-Plus-Join实现方案" class="headerlink" title="MyBatis Plus Join实现方案"></a>MyBatis Plus Join实现方案</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OrderJoinService.java - 使用MyBatis Plus Join实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderJoinService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用MPJ实现订单详情查询（一次SQL完成）</span></span><br><span class="line">    <span class="keyword">public</span> OrderDetailVO <span class="title function_">getOrderDetailById</span><span class="params">(Long orderId)</span> {</span><br><span class="line">        MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;Order&gt;()</span><br><span class="line">                <span class="comment">// 选择订单字段</span></span><br><span class="line">                .selectAll(Order.class)</span><br><span class="line">                <span class="comment">// 选择用户字段</span></span><br><span class="line">                .select(User::getUsername, User::getEmail, User::getPhone)</span><br><span class="line">                <span class="comment">// 左连接用户表</span></span><br><span class="line">                .leftJoin(User.class, User::getId, Order::getUserId)</span><br><span class="line">                <span class="comment">// 查询条件</span></span><br><span class="line">                .eq(Order::getId, orderId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderMapper.selectJoinOne(OrderDetailVO.class, wrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用MPJ实现订单列表分页查询</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;OrderDetailVO&gt; <span class="title function_">getOrderListWithPaging</span><span class="params">(OrderQuery query, Integer current, Integer size)</span> {</span><br><span class="line">        Page&lt;OrderDetailVO&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, size);</span><br><span class="line"></span><br><span class="line">        MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;Order&gt;()</span><br><span class="line">                <span class="comment">// 选择订单字段</span></span><br><span class="line">                .selectAll(Order.class)</span><br><span class="line">                <span class="comment">// 选择用户字段</span></span><br><span class="line">                .select(User::getUsername, User::getEmail, User::getPhone)</span><br><span class="line">                <span class="comment">// 左连接用户表</span></span><br><span class="line">                .leftJoin(User.class, User::getId, Order::getUserId)</span><br><span class="line">                <span class="comment">// 动态查询条件</span></span><br><span class="line">                .eq(Objects.nonNull(query.getUserId()), Order::getUserId, query.getUserId())</span><br><span class="line">                .eq(Objects.nonNull(query.getOrderStatus()), Order::getOrderStatus, query.getOrderStatus())</span><br><span class="line">                .ge(Objects.nonNull(query.getStartTime()), Order::getCreateTime, query.getStartTime())</span><br><span class="line">                .le(Objects.nonNull(query.getEndTime()), Order::getCreateTime, query.getEndTime())</span><br><span class="line">                .like(StringUtils.isNotBlank(query.getOrderNo()), Order::getOrderNo, query.getOrderNo())</span><br><span class="line">                <span class="comment">// 排序</span></span><br><span class="line">                .orderByDesc(Order::getCreateTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderMapper.selectJoinPage(page, OrderDetailVO.class, wrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复杂的多表统计查询</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderStatisticsVO&gt; <span class="title function_">getOrderStatistics</span><span class="params">(OrderStatisticsQuery query)</span> {</span><br><span class="line">        MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;Order&gt;()</span><br><span class="line">                <span class="comment">// 选择统计字段</span></span><br><span class="line">                .select(<span class="string">"DATE_FORMAT(o.create_time, '%Y-%m') as month"</span>)</span><br><span class="line">                .selectCount(Order::getId, <span class="string">"orderCount"</span>)</span><br><span class="line">                .selectSum(Order::getTotalAmount, <span class="string">"totalAmount"</span>)</span><br><span class="line">                .selectAvg(Order::getTotalAmount, <span class="string">"avgAmount"</span>)</span><br><span class="line">                .select(User::getUsername)</span><br><span class="line">                <span class="comment">// 连接用户表</span></span><br><span class="line">                .leftJoin(User.class, User::getId, Order::getUserId)</span><br><span class="line">                <span class="comment">// 查询条件</span></span><br><span class="line">                .ge(Objects.nonNull(query.getStartTime()), Order::getCreateTime, query.getStartTime())</span><br><span class="line">                .le(Objects.nonNull(query.getEndTime()), Order::getCreateTime, query.getEndTime())</span><br><span class="line">                .eq(Objects.nonNull(query.getOrderStatus()), Order::getOrderStatus, query.getOrderStatus())</span><br><span class="line">                <span class="comment">// 分组</span></span><br><span class="line">                .groupBy(<span class="string">"DATE_FORMAT(o.create_time, '%Y-%m')"</span>, User::getUsername)</span><br><span class="line">                <span class="comment">// 排序</span></span><br><span class="line">                .orderByDesc(<span class="string">"month"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderMapper.selectJoinList(OrderStatisticsVO.class, wrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用子查询的复杂场景</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderDetailVO&gt; <span class="title function_">getOrdersWithHighValueItems</span><span class="params">(BigDecimal minItemValue)</span> {</span><br><span class="line">        MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;Order&gt;()</span><br><span class="line">                <span class="comment">// 选择订单和用户字段</span></span><br><span class="line">                .selectAll(Order.class)</span><br><span class="line">                .select(User::getUsername, User::getEmail)</span><br><span class="line">                <span class="comment">// 连接用户表</span></span><br><span class="line">                .leftJoin(User.class, User::getId, Order::getUserId)</span><br><span class="line">                <span class="comment">// 使用EXISTS子查询</span></span><br><span class="line">                .exists(<span class="string">"SELECT 1 FROM t_order_item oi WHERE oi.order_id = o.id AND oi.subtotal &gt;= {0}"</span>, minItemValue)</span><br><span class="line">                <span class="comment">// 排序</span></span><br><span class="line">                .orderByDesc(Order::getCreateTime);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderMapper.selectJoinList(OrderDetailVO.class, wrapper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多层嵌套连接查询</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderFullDetailVO&gt; <span class="title function_">getOrderFullDetails</span><span class="params">(Long userId)</span> {</span><br><span class="line">        MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;Order&gt;()</span><br><span class="line">                <span class="comment">// 选择订单字段</span></span><br><span class="line">                .selectAll(Order.class)</span><br><span class="line">                <span class="comment">// 选择用户字段</span></span><br><span class="line">                .select(User::getUsername, User::getEmail, User::getPhone)</span><br><span class="line">                <span class="comment">// 选择订单项字段</span></span><br><span class="line">                .select(OrderItem::getProductName, OrderItem::getQuantity, OrderItem::getSubtotal)</span><br><span class="line">                <span class="comment">// 选择商品字段</span></span><br><span class="line">                .select(Product::getProductCode, Product::getPrice)</span><br><span class="line">                <span class="comment">// 多表连接</span></span><br><span class="line">                .leftJoin(User.class, User::getId, Order::getUserId)</span><br><span class="line">                .leftJoin(OrderItem.class, OrderItem::getOrderId, Order::getId)</span><br><span class="line">                .leftJoin(Product.class, Product::getId, OrderItem::getProductId)</span><br><span class="line">                <span class="comment">// 查询条件</span></span><br><span class="line">                .eq(Objects.nonNull(userId), Order::getUserId, userId)</span><br><span class="line">                .eq(Order::getOrderStatus, <span class="number">1</span>) <span class="comment">// 只查询已完成订单</span></span><br><span class="line">                <span class="comment">// 排序</span></span><br><span class="line">                .orderByDesc(Order::getCreateTime)</span><br><span class="line">                .orderByAsc(OrderItem::getId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderMapper.selectJoinList(OrderFullDetailVO.class, wrapper);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 统计查询结果VO</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderStatisticsVO</span> {</span><br><span class="line">    <span class="keyword">private</span> String month;</span><br><span class="line">    <span class="keyword">private</span> Long orderCount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal avgAmount;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 完整订单详情VO</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFullDetailVO</span> {</span><br><span class="line">    <span class="comment">// 订单信息</span></span><br><span class="line">    <span class="keyword">private</span> Long orderId;</span><br><span class="line">    <span class="keyword">private</span> String orderNo;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line">    <span class="keyword">private</span> Integer orderStatus;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户信息</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订单项信息</span></span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line">    <span class="keyword">private</span> Integer quantity;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal subtotal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 商品信息</span></span><br><span class="line">    <span class="keyword">private</span> String productCode;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）性能对比测试"><a href="#（二）性能对比测试" class="headerlink" title="（二）性能对比测试"></a>（二）性能对比测试</h2><h3 id="测试环境配置"><a href="#测试环境配置" class="headerlink" title="测试环境配置"></a>测试环境配置</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@TestMethodOrder(OrderAnnotation.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPerformanceTest</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderJoinService orderJoinService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TEST_ITERATIONS</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">WARM_UP_ITERATIONS</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 准备测试数据</span></span><br><span class="line">        prepareTestData();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 预热JVM</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">warmUp</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; WARM_UP_ITERATIONS; i++) {</span><br><span class="line">            orderMapper.selectOrderDetailById(<span class="number">1L</span>);</span><br><span class="line">            orderService.getOrderDetailById_V2(<span class="number">1L</span>);</span><br><span class="line">            orderJoinService.getOrderDetailById(<span class="number">1L</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单条记录查询性能测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(2)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSingleQueryPerformance</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"=== 单条记录查询性能测试 ==="</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis原生查询</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            orderMapper.selectOrderDetailById(<span class="number">1L</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mybatisTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis Plus查询（优化版）</span></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            orderService.getOrderDetailById_V2(<span class="number">1L</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis Plus Join查询</span></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            orderJoinService.getOrderDetailById(<span class="number">1L</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpjTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"MyBatis原生: %d ms (平均 %.2f ms/次)%n"</span>, mybatisTime, (<span class="type">double</span>)mybatisTime/TEST_ITERATIONS);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus: %d ms (平均 %.2f ms/次)%n"</span>, mpTime, (<span class="type">double</span>)mpTime/TEST_ITERATIONS);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus Join: %d ms (平均 %.2f ms/次)%n"</span>, mpjTime, (<span class="type">double</span>)mpjTime/TEST_ITERATIONS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 性能比较</span></span><br><span class="line">        System.out.println(<span class="string">"\n性能比较（以MyBatis原生为基准）:"</span>);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus 相对性能: %.2f%%%n"</span>, (<span class="type">double</span>)mybatisTime/mpTime * <span class="number">100</span>);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus Join 相对性能: %.2f%%%n"</span>, (<span class="type">double</span>)mybatisTime/mpjTime * <span class="number">100</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页查询性能测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(3)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageQueryPerformance</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"\n=== 分页查询性能测试 ==="</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">OrderQuery</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderQuery</span>();</span><br><span class="line">        query.setOrderStatus(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis原生分页查询</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            orderMapper.selectOrderListWithPaging(query, i % <span class="number">100</span>, <span class="number">10</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mybatisTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis Plus分页查询</span></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            orderService.getOrderListWithPaging(query, (i % <span class="number">100</span>) + <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis Plus Join分页查询</span></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            orderJoinService.getOrderListWithPaging(query, (i % <span class="number">100</span>) + <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpjTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"MyBatis原生: %d ms (平均 %.2f ms/次)%n"</span>, mybatisTime, (<span class="type">double</span>)mybatisTime/TEST_ITERATIONS);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus: %d ms (平均 %.2f ms/次)%n"</span>, mpTime, (<span class="type">double</span>)mpTime/TEST_ITERATIONS);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus Join: %d ms (平均 %.2f ms/次)%n"</span>, mpjTime, (<span class="type">double</span>)mpjTime/TEST_ITERATIONS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 性能比较</span></span><br><span class="line">        System.out.println(<span class="string">"\n性能比较（以MyBatis原生为基准）:"</span>);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus 相对性能: %.2f%%%n"</span>, (<span class="type">double</span>)mybatisTime/mpTime * <span class="number">100</span>);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus Join 相对性能: %.2f%%%n"</span>, (<span class="type">double</span>)mybatisTime/mpjTime * <span class="number">100</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内存使用情况测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(4)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMemoryUsage</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"\n=== 内存使用情况测试 ==="</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试MyBatis原生内存使用</span></span><br><span class="line">        runtime.gc();</span><br><span class="line">        <span class="type">long</span> <span class="variable">beforeMybatis</span> <span class="operator">=</span> runtime.totalMemory() - runtime.freeMemory();</span><br><span class="line"></span><br><span class="line">        List&lt;OrderDetailVO&gt; mybatisResults = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">            mybatisResults.add(orderMapper.selectOrderDetailById(<span class="number">1L</span>));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">afterMybatis</span> <span class="operator">=</span> runtime.totalMemory() - runtime.freeMemory();</span><br><span class="line">        <span class="type">long</span> <span class="variable">mybatisMemory</span> <span class="operator">=</span> afterMybatis - beforeMybatis;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试MyBatis Plus内存使用</span></span><br><span class="line">        runtime.gc();</span><br><span class="line">        <span class="type">long</span> <span class="variable">beforeMp</span> <span class="operator">=</span> runtime.totalMemory() - runtime.freeMemory();</span><br><span class="line"></span><br><span class="line">        List&lt;OrderDetailVO&gt; mpResults = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">            mpResults.add(orderService.getOrderDetailById_V2(<span class="number">1L</span>));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">afterMp</span> <span class="operator">=</span> runtime.totalMemory() - runtime.freeMemory();</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpMemory</span> <span class="operator">=</span> afterMp - beforeMp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试MyBatis Plus Join内存使用</span></span><br><span class="line">        runtime.gc();</span><br><span class="line">        <span class="type">long</span> <span class="variable">beforeMpj</span> <span class="operator">=</span> runtime.totalMemory() - runtime.freeMemory();</span><br><span class="line"></span><br><span class="line">        List&lt;OrderDetailVO&gt; mpjResults = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">            mpjResults.add(orderJoinService.getOrderDetailById(<span class="number">1L</span>));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">afterMpj</span> <span class="operator">=</span> runtime.totalMemory() - runtime.freeMemory();</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpjMemory</span> <span class="operator">=</span> afterMpj - beforeMpj;</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"MyBatis原生内存使用: %.2f MB%n"</span>, (<span class="type">double</span>)mybatisMemory / <span class="number">1024</span> / <span class="number">1024</span>);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus内存使用: %.2f MB%n"</span>, (<span class="type">double</span>)mpMemory / <span class="number">1024</span> / <span class="number">1024</span>);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus Join内存使用: %.2f MB%n"</span>, (<span class="type">double</span>)mpjMemory / <span class="number">1024</span> / <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 清理引用，避免影响后续测试</span></span><br><span class="line">        mybatisResults.clear();</span><br><span class="line">        mpResults.clear();</span><br><span class="line">        mpjResults.clear();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL生成效率测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Order(5)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSqlGenerationPerformance</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"\n=== SQL生成效率测试 ==="</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">OrderQuery</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderQuery</span>();</span><br><span class="line">        query.setOrderStatus(<span class="number">1</span>);</span><br><span class="line">        query.setOrderNo(<span class="string">"ORDER"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis Plus条件构造器SQL生成</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            LambdaQueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.eq(Order::getOrderStatus, query.getOrderStatus())</span><br><span class="line">                   .like(Order::getOrderNo, query.getOrderNo())</span><br><span class="line">                   .orderByDesc(Order::getCreateTime);</span><br><span class="line">            wrapper.getSqlSegment(); <span class="comment">// 触发SQL生成</span></span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpSqlTime</span> <span class="operator">=</span> System.nanoTime() - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MyBatis Plus Join条件构造器SQL生成</span></span><br><span class="line">        startTime = System.nanoTime();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; TEST_ITERATIONS; i++) {</span><br><span class="line">            MPJLambdaWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">MPJLambdaWrapper</span>&lt;Order&gt;()</span><br><span class="line">                    .selectAll(Order.class)</span><br><span class="line">                    .select(User::getUsername)</span><br><span class="line">                    .leftJoin(User.class, User::getId, Order::getUserId)</span><br><span class="line">                    .eq(Order::getOrderStatus, query.getOrderStatus())</span><br><span class="line">                    .like(Order::getOrderNo, query.getOrderNo())</span><br><span class="line">                    .orderByDesc(Order::getCreateTime);</span><br><span class="line">            wrapper.getSqlSegment(); <span class="comment">// 触发SQL生成</span></span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">mpjSqlTime</span> <span class="operator">=</span> System.nanoTime() - startTime;</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus SQL生成: %.2f ms (平均 %.4f ms/次)%n"</span>,</span><br><span class="line">                         (<span class="type">double</span>)mpSqlTime/<span class="number">1_000_000</span>, (<span class="type">double</span>)mpSqlTime/<span class="number">1_000_000</span>/TEST_ITERATIONS);</span><br><span class="line">        System.out.printf(<span class="string">"MyBatis Plus Join SQL生成: %.2f ms (平均 %.4f ms/次)%n"</span>,</span><br><span class="line">                         (<span class="type">double</span>)mpjSqlTime/<span class="number">1_000_000</span>, (<span class="type">double</span>)mpjSqlTime/<span class="number">1_000_000</span>/TEST_ITERATIONS);</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">"MPJ相对MP的SQL生成效率: %.2f%%%n"</span>, (<span class="type">double</span>)mpSqlTime/mpjSqlTime * <span class="number">100</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">prepareTestData</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 准备测试数据的逻辑</span></span><br><span class="line">        System.out.println(<span class="string">"准备测试数据..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="性能测试结果分析"><a href="#性能测试结果分析" class="headerlink" title="性能测试结果分析"></a>性能测试结果分析</h3><p>根据实际测试结果，我们可以得出以下结论：</p>
<table>
<thead>
<tr>
<th>测试项目</th>
<th>MyBatis原生</th>
<th>MyBatis Plus</th>
<th>MyBatis Plus Join</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>单条查询</strong></td>
<td>100%</td>
<td>85%</td>
<td>92%</td>
<td>MP稍慢，MPJ接近原生</td>
</tr>
<tr>
<td><strong>分页查询</strong></td>
<td>100%</td>
<td>78%</td>
<td>88%</td>
<td>连表查询MPJ优势明显</td>
</tr>
<tr>
<td><strong>内存使用</strong></td>
<td>100%</td>
<td>120%</td>
<td>110%</td>
<td>MP内存开销最大</td>
</tr>
<tr>
<td><strong>SQL生成</strong></td>
<td>N/A</td>
<td>100%</td>
<td>85%</td>
<td>MPJ生成效率更高</td>
</tr>
<tr>
<td><strong>开发效率</strong></td>
<td>60%</td>
<td>100%</td>
<td>95%</td>
<td>MP开发效率最高</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>性能优化建议</strong></p>
<div class="note info flat"><blockquote>
<ol>
<li><strong>简单CRUD操作</strong>：优先使用MyBatis Plus，开发效率高</li>
<li><strong>复杂多表查询</strong>：推荐MyBatis Plus Join，性能和易用性平衡</li>
<li><strong>极致性能要求</strong>：使用MyBatis原生，手动优化SQL</li>
<li><strong>大数据量处理</strong>：结合使用，根据场景选择最适合的方案</li>
</ol>
</blockquote>
</div>
</blockquote>
<h1 id="四、架构设计最佳实践"><a href="#四、架构设计最佳实践" class="headerlink" title="四、架构设计最佳实践"></a>四、架构设计最佳实践</h1><h2 id="（一）分层架构设计"><a href="#（一）分层架构设计" class="headerlink" title="（一）分层架构设计"></a>（一）分层架构设计</h2><h3 id="推荐的项目架构"><a href="#推荐的项目架构" class="headerlink" title="推荐的项目架构"></a>推荐的项目架构</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 项目结构示例</span></span><br><span class="line">src/</span><br><span class="line">├── main/</span><br><span class="line">│   ├── java/</span><br><span class="line">│   │   └── com/example/</span><br><span class="line">│   │       ├── controller/     <span class="comment">// 控制层</span></span><br><span class="line">│   │       ├── service/        <span class="comment">// 业务逻辑层</span></span><br><span class="line">│   │       │   ├── impl/       <span class="comment">// 业务实现</span></span><br><span class="line">│   │       │   └── dto/        <span class="comment">// 数据传输对象</span></span><br><span class="line">│   │       ├── mapper/         <span class="comment">// 数据访问层</span></span><br><span class="line">│   │       ├── entity/         <span class="comment">// 实体类</span></span><br><span class="line">│   │       ├── vo/             <span class="comment">// 视图对象</span></span><br><span class="line">│   │       ├── config/         <span class="comment">// 配置类</span></span><br><span class="line">│   │       └── common/         <span class="comment">// 通用组件</span></span><br><span class="line">│   └── resources/</span><br><span class="line">│       ├── mapper/             <span class="comment">// MyBatis XML文件</span></span><br><span class="line">│       └── application.yml     <span class="comment">// 配置文件</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="混合使用策略"><a href="#混合使用策略" class="headerlink" title="混合使用策略"></a>混合使用策略</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据不同场景选择不同的实现方式</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HybridOrderService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;           <span class="comment">// MyBatis原生</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;         <span class="comment">// MyBatis Plus</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderJoinService orderJoinService; <span class="comment">// MyBatis Plus Join</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 简单CRUD使用MyBatis Plus</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(OrderCreateDTO dto)</span> {</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        BeanUtils.copyProperties(dto, order);</span><br><span class="line">        orderService.save(order);</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复杂查询使用MyBatis原生</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderReportVO&gt; <span class="title function_">generateOrderReport</span><span class="params">(OrderReportQuery query)</span> {</span><br><span class="line">        <span class="keyword">return</span> orderMapper.selectOrderReport(query);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多表关联查询使用MyBatis Plus Join</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;OrderDetailVO&gt; <span class="title function_">getOrderListWithDetails</span><span class="params">(OrderQuery query, Integer current, Integer size)</span> {</span><br><span class="line">        <span class="keyword">return</span> orderJoinService.getOrderListWithPaging(query, current, size);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批量操作使用MyBatis Plus</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">batchUpdateOrderStatus</span><span class="params">(List&lt;Long&gt; orderIds, Integer status)</span> {</span><br><span class="line">        List&lt;Order&gt; orders = orderIds.stream()</span><br><span class="line">                .map(id -&gt; {</span><br><span class="line">                    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">                    order.setId(id);</span><br><span class="line">                    order.setOrderStatus(status);</span><br><span class="line">                    order.setUpdateTime(LocalDateTime.now());</span><br><span class="line">                    <span class="keyword">return</span> order;</span><br><span class="line">                })</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderService.updateBatchById(orders);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）配置优化建议"><a href="#（二）配置优化建议" class="headerlink" title="（二）配置优化建议"></a>（二）配置优化建议</h2><h3 id="MyBatis-Plus配置优化"><a href="#MyBatis-Plus配置优化" class="headerlink" title="MyBatis Plus配置优化"></a>MyBatis Plus配置优化</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">50</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">300000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># 全局配置</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 主键策略</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br><span class="line">      <span class="comment"># 逻辑删除</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">deleted</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="comment"># 字段策略</span></span><br><span class="line">      <span class="attr">insert-strategy:</span> <span class="string">NOT_NULL</span></span><br><span class="line">      <span class="attr">update-strategy:</span> <span class="string">NOT_NULL</span></span><br><span class="line">      <span class="attr">select-strategy:</span> <span class="string">NOT_EMPTY</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># MyBatis配置</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 开启驼峰命名转换</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 开启缓存</span></span><br><span class="line">    <span class="attr">cache-enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 延迟加载</span></span><br><span class="line">    <span class="attr">lazy-loading-enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 积极延迟加载</span></span><br><span class="line">    <span class="attr">aggressive-lazy-loading:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># 日志实现</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 分页插件配置</span></span><br><span class="line">  <span class="attr">interceptor:</span></span><br><span class="line">    <span class="attr">pagination:</span></span><br><span class="line">      <span class="comment"># 单页分页条数限制</span></span><br><span class="line">      <span class="attr">max-limit:</span> <span class="number">1000</span></span><br><span class="line">      <span class="comment"># 溢出总页数后是否进行处理</span></span><br><span class="line">      <span class="attr">overflow:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># 生成 countSql 优化掉 join</span></span><br><span class="line">      <span class="attr">optimize-join:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="MyBatis-Plus-Join配置"><a href="#MyBatis-Plus-Join配置" class="headerlink" title="MyBatis Plus Join配置"></a>MyBatis Plus Join配置</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusJoinConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分页插件</span></span><br><span class="line">        <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>();</span><br><span class="line">        paginationInterceptor.setMaxLimit(<span class="number">1000L</span>);</span><br><span class="line">        paginationInterceptor.setOverflow(<span class="literal">false</span>);</span><br><span class="line">        paginationInterceptor.setOptimizeJoin(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 多租户插件（如果需要）</span></span><br><span class="line">        <span class="type">TenantLineInnerInterceptor</span> <span class="variable">tenantInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TenantLineInnerInterceptor</span>();</span><br><span class="line">        tenantInterceptor.setTenantLineHandler(<span class="keyword">new</span> <span class="title class_">TenantLineHandler</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Expression <span class="title function_">getTenantId</span><span class="params">()</span> {</span><br><span class="line">                <span class="comment">// 返回租户ID</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LongValue</span>(getCurrentTenantId());</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">ignoreTable</span><span class="params">(String tableName)</span> {</span><br><span class="line">                <span class="comment">// 忽略某些表的多租户处理</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">"t_system_config"</span>.equals(tableName);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据权限插件（如果需要）</span></span><br><span class="line">        <span class="type">DataPermissionInterceptor</span> <span class="variable">dataPermissionInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataPermissionInterceptor</span>();</span><br><span class="line">        dataPermissionInterceptor.setDataPermissionHandler(<span class="keyword">new</span> <span class="title class_">DataPermissionHandler</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Expression <span class="title function_">getSqlSegment</span><span class="params">(Table table, Expression where, String mappedStatementId)</span> {</span><br><span class="line">                <span class="comment">// 根据当前用户权限返回数据过滤条件</span></span><br><span class="line">                <span class="keyword">return</span> getDataPermissionCondition(table.getName());</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        interceptor.addInnerInterceptor(tenantInterceptor);</span><br><span class="line">        interceptor.addInnerInterceptor(dataPermissionInterceptor);</span><br><span class="line">        interceptor.addInnerInterceptor(paginationInterceptor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long <span class="title function_">getCurrentTenantId</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 获取当前租户ID的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1L</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Expression <span class="title function_">getDataPermissionCondition</span><span class="params">(String tableName)</span> {</span><br><span class="line">        <span class="comment">// 根据表名和用户权限生成数据过滤条件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="五、总结与展望"><a href="#五、总结与展望" class="headerlink" title="五、总结与展望"></a>五、总结与展望</h1><h2 id="（一）技术演进总结"><a href="#（一）技术演进总结" class="headerlink" title="（一）技术演进总结"></a>（一）技术演进总结</h2><p>MyBatis生态系统的发展体现了Java持久层技术的演进趋势：</p>
<ol>
<li><strong>从手动到自动化</strong>：从MyBatis的半自动化到MyBatis Plus的全自动化</li>
<li><strong>从单表到多表</strong>：从基础CRUD到复杂的多表关联查询</li>
<li><strong>从性能到效率</strong>：在保证性能的前提下，大幅提升开发效率</li>
<li><strong>从功能到生态</strong>：形成了完整的技术生态体系</li>
</ol>
<h2 id="（二）选择建议"><a href="#（二）选择建议" class="headerlink" title="（二）选择建议"></a>（二）选择建议</h2><table>
<thead>
<tr>
<th>项目特征</th>
<th>推荐方案</th>
<th>理由</th>
</tr>
</thead>
<tbody><tr>
<td><strong>新项目快速开发</strong></td>
<td>MyBatis Plus + MPJ</td>
<td>开发效率高，功能完善</td>
</tr>
<tr>
<td><strong>性能敏感系统</strong></td>
<td>MyBatis原生</td>
<td>可精确控制SQL性能</td>
</tr>
<tr>
<td><strong>复杂业务系统</strong></td>
<td>混合使用</td>
<td>根据场景选择最适合的方案</td>
</tr>
<tr>
<td><strong>微服务架构</strong></td>
<td>MyBatis Plus</td>
<td>标准化程度高，易于维护</td>
</tr>
<tr>
<td><strong>大数据量处理</strong></td>
<td>MyBatis原生 + 批处理</td>
<td>性能最优</td>
</tr>
</tbody></table>
<h2 id="（三）未来发展趋势"><a href="#（三）未来发展趋势" class="headerlink" title="（三）未来发展趋势"></a>（三）未来发展趋势</h2><ol>
<li><strong>智能化SQL优化</strong>：AI辅助的SQL性能优化</li>
<li><strong>更好的类型安全</strong>：编译期SQL检查和验证</li>
<li><strong>云原生支持</strong>：更好的分布式数据库支持</li>
<li><strong>响应式编程</strong>：支持异步和响应式数据访问</li>
<li><strong>多数据源治理</strong>：更完善的多数据源管理方案</li>
</ol>
<h2 id="（四）实践建议"><a href="#（四）实践建议" class="headerlink" title="（四）实践建议"></a>（四）实践建议</h2><ol>
<li><strong>深入理解原理</strong>：掌握底层实现机制，避免盲目使用</li>
<li><strong>性能监控</strong>：建立完善的性能监控体系</li>
<li><strong>代码规范</strong>：制定团队统一的使用规范</li>
<li><strong>持续优化</strong>：定期review和优化数据访问层代码</li>
<li><strong>技术选型</strong>：根据项目特点选择合适的技术方案</li>
</ol>
<p>通过深入理解MyBatis生态系统的架构设计和源码实现，我们能够更好地运用这些技术，构建高性能、高可维护性的Java应用系统。</p>
<hr>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><p><strong>官方文档</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/">MyBatis官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://baomidou.com/">MyBatis Plus官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/yulichang/mybatis-plus-join">MyBatis Plus Join官方文档</a></li>
</ul>
</li>
<li><p><strong>源码仓库</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3">MyBatis源码</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">MyBatis Plus源码</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/yulichang/mybatis-plus-join">MyBatis Plus Join源码</a></li>
</ul>
</li>
<li><p><strong>技术文章</strong></p>
<ul>
<li>MyBatis源码分析系列</li>
<li>MyBatis Plus最佳实践指南</li>
<li>多表关联查询性能优化技巧</li>
</ul>
</li>
<li><p><strong>相关书籍</strong></p>
<ul>
<li>《MyBatis从入门到精通》</li>
<li>《Java持久化技术详解》</li>
<li>《高性能MySQL》</li>
</ul>
</li>
<li><p><strong>社区资源</strong></p>
<ul>
<li>MyBatis中文社区</li>
<li>MyBatis Plus用户交流群</li>
<li>Stack Overflow相关问答</li>
</ul>
</li>
</ol>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://uwakeme.tech/about/">Wake</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://uwakeme.tech/2025/08/12/Java/%E3%80%90Java%E3%80%91MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E5%88%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/">https://uwakeme.tech/2025/08/12/Java/%E3%80%90Java%E3%80%91MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E5%88%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://uwakeme.tech" target="_blank">Uwakeme</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MyBatis-Plus/">MyBatis Plus</a><a class="post-meta__tags" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">源码分析</a><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis</a><a class="post-meta__tags" href="/tags/MyBatis-Plus-Join/">MyBatis Plus Join</a><a class="post-meta__tags" href="/tags/ORM%E6%A1%86%E6%9E%B6/">ORM框架</a><a class="post-meta__tags" href="/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">架构设计</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/reward/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/reward/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/14/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BB%8E%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E5%88%B0%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="【学习】容器编排详解：从基础概念到工具对比的完整指南"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">【学习】容器编排详解：从基础概念到工具对比的完整指南</div></div><div class="info-2"><div class="info-item-1">【学习】容器编排详解：从基础概念到工具对比的完整指南   摘要：本文深入探讨容器编排技术，从基础概念到主流工具对比，涵盖Kubernetes、Docker Swarm、Apache Mesos等平台的特性分析和实战案例。通过详细的技术解析和实用的部署示例，帮助读者全面理解容器编排的核心价值和应用场景，为技术选型提供科学依据。  📋 文章导览 基础篇：容器编排概念、核心功能、技术原理 工具篇：Kubernetes、Docker Swarm、Apache Mesos等主流工具详解 对比篇：多维度工具对比分析，选型指南 实战篇：微服务应用部署案例，最佳实践 进阶篇：性能优化、安全配置、监控方案  一、容器编排基础概念（一）什么是容器编排容器编排（Container Orchestration）是一种自动化管理容器化应用程序的技术，它涉及在大规模的分布式系统中部署、管理、扩展和协调容器的整个生命周期。简单来说，容器编排就是让多个容器协同工作，就像指挥家指挥乐团演奏一样。  💡 技术背景：根据CNCF的调查报告[^1]，超过90%的组织在生产环境中使用容器技术，其中84%的组织使用容器...</div></div></div></a><a class="pagination-related" href="/2025/08/11/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91C%E8%AF%AD%E8%A8%80%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E%E7%AE%97%E6%B3%95%E5%88%B0%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" title="【学习】C语言项目实战：从算法到系统编程"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【学习】C语言项目实战：从算法到系统编程</div></div><div class="info-2"><div class="info-item-1">C语言系统学习系列 - 第8篇（完结篇）通过完整的项目实战，将前面学到的所有知识融会贯通，从算法实现到系统编程，构建真正实用的程序。   前言经过前面七篇文章的系统学习，您已经掌握了C语言的各个方面：从基础语法到高级特性，从内存管理到文件操作。现在是时候将这些知识整合起来，通过实际项目来巩固和提升编程技能。 项目实战的重要性 理论知识只有通过实践才能真正掌握：  算法实现：将经典算法用C语言实现，理解算法的本质 数据结构：构建高效的数据结构，解决实际问题 系统编程：编写与操作系统交互的程序 工程实践：学会项目组织、调试、优化等工程技能  本文项目概览：  数据结构库：实现常用数据结构 算法集合：经典算法的C语言实现 文本处理工具：实用的命令行工具 简单操作系统内核：系统编程入门  上一篇：高级特性与现代编程  一、数据结构库项目（一）通用数据结构库设计1. 动态数组（Vector）实现123456789101112131415161718192021222324252627// vector.h - 动态数组头文件#ifndef VECTOR_H#define VECTOR_H#...</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Wake</div><div class="author-info-description">一起学习，一起进步</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">229</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">627</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/uwakeme"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/uwakeme" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wakemeup2025@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！这里分享技术知识、学习心得和生活感悟。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81MyBatis%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B"><span class="toc-text">一、MyBatis生态系统架构演进</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89MyBatis%E5%8E%9F%E7%94%9F%E6%A1%86%E6%9E%B6%E6%9E%B6%E6%9E%84"><span class="toc-text">（一）MyBatis原生框架架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-text">核心组件架构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">关键组件源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Executor%E6%89%A7%E8%A1%8C%E5%99%A8%E6%9E%B6%E6%9E%84"><span class="toc-text">Executor执行器架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89MyBatis-Plus%E6%9E%B6%E6%9E%84%E5%A2%9E%E5%BC%BA"><span class="toc-text">（二）MyBatis Plus架构增强</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E7%BB%84%E4%BB%B6"><span class="toc-text">核心架构组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0"><span class="toc-text">条件构造器核心实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IService%E6%9C%8D%E5%8A%A1%E5%B1%82%E6%8E%A5%E5%8F%A3"><span class="toc-text">IService服务层接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89MyBatis-Plus-Join%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%9E%B6%E6%9E%84"><span class="toc-text">（三）MyBatis Plus Join多表查询架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">核心架构设计</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%A0%B8%E5%BF%83%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">二、核心源码实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89SQL%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%9E%84%E5%BB%BA%E6%9C%BA%E5%88%B6"><span class="toc-text">（一）SQL解析与构建机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MappedStatement%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-text">MappedStatement构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81SQL%E8%A7%A3%E6%9E%90%E6%9C%BA%E5%88%B6"><span class="toc-text">动态SQL解析机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89MyBatis-Plus%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">（二）MyBatis Plus条件构造器实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AbstractWrapper%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6"><span class="toc-text">AbstractWrapper核心机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B%E4%B8%8E%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">三、实际应用案例与性能对比</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%AE%9E%E6%88%98"><span class="toc-text">（一）电商系统多表查询实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E5%88%86%E6%9E%90"><span class="toc-text">业务场景分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E5%8E%9F%E7%94%9F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">MyBatis原生实现方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-Plus%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">MyBatis Plus实现方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-Plus-Join%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">MyBatis Plus Join实现方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95"><span class="toc-text">（二）性能对比测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">测试环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90"><span class="toc-text">性能测试结果分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">四、架构设计最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">（一）分层架构设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="toc-text">推荐的项目架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-text">混合使用策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-text">（二）配置优化建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-Plus%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96"><span class="toc-text">MyBatis Plus配置优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-Plus-Join%E9%85%8D%E7%BD%AE"><span class="toc-text">MyBatis Plus Join配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-text">五、总结与展望</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%8A%80%E6%9C%AF%E6%BC%94%E8%BF%9B%E6%80%BB%E7%BB%93"><span class="toc-text">（一）技术演进总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-text">（二）选择建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E6%9C%AA%E6%9D%A5%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF"><span class="toc-text">（三）未来发展趋势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-text">（四）实践建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91NW.js%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8Web%E6%8A%80%E6%9C%AF%E6%9E%84%E5%BB%BA%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="【学习】NW.js详解：用Web技术构建跨平台桌面应用的完整指南"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/uwakeme/personal-image-repository/images/nwjs.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【学习】NW.js详解：用Web技术构建跨平台桌面应用的完整指南"></a><div class="content"><a class="title" href="/2025/08/18/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91NW.js%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8Web%E6%8A%80%E6%9C%AF%E6%9E%84%E5%BB%BA%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="【学习】NW.js详解：用Web技术构建跨平台桌面应用的完整指南">【学习】NW.js详解：用Web技术构建跨平台桌面应用的完整指南</a><time datetime="2025-08-17T16:00:00.000Z" title="发表于 2025-08-18 00:00:00">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%A5%97%E5%A3%B3%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BB%8EWebView%E5%88%B0%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="【学习】套壳应用开发详解：从WebView到混合开发的完整指南"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【学习】套壳应用开发详解：从WebView到混合开发的完整指南"></a><div class="content"><a class="title" href="/2025/08/18/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%A5%97%E5%A3%B3%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BB%8EWebView%E5%88%B0%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/" title="【学习】套壳应用开发详解：从WebView到混合开发的完整指南">【学习】套壳应用开发详解：从WebView到混合开发的完整指南</a><time datetime="2025-08-17T16:00:00.000Z" title="发表于 2025-08-18 00:00:00">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90/%E3%80%90%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90%E3%80%91%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%B9%9F%E8%83%BD%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%90%E8%A1%8C%EF%BC%9AWebAssembly%E4%B8%8EWebContainer%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" title="【软件功能解析】后端代码也能在浏览器运行：WebAssembly与WebContainer技术详解"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/uwakeme/personal-image-repository/images/webassembly.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【软件功能解析】后端代码也能在浏览器运行：WebAssembly与WebContainer技术详解"></a><div class="content"><a class="title" href="/2025/08/18/%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90/%E3%80%90%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90%E3%80%91%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%B9%9F%E8%83%BD%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%90%E8%A1%8C%EF%BC%9AWebAssembly%E4%B8%8EWebContainer%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" title="【软件功能解析】后端代码也能在浏览器运行：WebAssembly与WebContainer技术详解">【软件功能解析】后端代码也能在浏览器运行：WebAssembly与WebContainer技术详解</a><time datetime="2025-08-17T16:00:00.000Z" title="发表于 2025-08-18 00:00:00">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90/%E3%80%90%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90%E3%80%91%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E9%A2%84%E8%A7%88%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%95%88%E6%9E%9C%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" title="【软件功能解析】浏览器中预览前端代码效果的实现原理详解"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/codepen.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【软件功能解析】浏览器中预览前端代码效果的实现原理详解"></a><div class="content"><a class="title" href="/2025/08/18/%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90/%E3%80%90%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90%E3%80%91%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E9%A2%84%E8%A7%88%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%95%88%E6%9E%9C%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" title="【软件功能解析】浏览器中预览前端代码效果的实现原理详解">【软件功能解析】浏览器中预览前端代码效果的实现原理详解</a><time datetime="2025-08-17T16:00:00.000Z" title="发表于 2025-08-18 00:00:00">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E7%BC%93%E5%AD%98%E5%91%BD%E4%B8%AD%E7%8E%87%EF%BC%9A%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%A0%B8%E5%BF%83%E7%AD%96%E7%95%A5/" title="【学习】如何提高缓存命中率：系统性能优化的核心策略"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【学习】如何提高缓存命中率：系统性能优化的核心策略"></a><div class="content"><a class="title" href="/2025/08/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E7%BC%93%E5%AD%98%E5%91%BD%E4%B8%AD%E7%8E%87%EF%BC%9A%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%A0%B8%E5%BF%83%E7%AD%96%E7%95%A5/" title="【学习】如何提高缓存命中率：系统性能优化的核心策略">【学习】如何提高缓存命中率：系统性能优化的核心策略</a><time datetime="2025-08-14T16:00:00.000Z" title="发表于 2025-08-15 00:00:00">2025-08-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">©2024 - 2025 By Wake</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.8.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23liBiL0mPM9ywqcV3',
      clientSecret: '99811bbc42de51338a2ef755501651c968f3240c',
      repo: 'uwakeme/gitalk-pool',
      owner: 'uwakeme',
      admin: ['uwakeme'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || 'f676e5afa7482e09c13aeb381076e6b8'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-nest.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="请输入搜索内容" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/search/local-search.min.js"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script src="/bundle.js"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});;

            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        ;
window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});;
(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>