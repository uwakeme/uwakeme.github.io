<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【学习】区块链技术详解与应用实践 | Uwakeme</title><meta name="author" content="Wake"><meta name="copyright" content="Wake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言区块链技术作为近年来最具革命性的技术之一，正在深刻改变着金融、供应链、医疗、政务等各个领域。从比特币的诞生到以太坊智能合约的兴起，再到各种DeFi应用的蓬勃发展，区块链技术展现出了巨大的潜力和价值。 本文将从技术原理出发，深入解析区块链的核心概念、关键技术、共识机制、智能合约等内容，并通过实际代码示例帮助读者理解区块链的工作原理。无论您是技术开发者、产品经理，还是对区块链技术感兴趣的学习者，都">
<meta property="og:type" content="article">
<meta property="og:title" content="【学习】区块链技术详解与应用实践">
<meta property="og:url" content="https://hexo.blog.uwakeme.tech/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="Uwakeme">
<meta property="og:description" content="前言区块链技术作为近年来最具革命性的技术之一，正在深刻改变着金融、供应链、医疗、政务等各个领域。从比特币的诞生到以太坊智能合约的兴起，再到各种DeFi应用的蓬勃发展，区块链技术展现出了巨大的潜力和价值。 本文将从技术原理出发，深入解析区块链的核心概念、关键技术、共识机制、智能合约等内容，并通过实际代码示例帮助读者理解区块链的工作原理。无论您是技术开发者、产品经理，还是对区块链技术感兴趣的学习者，都">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2026-01-15T08:48:25.219Z">
<meta property="article:modified_time" content="2026-01-15T08:48:25.219Z">
<meta property="article:author" content="Wake">
<meta property="article:tag" content="分布式系统">
<meta property="article:tag" content="区块链">
<meta property="article:tag" content="加密技术">
<meta property="article:tag" content="智能合约">
<meta property="article:tag" content="去中心化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【学习】区块链技术详解与应用实践",
  "url": "https://hexo.blog.uwakeme.tech/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/",
  "image": "https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png",
  "datePublished": "2026-01-15T08:48:25.219Z",
  "dateModified": "2026-01-15T08:48:25.219Z",
  "author": [
    {
      "@type": "Person",
      "name": "Wake",
      "url": "https://hexo.blog.uwakeme.tech/about/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/avatar.jpeg"><link rel="canonical" href="https://hexo.blog.uwakeme.tech/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f96f39b60e7cc4fbcbd971a88f91f326";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/local-search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【学习】区块链技术详解与应用实践',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css"></noscript></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">252</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">688</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Uwakeme</span></a><a class="nav-page-title" href="/"><span class="site-name">【学习】区块链技术详解与应用实践</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【学习】区块链技术详解与应用实践</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-15T08:48:25.219Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-15T08:48:25.219Z" title="更新于 2026-01-15 16:48:25">2026-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>65分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;本文最后更新于&quot;,&quot;messageNext&quot;:&quot;天前，文中内容可能已过时，请谨慎参考。&quot;,&quot;postUpdate&quot;:&quot;2026-01-15 16:48:25&quot;}" hidden=""></div><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>区块链技术作为近年来最具革命性的技术之一，正在深刻改变着金融、供应链、医疗、政务等各个领域。从比特币的诞生到以太坊智能合约的兴起，再到各种DeFi应用的蓬勃发展，区块链技术展现出了巨大的潜力和价值。</p>
<p>本文将从技术原理出发，深入解析区块链的核心概念、关键技术、共识机制、智能合约等内容，并通过实际代码示例帮助读者理解区块链的工作原理。无论您是技术开发者、产品经理，还是对区块链技术感兴趣的学习者，都能从本文中获得有价值的知识和实践指导。</p>
<h1 id="一、区块链基础概念"><a href="#一、区块链基础概念" class="headerlink" title="一、区块链基础概念"></a>一、区块链基础概念</h1><h2 id="（一）什么是区块链"><a href="#（一）什么是区块链" class="headerlink" title="（一）什么是区块链"></a>（一）什么是区块链</h2><p>区块链（Blockchain）是一种分布式数据库技术，它将数据存储在一个个相互连接的区块中，形成一个不可篡改的链式结构。每个区块包含一定数量的交易记录，并通过密码学哈希函数与前一个区块相连。</p>
<h3 id="1-核心特征"><a href="#1-核心特征" class="headerlink" title="1. 核心特征"></a>1. 核心特征</h3><ul>
<li><strong>去中心化</strong>：没有中央控制机构，所有节点平等参与</li>
<li><strong>不可篡改</strong>：一旦数据写入区块链，几乎无法修改</li>
<li><strong>透明性</strong>：所有交易记录公开可查</li>
<li><strong>匿名性</strong>：用户身份通过密码学地址保护</li>
<li><strong>共识机制</strong>：通过算法确保网络一致性</li>
</ul>
<h3 id="2-区块链的基本结构"><a href="#2-区块链的基本结构" class="headerlink" title="2. 区块链的基本结构"></a>2. 区块链的基本结构</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Block</span>:</span><br><span class="line">    <span class="string">"""区块类定义"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, index, transactions, timestamp, previous_hash, nonce=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.index = index                    <span class="comment"># 区块索引</span></span><br><span class="line">        <span class="variable language_">self</span>.transactions = transactions      <span class="comment"># 交易列表</span></span><br><span class="line">        <span class="variable language_">self</span>.timestamp = timestamp           <span class="comment"># 时间戳</span></span><br><span class="line">        <span class="variable language_">self</span>.previous_hash = previous_hash   <span class="comment"># 前一个区块的哈希值</span></span><br><span class="line">        <span class="variable language_">self</span>.nonce = nonce                   <span class="comment"># 工作量证明随机数</span></span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">hash</span> = <span class="variable language_">self</span>.calculate_hash()    <span class="comment"># 当前区块哈希值</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_hash</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""计算区块哈希值"""</span></span><br><span class="line">        block_string = json.dumps({</span><br><span class="line">            <span class="string">"index"</span>: <span class="variable language_">self</span>.index,</span><br><span class="line">            <span class="string">"transactions"</span>: <span class="variable language_">self</span>.transactions,</span><br><span class="line">            <span class="string">"timestamp"</span>: <span class="built_in">str</span>(<span class="variable language_">self</span>.timestamp),</span><br><span class="line">            <span class="string">"previous_hash"</span>: <span class="variable language_">self</span>.previous_hash,</span><br><span class="line">            <span class="string">"nonce"</span>: <span class="variable language_">self</span>.nonce</span><br><span class="line">        }, sort_keys=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> hashlib.sha256(block_string.encode()).hexdigest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mine_block</span>(<span class="params">self, difficulty</span>):</span><br><span class="line">        <span class="string">"""挖矿过程 - 工作量证明"""</span></span><br><span class="line">        target = <span class="string">"0"</span> * difficulty</span><br><span class="line">        <span class="keyword">while</span> <span class="variable language_">self</span>.<span class="built_in">hash</span>[:difficulty] != target:</span><br><span class="line">            <span class="variable language_">self</span>.nonce += <span class="number">1</span></span><br><span class="line">            <span class="variable language_">self</span>.<span class="built_in">hash</span> = <span class="variable language_">self</span>.calculate_hash()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"区块挖掘成功: <span class="subst">{self.<span class="built_in">hash</span>}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建创世区块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_genesis_block</span>():</span><br><span class="line">    <span class="keyword">return</span> Block(<span class="number">0</span>, [], datetime.now(), <span class="string">"0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例使用</span></span><br><span class="line">genesis_block = create_genesis_block()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"创世区块哈希: <span class="subst">{genesis_block.<span class="built_in">hash</span>}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）区块链的分类"><a href="#（二）区块链的分类" class="headerlink" title="（二）区块链的分类"></a>（二）区块链的分类</h2><h3 id="1-按访问权限分类"><a href="#1-按访问权限分类" class="headerlink" title="1. 按访问权限分类"></a>1. 按访问权限分类</h3><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>应用场景</th>
<th>代表项目</th>
</tr>
</thead>
<tbody><tr>
<td><strong>公有链</strong></td>
<td>完全去中心化，任何人可参与</td>
<td>数字货币、DeFi</td>
<td>Bitcoin、Ethereum</td>
</tr>
<tr>
<td><strong>私有链</strong></td>
<td>由单一组织控制</td>
<td>企业内部应用</td>
<td>Hyperledger Fabric</td>
</tr>
<tr>
<td><strong>联盟链</strong></td>
<td>由多个组织共同维护</td>
<td>行业联盟、供应链</td>
<td>R3 Corda</td>
</tr>
<tr>
<td><strong>混合链</strong></td>
<td>结合公有链和私有链特点</td>
<td>企业级应用</td>
<td>各种企业解决方案</td>
</tr>
</tbody></table>
<h3 id="2-按技术架构分类"><a href="#2-按技术架构分类" class="headerlink" title="2. 按技术架构分类"></a>2. 按技术架构分类</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不同共识机制的简单实现示例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsensusAlgorithm</span>:</span><br><span class="line">    <span class="string">"""共识算法基类"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_block</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProofOfWork</span>(<span class="title class_ inherited__">ConsensusAlgorithm</span>):</span><br><span class="line">    <span class="string">"""工作量证明"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, difficulty=<span class="number">4</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">"Proof of Work"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.difficulty = difficulty</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_block</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="string">"""验证工作量证明"""</span></span><br><span class="line">        target = <span class="string">"0"</span> * <span class="variable language_">self</span>.difficulty</span><br><span class="line">        <span class="keyword">return</span> block.<span class="built_in">hash</span>.startswith(target)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mine_block</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="string">"""挖矿过程"""</span></span><br><span class="line">        block.mine_block(<span class="variable language_">self</span>.difficulty)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProofOfStake</span>(<span class="title class_ inherited__">ConsensusAlgorithm</span>):</span><br><span class="line">    <span class="string">"""权益证明"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">"Proof of Stake"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.validators = {}  <span class="comment"># 验证者及其权益</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_validator</span>(<span class="params">self, address, stake</span>):</span><br><span class="line">        <span class="string">"""添加验证者"""</span></span><br><span class="line">        <span class="variable language_">self</span>.validators[address] = stake</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_validator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""根据权益选择验证者"""</span></span><br><span class="line">        total_stake = <span class="built_in">sum</span>(<span class="variable language_">self</span>.validators.values())</span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        random_point = random.uniform(<span class="number">0</span>, total_stake)</span><br><span class="line">        </span><br><span class="line">        current_stake = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> validator, stake <span class="keyword">in</span> <span class="variable language_">self</span>.validators.items():</span><br><span class="line">            current_stake += stake</span><br><span class="line">            <span class="keyword">if</span> current_stake &gt;= random_point:</span><br><span class="line">                <span class="keyword">return</span> validator</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">pow_consensus = ProofOfWork(difficulty=<span class="number">3</span>)</span><br><span class="line">pos_consensus = ProofOfStake()</span><br><span class="line">pos_consensus.add_validator(<span class="string">"validator1"</span>, <span class="number">1000</span>)</span><br><span class="line">pos_consensus.add_validator(<span class="string">"validator2"</span>, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">selected_validator = pos_consensus.select_validator()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"选中的验证者: <span class="subst">{selected_validator}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="二、区块链核心技术"><a href="#二、区块链核心技术" class="headerlink" title="二、区块链核心技术"></a>二、区块链核心技术</h1><h2 id="（一）密码学基础"><a href="#（一）密码学基础" class="headerlink" title="（一）密码学基础"></a>（一）密码学基础</h2><h3 id="1-哈希函数"><a href="#1-哈希函数" class="headerlink" title="1. 哈希函数"></a>1. 哈希函数</h3><p>哈希函数是区块链的基础，它将任意长度的输入转换为固定长度的输出，具有单向性和雪崩效应。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CryptographicUtils</span>:</span><br><span class="line">    <span class="string">"""密码学工具类"""</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sha256_hash</span>(<span class="params">data</span>):</span><br><span class="line">        <span class="string">"""SHA-256哈希"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">            data = data.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="keyword">return</span> hashlib.sha256(data).hexdigest()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">merkle_root</span>(<span class="params">transactions</span>):</span><br><span class="line">        <span class="string">"""计算默克尔树根"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> transactions:</span><br><span class="line">            <span class="keyword">return</span> CryptographicUtils.sha256_hash(<span class="string">""</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果交易数量为奇数，复制最后一个</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(transactions) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            transactions.append(transactions[-<span class="number">1</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 递归计算默克尔树</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(transactions) &gt; <span class="number">1</span>:</span><br><span class="line">            next_level = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(transactions), <span class="number">2</span>):</span><br><span class="line">                combined = transactions[i] + transactions[i + <span class="number">1</span>]</span><br><span class="line">                next_level.append(CryptographicUtils.sha256_hash(combined))</span><br><span class="line">            transactions = next_level</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> transactions[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hmac_signature</span>(<span class="params">key, message</span>):</span><br><span class="line">        <span class="string">"""HMAC签名"""</span></span><br><span class="line">        <span class="keyword">return</span> hmac.new(</span><br><span class="line">            key.encode(<span class="string">'utf-8'</span>),</span><br><span class="line">            message.encode(<span class="string">'utf-8'</span>),</span><br><span class="line">            hashlib.sha256</span><br><span class="line">        ).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例：默克尔树计算</span></span><br><span class="line">transactions = [</span><br><span class="line">    <span class="string">"tx1: Alice -&gt; Bob: 10 BTC"</span>,</span><br><span class="line">    <span class="string">"tx2: Bob -&gt; Charlie: 5 BTC"</span>,</span><br><span class="line">    <span class="string">"tx3: Charlie -&gt; David: 3 BTC"</span>,</span><br><span class="line">    <span class="string">"tx4: David -&gt; Eve: 2 BTC"</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">merkle_root = CryptographicUtils.merkle_root(transactions)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"默克尔树根: <span class="subst">{merkle_root}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证数据完整性</span></span><br><span class="line">original_hash = CryptographicUtils.sha256_hash(<span class="string">"重要数据"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"原始数据哈希: <span class="subst">{original_hash}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据被篡改后</span></span><br><span class="line">tampered_hash = CryptographicUtils.sha256_hash(<span class="string">"被篡改的数据"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"篡改后哈希: <span class="subst">{tampered_hash}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"数据是否被篡改: <span class="subst">{original_hash != tampered_hash}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-数字签名"><a href="#2-数字签名" class="headerlink" title="2. 数字签名"></a>2. 数字签名</h3><p>数字签名确保交易的真实性和不可否认性。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> hashes, serialization</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.asymmetric <span class="keyword">import</span> rsa, padding</span><br><span class="line"><span class="keyword">from</span> cryptography.exceptions <span class="keyword">import</span> InvalidSignature</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DigitalSignature</span>:</span><br><span class="line">    <span class="string">"""数字签名类"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.private_key = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.public_key = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_key_pair</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""生成密钥对"""</span></span><br><span class="line">        <span class="variable language_">self</span>.private_key = rsa.generate_private_key(</span><br><span class="line">            public_exponent=<span class="number">65537</span>,</span><br><span class="line">            key_size=<span class="number">2048</span></span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.public_key = <span class="variable language_">self</span>.private_key.public_key()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.private_key, <span class="variable language_">self</span>.public_key</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign_message</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">"""签名消息"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.private_key:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"请先生成密钥对"</span>)</span><br><span class="line">        </span><br><span class="line">        message_bytes = message.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">        signature = <span class="variable language_">self</span>.private_key.sign(</span><br><span class="line">            message_bytes,</span><br><span class="line">            padding.PSS(</span><br><span class="line">                mgf=padding.MGF1(hashes.SHA256()),</span><br><span class="line">                salt_length=padding.PSS.MAX_LENGTH</span><br><span class="line">            ),</span><br><span class="line">            hashes.SHA256()</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(signature).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_signature</span>(<span class="params">self, message, signature, public_key=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""验证签名"""</span></span><br><span class="line">        <span class="keyword">if</span> public_key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            public_key = <span class="variable language_">self</span>.public_key</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            message_bytes = message.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            signature_bytes = base64.b64decode(signature.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">            </span><br><span class="line">            public_key.verify(</span><br><span class="line">                signature_bytes,</span><br><span class="line">                message_bytes,</span><br><span class="line">                padding.PSS(</span><br><span class="line">                    mgf=padding.MGF1(hashes.SHA256()),</span><br><span class="line">                    salt_length=padding.PSS.MAX_LENGTH</span><br><span class="line">                ),</span><br><span class="line">                hashes.SHA256()</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> InvalidSignature:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">export_public_key</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""导出公钥"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.public_key:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"请先生成密钥对"</span>)</span><br><span class="line">        </span><br><span class="line">        pem = <span class="variable language_">self</span>.public_key.serialize(</span><br><span class="line">            encoding=serialization.Encoding.PEM,</span><br><span class="line">            <span class="built_in">format</span>=serialization.PublicFormat.SubjectPublicKeyInfo</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> pem.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">signer = DigitalSignature()</span><br><span class="line">private_key, public_key = signer.generate_key_pair()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 签名交易</span></span><br><span class="line">transaction = <span class="string">"Alice向Bob转账10个比特币"</span></span><br><span class="line">signature = signer.sign_message(transaction)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"交易签名: <span class="subst">{signature[:<span class="number">50</span>]}</span>..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证签名</span></span><br><span class="line">is_valid = signer.verify_signature(transaction, signature)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"签名验证结果: <span class="subst">{is_valid}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出公钥</span></span><br><span class="line">public_key_pem = signer.export_public_key()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"公钥 (前100字符): <span class="subst">{public_key_pem[:<span class="number">100</span>]}</span>..."</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）共识机制详解"><a href="#（二）共识机制详解" class="headerlink" title="（二）共识机制详解"></a>（二）共识机制详解</h2><h3 id="1-工作量证明-Proof-of-Work"><a href="#1-工作量证明-Proof-of-Work" class="headerlink" title="1. 工作量证明 (Proof of Work)"></a>1. 工作量证明 (Proof of Work)</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProofOfWorkMiner</span>:</span><br><span class="line">    <span class="string">"""工作量证明挖矿器"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, difficulty=<span class="number">4</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.difficulty = difficulty</span><br><span class="line">        <span class="variable language_">self</span>.target = <span class="string">"0"</span> * difficulty</span><br><span class="line">        <span class="variable language_">self</span>.mining = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.solution_found = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mine_block_single_thread</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="string">"""单线程挖矿"""</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        attempts = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> block.<span class="built_in">hash</span>.startswith(<span class="variable language_">self</span>.target):</span><br><span class="line">            block.nonce += <span class="number">1</span></span><br><span class="line">            block.<span class="built_in">hash</span> = block.calculate_hash()</span><br><span class="line">            attempts += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> attempts % <span class="number">100000</span> == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"尝试次数: <span class="subst">{attempts}</span>, 当前哈希: <span class="subst">{block.<span class="built_in">hash</span>[:<span class="number">20</span>]}</span>..."</span>)</span><br><span class="line">        </span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"挖矿成功! 耗时: <span class="subst">{end_time - start_time:<span class="number">.2</span>f}</span>秒"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"总尝试次数: <span class="subst">{attempts}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"最终哈希: <span class="subst">{block.<span class="built_in">hash</span>}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"随机数: <span class="subst">{block.nonce}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mine_worker</span>(<span class="params">self, block, start_nonce, step, result_container</span>):</span><br><span class="line">        <span class="string">"""多线程挖矿工作函数"""</span></span><br><span class="line">        local_block = Block(</span><br><span class="line">            block.index,</span><br><span class="line">            block.transactions,</span><br><span class="line">            block.timestamp,</span><br><span class="line">            block.previous_hash,</span><br><span class="line">            start_nonce</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        attempts = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="variable language_">self</span>.mining <span class="keyword">and</span> <span class="keyword">not</span> <span class="variable language_">self</span>.solution_found:</span><br><span class="line">            local_block.nonce += step</span><br><span class="line">            local_block.<span class="built_in">hash</span> = local_block.calculate_hash()</span><br><span class="line">            attempts += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> local_block.<span class="built_in">hash</span>.startswith(<span class="variable language_">self</span>.target):</span><br><span class="line">                <span class="variable language_">self</span>.solution_found = <span class="literal">True</span></span><br><span class="line">                result_container[<span class="string">'block'</span>] = local_block</span><br><span class="line">                result_container[<span class="string">'attempts'</span>] = attempts</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mine_block_multi_thread</span>(<span class="params">self, block, num_threads=<span class="number">4</span></span>):</span><br><span class="line">        <span class="string">"""多线程挖矿"""</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        <span class="variable language_">self</span>.mining = <span class="literal">True</span></span><br><span class="line">        <span class="variable language_">self</span>.solution_found = <span class="literal">False</span></span><br><span class="line">        result_container = {}</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> ThreadPoolExecutor(max_workers=num_threads) <span class="keyword">as</span> executor:</span><br><span class="line">            futures = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_threads):</span><br><span class="line">                future = executor.submit(</span><br><span class="line">                    <span class="variable language_">self</span>.mine_worker,</span><br><span class="line">                    block,</span><br><span class="line">                    i,  <span class="comment"># 起始随机数</span></span><br><span class="line">                    num_threads,  <span class="comment"># 步长</span></span><br><span class="line">                    result_container</span><br><span class="line">                )</span><br><span class="line">                futures.append(future)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 等待任一线程找到解</span></span><br><span class="line">            <span class="keyword">while</span> <span class="variable language_">self</span>.mining <span class="keyword">and</span> <span class="keyword">not</span> <span class="variable language_">self</span>.solution_found:</span><br><span class="line">                time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.mining = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        end_time = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">'block'</span> <span class="keyword">in</span> result_container:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"多线程挖矿成功! 耗时: <span class="subst">{end_time - start_time:<span class="number">.2</span>f}</span>秒"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"使用线程数: <span class="subst">{num_threads}</span>"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"最终哈希: <span class="subst">{result_container[<span class="string">'block'</span>].<span class="built_in">hash</span>}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> result_container[<span class="string">'block'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"挖矿失败"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 挖矿难度对比测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mining_difficulty_comparison</span>():</span><br><span class="line">    <span class="string">"""挖矿难度对比"""</span></span><br><span class="line">    difficulties = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> difficulty <span class="keyword">in</span> difficulties:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"\n=== 难度 <span class="subst">{difficulty}</span> 挖矿测试 ==="</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建测试区块</span></span><br><span class="line">        test_block = Block(</span><br><span class="line">            <span class="number">1</span>,</span><br><span class="line">            [<span class="string">"测试交易1"</span>, <span class="string">"测试交易2"</span>],</span><br><span class="line">            datetime.now(),</span><br><span class="line">            <span class="string">"0000abc123"</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        miner = ProofOfWorkMiner(difficulty)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 单线程挖矿</span></span><br><span class="line">        mined_block = miner.mine_block_single_thread(test_block)</span><br><span class="line">        </span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"难度 <span class="subst">{difficulty}</span> 挖矿耗时: <span class="subst">{end_time - start_time:<span class="number">.2</span>f}</span>秒"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"目标前缀: <span class="subst">{<span class="string">'0'</span> * difficulty}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"实际哈希: <span class="subst">{mined_block.<span class="built_in">hash</span>}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行挖矿测试</span></span><br><span class="line"><span class="comment"># mining_difficulty_comparison()</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-权益证明-Proof-of-Stake"><a href="#2-权益证明-Proof-of-Stake" class="headerlink" title="2. 权益证明 (Proof of Stake)"></a>2. 权益证明 (Proof of Stake)</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProofOfStakeValidator</span>:</span><br><span class="line">    <span class="string">"""权益证明验证者"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address, stake, reputation=<span class="number">1.0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.address = address</span><br><span class="line">        <span class="variable language_">self</span>.stake = stake</span><br><span class="line">        <span class="variable language_">self</span>.reputation = reputation</span><br><span class="line">        <span class="variable language_">self</span>.blocks_validated = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.rewards_earned = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.last_validation_time = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_selection_weight</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""计算选择权重"""</span></span><br><span class="line">        <span class="comment"># 权重 = 权益 × 声誉 × 时间因子</span></span><br><span class="line">        time_factor = <span class="built_in">min</span>(time.time() - <span class="variable language_">self</span>.last_validation_time, <span class="number">3600</span>) / <span class="number">3600</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.stake * <span class="variable language_">self</span>.reputation * (<span class="number">1</span> + time_factor)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_block</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="string">"""验证区块"""</span></span><br><span class="line">        <span class="comment"># 简化的验证逻辑</span></span><br><span class="line">        is_valid = <span class="literal">True</span>  <span class="comment"># 实际应包含复杂的验证逻辑</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> is_valid:</span><br><span class="line">            <span class="variable language_">self</span>.blocks_validated += <span class="number">1</span></span><br><span class="line">            <span class="variable language_">self</span>.last_validation_time = time.time()</span><br><span class="line">            reward = <span class="variable language_">self</span>.calculate_reward(block)</span><br><span class="line">            <span class="variable language_">self</span>.rewards_earned += reward</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_reward</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="string">"""计算验证奖励"""</span></span><br><span class="line">        base_reward = <span class="number">1.0</span></span><br><span class="line">        stake_bonus = <span class="variable language_">self</span>.stake * <span class="number">0.001</span></span><br><span class="line">        <span class="keyword">return</span> base_reward + stake_bonus</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProofOfStakeConsensus</span>:</span><br><span class="line">    <span class="string">"""权益证明共识机制"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.validators = {}</span><br><span class="line">        <span class="variable language_">self</span>.minimum_stake = <span class="number">32</span>  <span class="comment"># 最小权益要求</span></span><br><span class="line">        <span class="variable language_">self</span>.slashing_penalty = <span class="number">0.1</span>  <span class="comment"># 惩罚比例</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_validator</span>(<span class="params">self, address, stake, reputation=<span class="number">1.0</span></span>):</span><br><span class="line">        <span class="string">"""添加验证者"""</span></span><br><span class="line">        <span class="keyword">if</span> stake &lt; <span class="variable language_">self</span>.minimum_stake:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"权益不足，最小要求: <span class="subst">{self.minimum_stake}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        validator = ProofOfStakeValidator(address, stake, reputation)</span><br><span class="line">        <span class="variable language_">self</span>.validators[address] = validator</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"验证者 <span class="subst">{address}</span> 已加入，权益: <span class="subst">{stake}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_validator</span>(<span class="params">self, exclude=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""选择验证者"""</span></span><br><span class="line">        <span class="keyword">if</span> exclude <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            exclude = <span class="built_in">set</span>()</span><br><span class="line">        </span><br><span class="line">        available_validators = {</span><br><span class="line">            addr: validator <span class="keyword">for</span> addr, validator <span class="keyword">in</span> <span class="variable language_">self</span>.validators.items()</span><br><span class="line">            <span class="keyword">if</span> addr <span class="keyword">not</span> <span class="keyword">in</span> exclude <span class="keyword">and</span> validator.stake &gt;= <span class="variable language_">self</span>.minimum_stake</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> available_validators:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算总权重</span></span><br><span class="line">        total_weight = <span class="built_in">sum</span>(</span><br><span class="line">            validator.calculate_selection_weight()</span><br><span class="line">            <span class="keyword">for</span> validator <span class="keyword">in</span> available_validators.values()</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 随机选择</span></span><br><span class="line">        random_point = random.uniform(<span class="number">0</span>, total_weight)</span><br><span class="line">        current_weight = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> address, validator <span class="keyword">in</span> available_validators.items():</span><br><span class="line">            current_weight += validator.calculate_selection_weight()</span><br><span class="line">            <span class="keyword">if</span> current_weight &gt;= random_point:</span><br><span class="line">                <span class="keyword">return</span> address</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_block_pos</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="string">"""权益证明区块验证"""</span></span><br><span class="line">        <span class="comment"># 选择主验证者</span></span><br><span class="line">        primary_validator_addr = <span class="variable language_">self</span>.select_validator()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> primary_validator_addr:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"没有可用的验证者"</span></span><br><span class="line">        </span><br><span class="line">        primary_validator = <span class="variable language_">self</span>.validators[primary_validator_addr]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 主验证者验证区块</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> primary_validator.validate_block(block):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"主验证者验证失败"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 选择额外验证者进行确认</span></span><br><span class="line">        confirmations = <span class="number">0</span></span><br><span class="line">        required_confirmations = <span class="built_in">min</span>(<span class="number">3</span>, <span class="built_in">len</span>(<span class="variable language_">self</span>.validators) - <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(required_confirmations):</span><br><span class="line">            confirmer_addr = <span class="variable language_">self</span>.select_validator(exclude={primary_validator_addr})</span><br><span class="line">            <span class="keyword">if</span> confirmer_addr:</span><br><span class="line">                confirmer = <span class="variable language_">self</span>.validators[confirmer_addr]</span><br><span class="line">                <span class="keyword">if</span> confirmer.validate_block(block):</span><br><span class="line">                    confirmations += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        success = confirmations &gt;= required_confirmations * <span class="number">0.67</span>  <span class="comment"># 2/3多数</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> success:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">f"区块验证成功，确认数: <span class="subst">{confirmations}</span>/<span class="subst">{required_confirmations}</span>"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 惩罚恶意验证者</span></span><br><span class="line">            <span class="variable language_">self</span>.slash_validator(primary_validator_addr)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"验证失败，验证者被惩罚"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">slash_validator</span>(<span class="params">self, validator_address</span>):</span><br><span class="line">        <span class="string">"""惩罚恶意验证者"""</span></span><br><span class="line">        <span class="keyword">if</span> validator_address <span class="keyword">in</span> <span class="variable language_">self</span>.validators:</span><br><span class="line">            validator = <span class="variable language_">self</span>.validators[validator_address]</span><br><span class="line">            penalty = validator.stake * <span class="variable language_">self</span>.slashing_penalty</span><br><span class="line">            validator.stake -= penalty</span><br><span class="line">            validator.reputation *= <span class="number">0.9</span>  <span class="comment"># 降低声誉</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"验证者 <span class="subst">{validator_address}</span> 被惩罚，扣除权益: <span class="subst">{penalty}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_validator_stats</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取验证者统计信息"""</span></span><br><span class="line">        stats = []</span><br><span class="line">        <span class="keyword">for</span> addr, validator <span class="keyword">in</span> <span class="variable language_">self</span>.validators.items():</span><br><span class="line">            stats.append({</span><br><span class="line">                <span class="string">"地址"</span>: addr,</span><br><span class="line">                <span class="string">"权益"</span>: validator.stake,</span><br><span class="line">                <span class="string">"声誉"</span>: validator.reputation,</span><br><span class="line">                <span class="string">"验证区块数"</span>: validator.blocks_validated,</span><br><span class="line">                <span class="string">"获得奖励"</span>: validator.rewards_earned,</span><br><span class="line">                <span class="string">"选择权重"</span>: validator.calculate_selection_weight()</span><br><span class="line">            })</span><br><span class="line">        <span class="keyword">return</span> stats</span><br><span class="line"></span><br><span class="line"><span class="comment"># 权益证明演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_proof_of_stake</span>():</span><br><span class="line">    <span class="string">"""演示权益证明"""</span></span><br><span class="line">    pos_consensus = ProofOfStakeConsensus()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加验证者</span></span><br><span class="line">    validators_data = [</span><br><span class="line">        (<span class="string">"validator_1"</span>, <span class="number">100</span>, <span class="number">1.0</span>),</span><br><span class="line">        (<span class="string">"validator_2"</span>, <span class="number">200</span>, <span class="number">1.2</span>),</span><br><span class="line">        (<span class="string">"validator_3"</span>, <span class="number">150</span>, <span class="number">0.9</span>),</span><br><span class="line">        (<span class="string">"validator_4"</span>, <span class="number">300</span>, <span class="number">1.1</span>),</span><br><span class="line">        (<span class="string">"validator_5"</span>, <span class="number">50</span>, <span class="number">0.8</span>)</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> addr, stake, reputation <span class="keyword">in</span> validators_data:</span><br><span class="line">        pos_consensus.add_validator(addr, stake, reputation)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 验证者初始状态 ==="</span>)</span><br><span class="line">    <span class="keyword">for</span> stat <span class="keyword">in</span> pos_consensus.get_validator_stats():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{stat[<span class="string">'地址'</span>]}</span>: 权益=<span class="subst">{stat[<span class="string">'权益'</span>]}</span>, 声誉=<span class="subst">{stat[<span class="string">'声誉'</span>]:<span class="number">.2</span>f}</span>, 权重=<span class="subst">{stat[<span class="string">'选择权重'</span>]:<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟区块验证</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 模拟区块验证 ==="</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        test_block = Block(</span><br><span class="line">            i + <span class="number">1</span>,</span><br><span class="line">            [<span class="string">f"交易<span class="subst">{i*<span class="number">2</span>+<span class="number">1</span>}</span>"</span>, <span class="string">f"交易<span class="subst">{i*<span class="number">2</span>+<span class="number">2</span>}</span>"</span>],</span><br><span class="line">            datetime.now(),</span><br><span class="line">            <span class="string">f"previous_hash_<span class="subst">{i}</span>"</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        success, message = pos_consensus.validate_block_pos(test_block)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"区块 <span class="subst">{i+<span class="number">1</span>}</span>: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== 验证者最终状态 ==="</span>)</span><br><span class="line">    <span class="keyword">for</span> stat <span class="keyword">in</span> pos_consensus.get_validator_stats():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{stat[<span class="string">'地址'</span>]}</span>: 验证=<span class="subst">{stat[<span class="string">'验证区块数'</span>]}</span>, 奖励=<span class="subst">{stat[<span class="string">'获得奖励'</span>]:<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行演示</span></span><br><span class="line"><span class="comment"># demonstrate_proof_of_stake()</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="三、智能合约技术"><a href="#三、智能合约技术" class="headerlink" title="三、智能合约技术"></a>三、智能合约技术</h1><h2 id="（一）智能合约基础"><a href="#（一）智能合约基础" class="headerlink" title="（一）智能合约基础"></a>（一）智能合约基础</h2><p>智能合约是运行在区块链上的自动执行程序，它能够在满足预定条件时自动执行合约条款。</p>
<h3 id="1-简单智能合约实现"><a href="#1-简单智能合约实现" class="headerlink" title="1. 简单智能合约实现"></a>1. 简单智能合约实现</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContractState</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">"""合约状态枚举"""</span></span><br><span class="line">    CREATED = <span class="string">"created"</span></span><br><span class="line">    ACTIVE = <span class="string">"active"</span></span><br><span class="line">    COMPLETED = <span class="string">"completed"</span></span><br><span class="line">    CANCELLED = <span class="string">"cancelled"</span></span><br><span class="line">    EXPIRED = <span class="string">"expired"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartContract</span>:</span><br><span class="line">    <span class="string">"""智能合约基类"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, contract_id, creator, participants</span>):</span><br><span class="line">        <span class="variable language_">self</span>.contract_id = contract_id</span><br><span class="line">        <span class="variable language_">self</span>.creator = creator</span><br><span class="line">        <span class="variable language_">self</span>.participants = participants</span><br><span class="line">        <span class="variable language_">self</span>.state = ContractState.CREATED</span><br><span class="line">        <span class="variable language_">self</span>.created_at = datetime.now()</span><br><span class="line">        <span class="variable language_">self</span>.conditions = []</span><br><span class="line">        <span class="variable language_">self</span>.actions = []</span><br><span class="line">        <span class="variable language_">self</span>.events = []</span><br><span class="line">        <span class="variable language_">self</span>.storage = {}</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_condition</span>(<span class="params">self, condition_func, description</span>):</span><br><span class="line">        <span class="string">"""添加执行条件"""</span></span><br><span class="line">        <span class="variable language_">self</span>.conditions.append({</span><br><span class="line">            <span class="string">"function"</span>: condition_func,</span><br><span class="line">            <span class="string">"description"</span>: description</span><br><span class="line">        })</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_action</span>(<span class="params">self, action_func, description</span>):</span><br><span class="line">        <span class="string">"""添加执行动作"""</span></span><br><span class="line">        <span class="variable language_">self</span>.actions.append({</span><br><span class="line">            <span class="string">"function"</span>: action_func,</span><br><span class="line">            <span class="string">"description"</span>: description</span><br><span class="line">        })</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_conditions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""检查所有条件是否满足"""</span></span><br><span class="line">        <span class="keyword">for</span> condition <span class="keyword">in</span> <span class="variable language_">self</span>.conditions:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> condition[<span class="string">"function"</span>]():</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, condition[<span class="string">"description"</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"所有条件已满足"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""执行合约"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.state != ContractState.ACTIVE:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"合约未激活"</span></span><br><span class="line">        </span><br><span class="line">        conditions_met, message = <span class="variable language_">self</span>.check_conditions()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> conditions_met:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f"条件未满足: <span class="subst">{message}</span>"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 执行所有动作</span></span><br><span class="line">        <span class="keyword">for</span> action <span class="keyword">in</span> <span class="variable language_">self</span>.actions:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = action[<span class="string">"function"</span>]()</span><br><span class="line">                <span class="variable language_">self</span>.log_event(<span class="string">f"执行动作: <span class="subst">{action[<span class="string">'description'</span>]}</span>, 结果: <span class="subst">{result}</span>"</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="variable language_">self</span>.log_event(<span class="string">f"动作执行失败: <span class="subst">{action[<span class="string">'description'</span>]}</span>, 错误: <span class="subst">{<span class="built_in">str</span>(e)}</span>"</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f"动作执行失败: <span class="subst">{<span class="built_in">str</span>(e)}</span>"</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.state = ContractState.COMPLETED</span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">"合约执行完成"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"合约执行成功"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">activate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""激活合约"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.state == ContractState.CREATED:</span><br><span class="line">            <span class="variable language_">self</span>.state = ContractState.ACTIVE</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">"合约已激活"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cancel</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""取消合约"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.state <span class="keyword">in</span> [ContractState.CREATED, ContractState.ACTIVE]:</span><br><span class="line">            <span class="variable language_">self</span>.state = ContractState.CANCELLED</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">"合约已取消"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_event</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">"""记录事件"""</span></span><br><span class="line">        event = {</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now(),</span><br><span class="line">            <span class="string">"message"</span>: message</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">self</span>.events.append(event)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[<span class="subst">{event[<span class="string">'timestamp'</span>]}</span>] <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_status</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取合约状态"""</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"contract_id"</span>: <span class="variable language_">self</span>.contract_id,</span><br><span class="line">            <span class="string">"state"</span>: <span class="variable language_">self</span>.state.value,</span><br><span class="line">            <span class="string">"creator"</span>: <span class="variable language_">self</span>.creator,</span><br><span class="line">            <span class="string">"participants"</span>: <span class="variable language_">self</span>.participants,</span><br><span class="line">            <span class="string">"created_at"</span>: <span class="variable language_">self</span>.created_at,</span><br><span class="line">            <span class="string">"events_count"</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>.events),</span><br><span class="line">            <span class="string">"storage"</span>: <span class="variable language_">self</span>.storage</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EscrowContract</span>(<span class="title class_ inherited__">SmartContract</span>):</span><br><span class="line">    <span class="string">"""托管合约示例"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, contract_id, buyer, seller, amount, escrow_agent</span>):</span><br><span class="line">        participants = [buyer, seller, escrow_agent]</span><br><span class="line">        <span class="built_in">super</span>().__init__(contract_id, buyer, participants)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.buyer = buyer</span><br><span class="line">        <span class="variable language_">self</span>.seller = seller</span><br><span class="line">        <span class="variable language_">self</span>.amount = amount</span><br><span class="line">        <span class="variable language_">self</span>.escrow_agent = escrow_agent</span><br><span class="line">        <span class="variable language_">self</span>.payment_received = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.goods_delivered = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.buyer_confirmed = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置合约条件和动作</span></span><br><span class="line">        <span class="variable language_">self</span>.setup_contract()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_contract</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""设置合约条件和动作"""</span></span><br><span class="line">        <span class="comment"># 添加执行条件</span></span><br><span class="line">        <span class="variable language_">self</span>.add_condition(</span><br><span class="line">            <span class="keyword">lambda</span>: <span class="variable language_">self</span>.payment_received,</span><br><span class="line">            <span class="string">"买方已付款"</span></span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.add_condition(</span><br><span class="line">            <span class="keyword">lambda</span>: <span class="variable language_">self</span>.goods_delivered,</span><br><span class="line">            <span class="string">"卖方已发货"</span></span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.add_condition(</span><br><span class="line">            <span class="keyword">lambda</span>: <span class="variable language_">self</span>.buyer_confirmed,</span><br><span class="line">            <span class="string">"买方已确认收货"</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 添加执行动作</span></span><br><span class="line">        <span class="variable language_">self</span>.add_action(</span><br><span class="line">            <span class="variable language_">self</span>.release_payment,</span><br><span class="line">            <span class="string">"释放托管资金给卖方"</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive_payment</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="string">"""接收买方付款"""</span></span><br><span class="line">        <span class="keyword">if</span> amount &gt;= <span class="variable language_">self</span>.amount:</span><br><span class="line">            <span class="variable language_">self</span>.payment_received = <span class="literal">True</span></span><br><span class="line">            <span class="variable language_">self</span>.storage[<span class="string">"payment_amount"</span>] = amount</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">f"收到买方付款: <span class="subst">{amount}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">confirm_delivery</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""卖方确认发货"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.payment_received:</span><br><span class="line">            <span class="variable language_">self</span>.goods_delivered = <span class="literal">True</span></span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">"卖方已确认发货"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buyer_confirm_receipt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""买方确认收货"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.goods_delivered:</span><br><span class="line">            <span class="variable language_">self</span>.buyer_confirmed = <span class="literal">True</span></span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">"买方已确认收货"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">release_payment</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""释放托管资金"""</span></span><br><span class="line">        <span class="variable language_">self</span>.storage[<span class="string">"payment_released"</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="variable language_">self</span>.storage[<span class="string">"release_time"</span>] = datetime.now()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"向卖方 <span class="subst">{self.seller}</span> 释放资金 <span class="subst">{self.amount}</span>"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispute_resolution</span>(<span class="params">self, decision</span>):</span><br><span class="line">        <span class="string">"""争议解决"""</span></span><br><span class="line">        <span class="keyword">if</span> decision == <span class="string">"buyer"</span>:</span><br><span class="line">            <span class="variable language_">self</span>.storage[<span class="string">"refund_to_buyer"</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">"争议解决：退款给买方"</span>)</span><br><span class="line">        <span class="keyword">elif</span> decision == <span class="string">"seller"</span>:</span><br><span class="line">            <span class="variable language_">self</span>.release_payment()</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">"争议解决：付款给卖方"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.state = ContractState.COMPLETED</span><br><span class="line"></span><br><span class="line"><span class="comment"># 托管合约演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_escrow_contract</span>():</span><br><span class="line">    <span class="string">"""演示托管合约"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 托管合约演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建托管合约</span></span><br><span class="line">    escrow = EscrowContract(</span><br><span class="line">        contract_id=<span class="string">"ESC001"</span>,</span><br><span class="line">        buyer=<span class="string">"Alice"</span>,</span><br><span class="line">        seller=<span class="string">"Bob"</span>,</span><br><span class="line">        amount=<span class="number">1000</span>,</span><br><span class="line">        escrow_agent=<span class="string">"EscrowService"</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 激活合约</span></span><br><span class="line">    escrow.activate()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 买方付款"</span>)</span><br><span class="line">    escrow.receive_payment(<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. 卖方发货"</span>)</span><br><span class="line">    escrow.confirm_delivery()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. 买方确认收货"</span>)</span><br><span class="line">    escrow.buyer_confirm_receipt()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n4. 执行合约"</span>)</span><br><span class="line">    success, message = escrow.execute()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"执行结果: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n5. 合约状态"</span>)</span><br><span class="line">    status = escrow.get_status()</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> status.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{key}</span>: <span class="subst">{value}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行演示</span></span><br><span class="line"><span class="comment"># demonstrate_escrow_contract()</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-去中心化自治组织-DAO-合约"><a href="#2-去中心化自治组织-DAO-合约" class="headerlink" title="2. 去中心化自治组织 (DAO) 合约"></a>2. 去中心化自治组织 (DAO) 合约</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Proposal</span>:</span><br><span class="line">    <span class="string">"""提案类"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, proposal_id, title, description, proposer, voting_period_days=<span class="number">7</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.proposal_id = proposal_id</span><br><span class="line">        <span class="variable language_">self</span>.title = title</span><br><span class="line">        <span class="variable language_">self</span>.description = description</span><br><span class="line">        <span class="variable language_">self</span>.proposer = proposer</span><br><span class="line">        <span class="variable language_">self</span>.created_at = datetime.now()</span><br><span class="line">        <span class="variable language_">self</span>.voting_deadline = <span class="variable language_">self</span>.created_at + timedelta(days=voting_period_days)</span><br><span class="line">        <span class="variable language_">self</span>.votes_for = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.votes_against = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.voters = <span class="built_in">set</span>()</span><br><span class="line">        <span class="variable language_">self</span>.executed = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.passed = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DAOContract</span>(<span class="title class_ inherited__">SmartContract</span>):</span><br><span class="line">    <span class="string">"""去中心化自治组织合约"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, contract_id, name, token_supply=<span class="number">1000000</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(contract_id, <span class="string">"DAO_Creator"</span>, [])</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.token_supply = token_supply</span><br><span class="line">        <span class="variable language_">self</span>.token_balances = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">        <span class="variable language_">self</span>.members = <span class="built_in">set</span>()</span><br><span class="line">        <span class="variable language_">self</span>.proposals = {}</span><br><span class="line">        <span class="variable language_">self</span>.minimum_quorum = <span class="number">0.1</span>  <span class="comment"># 10%最小参与率</span></span><br><span class="line">        <span class="variable language_">self</span>.minimum_majority = <span class="number">0.6</span>  <span class="comment"># 60%多数通过</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># DAO治理参数</span></span><br><span class="line">        <span class="variable language_">self</span>.governance_params = {</span><br><span class="line">            <span class="string">"proposal_threshold"</span>: <span class="number">1000</span>,  <span class="comment"># 提案所需最小代币数</span></span><br><span class="line">            <span class="string">"voting_period"</span>: <span class="number">7</span>,  <span class="comment"># 投票期限（天）</span></span><br><span class="line">            <span class="string">"execution_delay"</span>: <span class="number">1</span>,  <span class="comment"># 执行延迟（天）</span></span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mint_tokens</span>(<span class="params">self, recipient, amount</span>):</span><br><span class="line">        <span class="string">"""铸造代币"""</span></span><br><span class="line">        <span class="keyword">if</span> amount &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"铸造数量必须大于0"</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.token_balances[recipient] += amount</span><br><span class="line">        <span class="variable language_">self</span>.members.add(recipient)</span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"为 <span class="subst">{recipient}</span> 铸造 <span class="subst">{amount}</span> 代币"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">f"成功铸造 <span class="subst">{amount}</span> 代币"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer_tokens</span>(<span class="params">self, from_addr, to_addr, amount</span>):</span><br><span class="line">        <span class="string">"""转移代币"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.token_balances[from_addr] &lt; amount:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"余额不足"</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.token_balances[from_addr] -= amount</span><br><span class="line">        <span class="variable language_">self</span>.token_balances[to_addr] += amount</span><br><span class="line">        <span class="variable language_">self</span>.members.add(to_addr)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"<span class="subst">{from_addr}</span> 向 <span class="subst">{to_addr}</span> 转移 <span class="subst">{amount}</span> 代币"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"转移成功"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_proposal</span>(<span class="params">self, proposer, title, description</span>):</span><br><span class="line">        <span class="string">"""创建提案"""</span></span><br><span class="line">        <span class="comment"># 检查提案者是否有足够代币</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.token_balances[proposer] &lt; <span class="variable language_">self</span>.governance_params[<span class="string">"proposal_threshold"</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">f"提案需要至少 <span class="subst">{self.governance_params[<span class="string">'proposal_threshold'</span>]}</span> 代币"</span></span><br><span class="line">        </span><br><span class="line">        proposal_id = <span class="built_in">str</span>(uuid.uuid4())[:<span class="number">8</span>]</span><br><span class="line">        proposal = Proposal(</span><br><span class="line">            proposal_id,</span><br><span class="line">            title,</span><br><span class="line">            description,</span><br><span class="line">            proposer,</span><br><span class="line">            <span class="variable language_">self</span>.governance_params[<span class="string">"voting_period"</span>]</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.proposals[proposal_id] = proposal</span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"创建提案 <span class="subst">{proposal_id}</span>: <span class="subst">{title}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, proposal_id</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">vote</span>(<span class="params">self, voter, proposal_id, support</span>):</span><br><span class="line">        <span class="string">"""投票"""</span></span><br><span class="line">        <span class="keyword">if</span> proposal_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.proposals:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"提案不存在"</span></span><br><span class="line">        </span><br><span class="line">        proposal = <span class="variable language_">self</span>.proposals[proposal_id]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查投票期限</span></span><br><span class="line">        <span class="keyword">if</span> datetime.now() &gt; proposal.voting_deadline:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"投票期限已过"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否已投票</span></span><br><span class="line">        <span class="keyword">if</span> voter <span class="keyword">in</span> proposal.voters:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"已经投过票"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查投票权重（基于代币余额）</span></span><br><span class="line">        voting_power = <span class="variable language_">self</span>.token_balances[voter]</span><br><span class="line">        <span class="keyword">if</span> voting_power &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"没有投票权"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录投票</span></span><br><span class="line">        proposal.voters.add(voter)</span><br><span class="line">        <span class="keyword">if</span> support:</span><br><span class="line">            proposal.votes_for += voting_power</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            proposal.votes_against += voting_power</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"<span class="subst">{voter}</span> 对提案 <span class="subst">{proposal_id}</span> 投票: <span class="subst">{<span class="string">'支持'</span> <span class="keyword">if</span> support <span class="keyword">else</span> <span class="string">'反对'</span>}</span> (权重: <span class="subst">{voting_power}</span>)"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"投票成功"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_proposal</span>(<span class="params">self, proposal_id</span>):</span><br><span class="line">        <span class="string">"""执行提案"""</span></span><br><span class="line">        <span class="keyword">if</span> proposal_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.proposals:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"提案不存在"</span></span><br><span class="line">        </span><br><span class="line">        proposal = <span class="variable language_">self</span>.proposals[proposal_id]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否已执行</span></span><br><span class="line">        <span class="keyword">if</span> proposal.executed:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"提案已执行"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查投票是否结束</span></span><br><span class="line">        <span class="keyword">if</span> datetime.now() &lt;= proposal.voting_deadline:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"投票期限未到"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算投票结果</span></span><br><span class="line">        total_votes = proposal.votes_for + proposal.votes_against</span><br><span class="line">        total_supply = <span class="built_in">sum</span>(<span class="variable language_">self</span>.token_balances.values())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查法定人数</span></span><br><span class="line">        quorum_met = total_votes &gt;= (total_supply * <span class="variable language_">self</span>.minimum_quorum)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> quorum_met:</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">f"提案 <span class="subst">{proposal_id}</span> 未达到法定人数"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"未达到法定人数"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查多数通过</span></span><br><span class="line">        majority_met = proposal.votes_for &gt;= (total_votes * <span class="variable language_">self</span>.minimum_majority)</span><br><span class="line">        </span><br><span class="line">        proposal.executed = <span class="literal">True</span></span><br><span class="line">        proposal.passed = majority_met</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> majority_met:</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">f"提案 <span class="subst">{proposal_id}</span> 通过并执行"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"提案通过并执行"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">f"提案 <span class="subst">{proposal_id}</span> 未通过"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"提案未通过"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_proposal_status</span>(<span class="params">self, proposal_id</span>):</span><br><span class="line">        <span class="string">"""获取提案状态"""</span></span><br><span class="line">        <span class="keyword">if</span> proposal_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.proposals:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        proposal = <span class="variable language_">self</span>.proposals[proposal_id]</span><br><span class="line">        total_votes = proposal.votes_for + proposal.votes_against</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"proposal_id"</span>: proposal.proposal_id,</span><br><span class="line">            <span class="string">"title"</span>: proposal.title,</span><br><span class="line">            <span class="string">"proposer"</span>: proposal.proposer,</span><br><span class="line">            <span class="string">"created_at"</span>: proposal.created_at,</span><br><span class="line">            <span class="string">"voting_deadline"</span>: proposal.voting_deadline,</span><br><span class="line">            <span class="string">"votes_for"</span>: proposal.votes_for,</span><br><span class="line">            <span class="string">"votes_against"</span>: proposal.votes_against,</span><br><span class="line">            <span class="string">"total_votes"</span>: total_votes,</span><br><span class="line">            <span class="string">"voters_count"</span>: <span class="built_in">len</span>(proposal.voters),</span><br><span class="line">            <span class="string">"executed"</span>: proposal.executed,</span><br><span class="line">            <span class="string">"passed"</span>: proposal.passed</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_member_info</span>(<span class="params">self, member</span>):</span><br><span class="line">        <span class="string">"""获取成员信息"""</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"address"</span>: member,</span><br><span class="line">            <span class="string">"token_balance"</span>: <span class="variable language_">self</span>.token_balances[member],</span><br><span class="line">            <span class="string">"voting_power"</span>: <span class="variable language_">self</span>.token_balances[member],</span><br><span class="line">            <span class="string">"is_member"</span>: member <span class="keyword">in</span> <span class="variable language_">self</span>.members</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"><span class="comment"># DAO演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_dao</span>():</span><br><span class="line">    <span class="string">"""演示DAO功能"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== DAO (去中心化自治组织) 演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建DAO</span></span><br><span class="line">    dao = DAOContract(<span class="string">"DAO001"</span>, <span class="string">"TechDAO"</span>)</span><br><span class="line">    dao.activate()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分发代币给成员</span></span><br><span class="line">    members = [<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="string">"Charlie"</span>, <span class="string">"David"</span>, <span class="string">"Eve"</span>]</span><br><span class="line">    token_amounts = [<span class="number">5000</span>, <span class="number">3000</span>, <span class="number">2000</span>, <span class="number">1500</span>, <span class="number">1000</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 分发代币"</span>)</span><br><span class="line">    <span class="keyword">for</span> member, amount <span class="keyword">in</span> <span class="built_in">zip</span>(members, token_amounts):</span><br><span class="line">        success, message = dao.mint_tokens(member, amount)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{member}</span>: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建提案</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. 创建提案"</span>)</span><br><span class="line">    success, proposal_id = dao.create_proposal(</span><br><span class="line">        <span class="string">"Alice"</span>,</span><br><span class="line">        <span class="string">"增加开发资金"</span>,</span><br><span class="line">        <span class="string">"提议增加1000 ETH用于新功能开发"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"提案创建: <span class="subst">{proposal_id <span class="keyword">if</span> success <span class="keyword">else</span> <span class="string">'失败'</span>}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 成员投票</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. 成员投票"</span>)</span><br><span class="line">    votes = [</span><br><span class="line">        (<span class="string">"Alice"</span>, <span class="literal">True</span>),</span><br><span class="line">        (<span class="string">"Bob"</span>, <span class="literal">True</span>),</span><br><span class="line">        (<span class="string">"Charlie"</span>, <span class="literal">False</span>),</span><br><span class="line">        (<span class="string">"David"</span>, <span class="literal">True</span>),</span><br><span class="line">        (<span class="string">"Eve"</span>, <span class="literal">True</span>)</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> voter, support <span class="keyword">in</span> votes:</span><br><span class="line">        success, message = dao.vote(voter, proposal_id, support)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{voter}</span>: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 查看提案状态</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n4. 提案状态"</span>)</span><br><span class="line">    status = dao.get_proposal_status(proposal_id)</span><br><span class="line">    <span class="keyword">if</span> status:</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> status.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"<span class="subst">{key}</span>: <span class="subst">{value}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟投票期限结束，执行提案</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n5. 执行提案"</span>)</span><br><span class="line">    <span class="comment"># 手动设置投票截止时间为过去时间</span></span><br><span class="line">    dao.proposals[proposal_id].voting_deadline = datetime.now() - timedelta(hours=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    success, message = dao.execute_proposal(proposal_id)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"执行结果: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 查看最终状态</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n6. 最终提案状态"</span>)</span><br><span class="line">    final_status = dao.get_proposal_status(proposal_id)</span><br><span class="line">    <span class="keyword">if</span> final_status:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"通过状态: <span class="subst">{final_status[<span class="string">'passed'</span>]}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"支持票: <span class="subst">{final_status[<span class="string">'votes_for'</span>]}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"反对票: <span class="subst">{final_status[<span class="string">'votes_against'</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行演示</span></span><br><span class="line"><span class="comment"># demonstrate_dao()</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="四、区块链应用场景"><a href="#四、区块链应用场景" class="headerlink" title="四、区块链应用场景"></a>四、区块链应用场景</h1><h2 id="（一）数字货币系统"><a href="#（一）数字货币系统" class="headerlink" title="（一）数字货币系统"></a>（一）数字货币系统</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置精度</span></span><br><span class="line">getcontext().prec = <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Transaction</span>:</span><br><span class="line">    <span class="string">"""交易类"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, from_addr, to_addr, amount, fee=<span class="number">0</span>, data=<span class="string">""</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.tx_id = <span class="variable language_">self</span>.generate_tx_id()</span><br><span class="line">        <span class="variable language_">self</span>.from_addr = from_addr</span><br><span class="line">        <span class="variable language_">self</span>.to_addr = to_addr</span><br><span class="line">        <span class="variable language_">self</span>.amount = Decimal(<span class="built_in">str</span>(amount))</span><br><span class="line">        <span class="variable language_">self</span>.fee = Decimal(<span class="built_in">str</span>(fee))</span><br><span class="line">        <span class="variable language_">self</span>.data = data</span><br><span class="line">        <span class="variable language_">self</span>.timestamp = datetime.now()</span><br><span class="line">        <span class="variable language_">self</span>.signature = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.confirmed = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_tx_id</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""生成交易ID"""</span></span><br><span class="line">        <span class="keyword">import</span> uuid</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign_transaction</span>(<span class="params">self, private_key</span>):</span><br><span class="line">        <span class="string">"""签名交易"""</span></span><br><span class="line">        <span class="comment"># 简化的签名过程</span></span><br><span class="line">        tx_data = <span class="string">f"<span class="subst">{self.from_addr}</span><span class="subst">{self.to_addr}</span><span class="subst">{self.amount}</span><span class="subst">{self.timestamp}</span>"</span></span><br><span class="line">        <span class="variable language_">self</span>.signature = CryptographicUtils.sha256_hash(tx_data + private_key)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_signature</span>(<span class="params">self, public_key</span>):</span><br><span class="line">        <span class="string">"""验证签名"""</span></span><br><span class="line">        <span class="comment"># 简化的验证过程</span></span><br><span class="line">        tx_data = <span class="string">f"<span class="subst">{self.from_addr}</span><span class="subst">{self.to_addr}</span><span class="subst">{self.amount}</span><span class="subst">{self.timestamp}</span>"</span></span><br><span class="line">        expected_signature = CryptographicUtils.sha256_hash(tx_data + public_key)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.signature == expected_signature</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_dict</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""转换为字典"""</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"tx_id"</span>: <span class="variable language_">self</span>.tx_id,</span><br><span class="line">            <span class="string">"from"</span>: <span class="variable language_">self</span>.from_addr,</span><br><span class="line">            <span class="string">"to"</span>: <span class="variable language_">self</span>.to_addr,</span><br><span class="line">            <span class="string">"amount"</span>: <span class="built_in">str</span>(<span class="variable language_">self</span>.amount),</span><br><span class="line">            <span class="string">"fee"</span>: <span class="built_in">str</span>(<span class="variable language_">self</span>.fee),</span><br><span class="line">            <span class="string">"timestamp"</span>: <span class="variable language_">self</span>.timestamp.isoformat(),</span><br><span class="line">            <span class="string">"confirmed"</span>: <span class="variable language_">self</span>.confirmed</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wallet</span>:</span><br><span class="line">    <span class="string">"""钱包类"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="variable language_">self</span>.address = address</span><br><span class="line">        <span class="variable language_">self</span>.private_key = <span class="variable language_">self</span>.generate_private_key()</span><br><span class="line">        <span class="variable language_">self</span>.public_key = <span class="variable language_">self</span>.generate_public_key()</span><br><span class="line">        <span class="variable language_">self</span>.balance = Decimal(<span class="string">'0'</span>)</span><br><span class="line">        <span class="variable language_">self</span>.transaction_history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_private_key</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""生成私钥"""</span></span><br><span class="line">        <span class="keyword">import</span> secrets</span><br><span class="line">        <span class="keyword">return</span> secrets.token_hex(<span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_public_key</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""生成公钥"""</span></span><br><span class="line">        <span class="keyword">return</span> CryptographicUtils.sha256_hash(<span class="variable language_">self</span>.private_key)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_transaction</span>(<span class="params">self, to_addr, amount, fee=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">"""创建交易"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.balance &lt; Decimal(<span class="built_in">str</span>(amount)) + Decimal(<span class="built_in">str</span>(fee)):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"余额不足"</span>)</span><br><span class="line">        </span><br><span class="line">        tx = Transaction(<span class="variable language_">self</span>.address, to_addr, amount, fee)</span><br><span class="line">        tx.sign_transaction(<span class="variable language_">self</span>.private_key)</span><br><span class="line">        <span class="keyword">return</span> tx</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_balance</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="string">"""更新余额"""</span></span><br><span class="line">        <span class="variable language_">self</span>.balance += Decimal(<span class="built_in">str</span>(amount))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_transaction</span>(<span class="params">self, transaction</span>):</span><br><span class="line">        <span class="string">"""添加交易记录"""</span></span><br><span class="line">        <span class="variable language_">self</span>.transaction_history.append(transaction)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DigitalCurrencyBlockchain</span>:</span><br><span class="line">    <span class="string">"""数字货币区块链"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, symbol, total_supply</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.symbol = symbol</span><br><span class="line">        <span class="variable language_">self</span>.total_supply = Decimal(<span class="built_in">str</span>(total_supply))</span><br><span class="line">        <span class="variable language_">self</span>.chain = []</span><br><span class="line">        <span class="variable language_">self</span>.pending_transactions = []</span><br><span class="line">        <span class="variable language_">self</span>.wallets = {}</span><br><span class="line">        <span class="variable language_">self</span>.mining_reward = Decimal(<span class="string">'10'</span>)</span><br><span class="line">        <span class="variable language_">self</span>.difficulty = <span class="number">4</span></span><br><span class="line">        <span class="variable language_">self</span>.lock = threading.Lock()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建创世区块</span></span><br><span class="line">        <span class="variable language_">self</span>.create_genesis_block()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_genesis_block</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""创建创世区块"""</span></span><br><span class="line">        genesis_block = Block(<span class="number">0</span>, [], datetime.now(), <span class="string">"0"</span>)</span><br><span class="line">        genesis_block.mine_block(<span class="variable language_">self</span>.difficulty)</span><br><span class="line">        <span class="variable language_">self</span>.chain.append(genesis_block)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_wallet</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="string">"""创建钱包"""</span></span><br><span class="line">        <span class="keyword">if</span> address <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.wallets:</span><br><span class="line">            wallet = Wallet(address)</span><br><span class="line">            <span class="variable language_">self</span>.wallets[address] = wallet</span><br><span class="line">            <span class="keyword">return</span> wallet</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.wallets[address]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_balance</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="string">"""获取地址余额"""</span></span><br><span class="line">        balance = Decimal(<span class="string">'0'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> <span class="variable language_">self</span>.chain:</span><br><span class="line">            <span class="keyword">for</span> tx_data <span class="keyword">in</span> block.transactions:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(tx_data, <span class="built_in">dict</span>):</span><br><span class="line">                    <span class="comment"># 挖矿奖励</span></span><br><span class="line">                    <span class="keyword">if</span> tx_data.get(<span class="string">'type'</span>) == <span class="string">'mining_reward'</span> <span class="keyword">and</span> tx_data.get(<span class="string">'to'</span>) == address:</span><br><span class="line">                        balance += Decimal(<span class="built_in">str</span>(tx_data.get(<span class="string">'amount'</span>, <span class="number">0</span>)))</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">hasattr</span>(tx_data, <span class="string">'to_addr'</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(tx_data, <span class="string">'from_addr'</span>):</span><br><span class="line">                    <span class="comment"># 普通交易</span></span><br><span class="line">                    <span class="keyword">if</span> tx_data.to_addr == address:</span><br><span class="line">                        balance += tx_data.amount</span><br><span class="line">                    <span class="keyword">if</span> tx_data.from_addr == address:</span><br><span class="line">                        balance -= (tx_data.amount + tx_data.fee)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> balance</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_transaction</span>(<span class="params">self, transaction</span>):</span><br><span class="line">        <span class="string">"""添加交易到待处理池"""</span></span><br><span class="line">        <span class="comment"># 验证交易</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.validate_transaction(transaction):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"交易验证失败"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">            <span class="variable language_">self</span>.pending_transactions.append(transaction)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"交易已添加到待处理池"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_transaction</span>(<span class="params">self, transaction</span>):</span><br><span class="line">        <span class="string">"""验证交易"""</span></span><br><span class="line">        <span class="comment"># 检查余额</span></span><br><span class="line">        sender_balance = <span class="variable language_">self</span>.get_balance(transaction.from_addr)</span><br><span class="line">        required_amount = transaction.amount + transaction.fee</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> sender_balance &lt; required_amount:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 验证签名（简化版本）</span></span><br><span class="line">        <span class="keyword">if</span> transaction.from_addr <span class="keyword">in</span> <span class="variable language_">self</span>.wallets:</span><br><span class="line">            wallet = <span class="variable language_">self</span>.wallets[transaction.from_addr]</span><br><span class="line">            <span class="keyword">return</span> transaction.verify_signature(wallet.public_key)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mine_pending_transactions</span>(<span class="params">self, mining_reward_address</span>):</span><br><span class="line">        <span class="string">"""挖矿处理待处理交易"""</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">            <span class="comment"># 添加挖矿奖励交易</span></span><br><span class="line">            reward_tx = {</span><br><span class="line">                <span class="string">'type'</span>: <span class="string">'mining_reward'</span>,</span><br><span class="line">                <span class="string">'to'</span>: mining_reward_address,</span><br><span class="line">                <span class="string">'amount'</span>: <span class="built_in">str</span>(<span class="variable language_">self</span>.mining_reward),</span><br><span class="line">                <span class="string">'timestamp'</span>: datetime.now().isoformat()</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 创建新区块</span></span><br><span class="line">            transactions = <span class="variable language_">self</span>.pending_transactions.copy() + [reward_tx]</span><br><span class="line">            new_block = Block(</span><br><span class="line">                <span class="built_in">len</span>(<span class="variable language_">self</span>.chain),</span><br><span class="line">                transactions,</span><br><span class="line">                datetime.now(),</span><br><span class="line">                <span class="variable language_">self</span>.get_latest_block().<span class="built_in">hash</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 挖矿</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"开始挖矿区块 <span class="subst">{new_block.index}</span>..."</span>)</span><br><span class="line">            new_block.mine_block(<span class="variable language_">self</span>.difficulty)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加到链中</span></span><br><span class="line">            <span class="variable language_">self</span>.chain.append(new_block)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 清空待处理交易</span></span><br><span class="line">            <span class="variable language_">self</span>.pending_transactions = []</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"区块 <span class="subst">{new_block.index}</span> 挖矿成功!"</span>)</span><br><span class="line">            <span class="keyword">return</span> new_block</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_latest_block</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取最新区块"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.chain[-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_chain_valid</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""验证区块链完整性"""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(<span class="variable language_">self</span>.chain)):</span><br><span class="line">            current_block = <span class="variable language_">self</span>.chain[i]</span><br><span class="line">            previous_block = <span class="variable language_">self</span>.chain[i - <span class="number">1</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 验证当前区块哈希</span></span><br><span class="line">            <span class="keyword">if</span> current_block.<span class="built_in">hash</span> != current_block.calculate_hash():</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 验证与前一个区块的连接</span></span><br><span class="line">            <span class="keyword">if</span> current_block.previous_hash != previous_block.<span class="built_in">hash</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_transaction_history</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="string">"""获取地址交易历史"""</span></span><br><span class="line">        history = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> <span class="variable language_">self</span>.chain:</span><br><span class="line">            <span class="keyword">for</span> tx_data <span class="keyword">in</span> block.transactions:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(tx_data, <span class="built_in">dict</span>):</span><br><span class="line">                    <span class="comment"># 挖矿奖励</span></span><br><span class="line">                    <span class="keyword">if</span> tx_data.get(<span class="string">'type'</span>) == <span class="string">'mining_reward'</span> <span class="keyword">and</span> tx_data.get(<span class="string">'to'</span>) == address:</span><br><span class="line">                        history.append({</span><br><span class="line">                            <span class="string">'type'</span>: <span class="string">'mining_reward'</span>,</span><br><span class="line">                            <span class="string">'amount'</span>: tx_data.get(<span class="string">'amount'</span>),</span><br><span class="line">                            <span class="string">'timestamp'</span>: tx_data.get(<span class="string">'timestamp'</span>),</span><br><span class="line">                            <span class="string">'block'</span>: block.index</span><br><span class="line">                        })</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">hasattr</span>(tx_data, <span class="string">'to_addr'</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(tx_data, <span class="string">'from_addr'</span>):</span><br><span class="line">                    <span class="comment"># 普通交易</span></span><br><span class="line">                    <span class="keyword">if</span> tx_data.to_addr == address <span class="keyword">or</span> tx_data.from_addr == address:</span><br><span class="line">                        history.append({</span><br><span class="line">                            <span class="string">'type'</span>: <span class="string">'transfer'</span>,</span><br><span class="line">                            <span class="string">'from'</span>: tx_data.from_addr,</span><br><span class="line">                            <span class="string">'to'</span>: tx_data.to_addr,</span><br><span class="line">                            <span class="string">'amount'</span>: <span class="built_in">str</span>(tx_data.amount),</span><br><span class="line">                            <span class="string">'fee'</span>: <span class="built_in">str</span>(tx_data.fee),</span><br><span class="line">                            <span class="string">'timestamp'</span>: tx_data.timestamp.isoformat(),</span><br><span class="line">                            <span class="string">'block'</span>: block.index</span><br><span class="line">                        })</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> history</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数字货币演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_digital_currency</span>():</span><br><span class="line">    <span class="string">"""演示数字货币系统"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 数字货币系统演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建区块链</span></span><br><span class="line">    blockchain = DigitalCurrencyBlockchain(<span class="string">"TechCoin"</span>, <span class="string">"TECH"</span>, <span class="number">1000000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建钱包</span></span><br><span class="line">    alice_wallet = blockchain.create_wallet(<span class="string">"Alice"</span>)</span><br><span class="line">    bob_wallet = blockchain.create_wallet(<span class="string">"Bob"</span>)</span><br><span class="line">    charlie_wallet = blockchain.create_wallet(<span class="string">"Charlie"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 初始挖矿 - 为Alice获得初始代币"</span>)</span><br><span class="line">    blockchain.mine_pending_transactions(<span class="string">"Alice"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Alice余额: <span class="subst">{blockchain.get_balance(<span class="string">'Alice'</span>)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. Alice向Bob转账"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tx1 = alice_wallet.create_transaction(<span class="string">"Bob"</span>, <span class="number">5</span>, <span class="number">0.1</span>)</span><br><span class="line">        success, message = blockchain.add_transaction(tx1)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"交易状态: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"交易失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. Alice向Charlie转账"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tx2 = alice_wallet.create_transaction(<span class="string">"Charlie"</span>, <span class="number">3</span>, <span class="number">0.1</span>)</span><br><span class="line">        success, message = blockchain.add_transaction(tx2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"交易状态: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"交易失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n4. 挖矿确认交易"</span>)</span><br><span class="line">    blockchain.mine_pending_transactions(<span class="string">"Bob"</span>)  <span class="comment"># Bob作为矿工</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n5. 查看余额"</span>)</span><br><span class="line">    <span class="keyword">for</span> address <span class="keyword">in</span> [<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="string">"Charlie"</span>]:</span><br><span class="line">        balance = blockchain.get_balance(address)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{address}</span>: <span class="subst">{balance}</span> TECH"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n6. 验证区块链完整性"</span>)</span><br><span class="line">    is_valid = blockchain.is_chain_valid()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"区块链完整性: <span class="subst">{<span class="string">'有效'</span> <span class="keyword">if</span> is_valid <span class="keyword">else</span> <span class="string">'无效'</span>}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n7. 查看交易历史"</span>)</span><br><span class="line">    alice_history = blockchain.get_transaction_history(<span class="string">"Alice"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Alice交易历史: <span class="subst">{<span class="built_in">len</span>(alice_history)}</span>笔交易"</span>)</span><br><span class="line">    <span class="keyword">for</span> tx <span class="keyword">in</span> alice_history:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"  - <span class="subst">{tx}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行演示</span></span><br><span class="line"><span class="comment"># demonstrate_digital_currency()</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）供应链管理"><a href="#（二）供应链管理" class="headerlink" title="（二）供应链管理"></a>（二）供应链管理</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SupplyChainItem</span>:</span><br><span class="line">    <span class="string">"""供应链物品类"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, item_id, name, category, origin</span>):</span><br><span class="line">        <span class="variable language_">self</span>.item_id = item_id</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.category = category</span><br><span class="line">        <span class="variable language_">self</span>.origin = origin</span><br><span class="line">        <span class="variable language_">self</span>.created_at = datetime.now()</span><br><span class="line">        <span class="variable language_">self</span>.current_owner = origin</span><br><span class="line">        <span class="variable language_">self</span>.status = <span class="string">"created"</span></span><br><span class="line">        <span class="variable language_">self</span>.location = <span class="string">"origin"</span></span><br><span class="line">        <span class="variable language_">self</span>.quality_checks = []</span><br><span class="line">        <span class="variable language_">self</span>.certifications = []</span><br><span class="line">        <span class="variable language_">self</span>.transfer_history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_quality_check</span>(<span class="params">self, inspector, result, notes=<span class="string">""</span></span>):</span><br><span class="line">        <span class="string">"""添加质量检查记录"""</span></span><br><span class="line">        check = {</span><br><span class="line">            <span class="string">"inspector"</span>: inspector,</span><br><span class="line">            <span class="string">"result"</span>: result,</span><br><span class="line">            <span class="string">"notes"</span>: notes,</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now(),</span><br><span class="line">            <span class="string">"location"</span>: <span class="variable language_">self</span>.location</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">self</span>.quality_checks.append(check)</span><br><span class="line">        <span class="keyword">return</span> check</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_certification</span>(<span class="params">self, authority, cert_type, cert_id</span>):</span><br><span class="line">        <span class="string">"""添加认证"""</span></span><br><span class="line">        cert = {</span><br><span class="line">            <span class="string">"authority"</span>: authority,</span><br><span class="line">            <span class="string">"type"</span>: cert_type,</span><br><span class="line">            <span class="string">"cert_id"</span>: cert_id,</span><br><span class="line">            <span class="string">"issued_at"</span>: datetime.now()</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">self</span>.certifications.append(cert)</span><br><span class="line">        <span class="keyword">return</span> cert</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer_ownership</span>(<span class="params">self, new_owner, location, notes=<span class="string">""</span></span>):</span><br><span class="line">        <span class="string">"""转移所有权"""</span></span><br><span class="line">        transfer = {</span><br><span class="line">            <span class="string">"from"</span>: <span class="variable language_">self</span>.current_owner,</span><br><span class="line">            <span class="string">"to"</span>: new_owner,</span><br><span class="line">            <span class="string">"location"</span>: location,</span><br><span class="line">            <span class="string">"notes"</span>: notes,</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now()</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.transfer_history.append(transfer)</span><br><span class="line">        <span class="variable language_">self</span>.current_owner = new_owner</span><br><span class="line">        <span class="variable language_">self</span>.location = location</span><br><span class="line">        <span class="keyword">return</span> transfer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SupplyChainContract</span>(<span class="title class_ inherited__">SmartContract</span>):</span><br><span class="line">    <span class="string">"""供应链智能合约"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, contract_id, supply_chain_name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(contract_id, <span class="string">"SupplyChain"</span>, [])</span><br><span class="line">        <span class="variable language_">self</span>.supply_chain_name = supply_chain_name</span><br><span class="line">        <span class="variable language_">self</span>.items = {}</span><br><span class="line">        <span class="variable language_">self</span>.participants = {}</span><br><span class="line">        <span class="variable language_">self</span>.compliance_rules = []</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_participant</span>(<span class="params">self, participant_id, name, role, location</span>):</span><br><span class="line">        <span class="string">"""注册参与者"""</span></span><br><span class="line">        participant = {</span><br><span class="line">            <span class="string">"id"</span>: participant_id,</span><br><span class="line">            <span class="string">"name"</span>: name,</span><br><span class="line">            <span class="string">"role"</span>: role,  <span class="comment"># producer, distributor, retailer, consumer</span></span><br><span class="line">            <span class="string">"location"</span>: location,</span><br><span class="line">            <span class="string">"registered_at"</span>: datetime.now(),</span><br><span class="line">            <span class="string">"reputation_score"</span>: <span class="number">100</span>,</span><br><span class="line">            <span class="string">"items_handled"</span>: <span class="number">0</span></span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.participants[participant_id] = participant</span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"参与者注册: <span class="subst">{name}</span> (<span class="subst">{role}</span>)"</span>)</span><br><span class="line">        <span class="keyword">return</span> participant</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">self, creator_id, item_id, name, category</span>):</span><br><span class="line">        <span class="string">"""创建物品"""</span></span><br><span class="line">        <span class="keyword">if</span> creator_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.participants:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"创建者未注册"</span></span><br><span class="line">        </span><br><span class="line">        creator = <span class="variable language_">self</span>.participants[creator_id]</span><br><span class="line">        item = SupplyChainItem(item_id, name, category, creator_id)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.items[item_id] = item</span><br><span class="line">        creator[<span class="string">"items_handled"</span>] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"物品创建: <span class="subst">{name}</span> (ID: <span class="subst">{item_id}</span>)"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, item</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transfer_item</span>(<span class="params">self, item_id, from_id, to_id, location, notes=<span class="string">""</span></span>):</span><br><span class="line">        <span class="string">"""转移物品"""</span></span><br><span class="line">        <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"物品不存在"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> from_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.participants <span class="keyword">or</span> to_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.participants:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"参与者未注册"</span></span><br><span class="line">        </span><br><span class="line">        item = <span class="variable language_">self</span>.items[item_id]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> item.current_owner != from_id:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"转移者不是当前所有者"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 执行转移</span></span><br><span class="line">        transfer = item.transfer_ownership(to_id, location, notes)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新参与者统计</span></span><br><span class="line">        <span class="variable language_">self</span>.participants[to_id][<span class="string">"items_handled"</span>] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"物品转移: <span class="subst">{item.name}</span> 从 <span class="subst">{from_id}</span> 到 <span class="subst">{to_id}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, transfer</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_quality_check</span>(<span class="params">self, item_id, inspector_id, result, notes=<span class="string">""</span></span>):</span><br><span class="line">        <span class="string">"""添加质量检查"""</span></span><br><span class="line">        <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"物品不存在"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> inspector_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.participants:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"检查员未注册"</span></span><br><span class="line">        </span><br><span class="line">        item = <span class="variable language_">self</span>.items[item_id]</span><br><span class="line">        check = item.add_quality_check(inspector_id, result, notes)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新检查员声誉</span></span><br><span class="line">        inspector = <span class="variable language_">self</span>.participants[inspector_id]</span><br><span class="line">        <span class="keyword">if</span> result == <span class="string">"pass"</span>:</span><br><span class="line">            inspector[<span class="string">"reputation_score"</span>] = <span class="built_in">min</span>(<span class="number">100</span>, inspector[<span class="string">"reputation_score"</span>] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> result == <span class="string">"fail"</span>:</span><br><span class="line">            inspector[<span class="string">"reputation_score"</span>] = <span class="built_in">max</span>(<span class="number">0</span>, inspector[<span class="string">"reputation_score"</span>] - <span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"质量检查: <span class="subst">{item.name}</span> - <span class="subst">{result}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, check</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">trace_item_history</span>(<span class="params">self, item_id</span>):</span><br><span class="line">        <span class="string">"""追溯物品历史"""</span></span><br><span class="line">        <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        item = <span class="variable language_">self</span>.items[item_id]</span><br><span class="line">        </span><br><span class="line">        history = {</span><br><span class="line">            <span class="string">"item_info"</span>: {</span><br><span class="line">                <span class="string">"id"</span>: item.item_id,</span><br><span class="line">                <span class="string">"name"</span>: item.name,</span><br><span class="line">                <span class="string">"category"</span>: item.category,</span><br><span class="line">                <span class="string">"origin"</span>: item.origin,</span><br><span class="line">                <span class="string">"created_at"</span>: item.created_at,</span><br><span class="line">                <span class="string">"current_owner"</span>: item.current_owner,</span><br><span class="line">                <span class="string">"current_location"</span>: item.location,</span><br><span class="line">                <span class="string">"status"</span>: item.status</span><br><span class="line">            },</span><br><span class="line">            <span class="string">"transfer_history"</span>: item.transfer_history,</span><br><span class="line">            <span class="string">"quality_checks"</span>: item.quality_checks,</span><br><span class="line">            <span class="string">"certifications"</span>: item.certifications</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> history</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_authenticity</span>(<span class="params">self, item_id</span>):</span><br><span class="line">        <span class="string">"""验证物品真实性"""</span></span><br><span class="line">        <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.items:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"物品不存在"</span></span><br><span class="line">        </span><br><span class="line">        item = <span class="variable language_">self</span>.items[item_id]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查是否有质量检查记录</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> item.quality_checks:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"缺少质量检查记录"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查最近的质量检查结果</span></span><br><span class="line">        latest_check = item.quality_checks[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> latest_check[<span class="string">"result"</span>] != <span class="string">"pass"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"最近质量检查未通过"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查转移历史的完整性</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(item.transfer_history) == <span class="number">0</span> <span class="keyword">and</span> item.current_owner != item.origin:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"转移历史不完整"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">"物品验证通过"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 供应链演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_supply_chain</span>():</span><br><span class="line">    <span class="string">"""演示供应链管理"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 供应链管理演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建供应链合约</span></span><br><span class="line">    supply_chain = SupplyChainContract(<span class="string">"SC001"</span>, <span class="string">"有机食品供应链"</span>)</span><br><span class="line">    supply_chain.activate()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 注册参与者</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 注册供应链参与者"</span>)</span><br><span class="line">    participants = [</span><br><span class="line">        (<span class="string">"farm001"</span>, <span class="string">"绿色农场"</span>, <span class="string">"producer"</span>, <span class="string">"山东寿光"</span>),</span><br><span class="line">        (<span class="string">"dist001"</span>, <span class="string">"新鲜配送"</span>, <span class="string">"distributor"</span>, <span class="string">"北京朝阳"</span>),</span><br><span class="line">        (<span class="string">"store001"</span>, <span class="string">"有机超市"</span>, <span class="string">"retailer"</span>, <span class="string">"北京海淀"</span>),</span><br><span class="line">        (<span class="string">"qc001"</span>, <span class="string">"质检机构"</span>, <span class="string">"inspector"</span>, <span class="string">"北京"</span>),</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pid, name, role, location <span class="keyword">in</span> participants:</span><br><span class="line">        participant = supply_chain.register_participant(pid, name, role, location)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"注册: <span class="subst">{name}</span> - <span class="subst">{role}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建物品</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. 创建有机蔬菜"</span>)</span><br><span class="line">    success, item = supply_chain.create_item(</span><br><span class="line">        <span class="string">"farm001"</span>, <span class="string">"tomato001"</span>, <span class="string">"有机西红柿"</span>, <span class="string">"蔬菜"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"创建结果: <span class="subst">{success}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加质量检查</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. 农场质量检查"</span>)</span><br><span class="line">    success, check = supply_chain.add_quality_check(</span><br><span class="line">        <span class="string">"tomato001"</span>, <span class="string">"qc001"</span>, <span class="string">"pass"</span>, <span class="string">"符合有机标准"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"质检结果: <span class="subst">{check[<span class="string">'result'</span>] <span class="keyword">if</span> success <span class="keyword">else</span> <span class="string">'失败'</span>}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转移到配送中心</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n4. 转移到配送中心"</span>)</span><br><span class="line">    success, transfer = supply_chain.transfer_item(</span><br><span class="line">        <span class="string">"tomato001"</span>, <span class="string">"farm001"</span>, <span class="string">"dist001"</span>, <span class="string">"配送中心"</span>, <span class="string">"冷链运输"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"转移结果: <span class="subst">{success}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 配送中心质量检查</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n5. 配送中心质量检查"</span>)</span><br><span class="line">    success, check = supply_chain.add_quality_check(</span><br><span class="line">        <span class="string">"tomato001"</span>, <span class="string">"qc001"</span>, <span class="string">"pass"</span>, <span class="string">"运输过程保持新鲜"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"质检结果: <span class="subst">{check[<span class="string">'result'</span>] <span class="keyword">if</span> success <span class="keyword">else</span> <span class="string">'失败'</span>}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转移到零售店</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n6. 转移到零售店"</span>)</span><br><span class="line">    success, transfer = supply_chain.transfer_item(</span><br><span class="line">        <span class="string">"tomato001"</span>, <span class="string">"dist001"</span>, <span class="string">"store001"</span>, <span class="string">"有机超市"</span>, <span class="string">"上架销售"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"转移结果: <span class="subst">{success}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 追溯历史</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n7. 追溯物品历史"</span>)</span><br><span class="line">    history = supply_chain.trace_item_history(<span class="string">"tomato001"</span>)</span><br><span class="line">    <span class="keyword">if</span> history:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"物品: <span class="subst">{history[<span class="string">'item_info'</span>][<span class="string">'name'</span>]}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"原产地: <span class="subst">{history[<span class="string">'item_info'</span>][<span class="string">'origin'</span>]}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"当前位置: <span class="subst">{history[<span class="string">'item_info'</span>][<span class="string">'current_location'</span>]}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"转移次数: <span class="subst">{<span class="built_in">len</span>(history[<span class="string">'transfer_history'</span>])}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"质检次数: <span class="subst">{<span class="built_in">len</span>(history[<span class="string">'quality_checks'</span>])}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n转移历史:"</span>)</span><br><span class="line">        <span class="keyword">for</span> i, transfer <span class="keyword">in</span> <span class="built_in">enumerate</span>(history[<span class="string">'transfer_history'</span>]):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  <span class="subst">{i+<span class="number">1</span>}</span>. <span class="subst">{transfer[<span class="string">'from'</span>]}</span> -&gt; <span class="subst">{transfer[<span class="string">'to'</span>]}</span> (<span class="subst">{transfer[<span class="string">'location'</span>]}</span>)"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证真实性</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n8. 验证物品真实性"</span>)</span><br><span class="line">    is_authentic, message = supply_chain.verify_authenticity(<span class="string">"tomato001"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"验证结果: <span class="subst">{message}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行演示</span></span><br><span class="line"><span class="comment"># demonstrate_supply_chain()</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="五、区块链开发实践"><a href="#五、区块链开发实践" class="headerlink" title="五、区块链开发实践"></a>五、区块链开发实践</h1><h2 id="（一）简单区块链网络实现"><a href="#（一）简单区块链网络实现" class="headerlink" title="（一）简单区块链网络实现"></a>（一）简单区块链网络实现</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlockchainNode</span>:</span><br><span class="line">    <span class="string">"""区块链网络节点"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, port, node_id</span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line">        <span class="variable language_">self</span>.node_id = node_id</span><br><span class="line">        <span class="variable language_">self</span>.blockchain = DigitalCurrencyBlockchain(<span class="string">"NetworkCoin"</span>, <span class="string">"NET"</span>, <span class="number">1000000</span>)</span><br><span class="line">        <span class="variable language_">self</span>.peers = <span class="built_in">set</span>()</span><br><span class="line">        <span class="variable language_">self</span>.server_socket = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.running = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.message_queue = Queue()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_server</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""启动节点服务器"""</span></span><br><span class="line">        <span class="variable language_">self</span>.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        <span class="variable language_">self</span>.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.server_socket.bind((<span class="variable language_">self</span>.host, <span class="variable language_">self</span>.port))</span><br><span class="line">        <span class="variable language_">self</span>.server_socket.listen(<span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.running = <span class="literal">True</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"节点 <span class="subst">{self.node_id}</span> 在 <span class="subst">{self.host}</span>:<span class="subst">{self.port}</span> 启动"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 启动消息处理线程</span></span><br><span class="line">        threading.Thread(target=<span class="variable language_">self</span>.process_messages, daemon=<span class="literal">True</span>).start()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="variable language_">self</span>.running:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                client_socket, address = <span class="variable language_">self</span>.server_socket.accept()</span><br><span class="line">                threading.Thread(</span><br><span class="line">                    target=<span class="variable language_">self</span>.handle_client,</span><br><span class="line">                    args=(client_socket, address),</span><br><span class="line">                    daemon=<span class="literal">True</span></span><br><span class="line">                ).start()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.running:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f"服务器错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_client</span>(<span class="params">self, client_socket, address</span>):</span><br><span class="line">        <span class="string">"""处理客户端连接"""</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="variable language_">self</span>.running:</span><br><span class="line">                data = client_socket.recv(<span class="number">4096</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                message = json.loads(data.decode())</span><br><span class="line">                <span class="variable language_">self</span>.message_queue.put((message, client_socket))</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"客户端处理错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            client_socket.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_messages</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""处理消息队列"""</span></span><br><span class="line">        <span class="keyword">while</span> <span class="variable language_">self</span>.running:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.message_queue.empty():</span><br><span class="line">                    message, sender_socket = <span class="variable language_">self</span>.message_queue.get()</span><br><span class="line">                    <span class="variable language_">self</span>.handle_message(message, sender_socket)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"消息处理错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_message</span>(<span class="params">self, message, sender_socket</span>):</span><br><span class="line">        <span class="string">"""处理收到的消息"""</span></span><br><span class="line">        msg_type = message.get(<span class="string">'type'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> msg_type == <span class="string">'new_block'</span>:</span><br><span class="line">            <span class="variable language_">self</span>.handle_new_block(message[<span class="string">'block'</span>])</span><br><span class="line">        <span class="keyword">elif</span> msg_type == <span class="string">'new_transaction'</span>:</span><br><span class="line">            <span class="variable language_">self</span>.handle_new_transaction(message[<span class="string">'transaction'</span>])</span><br><span class="line">        <span class="keyword">elif</span> msg_type == <span class="string">'request_blockchain'</span>:</span><br><span class="line">            <span class="variable language_">self</span>.send_blockchain(sender_socket)</span><br><span class="line">        <span class="keyword">elif</span> msg_type == <span class="string">'peer_discovery'</span>:</span><br><span class="line">            <span class="variable language_">self</span>.handle_peer_discovery(message)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_new_block</span>(<span class="params">self, block_data</span>):</span><br><span class="line">        <span class="string">"""处理新区块"""</span></span><br><span class="line">        <span class="comment"># 验证区块</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.validate_block(block_data):</span><br><span class="line">            <span class="comment"># 添加到本地链</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"节点 <span class="subst">{self.node_id}</span> 接收到新区块: <span class="subst">{block_data[<span class="string">'index'</span>]}</span>"</span>)</span><br><span class="line">            <span class="comment"># 这里应该有更复杂的区块验证和添加逻辑</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_new_transaction</span>(<span class="params">self, tx_data</span>):</span><br><span class="line">        <span class="string">"""处理新交易"""</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"节点 <span class="subst">{self.node_id}</span> 接收到新交易: <span class="subst">{tx_data[<span class="string">'tx_id'</span>]}</span>"</span>)</span><br><span class="line">        <span class="comment"># 验证并添加到交易池</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_block</span>(<span class="params">self, block_data</span>):</span><br><span class="line">        <span class="string">"""验证区块"""</span></span><br><span class="line">        <span class="comment"># 简化的区块验证</span></span><br><span class="line">        required_fields = [<span class="string">'index'</span>, <span class="string">'transactions'</span>, <span class="string">'timestamp'</span>, <span class="string">'previous_hash'</span>, <span class="string">'hash'</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">all</span>(field <span class="keyword">in</span> block_data <span class="keyword">for</span> field <span class="keyword">in</span> required_fields)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">broadcast_message</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">"""广播消息给所有节点"""</span></span><br><span class="line">        <span class="keyword">for</span> peer <span class="keyword">in</span> <span class="variable language_">self</span>.peers:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="variable language_">self</span>.send_message_to_peer(peer, message)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"广播到 <span class="subst">{peer}</span> 失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_message_to_peer</span>(<span class="params">self, peer, message</span>):</span><br><span class="line">        <span class="string">"""发送消息给指定节点"""</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">            sock.connect(peer)</span><br><span class="line">            sock.send(json.dumps(message).encode())</span><br><span class="line">            sock.close()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"发送消息到 <span class="subst">{peer}</span> 失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_peer</span>(<span class="params">self, peer_host, peer_port</span>):</span><br><span class="line">        <span class="string">"""添加对等节点"""</span></span><br><span class="line">        peer = (peer_host, peer_port)</span><br><span class="line">        <span class="variable language_">self</span>.peers.add(peer)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"节点 <span class="subst">{self.node_id}</span> 添加对等节点: <span class="subst">{peer}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""停止节点"""</span></span><br><span class="line">        <span class="variable language_">self</span>.running = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.server_socket:</span><br><span class="line">            <span class="variable language_">self</span>.server_socket.close()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"节点 <span class="subst">{self.node_id}</span> 已停止"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 网络演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_blockchain_network</span>():</span><br><span class="line">    <span class="string">"""演示区块链网络"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 区块链网络演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建多个节点</span></span><br><span class="line">    nodes = []</span><br><span class="line">    ports = [<span class="number">8001</span>, <span class="number">8002</span>, <span class="number">8003</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, port <span class="keyword">in</span> <span class="built_in">enumerate</span>(ports):</span><br><span class="line">        node = BlockchainNode(<span class="string">"localhost"</span>, port, <span class="string">f"node_<span class="subst">{i+<span class="number">1</span>}</span>"</span>)</span><br><span class="line">        nodes.append(node)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 启动节点（在实际应用中，这些会在不同的进程或机器上运行）</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> nodes:</span><br><span class="line">        threading.Thread(target=node.start_server, daemon=<span class="literal">True</span>).start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 等待节点启动</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 建立节点连接</span></span><br><span class="line">    <span class="keyword">for</span> i, node <span class="keyword">in</span> <span class="built_in">enumerate</span>(nodes):</span><br><span class="line">        <span class="keyword">for</span> j, other_node <span class="keyword">in</span> <span class="built_in">enumerate</span>(nodes):</span><br><span class="line">            <span class="keyword">if</span> i != j:</span><br><span class="line">                node.add_peer(<span class="string">"localhost"</span>, other_node.port)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n网络节点已启动并连接"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟网络活动</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 停止所有节点</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> nodes:</span><br><span class="line">        node.stop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行网络演示</span></span><br><span class="line"><span class="comment"># demonstrate_blockchain_network()</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）性能优化策略"><a href="#（二）性能优化策略" class="headerlink" title="（二）性能优化策略"></a>（二）性能优化策略</h2><h3 id="1-分片技术"><a href="#1-分片技术" class="headerlink" title="1. 分片技术"></a>1. 分片技术</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShardedBlockchain</span>:</span><br><span class="line">    <span class="string">"""分片区块链实现"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_shards=<span class="number">4</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.num_shards = num_shards</span><br><span class="line">        <span class="variable language_">self</span>.shards = []</span><br><span class="line">        <span class="variable language_">self</span>.cross_shard_transactions = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化分片</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_shards):</span><br><span class="line">            shard = {</span><br><span class="line">                <span class="string">"shard_id"</span>: i,</span><br><span class="line">                <span class="string">"blockchain"</span>: DigitalCurrencyBlockchain(<span class="string">f"Shard<span class="subst">{i}</span>"</span>, <span class="string">f"S<span class="subst">{i}</span>"</span>, <span class="number">250000</span>),</span><br><span class="line">                <span class="string">"validators"</span>: <span class="built_in">set</span>(),</span><br><span class="line">                <span class="string">"transaction_pool"</span>: []</span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">self</span>.shards.append(shard)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_shard_for_address</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="string">"""根据地址确定分片"""</span></span><br><span class="line">        address_hash = CryptographicUtils.sha256_hash(address)</span><br><span class="line">        shard_id = <span class="built_in">int</span>(address_hash[:<span class="number">8</span>], <span class="number">16</span>) % <span class="variable language_">self</span>.num_shards</span><br><span class="line">        <span class="keyword">return</span> shard_id</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_transaction</span>(<span class="params">self, transaction</span>):</span><br><span class="line">        <span class="string">"""处理交易"""</span></span><br><span class="line">        from_shard = <span class="variable language_">self</span>.get_shard_for_address(transaction.from_addr)</span><br><span class="line">        to_shard = <span class="variable language_">self</span>.get_shard_for_address(transaction.to_addr)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> from_shard == to_shard:</span><br><span class="line">            <span class="comment"># 同分片交易</span></span><br><span class="line">            <span class="variable language_">self</span>.shards[from_shard][<span class="string">"transaction_pool"</span>].append(transaction)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"交易添加到分片 <span class="subst">{from_shard}</span>"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 跨分片交易</span></span><br><span class="line">            cross_shard_tx = {</span><br><span class="line">                <span class="string">"transaction"</span>: transaction,</span><br><span class="line">                <span class="string">"from_shard"</span>: from_shard,</span><br><span class="line">                <span class="string">"to_shard"</span>: to_shard,</span><br><span class="line">                <span class="string">"status"</span>: <span class="string">"pending"</span></span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">self</span>.cross_shard_transactions.append(cross_shard_tx)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"跨分片交易: <span class="subst">{from_shard}</span> -&gt; <span class="subst">{to_shard}</span>"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_cross_shard_transactions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""处理跨分片交易"""</span></span><br><span class="line">        <span class="keyword">for</span> cross_tx <span class="keyword">in</span> <span class="variable language_">self</span>.cross_shard_transactions:</span><br><span class="line">            <span class="keyword">if</span> cross_tx[<span class="string">"status"</span>] == <span class="string">"pending"</span>:</span><br><span class="line">                <span class="comment"># 简化的跨分片处理逻辑</span></span><br><span class="line">                from_shard = <span class="variable language_">self</span>.shards[cross_tx[<span class="string">"from_shard"</span>]]</span><br><span class="line">                to_shard = <span class="variable language_">self</span>.shards[cross_tx[<span class="string">"to_shard"</span>]]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 在源分片扣除余额</span></span><br><span class="line">                from_shard[<span class="string">"transaction_pool"</span>].append(cross_tx[<span class="string">"transaction"</span>])</span><br><span class="line">                <span class="comment"># 在目标分片增加余额</span></span><br><span class="line">                to_shard[<span class="string">"transaction_pool"</span>].append(cross_tx[<span class="string">"transaction"</span>])</span><br><span class="line">                </span><br><span class="line">                cross_tx[<span class="string">"status"</span>] = <span class="string">"completed"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_shard_stats</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取分片统计信息"""</span></span><br><span class="line">        stats = []</span><br><span class="line">        <span class="keyword">for</span> shard <span class="keyword">in</span> <span class="variable language_">self</span>.shards:</span><br><span class="line">            stats.append({</span><br><span class="line">                <span class="string">"shard_id"</span>: shard[<span class="string">"shard_id"</span>],</span><br><span class="line">                <span class="string">"blocks"</span>: <span class="built_in">len</span>(shard[<span class="string">"blockchain"</span>].chain),</span><br><span class="line">                <span class="string">"pending_transactions"</span>: <span class="built_in">len</span>(shard[<span class="string">"transaction_pool"</span>]),</span><br><span class="line">                <span class="string">"validators"</span>: <span class="built_in">len</span>(shard[<span class="string">"validators"</span>])</span><br><span class="line">            })</span><br><span class="line">        <span class="keyword">return</span> stats</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分片演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_sharding</span>():</span><br><span class="line">    <span class="string">"""演示分片技术"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 分片技术演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    sharded_bc = ShardedBlockchain(num_shards=<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建测试交易</span></span><br><span class="line">    addresses = [<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="string">"Charlie"</span>, <span class="string">"David"</span>, <span class="string">"Eve"</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n地址分片分配:"</span>)</span><br><span class="line">    <span class="keyword">for</span> addr <span class="keyword">in</span> addresses:</span><br><span class="line">        shard_id = sharded_bc.get_shard_for_address(addr)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{addr}</span>: 分片 <span class="subst">{shard_id}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建交易</span></span><br><span class="line">    transactions = [</span><br><span class="line">        Transaction(<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="number">10</span>),</span><br><span class="line">        Transaction(<span class="string">"Bob"</span>, <span class="string">"Charlie"</span>, <span class="number">5</span>),</span><br><span class="line">        Transaction(<span class="string">"Charlie"</span>, <span class="string">"David"</span>, <span class="number">3</span>),</span><br><span class="line">        Transaction(<span class="string">"David"</span>, <span class="string">"Eve"</span>, <span class="number">2</span>)</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n处理交易:"</span>)</span><br><span class="line">    <span class="keyword">for</span> tx <span class="keyword">in</span> transactions:</span><br><span class="line">        result = sharded_bc.process_transaction(tx)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{tx.from_addr}</span> -&gt; <span class="subst">{tx.to_addr}</span>: <span class="subst">{result}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n分片统计:"</span>)</span><br><span class="line">    stats = sharded_bc.get_shard_stats()</span><br><span class="line">    <span class="keyword">for</span> stat <span class="keyword">in</span> stats:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"分片 <span class="subst">{stat[<span class="string">'shard_id'</span>]}</span>: <span class="subst">{stat[<span class="string">'pending_transactions'</span>]}</span> 笔待处理交易"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行分片演示</span></span><br><span class="line"><span class="comment"># demonstrate_sharding()</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-状态通道"><a href="#2-状态通道" class="headerlink" title="2. 状态通道"></a>2. 状态通道</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StateChannel</span>:</span><br><span class="line">    <span class="string">"""状态通道实现"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel_id, participant_a, participant_b, initial_balance_a, initial_balance_b</span>):</span><br><span class="line">        <span class="variable language_">self</span>.channel_id = channel_id</span><br><span class="line">        <span class="variable language_">self</span>.participant_a = participant_a</span><br><span class="line">        <span class="variable language_">self</span>.participant_b = participant_b</span><br><span class="line">        <span class="variable language_">self</span>.balance_a = initial_balance_a</span><br><span class="line">        <span class="variable language_">self</span>.balance_b = initial_balance_b</span><br><span class="line">        <span class="variable language_">self</span>.nonce = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.state_updates = []</span><br><span class="line">        <span class="variable language_">self</span>.is_open = <span class="literal">True</span></span><br><span class="line">        <span class="variable language_">self</span>.dispute_period = timedelta(days=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.created_at = datetime.now()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_state_update</span>(<span class="params">self, from_participant, to_participant, amount</span>):</span><br><span class="line">        <span class="string">"""创建状态更新"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.is_open:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"通道已关闭"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 验证参与者</span></span><br><span class="line">        <span class="keyword">if</span> from_participant <span class="keyword">not</span> <span class="keyword">in</span> [<span class="variable language_">self</span>.participant_a, <span class="variable language_">self</span>.participant_b]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"无效的发送者"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> to_participant <span class="keyword">not</span> <span class="keyword">in</span> [<span class="variable language_">self</span>.participant_a, <span class="variable language_">self</span>.participant_b]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"无效的接收者"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查余额</span></span><br><span class="line">        <span class="keyword">if</span> from_participant == <span class="variable language_">self</span>.participant_a:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.balance_a &lt; amount:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"余额不足"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.balance_b &lt; amount:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"余额不足"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建状态更新</span></span><br><span class="line">        <span class="variable language_">self</span>.nonce += <span class="number">1</span></span><br><span class="line">        state_update = {</span><br><span class="line">            <span class="string">"nonce"</span>: <span class="variable language_">self</span>.nonce,</span><br><span class="line">            <span class="string">"from"</span>: from_participant,</span><br><span class="line">            <span class="string">"to"</span>: to_participant,</span><br><span class="line">            <span class="string">"amount"</span>: amount,</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now(),</span><br><span class="line">            <span class="string">"new_balance_a"</span>: <span class="variable language_">self</span>.balance_a - amount <span class="keyword">if</span> from_participant == <span class="variable language_">self</span>.participant_a <span class="keyword">else</span> <span class="variable language_">self</span>.balance_a + amount,</span><br><span class="line">            <span class="string">"new_balance_b"</span>: <span class="variable language_">self</span>.balance_b - amount <span class="keyword">if</span> from_participant == <span class="variable language_">self</span>.participant_b <span class="keyword">else</span> <span class="variable language_">self</span>.balance_b + amount</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新余额</span></span><br><span class="line">        <span class="keyword">if</span> from_participant == <span class="variable language_">self</span>.participant_a:</span><br><span class="line">            <span class="variable language_">self</span>.balance_a -= amount</span><br><span class="line">            <span class="variable language_">self</span>.balance_b += amount</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.balance_b -= amount</span><br><span class="line">            <span class="variable language_">self</span>.balance_a += amount</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.state_updates.append(state_update)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, state_update</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_channel</span>(<span class="params">self, final_balance_a=<span class="literal">None</span>, final_balance_b=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""关闭通道"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.is_open:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"通道已关闭"</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用最终余额或当前余额</span></span><br><span class="line">        final_a = final_balance_a <span class="keyword">if</span> final_balance_a <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="variable language_">self</span>.balance_a</span><br><span class="line">        final_b = final_balance_b <span class="keyword">if</span> final_balance_b <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="variable language_">self</span>.balance_b</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.is_open = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        closure_info = {</span><br><span class="line">            <span class="string">"closed_at"</span>: datetime.now(),</span><br><span class="line">            <span class="string">"final_balance_a"</span>: final_a,</span><br><span class="line">            <span class="string">"final_balance_b"</span>: final_b,</span><br><span class="line">            <span class="string">"total_updates"</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>.state_updates)</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, closure_info</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_channel_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""获取通道信息"""</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="string">"channel_id"</span>: <span class="variable language_">self</span>.channel_id,</span><br><span class="line">            <span class="string">"participants"</span>: [<span class="variable language_">self</span>.participant_a, <span class="variable language_">self</span>.participant_b],</span><br><span class="line">            <span class="string">"current_balances"</span>: {</span><br><span class="line">                <span class="variable language_">self</span>.participant_a: <span class="variable language_">self</span>.balance_a,</span><br><span class="line">                <span class="variable language_">self</span>.participant_b: <span class="variable language_">self</span>.balance_b</span><br><span class="line">            },</span><br><span class="line">            <span class="string">"nonce"</span>: <span class="variable language_">self</span>.nonce,</span><br><span class="line">            <span class="string">"is_open"</span>: <span class="variable language_">self</span>.is_open,</span><br><span class="line">            <span class="string">"total_updates"</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>.state_updates),</span><br><span class="line">            <span class="string">"created_at"</span>: <span class="variable language_">self</span>.created_at</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"><span class="comment"># 状态通道演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_state_channel</span>():</span><br><span class="line">    <span class="string">"""演示状态通道"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 状态通道演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建状态通道</span></span><br><span class="line">    channel = StateChannel(<span class="string">"CH001"</span>, <span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 初始状态"</span>)</span><br><span class="line">    info = channel.get_channel_info()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Alice余额: <span class="subst">{info[<span class="string">'current_balances'</span>][<span class="string">'Alice'</span>]}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Bob余额: <span class="subst">{info[<span class="string">'current_balances'</span>][<span class="string">'Bob'</span>]}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 进行多次交易</span></span><br><span class="line">    transactions = [</span><br><span class="line">        (<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="number">10</span>),</span><br><span class="line">        (<span class="string">"Bob"</span>, <span class="string">"Alice"</span>, <span class="number">5</span>),</span><br><span class="line">        (<span class="string">"Alice"</span>, <span class="string">"Bob"</span>, <span class="number">15</span>),</span><br><span class="line">        (<span class="string">"Bob"</span>, <span class="string">"Alice"</span>, <span class="number">8</span>)</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. 链下交易"</span>)</span><br><span class="line">    <span class="keyword">for</span> from_addr, to_addr, amount <span class="keyword">in</span> transactions:</span><br><span class="line">        success, result = channel.create_state_update(from_addr, to_addr, amount)</span><br><span class="line">        <span class="keyword">if</span> success:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"<span class="subst">{from_addr}</span> -&gt; <span class="subst">{to_addr}</span>: <span class="subst">{amount}</span> (成功)"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"<span class="subst">{from_addr}</span> -&gt; <span class="subst">{to_addr}</span>: <span class="subst">{amount}</span> (失败: <span class="subst">{result}</span>)"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. 最终状态"</span>)</span><br><span class="line">    final_info = channel.get_channel_info()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Alice余额: <span class="subst">{final_info[<span class="string">'current_balances'</span>][<span class="string">'Alice'</span>]}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Bob余额: <span class="subst">{final_info[<span class="string">'current_balances'</span>][<span class="string">'Bob'</span>]}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"总交易次数: <span class="subst">{final_info[<span class="string">'total_updates'</span>]}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 关闭通道</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n4. 关闭通道"</span>)</span><br><span class="line">    success, closure = channel.close_channel()</span><br><span class="line">    <span class="keyword">if</span> success:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"通道已关闭"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Alice最终余额: <span class="subst">{closure[<span class="string">'final_balance_a'</span>]}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Bob最终余额: <span class="subst">{closure[<span class="string">'final_balance_b'</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行状态通道演示</span></span><br><span class="line"><span class="comment"># demonstrate_state_channel()</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="六、区块链安全考虑"><a href="#六、区块链安全考虑" class="headerlink" title="六、区块链安全考虑"></a>六、区块链安全考虑</h1><h2 id="（一）常见攻击类型及防护"><a href="#（一）常见攻击类型及防护" class="headerlink" title="（一）常见攻击类型及防护"></a>（一）常见攻击类型及防护</h2><h3 id="1-51-攻击防护"><a href="#1-51-攻击防护" class="headerlink" title="1. 51%攻击防护"></a>1. 51%攻击防护</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AttackDetection</span>:</span><br><span class="line">    <span class="string">"""攻击检测系统"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mining_power_distribution = {}</span><br><span class="line">        <span class="variable language_">self</span>.block_production_history = []</span><br><span class="line">        <span class="variable language_">self</span>.suspicious_activities = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">monitor_mining_power</span>(<span class="params">self, miner_id, hash_rate</span>):</span><br><span class="line">        <span class="string">"""监控挖矿算力"""</span></span><br><span class="line">        <span class="variable language_">self</span>.mining_power_distribution[miner_id] = hash_rate</span><br><span class="line">        </span><br><span class="line">        total_hash_rate = <span class="built_in">sum</span>(<span class="variable language_">self</span>.mining_power_distribution.values())</span><br><span class="line">        miner_percentage = (hash_rate / total_hash_rate) * <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> miner_percentage &gt; <span class="number">45</span>:  <span class="comment"># 接近51%时发出警告</span></span><br><span class="line">            warning = {</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"high_mining_power"</span>,</span><br><span class="line">                <span class="string">"miner_id"</span>: miner_id,</span><br><span class="line">                <span class="string">"percentage"</span>: miner_percentage,</span><br><span class="line">                <span class="string">"timestamp"</span>: datetime.now()</span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">self</span>.suspicious_activities.append(warning)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"警告: 矿工 <span class="subst">{miner_id}</span> 控制了 <span class="subst">{miner_percentage:<span class="number">.1</span>f}</span>% 的算力"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"矿工 <span class="subst">{miner_id}</span> 算力占比: <span class="subst">{miner_percentage:<span class="number">.1</span>f}</span>%"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detect_selfish_mining</span>(<span class="params">self, miner_id, blocks_mined, time_period</span>):</span><br><span class="line">        <span class="string">"""检测自私挖矿"""</span></span><br><span class="line">        expected_blocks = time_period * <span class="number">0.1</span>  <span class="comment"># 假设正常情况下10%的出块率</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> blocks_mined &gt; expected_blocks * <span class="number">2</span>:</span><br><span class="line">            alert = {</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"selfish_mining"</span>,</span><br><span class="line">                <span class="string">"miner_id"</span>: miner_id,</span><br><span class="line">                <span class="string">"blocks_mined"</span>: blocks_mined,</span><br><span class="line">                <span class="string">"expected_blocks"</span>: expected_blocks,</span><br><span class="line">                <span class="string">"timestamp"</span>: datetime.now()</span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">self</span>.suspicious_activities.append(alert)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"可能的自私挖矿: <span class="subst">{miner_id}</span> 在 <span class="subst">{time_period}</span> 时间内挖出 <span class="subst">{blocks_mined}</span> 个区块"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"正常挖矿行为"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_double_spending</span>(<span class="params">self, transaction_history</span>):</span><br><span class="line">        <span class="string">"""检查双花攻击"""</span></span><br><span class="line">        spent_outputs = <span class="built_in">set</span>()</span><br><span class="line">        double_spends = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> tx <span class="keyword">in</span> transaction_history:</span><br><span class="line">            tx_input = <span class="string">f"<span class="subst">{tx.from_addr}</span>_<span class="subst">{tx.amount}</span>_<span class="subst">{tx.timestamp}</span>"</span></span><br><span class="line">            <span class="keyword">if</span> tx_input <span class="keyword">in</span> spent_outputs:</span><br><span class="line">                double_spends.append(tx)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                spent_outputs.add(tx_input)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> double_spends:</span><br><span class="line">            alert = {</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"double_spending"</span>,</span><br><span class="line">                <span class="string">"transactions"</span>: double_spends,</span><br><span class="line">                <span class="string">"timestamp"</span>: datetime.now()</span><br><span class="line">            }</span><br><span class="line">            <span class="variable language_">self</span>.suspicious_activities.append(alert)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f"检测到 <span class="subst">{<span class="built_in">len</span>(double_spends)}</span> 笔双花交易"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"未检测到双花攻击"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_security_report</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""生成安全报告"""</span></span><br><span class="line">        total_hash_rate = <span class="built_in">sum</span>(<span class="variable language_">self</span>.mining_power_distribution.values())</span><br><span class="line">        </span><br><span class="line">        report = {</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now(),</span><br><span class="line">            <span class="string">"total_miners"</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>.mining_power_distribution),</span><br><span class="line">            <span class="string">"total_hash_rate"</span>: total_hash_rate,</span><br><span class="line">            <span class="string">"mining_power_distribution"</span>: {</span><br><span class="line">                miner: (power/total_hash_rate)*<span class="number">100</span> </span><br><span class="line">                <span class="keyword">for</span> miner, power <span class="keyword">in</span> <span class="variable language_">self</span>.mining_power_distribution.items()</span><br><span class="line">            },</span><br><span class="line">            <span class="string">"suspicious_activities"</span>: <span class="built_in">len</span>(<span class="variable language_">self</span>.suspicious_activities),</span><br><span class="line">            <span class="string">"recent_alerts"</span>: <span class="variable language_">self</span>.suspicious_activities[-<span class="number">5</span>:]  <span class="comment"># 最近5个警报</span></span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> report</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全监控演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_security_monitoring</span>():</span><br><span class="line">    <span class="string">"""演示安全监控"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 区块链安全监控演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    detector = AttackDetection()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟矿工算力分布</span></span><br><span class="line">    miners = [</span><br><span class="line">        (<span class="string">"miner_1"</span>, <span class="number">1000</span>),</span><br><span class="line">        (<span class="string">"miner_2"</span>, <span class="number">800</span>),</span><br><span class="line">        (<span class="string">"miner_3"</span>, <span class="number">600</span>),</span><br><span class="line">        (<span class="string">"miner_4"</span>, <span class="number">400</span>),</span><br><span class="line">        (<span class="string">"miner_5"</span>, <span class="number">200</span>)</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 监控挖矿算力分布"</span>)</span><br><span class="line">    <span class="keyword">for</span> miner_id, hash_rate <span class="keyword">in</span> miners:</span><br><span class="line">        result = detector.monitor_mining_power(miner_id, hash_rate)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模拟算力集中</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. 模拟算力集中情况"</span>)</span><br><span class="line">    result = detector.monitor_mining_power(<span class="string">"miner_1"</span>, <span class="number">2000</span>)  <span class="comment"># 大幅增加算力</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测自私挖矿</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. 检测自私挖矿"</span>)</span><br><span class="line">    result = detector.detect_selfish_mining(<span class="string">"miner_1"</span>, <span class="number">15</span>, <span class="number">10</span>)  <span class="comment"># 10个时间单位内挖出15个区块</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成安全报告</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n4. 安全报告"</span>)</span><br><span class="line">    report = detector.get_security_report()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"总矿工数: <span class="subst">{report[<span class="string">'total_miners'</span>]}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"可疑活动数: <span class="subst">{report[<span class="string">'suspicious_activities'</span>]}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n算力分布:"</span>)</span><br><span class="line">    <span class="keyword">for</span> miner, percentage <span class="keyword">in</span> report[<span class="string">'mining_power_distribution'</span>].items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"  <span class="subst">{miner}</span>: <span class="subst">{percentage:<span class="number">.1</span>f}</span>%"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行安全监控演示</span></span><br><span class="line"><span class="comment"># demonstrate_security_monitoring()</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="（二）智能合约安全"><a href="#（二）智能合约安全" class="headerlink" title="（二）智能合约安全"></a>（二）智能合约安全</h2><h3 id="1-重入攻击防护"><a href="#1-重入攻击防护" class="headerlink" title="1. 重入攻击防护"></a>1. 重入攻击防护</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReentrancyGuard</span>:</span><br><span class="line">    <span class="string">"""重入攻击防护"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.locked = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.locked:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"重入攻击检测: 函数正在执行中"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.locked = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="variable language_">self</span>.locked = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecureContract</span>(<span class="title class_ inherited__">SmartContract</span>):</span><br><span class="line">    <span class="string">"""安全智能合约"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, contract_id, creator, participants</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(contract_id, creator, participants)</span><br><span class="line">        <span class="variable language_">self</span>.balances = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">        <span class="variable language_">self</span>.reentrancy_guard = ReentrancyGuard()</span><br><span class="line">        <span class="variable language_">self</span>.withdrawal_limits = defaultdict(<span class="keyword">lambda</span>: {<span class="string">"amount"</span>: <span class="number">0</span>, <span class="string">"last_withdrawal"</span>: datetime.<span class="built_in">min</span>})</span><br><span class="line">        <span class="variable language_">self</span>.daily_limit = <span class="number">1000</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self, user, amount</span>):</span><br><span class="line">        <span class="string">"""安全存款"""</span></span><br><span class="line">        <span class="keyword">if</span> amount &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"存款金额必须大于0"</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.balances[user] += amount</span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">f"<span class="subst">{user}</span> 存款 <span class="subst">{amount}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">f"存款成功: <span class="subst">{amount}</span>"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self, user, amount</span>):</span><br><span class="line">        <span class="string">"""安全提款 - 防重入攻击"""</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.reentrancy_guard:</span><br><span class="line">            <span class="comment"># 检查余额</span></span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.balances[user] &lt; amount:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"余额不足"</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查提款限制</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.check_withdrawal_limit(user, amount):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">"超出每日提款限制"</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 先更新状态，再执行外部调用</span></span><br><span class="line">            <span class="variable language_">self</span>.balances[user] -= amount</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 更新提款记录</span></span><br><span class="line">            today = datetime.now().date()</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.withdrawal_limits[user][<span class="string">"last_withdrawal"</span>].date() != today:</span><br><span class="line">                <span class="variable language_">self</span>.withdrawal_limits[user] = {<span class="string">"amount"</span>: <span class="number">0</span>, <span class="string">"last_withdrawal"</span>: datetime.now()}</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.withdrawal_limits[user][<span class="string">"amount"</span>] += amount</span><br><span class="line">            <span class="variable language_">self</span>.withdrawal_limits[user][<span class="string">"last_withdrawal"</span>] = datetime.now()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 模拟外部调用</span></span><br><span class="line">            <span class="variable language_">self</span>.external_transfer(user, amount)</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.log_event(<span class="string">f"<span class="subst">{user}</span> 提款 <span class="subst">{amount}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>, <span class="string">f"提款成功: <span class="subst">{amount}</span>"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_withdrawal_limit</span>(<span class="params">self, user, amount</span>):</span><br><span class="line">        <span class="string">"""检查提款限制"""</span></span><br><span class="line">        today = datetime.now().date()</span><br><span class="line">        user_limit = <span class="variable language_">self</span>.withdrawal_limits[user]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果是新的一天，重置限制</span></span><br><span class="line">        <span class="keyword">if</span> user_limit[<span class="string">"last_withdrawal"</span>].date() != today:</span><br><span class="line">            <span class="keyword">return</span> amount &lt;= <span class="variable language_">self</span>.daily_limit</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查今日累计提款</span></span><br><span class="line">        total_today = user_limit[<span class="string">"amount"</span>] + amount</span><br><span class="line">        <span class="keyword">return</span> total_today &lt;= <span class="variable language_">self</span>.daily_limit</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">external_transfer</span>(<span class="params">self, user, amount</span>):</span><br><span class="line">        <span class="string">"""模拟外部转账"""</span></span><br><span class="line">        <span class="comment"># 这里模拟可能触发重入攻击的外部调用</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_balance</span>(<span class="params">self, user</span>):</span><br><span class="line">        <span class="string">"""获取余额"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.balances[user]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">emergency_pause</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""紧急暂停"""</span></span><br><span class="line">        <span class="variable language_">self</span>.state = ContractState.CANCELLED</span><br><span class="line">        <span class="variable language_">self</span>.log_event(<span class="string">"合约已紧急暂停"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全合约演示</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demonstrate_secure_contract</span>():</span><br><span class="line">    <span class="string">"""演示安全合约"""</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== 安全智能合约演示 ==="</span>)</span><br><span class="line">    </span><br><span class="line">    contract = SecureContract(<span class="string">"SEC001"</span>, <span class="string">"Admin"</span>, [<span class="string">"Alice"</span>, <span class="string">"Bob"</span>])</span><br><span class="line">    contract.activate()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 正常操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n1. 正常存款和提款"</span>)</span><br><span class="line">    contract.deposit(<span class="string">"Alice"</span>, <span class="number">1500</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Alice余额: <span class="subst">{contract.get_balance(<span class="string">'Alice'</span>)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    success, message = contract.withdraw(<span class="string">"Alice"</span>, <span class="number">500</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"提款结果: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Alice余额: <span class="subst">{contract.get_balance(<span class="string">'Alice'</span>)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试提款限制</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n2. 测试每日提款限制"</span>)</span><br><span class="line">    success, message = contract.withdraw(<span class="string">"Alice"</span>, <span class="number">800</span>)  <span class="comment"># 总计1300，超过1000限制</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"大额提款结果: <span class="subst">{message}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试重入攻击防护</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n3. 测试重入攻击防护"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 模拟重入攻击</span></span><br><span class="line">        <span class="keyword">with</span> contract.reentrancy_guard:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第一层调用"</span>)</span><br><span class="line">            <span class="keyword">with</span> contract.reentrancy_guard:  <span class="comment"># 这会触发重入检测</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"第二层调用 - 不应该执行"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"重入攻击被阻止: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行安全合约演示</span></span><br><span class="line"><span class="comment"># demonstrate_secure_contract()</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="七、区块链发展趋势"><a href="#七、区块链发展趋势" class="headerlink" title="七、区块链发展趋势"></a>七、区块链发展趋势</h1><h2 id="（一）新兴技术方向"><a href="#（一）新兴技术方向" class="headerlink" title="（一）新兴技术方向"></a>（一）新兴技术方向</h2><h3 id="1-跨链技术"><a href="#1-跨链技术" class="headerlink" title="1. 跨链技术"></a>1. 跨链技术</h3><p>跨链技术允许不同区块链网络之间进行资产和信息的交换，主要包括：</p>
<ul>
<li><strong>侧链技术</strong>：通过双向锚定机制实现主链和侧链的资产转移</li>
<li><strong>中继链</strong>：作为多条区块链的桥梁，协调跨链交易</li>
<li><strong>原子交换</strong>：无需第三方的点对点跨链交易</li>
<li><strong>跨链桥</strong>：连接不同区块链生态系统的基础设施</li>
</ul>
<h3 id="2-量子抗性"><a href="#2-量子抗性" class="headerlink" title="2. 量子抗性"></a>2. 量子抗性</h3><p>随着量子计算的发展，传统密码学面临挑战：</p>
<ul>
<li><strong>后量子密码学</strong>：开发抗量子攻击的加密算法</li>
<li><strong>量子密钥分发</strong>：利用量子物理原理确保通信安全</li>
<li><strong>混合加密方案</strong>：结合传统和量子抗性算法</li>
</ul>
<h3 id="3-绿色区块链"><a href="#3-绿色区块链" class="headerlink" title="3. 绿色区块链"></a>3. 绿色区块链</h3><p>环保和可持续发展成为重要考虑因素：</p>
<ul>
<li><strong>权益证明机制</strong>：大幅降低能耗</li>
<li><strong>碳中和区块链</strong>：通过碳抵消实现环保目标</li>
<li><strong>可再生能源挖矿</strong>：使用清洁能源进行区块链操作</li>
</ul>
<h2 id="（二）应用前景展望"><a href="#（二）应用前景展望" class="headerlink" title="（二）应用前景展望"></a>（二）应用前景展望</h2><h3 id="1-Web3-0时代"><a href="#1-Web3-0时代" class="headerlink" title="1. Web3.0时代"></a>1. Web3.0时代</h3><ul>
<li><strong>去中心化身份</strong>：用户完全控制自己的数字身份</li>
<li><strong>去中心化存储</strong>：分布式文件存储系统</li>
<li><strong>去中心化计算</strong>：分布式计算资源共享</li>
<li><strong>DAO治理</strong>：去中心化自治组织管理</li>
</ul>
<h3 id="2-元宇宙基础设施"><a href="#2-元宇宙基础设施" class="headerlink" title="2. 元宇宙基础设施"></a>2. 元宇宙基础设施</h3><ul>
<li><strong>虚拟资产确权</strong>：NFT技术确保虚拟物品所有权</li>
<li><strong>跨平台互操作</strong>：不同元宇宙平台间的资产流通</li>
<li><strong>去中心化虚拟经济</strong>：基于区块链的虚拟世界经济系统</li>
</ul>
<h3 id="3-央行数字货币-CBDC"><a href="#3-央行数字货币-CBDC" class="headerlink" title="3. 央行数字货币(CBDC)"></a>3. 央行数字货币(CBDC)</h3><ul>
<li><strong>数字法币</strong>：政府发行的数字化法定货币</li>
<li><strong>可编程货币</strong>：具备智能合约功能的数字货币</li>
<li><strong>跨境支付</strong>：简化国际贸易和汇款流程</li>
</ul>
<h1 id="八、学习建议与实践指南"><a href="#八、学习建议与实践指南" class="headerlink" title="八、学习建议与实践指南"></a>八、学习建议与实践指南</h1><h2 id="（一）技术学习路径"><a href="#（一）技术学习路径" class="headerlink" title="（一）技术学习路径"></a>（一）技术学习路径</h2><h3 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h3><ul>
<li>密码学基础（哈希函数、数字签名、非对称加密）</li>
<li>分布式系统原理</li>
<li>网络协议和P2P网络</li>
<li>数据结构和算法</li>
</ul>
<h3 id="2-区块链核心技术"><a href="#2-区块链核心技术" class="headerlink" title="2. 区块链核心技术"></a>2. 区块链核心技术</h3><ul>
<li>共识机制深入理解</li>
<li>智能合约开发</li>
<li>区块链网络架构</li>
<li>性能优化技术</li>
</ul>
<h3 id="3-开发实践"><a href="#3-开发实践" class="headerlink" title="3. 开发实践"></a>3. 开发实践</h3><ul>
<li>选择合适的区块链平台（Ethereum、Hyperledger等）</li>
<li>学习智能合约语言（Solidity、Rust等）</li>
<li>掌握开发工具和框架</li>
<li>参与开源项目</li>
</ul>
<h2 id="（二）实际项目建议"><a href="#（二）实际项目建议" class="headerlink" title="（二）实际项目建议"></a>（二）实际项目建议</h2><h3 id="1-初级项目"><a href="#1-初级项目" class="headerlink" title="1. 初级项目"></a>1. 初级项目</h3><ul>
<li>简单的数字货币实现</li>
<li>基础投票系统</li>
<li>简单的供应链追溯</li>
</ul>
<h3 id="2-中级项目"><a href="#2-中级项目" class="headerlink" title="2. 中级项目"></a>2. 中级项目</h3><ul>
<li>去中心化交易所(DEX)</li>
<li>NFT市场平台</li>
<li>去中心化借贷协议</li>
</ul>
<h3 id="3-高级项目"><a href="#3-高级项目" class="headerlink" title="3. 高级项目"></a>3. 高级项目</h3><ul>
<li>跨链桥开发</li>
<li>Layer 2扩容方案</li>
<li>复杂的DeFi协议</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>区块链技术作为一项革命性的创新，正在深刻改变着我们的数字世界。从比特币的诞生到如今丰富多样的区块链应用生态，这项技术展现出了巨大的潜力和价值。</p>
<h2 id="核心价值"><a href="#核心价值" class="headerlink" title="核心价值"></a>核心价值</h2><ol>
<li><strong>去中心化</strong>：消除单点故障，提高系统韧性</li>
<li><strong>透明性</strong>：所有交易公开可验证，增强信任</li>
<li><strong>不可篡改</strong>：密码学保证数据完整性</li>
<li><strong>可编程性</strong>：智能合约实现自动化执行</li>
<li><strong>全球化</strong>：无国界的价值传输网络</li>
</ol>
<h2 id="技术挑战"><a href="#技术挑战" class="headerlink" title="技术挑战"></a>技术挑战</h2><ol>
<li><strong>可扩展性</strong>：交易吞吐量和确认时间的平衡</li>
<li><strong>能耗问题</strong>：工作量证明机制的环境影响</li>
<li><strong>用户体验</strong>：复杂的技术门槛和操作流程</li>
<li><strong>监管合规</strong>：法律法规的不确定性</li>
<li><strong>安全风险</strong>：智能合约漏洞和攻击威胁</li>
</ol>
<h2 id="发展机遇"><a href="#发展机遇" class="headerlink" title="发展机遇"></a>发展机遇</h2><ol>
<li><strong>金融创新</strong>：DeFi重塑传统金融服务</li>
<li><strong>数字经济</strong>：NFT和元宇宙创造新的价值形式</li>
<li><strong>供应链优化</strong>：提高透明度和可追溯性</li>
<li><strong>身份认证</strong>：去中心化身份管理</li>
<li><strong>社会治理</strong>：DAO探索新的组织形式</li>
</ol>
<h2 id="未来展望"><a href="#未来展望" class="headerlink" title="未来展望"></a>未来展望</h2><p>区块链技术仍处于快速发展阶段，随着技术的不断成熟和应用场景的拓展，我们可以期待：</p>
<ul>
<li><strong>技术融合</strong>：与AI、IoT、5G等技术深度结合</li>
<li><strong>标准化</strong>：行业标准和协议的统一</li>
<li><strong>普及应用</strong>：更多传统行业的数字化转型</li>
<li><strong>监管完善</strong>：更加明确和友好的法律环境</li>
<li><strong>生态繁荣</strong>：更加丰富和成熟的应用生态</li>
</ul>
<p>作为一项颠覆性技术，区块链不仅仅是技术创新，更是思维方式和商业模式的革命。无论是开发者、投资者还是普通用户，都应该持续关注和学习这项技术，在数字化浪潮中把握机遇，迎接挑战。</p>
<p>区块链的未来充满无限可能，让我们共同见证和参与这场技术革命的进程！</p>
<hr>
<p><em>本文涵盖了区块链技术的核心概念、技术原理、应用实践和发展趋势。通过理论学习和代码实践相结合的方式，希望能够帮助读者深入理解区块链技术，为进一步的学习和应用打下坚实基础。</em></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://hexo.blog.uwakeme.tech/about/">Wake</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://hexo.blog.uwakeme.tech/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/">https://hexo.blog.uwakeme.tech/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://hexo.blog.uwakeme.tech" target="_blank">Uwakeme</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">分布式系统</a><a class="post-meta__tags" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a><a class="post-meta__tags" href="/tags/%E5%8A%A0%E5%AF%86%E6%8A%80%E6%9C%AF/">加密技术</a><a class="post-meta__tags" href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/">智能合约</a><a class="post-meta__tags" href="/tags/%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96/">去中心化</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/reward/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/reward/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E6%9C%89%E5%85%B3token%E7%9A%84%E4%B8%80%E5%88%87/" title="【学习】有关token的一切"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">【学习】有关token的一切</div></div><div class="info-2"><div class="info-item-1">一、token概述（一）什么是token？1、 在web领域 token翻译过来就是令牌的意思。 token是由服务器生成的一串字符串，在第一次登录成功后返回给前端，保存在浏览器或本地，在之后的请求中都会带上以供服务器校验。  2、 在人工智能领域 在人工智能领域，尤其是自然语言处理(Natural Language Processing, NLP)中，token指的是处理文本的最小单元或基本元素。 需要注意的是，token并不一定是一个字符，它可以是一个字符，一个词语，一个标点符号，比如： 英文单词：”hello”, “world” 中文字符：”你”, “好” 标点符号：”.”, “!” 特殊标记：”[CLS]”, “[SEP]”   在大型语言模型（如GPT、BERT等）中，token是模型处理和生成文本的基本单位，也是计算模型容量和处理速度的基本单位。  （二）token的分类在Web应用中，token主要可以分为以下几类： 1. 会话Token（Session Token） 传统的会话管理方式，服务器生成一个唯一标识符并存储在服务器的会话存储中。 客户端通过Cookie或...</div></div></div></a><a class="pagination-related" href="/2026/01/15/%E5%AD%A6%E4%B9%A0/%E3%80%90%E5%AD%A6%E4%B9%A0%E3%80%91%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%86%E7%89%87%E4%B8%8A%E4%BC%A0%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" title="【学习】大文件分片上传技术详解"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【学习】大文件分片上传技术详解</div></div><div class="info-2"><div class="info-item-1">前言在日常的Web应用中，文件上传是一个非常常见的功能。对于小文件，传统的表单提交或Ajax异步上传方式尚能应付。但当涉及到G级别甚至更大的文件时，一次性将整个文件内容发送到服务器会面临诸多挑战，例如：上传时间过长导致HTTP请求超时、网络波动导致上传失败需要从头开始、服务器内存和带宽压力过大等。为了解决这些问题，大文件分片上传技术应运而生。本文将详细介绍分片上传的原理、实现方案以及相关的优化策略。 一、什么是分片上传？分片上传，顾名思义，就是将一个大文件分割成若干个较小的数据块（称为”分片”或”chunk”），然后将这些分片独立地、逐个或并发地上传到服务器。当所有分片都成功上传后，服务器再将这些分片按照原始顺序合并成完整的文件。 （一）分片上传的优势采用分片上传技术可以带来诸多好处：  提高上传成功率：网络环境复杂多变，大文件一次性上传很容易因网络抖动、超时等原因失败。分片上传将大任务分解为小任务，单个分片上传失败后，只需重新上传该分片，而无需重传整个文件，大大提高了成功率。 支持断点续传：可以记录已成功上传的分片信息。即使用户关闭浏览器或网络中断，下次上传时可以从上一次中断的...</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Wake</div><div class="author-info-description">一起学习，一起进步</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">252</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">688</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/uwakeme"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/uwakeme" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wakemeup2025@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！这里分享技术知识、学习心得和生活感悟。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-text">一、区块链基础概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E4%BB%80%E4%B9%88%E6%98%AF%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="toc-text">（一）什么是区块链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E7%89%B9%E5%BE%81"><span class="toc-text">1. 核心特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-text">2. 区块链的基本结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">（二）区块链的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8C%89%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E5%88%86%E7%B1%BB"><span class="toc-text">1. 按访问权限分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%8C%89%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E5%88%86%E7%B1%BB"><span class="toc-text">2. 按技术架构分类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="toc-text">二、区块链核心技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80"><span class="toc-text">（一）密码学基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0"><span class="toc-text">1. 哈希函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D"><span class="toc-text">2. 数字签名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">（二）共识机制详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E-Proof-of-Work"><span class="toc-text">1. 工作量证明 (Proof of Work)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9D%83%E7%9B%8A%E8%AF%81%E6%98%8E-Proof-of-Stake"><span class="toc-text">2. 权益证明 (Proof of Stake)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%8A%80%E6%9C%AF"><span class="toc-text">三、智能合约技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%9F%BA%E7%A1%80"><span class="toc-text">（一）智能合约基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%9E%E7%8E%B0"><span class="toc-text">1. 简单智能合约实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E8%87%AA%E6%B2%BB%E7%BB%84%E7%BB%87-DAO-%E5%90%88%E7%BA%A6"><span class="toc-text">2. 去中心化自治组织 (DAO) 合约</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">四、区块链应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E5%AD%97%E8%B4%A7%E5%B8%81%E7%B3%BB%E7%BB%9F"><span class="toc-text">（一）数字货币系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BE%9B%E5%BA%94%E9%93%BE%E7%AE%A1%E7%90%86"><span class="toc-text">（二）供应链管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5"><span class="toc-text">五、区块链开发实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E5%8D%95%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0"><span class="toc-text">（一）简单区块链网络实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">（二）性能优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%86%E7%89%87%E6%8A%80%E6%9C%AF"><span class="toc-text">1. 分片技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%8A%B6%E6%80%81%E9%80%9A%E9%81%93"><span class="toc-text">2. 状态通道</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91"><span class="toc-text">六、区块链安全考虑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E7%B1%BB%E5%9E%8B%E5%8F%8A%E9%98%B2%E6%8A%A4"><span class="toc-text">（一）常见攻击类型及防护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-51-%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4"><span class="toc-text">1. 51%攻击防护</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8"><span class="toc-text">（二）智能合约安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4"><span class="toc-text">1. 重入攻击防护</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8C%BA%E5%9D%97%E9%93%BE%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF"><span class="toc-text">七、区块链发展趋势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%96%B0%E5%85%B4%E6%8A%80%E6%9C%AF%E6%96%B9%E5%90%91"><span class="toc-text">（一）新兴技术方向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B7%A8%E9%93%BE%E6%8A%80%E6%9C%AF"><span class="toc-text">1. 跨链技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%87%8F%E5%AD%90%E6%8A%97%E6%80%A7"><span class="toc-text">2. 量子抗性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BB%BF%E8%89%B2%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="toc-text">3. 绿色区块链</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BA%94%E7%94%A8%E5%89%8D%E6%99%AF%E5%B1%95%E6%9C%9B"><span class="toc-text">（二）应用前景展望</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Web3-0%E6%97%B6%E4%BB%A3"><span class="toc-text">1. Web3.0时代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%83%E5%AE%87%E5%AE%99%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD"><span class="toc-text">2. 元宇宙基础设施</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A4%AE%E8%A1%8C%E6%95%B0%E5%AD%97%E8%B4%A7%E5%B8%81-CBDC"><span class="toc-text">3. 央行数字货币(CBDC)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE%E4%B8%8E%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97"><span class="toc-text">八、学习建议与实践指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-text">（一）技术学习路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">1. 基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="toc-text">2. 区块链核心技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5"><span class="toc-text">3. 开发实践</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E5%BB%BA%E8%AE%AE"><span class="toc-text">（二）实际项目建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9D%E7%BA%A7%E9%A1%B9%E7%9B%AE"><span class="toc-text">1. 初级项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%AD%E7%BA%A7%E9%A1%B9%E7%9B%AE"><span class="toc-text">2. 中级项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%AB%98%E7%BA%A7%E9%A1%B9%E7%9B%AE"><span class="toc-text">3. 高级项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%B7%E5%80%BC"><span class="toc-text">核心价值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98"><span class="toc-text">技术挑战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B1%95%E6%9C%BA%E9%81%87"><span class="toc-text">发展机遇</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B"><span class="toc-text">未来展望</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/13/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%9AKMP%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="【算法】字符串匹配算法深入解析：KMP算法原理与实现"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】字符串匹配算法深入解析：KMP算法原理与实现"></a><div class="content"><a class="title" href="/2026/02/13/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%EF%BC%9AKMP%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="【算法】字符串匹配算法深入解析：KMP算法原理与实现">【算法】字符串匹配算法深入解析：KMP算法原理与实现</a><time datetime="2026-02-13T09:06:00.000Z" title="发表于 2026-02-13 17:06:00">2026-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/22/BUG/%E3%80%90BUG%E3%80%91Claude%20Code%E8%B7%B3%E8%BF%87%E5%BC%BA%E5%88%B6%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="【BUG】Claude Code跳过强制登录解决方法"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://raw.githubusercontent.com/uwakeme/personal-image-repository/master/images/20260122114551679.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【BUG】Claude Code跳过强制登录解决方法"></a><div class="content"><a class="title" href="/2026/01/22/BUG/%E3%80%90BUG%E3%80%91Claude%20Code%E8%B7%B3%E8%BF%87%E5%BC%BA%E5%88%B6%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="【BUG】Claude Code跳过强制登录解决方法">【BUG】Claude Code跳过强制登录解决方法</a><time datetime="2026-01-22T03:45:00.000Z" title="发表于 2026-01-22 11:45:00">2026-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%88%86%E8%80%8C%E6%B2%BB%E4%B9%8B%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" title="【算法】《算法图解》第四章学习笔记：分而治之与快速排序"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】《算法图解》第四章学习笔记：分而治之与快速排序"></a><div class="content"><a class="title" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%9B%9B%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%88%86%E8%80%8C%E6%B2%BB%E4%B9%8B%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" title="【算法】《算法图解》第四章学习笔记：分而治之与快速排序">【算法】《算法图解》第四章学习笔记：分而治之与快速排序</a><time datetime="2026-01-15T08:48:25.264Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95/" title="【算法】《算法图解》第十章学习笔记：贪婪算法"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】《算法图解》第十章学习笔记：贪婪算法"></a><div class="content"><a class="title" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95/" title="【算法】《算法图解》第十章学习笔记：贪婪算法">【算法】《算法图解》第十章学习笔记：贪婪算法</a><time datetime="2026-01-15T08:48:25.264Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%A6%82%E4%BD%95%E5%81%9A/" title="【算法】《算法图解》第十三章学习笔记：接下来如何做"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【算法】《算法图解》第十三章学习笔记：接下来如何做"></a><div class="content"><a class="title" href="/2026/01/15/%E7%AE%97%E6%B3%95/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E3%80%8A%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3%E3%80%8B%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%A6%82%E4%BD%95%E5%81%9A/" title="【算法】《算法图解》第十三章学习笔记：接下来如何做">【算法】《算法图解》第十三章学习笔记：接下来如何做</a><time datetime="2026-01-15T08:48:25.263Z" title="发表于 2026-01-15 16:48:25">2026-01-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">©2024 - 2026 By Wake</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.8.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23liBiL0mPM9ywqcV3',
      clientSecret: '99811bbc42de51338a2ef755501651c968f3240c',
      repo: 'gitalk-pool',
      owner: 'uwakeme',
      admin: ['uwakeme'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || '5331cd0eefa5484ec3f726e81090e449'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-nest.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="请输入搜索内容" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.4.2/source/js/search/local-search.min.js"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script src="/bundle.js"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});;

            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        ;
window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});;
(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>